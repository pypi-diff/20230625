# Comparing `tmp/pyperspace-0.1.8-py3-none-any.whl.zip` & `tmp/pyperspace-0.1.9-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,12 +1,12 @@
-Zip file size: 53149 bytes, number of entries: 54
+Zip file size: 53116 bytes, number of entries: 54
 -rw-r--r--  2.0 unx       22 b- defN 22-Jul-27 00:53 pyperspace/__init__.py
 -rw-r--r--  2.0 unx     1167 b- defN 22-Aug-20 16:44 pyperspace/__main__.py
 -rw-r--r--  2.0 unx     2175 b- defN 22-Aug-22 02:10 pyperspace/config.py
--rw-r--r--  2.0 unx     4469 b- defN 22-Aug-24 22:15 pyperspace/rest_api.py
+-rw-r--r--  2.0 unx     4469 b- defN 22-Aug-25 22:26 pyperspace/rest_api.py
 -rw-r--r--  2.0 unx      150 b- defN 22-Aug-20 16:48 pyperspace/daemon/__init__.py
 -rw-r--r--  2.0 unx     1693 b- defN 22-Aug-22 02:09 pyperspace/daemon/daemon.py
 -rw-r--r--  2.0 unx     1723 b- defN 22-Aug-06 12:51 pyperspace/daemon/dataset.py
 -rw-r--r--  2.0 unx      198 b- defN 22-Jul-27 00:05 pyperspace/data/__init__.py
 -rw-r--r--  2.0 unx       99 b- defN 22-Apr-06 23:01 pyperspace/data/count.py
 -rw-r--r--  2.0 unx     2703 b- defN 22-Aug-06 13:03 pyperspace/data/entry.py
 -rw-r--r--  2.0 unx     3097 b- defN 22-Aug-05 23:10 pyperspace/data/interval.py
@@ -28,29 +28,29 @@
 -rw-r--r--  2.0 unx    21947 b- defN 22-Apr-10 23:36 pyperspace/protocol/node_pb2.py
 -rw-r--r--  2.0 unx       27 b- defN 22-Apr-02 12:53 pyperspace/protocol/storage.py
 -rw-r--r--  2.0 unx    42025 b- defN 22-Aug-06 02:23 pyperspace/protocol/storage_pb2.py
 -rw-r--r--  2.0 unx      254 b- defN 22-Jul-27 00:53 pyperspace/storage/__init__.py
 -rw-r--r--  2.0 unx      491 b- defN 22-Jul-27 00:53 pyperspace/storage/convert.py
 -rw-r--r--  2.0 unx     4265 b- defN 22-Aug-21 19:14 pyperspace/storage/dataset.py
 -rw-r--r--  2.0 unx     1787 b- defN 22-Aug-02 00:26 pyperspace/storage/deletion.py
--rw-r--r--  2.0 unx     9390 b- defN 22-Aug-24 22:14 pyperspace/storage/lsm.py
+-rw-r--r--  2.0 unx     8830 b- defN 22-Aug-25 21:21 pyperspace/storage/lsm.py
 -rw-r--r--  2.0 unx     2302 b- defN 22-Aug-06 12:46 pyperspace/storage/lsm_dataset.py
 -rw-r--r--  2.0 unx     2034 b- defN 22-Aug-22 20:38 pyperspace/storage/memtable.py
 -rw-r--r--  2.0 unx      178 b- defN 22-Apr-06 23:00 pyperspace/storage/select.py
 -rw-r--r--  2.0 unx     6601 b- defN 22-Aug-18 14:25 pyperspace/storage/storage_mgr.py
 -rw-r--r--  2.0 unx      132 b- defN 22-May-04 22:59 pyperspace/workers/__init__.py
--rw-r--r--  2.0 unx    25447 b- defN 22-Aug-22 02:18 pyperspace/workers/dataset.py
+-rw-r--r--  2.0 unx    25677 b- defN 22-Aug-25 21:26 pyperspace/workers/dataset.py
 -rw-r--r--  2.0 unx    21752 b- defN 22-Aug-24 22:15 pyperspace/workers/storage.py
--rw-r--r--  2.0 unx     2929 b- defN 22-Aug-25 00:00 pyperspace-0.1.8.data/data/config/sample.yaml
+-rw-r--r--  2.0 unx     2929 b- defN 22-Aug-25 00:00 pyperspace-0.1.9.data/data/config/sample.yaml
 -rw-r--r--  2.0 unx        0 b- defN 22-Feb-08 14:41 tools/__init__.py
 -rw-r--r--  2.0 unx      898 b- defN 22-Jul-27 00:53 tools/lsm_check.py
 -rw-r--r--  2.0 unx      278 b- defN 22-Jul-27 00:53 tools/lsm_merge.py
 -rw-r--r--  2.0 unx      464 b- defN 22-Jul-27 00:53 tools/lsm_reader.py
 -rw-r--r--  2.0 unx      188 b- defN 22-Feb-08 14:42 tools/lsm_stat.py
 -rw-r--r--  2.0 unx      460 b- defN 22-Mar-20 23:21 tools/wal2lsm.py
 -rw-r--r--  2.0 unx      666 b- defN 22-Aug-17 20:58 tools/wal_reader.py
--rw-r--r--  2.0 unx     1535 b- defN 22-Aug-25 00:01 pyperspace-0.1.8.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 22-Aug-25 00:01 pyperspace-0.1.8.dist-info/WHEEL
--rw-r--r--  2.0 unx      254 b- defN 22-Aug-25 00:01 pyperspace-0.1.8.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       17 b- defN 22-Aug-25 00:01 pyperspace-0.1.8.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     4463 b- defN 22-Aug-25 00:01 pyperspace-0.1.8.dist-info/RECORD
-54 files, 226898 bytes uncompressed, 46085 bytes compressed:  79.7%
+-rw-r--r--  2.0 unx     1535 b- defN 22-Aug-25 22:28 pyperspace-0.1.9.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 22-Aug-25 22:28 pyperspace-0.1.9.dist-info/WHEEL
+-rw-r--r--  2.0 unx      254 b- defN 22-Aug-25 22:28 pyperspace-0.1.9.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       17 b- defN 22-Aug-25 22:28 pyperspace-0.1.9.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     4463 b- defN 22-Aug-25 22:28 pyperspace-0.1.9.dist-info/RECORD
+54 files, 226568 bytes uncompressed, 46052 bytes compressed:  79.7%
```

## zipnote {}

```diff
@@ -117,15 +117,15 @@
 
 Filename: pyperspace/workers/dataset.py
 Comment: 
 
 Filename: pyperspace/workers/storage.py
 Comment: 
 
-Filename: pyperspace-0.1.8.data/data/config/sample.yaml
+Filename: pyperspace-0.1.9.data/data/config/sample.yaml
 Comment: 
 
 Filename: tools/__init__.py
 Comment: 
 
 Filename: tools/lsm_check.py
 Comment: 
@@ -141,23 +141,23 @@
 
 Filename: tools/wal2lsm.py
 Comment: 
 
 Filename: tools/wal_reader.py
 Comment: 
 
-Filename: pyperspace-0.1.8.dist-info/METADATA
+Filename: pyperspace-0.1.9.dist-info/METADATA
 Comment: 
 
-Filename: pyperspace-0.1.8.dist-info/WHEEL
+Filename: pyperspace-0.1.9.dist-info/WHEEL
 Comment: 
 
-Filename: pyperspace-0.1.8.dist-info/entry_points.txt
+Filename: pyperspace-0.1.9.dist-info/entry_points.txt
 Comment: 
 
-Filename: pyperspace-0.1.8.dist-info/top_level.txt
+Filename: pyperspace-0.1.9.dist-info/top_level.txt
 Comment: 
 
-Filename: pyperspace-0.1.8.dist-info/RECORD
+Filename: pyperspace-0.1.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## pyperspace/rest_api.py

```diff
@@ -20,15 +20,15 @@
     return datetime.fromtimestamp(ns / 1000000000)
 
 class DataEntry(BaseModel):
     time: Union[int, datetime]
     data: bytes
 
 def generate_api(cfg: Config) -> FastAPI:
-    app = FastAPI(title="Pyperspace Frontend", version="0.1.8", docs_url="/")
+    app = FastAPI(title="Pyperspace Frontend", version="0.1.9", docs_url="/")
     db = Daemon(cfg.data_dir, cfg.datasets, cfg.storage)
 
     @app.on_event("startup")
     async def startup():
         LOG.info("starting daemon...")
         db.start()
```

## pyperspace/storage/lsm.py

```diff
@@ -51,57 +51,41 @@
 
     def find_all(self) -> Iterable[Entry]:
         return self._iter_from_offset(self._entry_start_offset, 0, self._header.num_entries-1)
 
     def find_range(self, begin_time: int, end_time: int) -> Iterable[Entry]:
         if begin_time <= self.header.end_time:
             # TODO: use LSMIndexListView wrapper
-            offset, begin_idx = self._find_index_offset_upper(begin_time)
-            _, end_idx = self._find_index_offset_lower(end_time)
-            yield from self._iter_from_offset(offset, begin_idx, end_idx)
+            offset, begin_idx = self._find_index_offset(begin_time)
+            _, end_idx = self._find_index_offset(end_time)
+            yield from self._iter_from_offset(offset, begin_idx, end_idx-1)
 
     @property
     def header(self) -> LSMFileHeader:
         return self._header
 
     def _read_header(self) -> None:
         data = self._pread(_lsm_header.size, 0)
         self._header = LSMFileHeader(*_lsm_header.unpack(data))
 
-    def _find_index_offset_lower(self, time: int) -> Tuple[int, int]:
+    def _find_index_offset(self, time: int) -> Tuple[int, int]:
         idx_start = _lsm_header.size
         lo = 0
         hi = self.header.num_entries
         f_offset = None
         _pread = self._pread
         while lo != hi:
             mid = (lo+hi)//2
             data = _pread(_index_header_size, (idx_start + (_index_header_size*mid)))
             i_time, f_offset = _unpack_index_header(data)
             if i_time > time:
                 hi = mid
             else:
                 lo = mid+1
-        return f_offset, mid
-    
-    def _find_index_offset_upper(self, time: int) -> Tuple[int, int]:
-        idx_start = _lsm_header.size
-        lo = 0
-        hi = self.header.num_entries
-        f_offset = None
-        _pread = self._pread
-        while lo != hi:
-            mid = (lo+hi)//2
-            data = _pread(_index_header_size, (idx_start + (_index_header_size*mid)))
-            i_time, f_offset = _unpack_index_header(data)
-            if i_time > time:
-                hi = mid-1
-            else:
-                lo = mid
-        return f_offset, mid
+        return f_offset, lo
 
 
 class LSMFileWriter:
     """
     LSM File Format
     ---------------
       0x00  -- Header (size information)
```

## pyperspace/workers/dataset.py

```diff
@@ -137,24 +137,31 @@
                     name = fd.readline().strip()
                     self._mqueues[name] = MessageQueue(self._sockets[node_id], name, self._insert_buf_size, self._insert_ack, self._insert_flush)
 
     @property
     def names(self) -> List[str]:
         return list(self._mqueues.keys())
 
-    def __getitem__(self, name: str) -> MessageQueue:
+    def create(self, name: str) -> None:
         _mqueues = self._mqueues
         mq = _mqueues.get(name)
+        if mq is not None:
+            raise KeyError(f"dataset \"{name}\" already exists")
+        _sockets = self._sockets
+        _next = self._next
+        sock = _sockets[_next]
+        self._next = (_next + 1) % len(_sockets)
+        mq = MessageQueue(sock, name, self._insert_buf_size, self._insert_ack, self._insert_flush)
+        _mqueues[name] = mq
+        mq.send_create()
+
+    def __getitem__(self, name: str) -> MessageQueue:
+        mq = self._mqueues.get(name)
         if mq is None:
-            _sockets = self._sockets
-            _next = self._next
-            sock = _sockets[_next]
-            self._next = (_next + 1) % len(_sockets)
-            mq = MessageQueue(sock, name, self._insert_buf_size, self._insert_ack, self._insert_flush)
-            _mqueues[name] = mq
+            raise KeyError(f"dataset \"{name}\" does not exist")
         return mq
 
     def drop(self, name: str) -> None:
         mq = self._mqueues.get(name)
         if mq is None:
             raise KeyError(f"dataset \"{name}\" does not exist")
         mq.send_drop()
@@ -564,14 +571,14 @@
     def send_select_all(self, name: str) -> Iterable[RawEntry]:
         return self._dsmap[name].send_select_all()
     
     def send_delete(self, name: str, begin_time: int, end_time: int) -> None:
         self._dsmap[name].send_delete(begin_time, end_time)
     
     def send_create(self, name: str) -> None:
-        self._dsmap[name].send_create()
+        self._dsmap.create(name)
     
     def send_drop(self, name: str) -> None:
         self._dsmap.drop(name)
     
     def send_stats_request(self, name: str) -> Tuple[int, int, int]:
         return self._dsmap[name].send_stats_request()
```

## Comparing `pyperspace-0.1.8.data/data/config/sample.yaml` & `pyperspace-0.1.9.data/data/config/sample.yaml`

 * *Files identical despite different names*

## Comparing `pyperspace-0.1.8.dist-info/METADATA` & `pyperspace-0.1.9.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: pyperspace
-Version: 0.1.8
+Version: 0.1.9
 Summary: Time series database server
 Home-page: https://www.nuradius.com
 Author: Nuradius Software
 Author-email: todd@datacomponents.net
 License: Apache Software License
 Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
```

## Comparing `pyperspace-0.1.8.dist-info/RECORD` & `pyperspace-0.1.9.dist-info/RECORD`

 * *Files 4% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 pyperspace/__init__.py,sha256=YdgcuXlh65W8a60JhCTiCkAdSorwT9DNopOYgELx3JY,22
 pyperspace/__main__.py,sha256=swkeo8_nRbt7S_jL_QMmL2a_zn-sHS6McjQ7I0OqlFI,1167
 pyperspace/config.py,sha256=juucEZa7R4fL8e2d4MJ6UEeAqBpYteARZUX7jNQmLKE,2175
-pyperspace/rest_api.py,sha256=rRMnMpQZnuwgvYPS0s_EkjrEAVsxNL4t1CbisZHDpn8,4469
+pyperspace/rest_api.py,sha256=3J7p2mKPqCLLIKLJmW74TQFxf2itWtqyNsKtGHjJNlw,4469
 pyperspace/daemon/__init__.py,sha256=fpI0HKUNe6Ymk_qsPECbr7PVYDfi9bqKQkIajBMB8B8,150
 pyperspace/daemon/daemon.py,sha256=wyksVM52R8_tuCMaKxCuXB-ys6-gQVVByE9ZJyZmzBQ,1693
 pyperspace/daemon/dataset.py,sha256=td5MIslg_JThDvoQN6qIwWRtaRDinBC6FaLb7fMczxI,1723
 pyperspace/data/__init__.py,sha256=OdNNMO4NLMixCNOtXOhizxExcN8Z-fr7_xj1Iq62SnU,198
 pyperspace/data/count.py,sha256=w3YD7cODjnI8ENbxF6nmFULLkG3Cn6XjAEiyB381dMg,99
 pyperspace/data/entry.py,sha256=xD2lDe27LxLRkyD_Dqilp9qR1ygUjplZqNLl1ac8chs,2703
 pyperspace/data/interval.py,sha256=8YwSEgUonWAodsyFw0woKzZP9CkSV5IKmT2WoZLRJ78,3097
@@ -27,28 +27,28 @@
 pyperspace/protocol/node_pb2.py,sha256=B6lxnDMOSSISpdO-nGX_--8ohbuKDh0tLIuqVMyMJCo,21947
 pyperspace/protocol/storage.py,sha256=YjG_ZF8HR4_A9OqwHHbqQrD2tFyLYllyK9NadSG2zL4,27
 pyperspace/protocol/storage_pb2.py,sha256=NCHNvSepKJd7qNO0rJ5YvmzUlFNMg5pBgssBNMBeNa0,42025
 pyperspace/storage/__init__.py,sha256=5fbQS6aLeBnSnyJI6TiJLhUCKmY1jQeCThXliAm5kFQ,254
 pyperspace/storage/convert.py,sha256=sqmlDPBFwQ4lD8pe67mMZMc48HJ4VmSMda3cDUaQ2J8,491
 pyperspace/storage/dataset.py,sha256=2SDg5oL_Y1pmT689hV2VJntYturZkhJBcp4QqP77dRw,4265
 pyperspace/storage/deletion.py,sha256=j5bEesRYtO0Rv1t7CLzlkrZydvLqwaER97XAxCqMEBE,1787
-pyperspace/storage/lsm.py,sha256=2Psgq7eOFQHyhv7EteNiCyvTgHLMROfyE9dWV0C711U,9390
+pyperspace/storage/lsm.py,sha256=nf2jkOQE2vzGwDjpByV45EvVei7Gxy-N3NTpYJL7jys,8830
 pyperspace/storage/lsm_dataset.py,sha256=ls4RjZBRGzuo5zXBod6yby3ju3XVXqikMWEusf7i-ME,2302
 pyperspace/storage/memtable.py,sha256=PSkUemCO1h2aw1z0pUBaVYAVHiFPdTTbfYRTxSkjoRg,2034
 pyperspace/storage/select.py,sha256=Xc1aFW0E_g6BcS0NfcE5_f9QX1k5QIsi6-hlaR1W7Vs,178
 pyperspace/storage/storage_mgr.py,sha256=qnMUt9c1PXnXYkGJiZ_H5w-ePW3J0Xi1rFki9SlDDHk,6601
 pyperspace/workers/__init__.py,sha256=y0k2ZoPY2q3jruRhtBTTImfDeunMz4CwzKjRlnEyd_o,132
-pyperspace/workers/dataset.py,sha256=CRSm4mEVKsqy0rB4ZOB63hpq7kizdHRmUQTySHPS6cg,25447
+pyperspace/workers/dataset.py,sha256=InPrRnU9PIQJqgNY6pwChDHx_e2k5p5Um72laD2bbtk,25677
 pyperspace/workers/storage.py,sha256=l4qBYBdzbtBCayKcoJStVFO3Zkcqh3EdmBUuGs5Gqf4,21752
-pyperspace-0.1.8.data/data/config/sample.yaml,sha256=ilO7e62BfoU9yQ1PBxPyMBDnfXsjGbXRtsDbAaEndek,2929
+pyperspace-0.1.9.data/data/config/sample.yaml,sha256=ilO7e62BfoU9yQ1PBxPyMBDnfXsjGbXRtsDbAaEndek,2929
 tools/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tools/lsm_check.py,sha256=DuDItlmwOYfWJazL5EB4vLoO2eFJn9aAgLivZ5YrF6U,898
 tools/lsm_merge.py,sha256=8aw-wx41mHIDUrV0uwFzKBJMyEgyfQ7CxNIXqSeuVbc,278
 tools/lsm_reader.py,sha256=QbeMJGZBpGRp6_P3euKln6HGhggNlr-J-CH79do33yM,464
 tools/lsm_stat.py,sha256=J0HP0x0mDCCflp8sRarhbetETpNC6itosF9SwbzlOIo,188
 tools/wal2lsm.py,sha256=rY44mxtSxWrK0Tmw7zbvLxFfAVFVUglm3ZGdr2PPolM,460
 tools/wal_reader.py,sha256=v1kabpgVkjq5NpyU5vRpLmjvu0KeE0qDR6akoLltPhU,666
-pyperspace-0.1.8.dist-info/METADATA,sha256=be_r3hsUCnAAXEboqBPf47Af2QIPX3_2_0a6Te3kZ-M,1535
-pyperspace-0.1.8.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-pyperspace-0.1.8.dist-info/entry_points.txt,sha256=2abP4y7FCUEbOW8wQ9_ku1kHGFYBb8cuOD0TB7oLjSk,254
-pyperspace-0.1.8.dist-info/top_level.txt,sha256=46xZ0AYw65qgKHQNmFbdGYQJGZC850yTd5rpG1yPeg4,17
-pyperspace-0.1.8.dist-info/RECORD,,
+pyperspace-0.1.9.dist-info/METADATA,sha256=RSzl5OW-avlOLIqlmH-_ozhSSN_yJJ9Z_kSVG_2YBU4,1535
+pyperspace-0.1.9.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+pyperspace-0.1.9.dist-info/entry_points.txt,sha256=2abP4y7FCUEbOW8wQ9_ku1kHGFYBb8cuOD0TB7oLjSk,254
+pyperspace-0.1.9.dist-info/top_level.txt,sha256=46xZ0AYw65qgKHQNmFbdGYQJGZC850yTd5rpG1yPeg4,17
+pyperspace-0.1.9.dist-info/RECORD,,
```

