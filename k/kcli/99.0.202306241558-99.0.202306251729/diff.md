# Comparing `tmp/kcli-99.0.202306241558-py3-none-any.whl.zip` & `tmp/kcli-99.0.202306251729-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,606 +1,610 @@
-Zip file size: 1485516 bytes, number of entries: 604
--rw-r--r--  2.0 unx       15 b- defN 23-Jun-24 15:55 kvirt/__init__.py
--rw-r--r--  2.0 unx   100420 b- defN 23-Jun-24 15:55 kvirt/baseconfig.py
--rw-r--r--  2.0 unx   171487 b- defN 23-Jun-24 15:55 kvirt/bottle.py
--rw-r--r--  2.0 unx   251162 b- defN 23-Jun-24 15:55 kvirt/cli.py
--rw-r--r--  2.0 unx   189470 b- defN 23-Jun-24 15:55 kvirt/config.py
--rw-r--r--  2.0 unx     2851 b- defN 23-Jun-24 15:55 kvirt/containerconfig.py
--rw-r--r--  2.0 unx    11612 b- defN 23-Jun-24 15:55 kvirt/defaults.py
--rw-r--r--  2.0 unx    20237 b- defN 23-Jun-24 15:55 kvirt/examples.py
--rw-r--r--  2.0 unx     4333 b- defN 23-Jun-24 15:55 kvirt/ignitionmerger.py
--rw-r--r--  2.0 unx     9871 b- defN 23-Jun-24 15:55 kvirt/keywords.yaml
--rw-r--r--  2.0 unx     3487 b- defN 23-Jun-24 15:55 kvirt/klist.py
--rw-r--r--  2.0 unx     6009 b- defN 23-Jun-24 15:55 kvirt/ansibleutils/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-24 15:55 kvirt/cluster/__init__.py
--rw-r--r--  2.0 unx      204 b- defN 23-Jun-24 15:55 kvirt/cluster/sampleprovider.py
--rw-r--r--  2.0 unx    12317 b- defN 23-Jun-24 15:55 kvirt/cluster/gke/__init__.py
--rw-r--r--  2.0 unx       16 b- defN 23-Jun-24 15:55 kvirt/cluster/gke/fake.yml
--rw-r--r--  2.0 unx      497 b- defN 23-Jun-24 15:55 kvirt/cluster/gke/kcli_default.yml
--rw-r--r--  2.0 unx      312 b- defN 23-Jun-24 15:55 kvirt/cluster/gke/kubeconfig.j2
--rw-r--r--  2.0 unx      931 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/99-apps.yaml
--rw-r--r--  2.0 unx      694 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/99-forcedns
--rw-r--r--  2.0 unx     1480 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/99-notifications.yaml
--rw-r--r--  2.0 unx      653 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/Corefile
--rw-r--r--  2.0 unx    43480 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/__init__.py
--rw-r--r--  2.0 unx     1121 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/assisted_infra.yml
--rw-r--r--  2.0 unx     1269 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/assisted_ingress.yml
--rw-r--r--  2.0 unx     1366 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/autoapprovercron.yml
--rw-r--r--  2.0 unx     1106 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/bmc.yml.j2
--rw-r--r--  2.0 unx      511 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/calico.sh.j2
--rw-r--r--  2.0 unx      200 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/cloud_lb_apps.yml
--rw-r--r--  2.0 unx     1433 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/disconnected.sh
--rw-r--r--  2.0 unx      184 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/extras.service
--rw-r--r--  2.0 unx      839 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/extras.sh
--rw-r--r--  2.0 unx     3131 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/hostedcluster.yaml
--rw-r--r--  2.0 unx     1174 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/httpd.yaml
--rw-r--r--  2.0 unx      889 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/ignition.sh
--rw-r--r--  2.0 unx     2307 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/kcli_plan.yml
--rw-r--r--  2.0 unx     2069 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/kcli_plan_default.yml
--rw-r--r--  2.0 unx      502 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/keepalived.conf
--rw-r--r--  2.0 unx     1587 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/nmstateconfig.yml.j2
--rw-r--r--  2.0 unx      752 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/nodepool.yaml
--rw-r--r--  2.0 unx       60 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/nonlocalbind.conf
--rw-r--r--  2.0 unx     1890 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/staticpods/coredns.yml
--rw-r--r--  2.0 unx     2142 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/staticpods/keepalived.yml
--rw-r--r--  2.0 unx     1619 b- defN 23-Jun-24 15:55 kvirt/cluster/hypershift/staticpods/mdns.yml
--rw-r--r--  2.0 unx    13415 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/__init__.py
--rw-r--r--  2.0 unx     1117 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/bootstrap.sh
--rw-r--r--  2.0 unx     1035 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/bootstrap.yml
--rw-r--r--  2.0 unx      441 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/cloud_lb_api.yml
--rw-r--r--  2.0 unx      440 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/ctlplanes.sh
--rw-r--r--  2.0 unx     1068 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/ctlplanes.yml
--rw-r--r--  2.0 unx      231 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/join.sh
--rw-r--r--  2.0 unx     1265 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/kcli_default.yml
--rw-r--r--  2.0 unx      511 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/keepalived.conf
--rw-r--r--  2.0 unx      352 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/keepalived.sh
--rw-r--r--  2.0 unx      166 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/workers.sh
--rw-r--r--  2.0 unx      709 b- defN 23-Jun-24 15:55 kvirt/cluster/k3s/workers.yml
--rw-r--r--  2.0 unx    13736 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/__init__.py
--rwxr-xr-x  2.0 unx     2772 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/bootstrap.sh
--rw-r--r--  2.0 unx     1550 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/bootstrap.yml
--rw-r--r--  2.0 unx      338 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/cloud_lb_api.yml
--rw-r--r--  2.0 unx     1172 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/ctlplanes.yml
--rwxr-xr-x  2.0 unx      343 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/deploy.sh
--rwxr-xr-x  2.0 unx      308 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/join.sh
--rw-r--r--  2.0 unx     1839 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/kcli_default.yml
--rw-r--r--  2.0 unx      563 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/keepalived.conf
--rw-r--r--  2.0 unx      424 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/keepalived.sh
--rw-r--r--  2.0 unx      140 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/kubernetes.repo
--rw-r--r--  2.0 unx      179 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/multus.sh
--rw-r--r--  2.0 unx      572 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/nfs.sh
--rw-r--r--  2.0 unx      226 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/nfs.yml
--rw-r--r--  2.0 unx     4021 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/pre_el.sh
--rw-r--r--  2.0 unx     3906 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/pre_ubuntu.sh
--rw-r--r--  2.0 unx     2127 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/registry.yml
--rw-r--r--  2.0 unx      949 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/workers.yml
--rw-r--r--  2.0 unx      487 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/argocd/ingress.yml
--rw-r--r--  2.0 unx     2134 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/argocd/install.sh
--rw-r--r--  2.0 unx       71 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/argocd/kcli_default.yml
--rw-r--r--  2.0 unx      314 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/argocd/uninstall.sh
--rw-r--r--  2.0 unx       90 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/autolabeller/install.sh
--rw-r--r--  2.0 unx       91 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/autolabeller/uninstall.sh
--rw-r--r--  2.0 unx      380 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/certmanager/install.sh
--rw-r--r--  2.0 unx      317 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/dashboard/admin.yml
--rw-r--r--  2.0 unx      452 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/dashboard/ingress.yml
--rw-r--r--  2.0 unx     1433 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/dashboard/install.sh
--rw-r--r--  2.0 unx       23 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/dashboard/kcli_default.yml
--rw-r--r--  2.0 unx      373 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/dashboard/user.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/falco/falco_advertisements.yml
--rw-r--r--  2.0 unx      185 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/falco/falco_ip.yml
--rw-r--r--  2.0 unx      839 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/falco/install.sh
--rw-r--r--  2.0 unx       57 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/falco/kcli_default.yml
--rw-r--r--  2.0 unx      133 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/falco/uninstall.sh
--rw-r--r--  2.0 unx      175 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/ingress/install.sh
--rw-r--r--  2.0 unx      176 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/ingress/uninstall.sh
--rw-r--r--  2.0 unx      112 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/istio/install.sh
--rw-r--r--  2.0 unx      910 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/istio/istio-minimal-operator.yaml
--rw-r--r--  2.0 unx      766 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/katacontainer/install.sh
--rw-r--r--  2.0 unx      913 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/katacontainer/uninstall.sh
--rw-r--r--  2.0 unx      198 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/knative/cr_eventing.yml
--rw-r--r--  2.0 unx      194 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/knative/cr_serving.yml
--rw-r--r--  2.0 unx      253 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/knative/install.sh
--rw-r--r--  2.0 unx      670 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/kubevirt/install.sh
--rw-r--r--  2.0 unx       30 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/kubevirt/kcli_default.yml
--rw-r--r--  2.0 unx      534 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/metallb/install.sh
--rw-r--r--  2.0 unx       47 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/metallb/kcli_default.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/metallb/metallb_advertisements.yml
--rw-r--r--  2.0 unx      150 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/metallb/metallb_cr.yml
--rw-r--r--  2.0 unx      283 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/metallb/uninstall.sh
--rw-r--r--  2.0 unx      348 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/olm/install.sh
--rw-r--r--  2.0 unx      350 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/olm/uninstall.sh
--rw-r--r--  2.0 unx      320 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/policy_as_code/install.sh
--rw-r--r--  2.0 unx       34 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/policy_as_code/kcli_default.yml
--rw-r--r--  2.0 unx      322 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/policy_as_code/uninstall.sh
--rw-r--r--  2.0 unx     1662 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/rancher/install.sh
--rw-r--r--  2.0 unx      103 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/rancher/kcli_default.yml
--rw-r--r--  2.0 unx      161 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/rancher/rancher_advertisements.yml
--rw-r--r--  2.0 unx      191 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/rancher/rancher_ip.yml
--rw-r--r--  2.0 unx      151 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/rancher/uninstall.sh
--rw-r--r--  2.0 unx      572 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/rook/install.sh
--rw-r--r--  2.0 unx      190 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/submariner/install.sh
--rw-r--r--  2.0 unx       22 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/submariner/kcli_default.yml
--rw-r--r--  2.0 unx      277 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/tekton/install.sh
--rw-r--r--  2.0 unx      278 b- defN 23-Jun-24 15:55 kvirt/cluster/kubeadm/apps/tekton/uninstall.sh
--rw-r--r--  2.0 unx     2970 b- defN 23-Jun-24 15:55 kvirt/cluster/kubecommon/__init__.py
--rw-r--r--  2.0 unx     9395 b- defN 23-Jun-24 15:55 kvirt/cluster/kubernetes/__init__.py
--rw-r--r--  2.0 unx     4782 b- defN 23-Jun-24 15:55 kvirt/cluster/microshift/__init__.py
--rw-r--r--  2.0 unx      603 b- defN 23-Jun-24 15:55 kvirt/cluster/microshift/kcli_plan.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jun-24 15:55 kvirt/cluster/microshift/kcli_plan_default.yml
--rw-r--r--  2.0 unx      262 b- defN 23-Jun-24 15:55 kvirt/cluster/microshift/scripts/00_sslip.sh
--rw-r--r--  2.0 unx      799 b- defN 23-Jun-24 15:55 kvirt/cluster/microshift/scripts/01_clients.sh
--rw-r--r--  2.0 unx      183 b- defN 23-Jun-24 15:55 kvirt/cluster/microshift/scripts/02_crio.sh
--rw-r--r--  2.0 unx      538 b- defN 23-Jun-24 15:55 kvirt/cluster/microshift/scripts/03_microshift.sh
--rw-r--r--  2.0 unx      341 b- defN 23-Jun-24 15:55 kvirt/cluster/microshift/scripts/04_kubeconfig.sh
--rw-r--r--  2.0 unx     2252 b- defN 23-Jun-24 15:55 kvirt/cluster/microshift/scripts/05_acm.sh
--rw-r--r--  2.0 unx      696 b- defN 23-Jun-24 15:55 kvirt/cluster/microshift/scripts/deploy.sh
--rw-r--r--  2.0 unx      219 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/01-workload-partitioning
--rw-r--r--  2.0 unx      573 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/10-node-ip-hint.yaml
--rw-r--r--  2.0 unx      980 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-apps.yaml
--rw-r--r--  2.0 unx      618 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-bootstrap-deletion-2.yaml
--rw-r--r--  2.0 unx     1239 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-bootstrap-deletion.yaml
--rw-r--r--  2.0 unx      529 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-chrony.yaml
--rw-r--r--  2.0 unx      646 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-forcedns
--rw-r--r--  2.0 unx      476 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-forcedns-ibm
--rw-r--r--  2.0 unx      854 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-kubevirt-fix.yaml
--rw-r--r--  2.0 unx     1127 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-localhost-fix.yaml
--rw-r--r--  2.0 unx      250 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-metal3-fake-machine.yaml
--rw-r--r--  2.0 unx      162 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     1659 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-notifications.yaml
--rw-r--r--  2.0 unx      118 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-operatorhub.yaml
--rw-r--r--  2.0 unx      314 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-ovn.yaml
--rw-r--r--  2.0 unx      912 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/99-sno.yaml
--rw-r--r--  2.0 unx      762 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/Corefile
--rw-r--r--  2.0 unx    85605 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/__init__.py
--rw-r--r--  2.0 unx     1326 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/autoapprovercron.yml
--rw-r--r--  2.0 unx      987 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/autorules.yml
--rw-r--r--  2.0 unx     1630 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/bootstrap.yml
--rw-r--r--  2.0 unx      250 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/calico.sh.j2
--rw-r--r--  2.0 unx      107 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/chrony.conf
--rw-r--r--  2.0 unx      629 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/cloud_bootstrap.yml
--rw-r--r--  2.0 unx      792 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/cloud_ctlplanes.yml
--rw-r--r--  2.0 unx      217 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/cloud_dns.yml
--rw-r--r--  2.0 unx      616 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/cloud_lb_api.yml
--rw-r--r--  2.0 unx      224 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/cloud_lb_apps.yml
--rw-r--r--  2.0 unx      703 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/cloud_workers.yml
--rw-r--r--  2.0 unx      123 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/cluster-ingress-02-config.yml
--rw-r--r--  2.0 unx      159 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/cluster-scheduler-02-config.yml
--rw-r--r--  2.0 unx      224 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/config.hcl.templ
--rw-r--r--  2.0 unx       98 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/contrail-ca-patch.service
--rw-r--r--  2.0 unx      486 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/contrail-ca-patch.sh
--rw-r--r--  2.0 unx       87 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/contrail.auth
--rw-r--r--  2.0 unx     1108 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/contrail.sh.j2
--rw-r--r--  2.0 unx     2278 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/ctlplanes.yml
--rw-r--r--  2.0 unx      326 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/dhcp.conf
--rw-r--r--  2.0 unx      106 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/dhcp.sh
--rw-r--r--  2.0 unx      536 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/dhcp.yml
--rw-r--r--  2.0 unx      836 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected.yml
--rw-r--r--  2.0 unx     8945 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/fake_kubeconfig.json
--rw-r--r--  2.0 unx       35 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/fake_pull.json
--rw-r--r--  2.0 unx     1792 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/haproxy.cfg
--rw-r--r--  2.0 unx     2483 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/haproxy.cfg.kubevirt
--rw-r--r--  2.0 unx      902 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/httpd.yaml
--rw-r--r--  2.0 unx      524 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/ignition.j2
--rw-r--r--  2.0 unx     3835 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/install-config.yaml
--rw-r--r--  2.0 unx     2691 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/iso.sh
--rw-r--r--  2.0 unx      237 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/kcli-ipv6.conf.j2
--rw-r--r--  2.0 unx     4489 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/kcli_default.yml
--rw-r--r--  2.0 unx      982 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/keepalived.conf
--rw-r--r--  2.0 unx       60 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/nonlocalbind.conf
--rw-r--r--  2.0 unx       59 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/openshift-workload-pinning
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/relocate-ip-bootstrap.service
--rw-r--r--  2.0 unx      281 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/relocate-ip-bootstrap.sh
--rw-r--r--  2.0 unx      690 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/relocate-ip.sh
--rw-r--r--  2.0 unx      212 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/sno-finish.service
--rw-r--r--  2.0 unx     2085 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/sno-finish.sh
--rw-r--r--  2.0 unx      660 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/sno.yml
--rw-r--r--  2.0 unx     1615 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/workers.yml
--rw-r--r--  2.0 unx       40 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/cr.sh
--rw-r--r--  2.0 unx      768 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/install.yml.j2
--rw-r--r--  2.0 unx      162 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/advanced-cluster-management/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     2913 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sample.yml
--rwxr-xr-x  2.0 unx     2838 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sh
--rw-r--r--  2.0 unx      418 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/advanced-cluster-management/cr.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/advanced-cluster-management/gen_registries.py
--rw-r--r--  2.0 unx      290 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/advanced-cluster-management/kcli_default.yml
--rw-r--r--  2.0 unx     1219 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/advanced-cluster-management/post.sh
--rw-r--r--  2.0 unx      645 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/argocd/configmap.yml
--rw-r--r--  2.0 unx     2423 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/argocd/install.sh
--rw-r--r--  2.0 unx       49 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/argocd/kcli_default.yml
--rw-r--r--  2.0 unx     1093 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/autolabeller/cr.yml
--rw-r--r--  2.0 unx      142 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/autolabeller/install.sh
--rw-r--r--  2.0 unx     1093 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/autolabeller/install.yml
--rw-r--r--  2.0 unx      165 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/autolabeller/kcli_default.yml
--rw-r--r--  2.0 unx       25 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/autolabeller/uninstall.sh
--rw-r--r--  2.0 unx      873 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/cluster-logging/cr.yml
--rw-r--r--  2.0 unx       63 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/cluster-logging/kcli_default.yml
--rw-r--r--  2.0 unx      265 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/istio/install.sh
--rw-r--r--  2.0 unx      377 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/istio/istio-cni.yaml
--rw-r--r--  2.0 unx     1039 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/cr.yml
--rw-r--r--  2.0 unx      154 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/kcli_default.yml
--rw-r--r--  2.0 unx      775 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/local-storage-operator/cr.yml
--rw-r--r--  2.0 unx      227 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/local-storage-operator/kcli_default.yml
--rw-r--r--  2.0 unx      642 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/local-storage-operator/post.sh
--rw-r--r--  2.0 unx      349 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/lvms-operator/cr.yml
--rw-r--r--  2.0 unx      137 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/lvms-operator/kcli_default.yml
--rw-r--r--  2.0 unx      595 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/lvms-operator/post.sh
--rw-r--r--  2.0 unx      510 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/metallb-operator/cr.yml
--rw-r--r--  2.0 unx       94 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/metallb-operator/kcli_default.yml
--rw-r--r--  2.0 unx      162 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/multicluster-engine/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     2913 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sample.yml
--rwxr-xr-x  2.0 unx     2845 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sh
--rw-r--r--  2.0 unx      245 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/multicluster-engine/cr.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/multicluster-engine/gen_registries.py
--rw-r--r--  2.0 unx      149 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/multicluster-engine/kcli_default.yml
--rwxr-xr-x  2.0 unx       55 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/multicluster-engine/post.sh
--rwxr-xr-x  2.0 unx     2298 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/nfs/install.sh
--rw-r--r--  2.0 unx      117 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/nfs/kcli_default.yml
--rw-r--r--  2.0 unx      185 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/nfs/uninstall.sh
--rw-r--r--  2.0 unx      849 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/odf-operator/cr.yml
--rw-r--r--  2.0 unx      298 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/odf-operator/kcli_default.yml
--rw-r--r--  2.0 unx      364 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/odf-operator/nad_cluster.yml
--rw-r--r--  2.0 unx      362 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/odf-operator/nad_public.yml
--rw-r--r--  2.0 unx      745 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/odf-operator/post.sh
--rw-r--r--  2.0 unx      530 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/odf-operator/pre.sh
--rw-r--r--  2.0 unx      363 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/serverless-operator/cr.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/serverless-operator/kcli_default.yml
--rw-r--r--  2.0 unx      278 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/serverless-operator/post.sh
--rw-r--r--  2.0 unx     1227 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/users/install.sh
--rw-r--r--  2.0 unx       84 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/users/kcli_default.yml
--rw-r--r--  2.0 unx      258 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/users/oauth.yml
--rw-r--r--  2.0 unx      249 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/users/oauth_hypershift.yml
--rw-r--r--  2.0 unx      422 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/apps/users/uninstall.sh
--rw-r--r--  2.0 unx       60 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/customisation/00-kcli-namespace.yaml
--rw-r--r--  2.0 unx       91 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/customisation/97-autoapprovercron-sa.yaml
--rw-r--r--  2.0 unx      264 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/customisation/98-autoapprovercron-binding.yaml
--rw-r--r--  2.0 unx      912 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/customisation/99-autoapprovercron-cronjob.yaml
--rw-r--r--  2.0 unx      389 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/customisation/99-ingress-controller.yaml
--rw-r--r--  2.0 unx      184 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/customisation/99-monitoring.yaml
--rw-r--r--  2.0 unx      289 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/customisation/99-registry.yaml
--rw-r--r--  2.0 unx     1685 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected/haproxy.cfg
--rw-r--r--  2.0 unx      211 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected/registry.service
--rwxr-xr-x  2.0 unx      328 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected/bin/sync_image.sh
--rwxr-xr-x  2.0 unx      201 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected/scripts/01_get_oc.sh
--rwxr-xr-x  2.0 unx     2381 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected/scripts/03_mirror.sh
--rwxr-xr-x  2.0 unx     2046 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected/scripts/03_registry.sh
--rwxr-xr-x  2.0 unx      337 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected/scripts/04_extras.sh
--rwxr-xr-x  2.0 unx     2319 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected/scripts/05_olm.sh
--rwxr-xr-x  2.0 unx      241 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected/scripts/06_web.sh
--rwxr-xr-x  2.0 unx      733 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected/scripts/deploy.sh
--rw-r--r--  2.0 unx     4223 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/disconnected/scripts/mirror-config.yaml.sample
--rw-r--r--  2.0 unx     2557 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/staticpods/coredns.yml
--rw-r--r--  2.0 unx      987 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/staticpods/haproxy.yml
--rw-r--r--  2.0 unx     2539 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/staticpods/keepalived.yml
--rw-r--r--  2.0 unx     1721 b- defN 23-Jun-24 15:55 kvirt/cluster/openshift/staticpods/mdns.yml
--rw-r--r--  2.0 unx      193 b- defN 23-Jun-24 15:55 kvirt/cluster/profiles/sample-kubeadm-default.yml
--rw-r--r--  2.0 unx      135 b- defN 23-Jun-24 15:55 kvirt/cluster/profiles/sample-openshift-compact.yml
--rw-r--r--  2.0 unx      210 b- defN 23-Jun-24 15:55 kvirt/cluster/profiles/sample-openshift-contrail.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-24 15:55 kvirt/cluster/profiles/sample-openshift-ipv6.yml
--rw-r--r--  2.0 unx       55 b- defN 23-Jun-24 15:55 kvirt/cluster/profiles/sample-openshift-sno-bm.yml
--rw-r--r--  2.0 unx      148 b- defN 23-Jun-24 15:55 kvirt/cluster/profiles/sample-openshift-sno.yml
--rw-r--r--  2.0 unx     3377 b- defN 23-Jun-24 15:55 kvirt/common/Jenkinsfile.j2
--rw-r--r--  2.0 unx    98237 b- defN 23-Jun-24 15:55 kvirt/common/__init__.py
--rw-r--r--  2.0 unx     1406 b- defN 23-Jun-24 15:55 kvirt/common/autoscale.yaml.j2
--rw-r--r--  2.0 unx     8945 b- defN 23-Jun-24 15:55 kvirt/common/fake_kubeconfig.json
--rw-r--r--  2.0 unx      669 b- defN 23-Jun-24 15:55 kvirt/common/ignition.j2
--rw-r--r--  2.0 unx      125 b- defN 23-Jun-24 15:55 kvirt/common/kubevirt_kcli_conf.j2
--rw-r--r--  2.0 unx       99 b- defN 23-Jun-24 15:55 kvirt/common/local_kcli_conf.j2
--rw-r--r--  2.0 unx     3068 b- defN 23-Jun-24 15:55 kvirt/common/pipeline.yml.j2
--rw-r--r--  2.0 unx     2377 b- defN 23-Jun-24 15:55 kvirt/common/pipeline_kube.yml.j2
--rw-r--r--  2.0 unx     1381 b- defN 23-Jun-24 15:55 kvirt/common/playbook.j2
--rw-r--r--  2.0 unx      833 b- defN 23-Jun-24 15:55 kvirt/common/storage.sh.aws
--rw-r--r--  2.0 unx      635 b- defN 23-Jun-24 15:55 kvirt/common/storage.sh.gcp
--rw-r--r--  2.0 unx       68 b- defN 23-Jun-24 15:55 kvirt/common/storage.sh.ibmcloud
--rw-r--r--  2.0 unx     4562 b- defN 23-Jun-24 15:55 kvirt/common/vm.ovf.j2
--rw-r--r--  2.0 unx     2241 b- defN 23-Jun-24 15:55 kvirt/common/workflow.yml.j2
--rw-r--r--  2.0 unx     2208 b- defN 23-Jun-24 15:55 kvirt/common/workflow_script.yml.j2
--rw-r--r--  2.0 unx    15041 b- defN 23-Jun-24 15:55 kvirt/container/__init__.py
--rw-r--r--  2.0 unx    11716 b- defN 23-Jun-24 15:55 kvirt/expose/__init__.py
--rw-r--r--  2.0 unx     4319 b- defN 23-Jun-24 15:55 kvirt/expose/swagger.yml
--rw-r--r--  2.0 unx      408 b- defN 23-Jun-24 15:55 kvirt/expose/static/css/bootstrap-notify.css
--rw-r--r--  2.0 unx   121125 b- defN 23-Jun-24 15:55 kvirt/expose/static/css/bootstrap.min.css
--rw-r--r--  2.0 unx      399 b- defN 23-Jun-24 15:55 kvirt/expose/static/css/dataTables.checkboxes.css
--rw-r--r--  2.0 unx    13587 b- defN 23-Jun-24 15:55 kvirt/expose/static/css/jquery.dataTables.min.css
--rw-r--r--  2.0 unx      868 b- defN 23-Jun-24 15:55 kvirt/expose/static/css/kcli.css
--rw-r--r--  2.0 unx      269 b- defN 23-Jun-24 15:55 kvirt/expose/static/css/wheel.css
--rw-r--r--  2.0 unx     1406 b- defN 23-Jun-24 15:55 kvirt/expose/static/images/favicon.ico
--rw-r--r--  2.0 unx      160 b- defN 23-Jun-24 15:55 kvirt/expose/static/images/sort_asc.png
--rw-r--r--  2.0 unx      201 b- defN 23-Jun-24 15:55 kvirt/expose/static/images/sort_both.png
--rw-r--r--  2.0 unx      158 b- defN 23-Jun-24 15:55 kvirt/expose/static/images/sort_desc.png
--rw-r--r--  2.0 unx    24772 b- defN 23-Jun-24 15:55 kvirt/expose/static/images/wheel.gif
--rw-r--r--  2.0 unx    12398 b- defN 23-Jun-24 15:55 kvirt/expose/static/js/dataTables.checkboxes.min.js
--rw-r--r--  2.0 unx      367 b- defN 23-Jun-24 15:55 kvirt/expose/static/js/exposeactions.js
--rw-r--r--  2.0 unx    83059 b- defN 23-Jun-24 15:55 kvirt/expose/static/js/jquery.dataTables.min.js
--rw-r--r--  2.0 unx    89795 b- defN 23-Jun-24 15:55 kvirt/expose/static/js/jquery.min.js
--rw-r--r--  2.0 unx      263 b- defN 23-Jun-24 15:55 kvirt/expose/static/js/list.js
--rw-r--r--  2.0 unx     1605 b- defN 23-Jun-24 15:55 kvirt/expose/templates/form.html
--rw-r--r--  2.0 unx     1035 b- defN 23-Jun-24 15:55 kvirt/expose/templates/head.html
--rw-r--r--  2.0 unx      406 b- defN 23-Jun-24 15:55 kvirt/expose/templates/index.html
--rw-r--r--  2.0 unx     1220 b- defN 23-Jun-24 15:55 kvirt/expose/templates/infoplan.html
--rw-r--r--  2.0 unx      574 b- defN 23-Jun-24 15:55 kvirt/expose/templates/planstable.html
--rw-r--r--  2.0 unx      550 b- defN 23-Jun-24 15:55 kvirt/expose/templates/result.html
--rw-r--r--  2.0 unx     1754 b- defN 23-Jun-24 15:55 kvirt/internalplans/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-24 15:55 kvirt/jinjafilters/__init__.py
--rw-r--r--  2.0 unx     5351 b- defN 23-Jun-24 15:55 kvirt/jinjafilters/jinjafilters.py
--rw-r--r--  2.0 unx     8477 b- defN 23-Jun-24 15:55 kvirt/kfish/__init__.py
--rw-r--r--  2.0 unx    10384 b- defN 23-Jun-24 15:55 kvirt/ksushy/__init__.py
--rw-r--r--  2.0 unx      121 b- defN 23-Jun-24 15:55 kvirt/ksushy/main.py
--rw-r--r--  2.0 unx     1028 b- defN 23-Jun-24 15:55 kvirt/ksushy/templates/bios.json
--rw-r--r--  2.0 unx      443 b- defN 23-Jun-24 15:55 kvirt/ksushy/templates/interface.json
--rw-r--r--  2.0 unx      418 b- defN 23-Jun-24 15:55 kvirt/ksushy/templates/interfaces.json
--rw-r--r--  2.0 unx     1050 b- defN 23-Jun-24 15:55 kvirt/ksushy/templates/manager.json
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-24 15:55 kvirt/ksushy/templates/managers.json
--rw-r--r--  2.0 unx      535 b- defN 23-Jun-24 15:55 kvirt/ksushy/templates/root.json
--rw-r--r--  2.0 unx     2732 b- defN 23-Jun-24 15:55 kvirt/ksushy/templates/system.json
--rw-r--r--  2.0 unx      511 b- defN 23-Jun-24 15:55 kvirt/ksushy/templates/systems.json
--rw-r--r--  2.0 unx     1219 b- defN 23-Jun-24 15:55 kvirt/ksushy/templates/virtualmedia_cd.json
--rw-r--r--  2.0 unx      705 b- defN 23-Jun-24 15:55 kvirt/ksushy/templates/virtualmedias.json
--rw-r--r--  2.0 unx     2780 b- defN 23-Jun-24 15:55 kvirt/miniconsole/__init__.py
--rw-r--r--  2.0 unx     3721 b- defN 23-Jun-24 15:55 kvirt/nameutils/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-24 15:55 kvirt/providers/__init__.py
--rw-r--r--  2.0 unx     9038 b- defN 23-Jun-24 15:55 kvirt/providers/sampleprovider.py
--rw-r--r--  2.0 unx    65930 b- defN 23-Jun-24 15:55 kvirt/providers/aws/__init__.py
--rw-r--r--  2.0 unx      479 b- defN 23-Jun-24 15:55 kvirt/providers/fake/__init__.py
--rw-r--r--  2.0 unx    74801 b- defN 23-Jun-24 15:55 kvirt/providers/gcp/__init__.py
--rw-r--r--  2.0 unx      175 b- defN 23-Jun-24 15:55 kvirt/providers/gcp/gcp-hack.service
--rw-r--r--  2.0 unx      231 b- defN 23-Jun-24 15:55 kvirt/providers/gcp/gcp-hack.sh
--rw-r--r--  2.0 unx    65166 b- defN 23-Jun-24 15:55 kvirt/providers/ibm/__init__.py
--rw-r--r--  2.0 unx    81078 b- defN 23-Jun-24 15:55 kvirt/providers/kubevirt/__init__.py
--rw-r--r--  2.0 unx   185506 b- defN 23-Jun-24 15:55 kvirt/providers/kvm/__init__.py
--rw-r--r--  2.0 unx     1965 b- defN 23-Jun-24 15:55 kvirt/providers/kvm/helpers.py
--rw-r--r--  2.0 unx    57194 b- defN 23-Jun-24 15:55 kvirt/providers/openstack/__init__.py
--rw-r--r--  2.0 unx    62662 b- defN 23-Jun-24 15:55 kvirt/providers/ovirt/__init__.py
--rw-r--r--  2.0 unx    31230 b- defN 23-Jun-24 15:55 kvirt/providers/packet/__init__.py
--rw-r--r--  2.0 unx    73215 b- defN 23-Jun-24 15:55 kvirt/providers/vsphere/__init__.py
--rw-r--r--  2.0 unx    13655 b- defN 23-Jun-24 15:55 kvirt/providers/vsphere/helpers.py
--rw-r--r--  2.0 unx     4893 b- defN 23-Jun-24 15:55 kvirt/providers/vsphere/tagging.py
--rw-r--r--  2.0 unx    21420 b- defN 23-Jun-24 15:55 kvirt/providers/web/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-24 15:55 kvirt/version/__init__.py
--rw-r--r--  2.0 unx       19 b- defN 23-Jun-24 15:58 kvirt/version/git
--rw-r--r--  2.0 unx    46652 b- defN 23-Jun-24 15:55 kvirt/web/__init__.py
--rw-r--r--  2.0 unx      261 b- defN 23-Jun-24 15:55 kvirt/web/main.py
--rw-r--r--  2.0 unx      408 b- defN 23-Jun-24 15:55 kvirt/web/static/css/bootstrap-notify.css
--rw-r--r--  2.0 unx    23409 b- defN 23-Jun-24 15:55 kvirt/web/static/css/bootstrap-theme.min.css
--rw-r--r--  2.0 unx   121125 b- defN 23-Jun-24 15:55 kvirt/web/static/css/bootstrap.min.css
--rw-r--r--  2.0 unx      399 b- defN 23-Jun-24 15:55 kvirt/web/static/css/dataTables.checkboxes.css
--rw-r--r--  2.0 unx    13587 b- defN 23-Jun-24 15:55 kvirt/web/static/css/jquery.dataTables.min.css
--rw-r--r--  2.0 unx      816 b- defN 23-Jun-24 15:55 kvirt/web/static/css/kcli.css
--rw-r--r--  2.0 unx     3033 b- defN 23-Jun-24 15:55 kvirt/web/static/css/navbar.css
--rw-r--r--  2.0 unx     2908 b- defN 23-Jun-24 15:55 kvirt/web/static/css/spice.css
--rw-r--r--  2.0 unx      271 b- defN 23-Jun-24 15:55 kvirt/web/static/css/wheel.css
--rw-r--r--  2.0 unx    18028 b- defN 23-Jun-24 15:55 kvirt/web/static/fonts/glyphicons-halflings-regular.woff2
--rw-r--r--  2.0 unx      715 b- defN 23-Jun-24 15:55 kvirt/web/static/images/Centos.png
--rw-r--r--  2.0 unx      294 b- defN 23-Jun-24 15:55 kvirt/web/static/images/Debian.png
--rw-r--r--  2.0 unx      987 b- defN 23-Jun-24 15:55 kvirt/web/static/images/Fedora.png
--rw-r--r--  2.0 unx      672 b- defN 23-Jun-24 15:55 kvirt/web/static/images/Redhat.png
--rw-r--r--  2.0 unx     1278 b- defN 23-Jun-24 15:55 kvirt/web/static/images/Suse.png
--rw-r--r--  2.0 unx     1782 b- defN 23-Jun-24 15:55 kvirt/web/static/images/Tux.png
--rw-r--r--  2.0 unx      544 b- defN 23-Jun-24 15:55 kvirt/web/static/images/Ubuntu.png
--rw-r--r--  2.0 unx     4213 b- defN 23-Jun-24 15:55 kvirt/web/static/images/delete.png
--rw-r--r--  2.0 unx     1406 b- defN 23-Jun-24 15:55 kvirt/web/static/images/favicon.ico
--rw-r--r--  2.0 unx    23320 b- defN 23-Jun-24 15:55 kvirt/web/static/images/kcli-small.png
--rw-r--r--  2.0 unx    27185 b- defN 23-Jun-24 15:55 kvirt/web/static/images/kcli.jpg
--rw-r--r--  2.0 unx   113928 b- defN 23-Jun-24 15:55 kvirt/web/static/images/kcli.png
--rw-r--r--  2.0 unx    48809 b- defN 23-Jun-24 15:55 kvirt/web/static/images/logo-header.svg
--rw-r--r--  2.0 unx    48809 b- defN 23-Jun-24 15:55 kvirt/web/static/images/logo-main.svg
--rw-r--r--  2.0 unx      160 b- defN 23-Jun-24 15:55 kvirt/web/static/images/sort_asc.png
--rw-r--r--  2.0 unx      201 b- defN 23-Jun-24 15:55 kvirt/web/static/images/sort_both.png
--rw-r--r--  2.0 unx      158 b- defN 23-Jun-24 15:55 kvirt/web/static/images/sort_desc.png
--rw-r--r--  2.0 unx     3927 b- defN 23-Jun-24 15:55 kvirt/web/static/images/start.png
--rw-r--r--  2.0 unx     3631 b- defN 23-Jun-24 15:55 kvirt/web/static/images/stop.png
--rw-r--r--  2.0 unx    24772 b- defN 23-Jun-24 15:55 kvirt/web/static/images/wheel.gif
--rw-r--r--  2.0 unx     2933 b- defN 23-Jun-24 15:55 kvirt/web/static/js/bootstrap-notify.js
--rw-r--r--  2.0 unx    37045 b- defN 23-Jun-24 15:55 kvirt/web/static/js/bootstrap.min.js
--rw-r--r--  2.0 unx     2523 b- defN 23-Jun-24 15:55 kvirt/web/static/js/containeraction.js
--rw-r--r--  2.0 unx    12398 b- defN 23-Jun-24 15:55 kvirt/web/static/js/dataTables.checkboxes.min.js
--rw-r--r--  2.0 unx     1642 b- defN 23-Jun-24 15:55 kvirt/web/static/js/hostaction.js
--rw-r--r--  2.0 unx     1187 b- defN 23-Jun-24 15:55 kvirt/web/static/js/imageaction.js
--rw-r--r--  2.0 unx    83059 b- defN 23-Jun-24 15:55 kvirt/web/static/js/jquery.dataTables.min.js
--rw-r--r--  2.0 unx    87462 b- defN 23-Jun-24 15:55 kvirt/web/static/js/jquery.min.js
--rw-r--r--  2.0 unx     2704 b- defN 23-Jun-24 15:55 kvirt/web/static/js/kcli.js
--rw-r--r--  2.0 unx     1594 b- defN 23-Jun-24 15:55 kvirt/web/static/js/kubeaction.js
--rw-r--r--  2.0 unx     3907 b- defN 23-Jun-24 15:55 kvirt/web/static/js/list.js
--rw-r--r--  2.0 unx     1376 b- defN 23-Jun-24 15:55 kvirt/web/static/js/networkaction.js
--rw-r--r--  2.0 unx     2457 b- defN 23-Jun-24 15:55 kvirt/web/static/js/planaction.js
--rw-r--r--  2.0 unx     1237 b- defN 23-Jun-24 15:55 kvirt/web/static/js/poolaction.js
--rw-r--r--  2.0 unx      846 b- defN 23-Jun-24 15:55 kvirt/web/static/js/productaction.js
--rw-r--r--  2.0 unx      270 b- defN 23-Jun-24 15:55 kvirt/web/static/js/refresh.js
--rw-r--r--  2.0 unx     1835 b- defN 23-Jun-24 15:55 kvirt/web/static/js/repoaction.js
--rw-r--r--  2.0 unx     3463 b- defN 23-Jun-24 15:55 kvirt/web/static/js/snapshotaction.js
--rw-r--r--  2.0 unx     2745 b- defN 23-Jun-24 15:55 kvirt/web/static/js/vmaction.js
--rw-r--r--  2.0 unx      123 b- defN 23-Jun-24 15:55 kvirt/web/static/js/wheel.js
--rw-r--r--  2.0 unx     9944 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/atKeynames.js
--rw-r--r--  2.0 unx     2335 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/bitmap.js
--rw-r--r--  2.0 unx     4795 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/cursor.js
--rw-r--r--  2.0 unx    49214 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/display.js
--rw-r--r--  2.0 unx    13253 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/enums.js
--rw-r--r--  2.0 unx     2847 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/filexfer.js
--rw-r--r--  2.0 unx     9535 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/inputs.js
--rw-r--r--  2.0 unx     6176 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/lz.js
--rw-r--r--  2.0 unx    18370 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/main.js
--rw-r--r--  2.0 unx    12677 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/playback.js
--rw-r--r--  2.0 unx     7036 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/png.js
--rw-r--r--  2.0 unx     3110 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/port.js
--rw-r--r--  2.0 unx    44531 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/quic.js
--rw-r--r--  2.0 unx     3030 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/resize.js
--rw-r--r--  2.0 unx     7282 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/simulatecursor.js
--rw-r--r--  2.0 unx     1895 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/spicearraybuffer.js
--rw-r--r--  2.0 unx    18202 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/spiceconn.js
--rw-r--r--  2.0 unx     3616 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/spicedataview.js
--rw-r--r--  2.0 unx    33015 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/spicemsg.js
--rw-r--r--  2.0 unx    12767 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/spicetype.js
--rw-r--r--  2.0 unx     6808 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/ticket.js
--rw-r--r--  2.0 unx    13628 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/utils.js
--rw-r--r--  2.0 unx    21577 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/webm.js
--rw-r--r--  2.0 unx     4131 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/wire.js
--rw-r--r--  2.0 unx    16580 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/thirdparty/jsbn.js
--rw-r--r--  2.0 unx     2529 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/thirdparty/prng4.js
--rw-r--r--  2.0 unx     3442 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/thirdparty/rng.js
--rw-r--r--  2.0 unx     4257 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/thirdparty/rsa.js
--rw-r--r--  2.0 unx    10671 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/thirdparty/sha1.js
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/.npmignore
--rw-r--r--  2.0 unx      419 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/README.md
--rw-r--r--  2.0 unx      359 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/rollup.config.js
--rw-r--r--  2.0 unx     1113 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/babel-worker.js
--rw-r--r--  2.0 unx     8601 b- defN 23-Jun-24 15:55 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/browser-es-module-loader.js
--rw-r--r--  2.0 unx     2176 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/error-handler.js
--rw-r--r--  2.0 unx     5682 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/localization.js
--rw-r--r--  2.0 unx    56845 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/ui.js
--rw-r--r--  2.0 unx     6696 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/webutil.js
--rw-r--r--  2.0 unx     3553 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/alt.svg
--rw-r--r--  2.0 unx     3980 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/clipboard.svg
--rw-r--r--  2.0 unx     3430 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/connect.svg
--rw-r--r--  2.0 unx     4381 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/ctrl.svg
--rw-r--r--  2.0 unx     3237 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/ctrlaltdel.svg
--rw-r--r--  2.0 unx     5062 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/disconnect.svg
--rw-r--r--  2.0 unx     4684 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/drag.svg
--rw-r--r--  2.0 unx     3106 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/error.svg
--rw-r--r--  2.0 unx     4522 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/esc.svg
--rw-r--r--  2.0 unx     3066 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/expander.svg
--rw-r--r--  2.0 unx     3139 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/fullscreen.svg
--rw-r--r--  2.0 unx     2559 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/handle.svg
--rw-r--r--  2.0 unx     6386 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/handle_bg.svg
--rw-r--r--  2.0 unx     3204 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/info.svg
--rw-r--r--  2.0 unx     6404 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/keyboard.svg
--rw-r--r--  2.0 unx     7000 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/mouse_left.svg
--rw-r--r--  2.0 unx     7002 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/mouse_middle.svg
--rw-r--r--  2.0 unx     6993 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/mouse_none.svg
--rw-r--r--  2.0 unx     7001 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/mouse_right.svg
--rw-r--r--  2.0 unx     3985 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/power.svg
--rw-r--r--  2.0 unx     3082 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/settings.svg
--rw-r--r--  2.0 unx     2953 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/tab.svg
--rw-r--r--  2.0 unx     4441 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/toggleextrakeys.svg
--rw-r--r--  2.0 unx     3869 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/warning.svg
--rw-r--r--  2.0 unx     3178 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/windows.svg
--rw-r--r--  2.0 unx      871 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/Makefile
--rw-r--r--  2.0 unx     4028 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-120x120.png
--rw-r--r--  2.0 unx     4582 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-144x144.png
--rw-r--r--  2.0 unx     5216 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-152x152.png
--rw-r--r--  2.0 unx      675 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-16x16.png
--rw-r--r--  2.0 unx     5787 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-192x192.png
--rw-r--r--  2.0 unx     1000 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-24x24.png
--rw-r--r--  2.0 unx     1064 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-32x32.png
--rw-r--r--  2.0 unx     1397 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-48x48.png
--rw-r--r--  2.0 unx     1932 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-60x60.png
--rw-r--r--  2.0 unx     1946 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-64x64.png
--rw-r--r--  2.0 unx     2699 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-72x72.png
--rw-r--r--  2.0 unx     2874 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-76x76.png
--rw-r--r--  2.0 unx     2351 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-96x96.png
--rw-r--r--  2.0 unx    11685 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-icon-sm.svg
--rw-r--r--  2.0 unx    11549 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/images/icons/novnc-icon.svg
--rw-r--r--  2.0 unx     2885 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/cs.json
--rw-r--r--  2.0 unx     2854 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/de.json
--rw-r--r--  2.0 unx     3906 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/el.json
--rw-r--r--  2.0 unx     2671 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/es.json
--rw-r--r--  2.0 unx     3354 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/ja.json
--rw-r--r--  2.0 unx     2961 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/ko.json
--rw-r--r--  2.0 unx     3035 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/nl.json
--rw-r--r--  2.0 unx     2830 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/pl.json
--rw-r--r--  2.0 unx     3825 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/ru.json
--rw-r--r--  2.0 unx     2845 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/sv.json
--rw-r--r--  2.0 unx     2811 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/tr.json
--rw-r--r--  2.0 unx     2597 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/zh_CN.json
--rw-r--r--  2.0 unx     2606 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/locale/zh_TW.json
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/sounds/CREDITS
--rw-r--r--  2.0 unx     4531 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/sounds/bell.mp3
--rw-r--r--  2.0 unx     8495 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/sounds/bell.oga
--rw-r--r--  2.0 unx    38580 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/styles/Orbitron700.ttf
--rw-r--r--  2.0 unx    17472 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/styles/Orbitron700.woff
--rw-r--r--  2.0 unx    18450 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/app/styles/base.css
--rw-r--r--  2.0 unx     4189 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/base64.js
--rw-r--r--  2.0 unx    11241 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/des.js
--rw-r--r--  2.0 unx    20381 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/display.js
--rw-r--r--  2.0 unx     1374 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/encodings.js
--rw-r--r--  2.0 unx     1170 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/inflator.js
--rw-r--r--  2.0 unx    74196 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/rfb.js
--rw-r--r--  2.0 unx     9130 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/websock.js
--rw-r--r--  2.0 unx      628 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/decoders/copyrect.js
--rw-r--r--  2.0 unx     4814 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/decoders/hextile.js
--rw-r--r--  2.0 unx     1739 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/decoders/raw.js
--rw-r--r--  2.0 unx     1210 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/decoders/rre.js
--rw-r--r--  2.0 unx     9662 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/decoders/tight.js
--rw-r--r--  2.0 unx      768 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/decoders/tightpng.js
--rw-r--r--  2.0 unx    11438 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/input/domkeytable.js
--rw-r--r--  2.0 unx     3804 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/input/fixedkeys.js
--rw-r--r--  2.0 unx    13090 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/input/keyboard.js
--rw-r--r--  2.0 unx    34609 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/input/keysym.js
--rw-r--r--  2.0 unx    25374 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/input/keysymdef.js
--rw-r--r--  2.0 unx     9995 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/input/mouse.js
--rw-r--r--  2.0 unx     5283 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/input/util.js
--rw-r--r--  2.0 unx     2580 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/input/vkeys.js
--rw-r--r--  2.0 unx    14256 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/input/xtscancodes.js
--rw-r--r--  2.0 unx     3155 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/util/browser.js
--rw-r--r--  2.0 unx     7556 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/util/cursor.js
--rw-r--r--  2.0 unx     4221 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/util/events.js
--rw-r--r--  2.0 unx      896 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/util/eventtarget.js
--rw-r--r--  2.0 unx     1358 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/util/logging.js
--rw-r--r--  2.0 unx     1866 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/util/polyfill.js
--rw-r--r--  2.0 unx      301 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/core/util/strings.js
--rw-r--r--  2.0 unx     7388 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/promise.js
--rw-r--r--  2.0 unx      419 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/browser-es-module-loader/README.md
--rw-r--r--  2.0 unx      295 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/browser-es-module-loader/rollup.config.js
--rw-r--r--  2.0 unx     1113 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/babel-worker.js
--rw-r--r--  2.0 unx     8498 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/browser-es-module-loader.js
--rw-r--r--  2.0 unx     1084 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/LICENSE
--rw-r--r--  2.0 unx      301 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/README.md
--rw-r--r--  2.0 unx     1062 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/utils/common.js
--rw-r--r--  2.0 unx      666 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/zlib/adler32.js
--rw-r--r--  2.0 unx     1334 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/zlib/constants.js
--rw-r--r--  2.0 unx      764 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/zlib/crc32.js
--rw-r--r--  2.0 unx    60016 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/zlib/deflate.js
--rw-r--r--  2.0 unx     1251 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/zlib/gzheader.js
--rw-r--r--  2.0 unx    11690 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/zlib/inffast.js
--rw-r--r--  2.0 unx    47128 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/zlib/inflate.js
--rw-r--r--  2.0 unx    11527 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/zlib/inftrees.js
--rw-r--r--  2.0 unx      560 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/zlib/messages.js
--rw-r--r--  2.0 unx    38767 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/zlib/trees.js
--rw-r--r--  2.0 unx      823 b- defN 23-Jun-24 15:55 kvirt/web/static/vnc/vendor/pako/lib/zlib/zstream.js
--rw-r--r--  2.0 unx     2509 b- defN 23-Jun-24 15:55 kvirt/web/templates/bootstrap.html
--rw-r--r--  2.0 unx    14595 b- defN 23-Jun-24 15:55 kvirt/web/templates/console.html
--rw-r--r--  2.0 unx      717 b- defN 23-Jun-24 15:55 kvirt/web/templates/containercreate.html
--rw-r--r--  2.0 unx      493 b- defN 23-Jun-24 15:55 kvirt/web/templates/containerprofiles.html
--rw-r--r--  2.0 unx     1050 b- defN 23-Jun-24 15:55 kvirt/web/templates/containerprofilestable.html
--rw-r--r--  2.0 unx      490 b- defN 23-Jun-24 15:55 kvirt/web/templates/containers.html
--rw-r--r--  2.0 unx     1746 b- defN 23-Jun-24 15:55 kvirt/web/templates/containerstable.html
--rw-r--r--  2.0 unx     2123 b- defN 23-Jun-24 15:55 kvirt/web/templates/head.html
--rw-r--r--  2.0 unx      473 b- defN 23-Jun-24 15:55 kvirt/web/templates/hosts.html
--rw-r--r--  2.0 unx     1705 b- defN 23-Jun-24 15:55 kvirt/web/templates/hoststable.html
--rw-r--r--  2.0 unx     1119 b- defN 23-Jun-24 15:55 kvirt/web/templates/imagecreate.html
--rw-r--r--  2.0 unx      478 b- defN 23-Jun-24 15:55 kvirt/web/templates/images.html
--rw-r--r--  2.0 unx      646 b- defN 23-Jun-24 15:55 kvirt/web/templates/imagestable.html
--rw-r--r--  2.0 unx      472 b- defN 23-Jun-24 15:55 kvirt/web/templates/isos.html
--rw-r--r--  2.0 unx      261 b- defN 23-Jun-24 15:55 kvirt/web/templates/isostable.html
--rw-r--r--  2.0 unx      609 b- defN 23-Jun-24 15:55 kvirt/web/templates/kubecreate.html
--rw-r--r--  2.0 unx      622 b- defN 23-Jun-24 15:55 kvirt/web/templates/kubeinfo.html
--rw-r--r--  2.0 unx      488 b- defN 23-Jun-24 15:55 kvirt/web/templates/kubeprofiles.html
--rw-r--r--  2.0 unx      845 b- defN 23-Jun-24 15:55 kvirt/web/templates/kubeprofilestable.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jun-24 15:55 kvirt/web/templates/kubes.html
--rw-r--r--  2.0 unx     1850 b- defN 23-Jun-24 15:55 kvirt/web/templates/kubestable.html
--rw-r--r--  2.0 unx      151 b- defN 23-Jun-24 15:55 kvirt/web/templates/layout.html
--rw-r--r--  2.0 unx     5517 b- defN 23-Jun-24 15:55 kvirt/web/templates/navbar.html
--rw-r--r--  2.0 unx      882 b- defN 23-Jun-24 15:55 kvirt/web/templates/networkcreate.html
--rw-r--r--  2.0 unx      537 b- defN 23-Jun-24 15:55 kvirt/web/templates/networks.html
--rw-r--r--  2.0 unx      845 b- defN 23-Jun-24 15:55 kvirt/web/templates/networkstable.html
--rw-r--r--  2.0 unx      750 b- defN 23-Jun-24 15:55 kvirt/web/templates/plancreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jun-24 15:55 kvirt/web/templates/plans.html
--rw-r--r--  2.0 unx     1525 b- defN 23-Jun-24 15:55 kvirt/web/templates/planstable.html
--rw-r--r--  2.0 unx      859 b- defN 23-Jun-24 15:55 kvirt/web/templates/poolcreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jun-24 15:55 kvirt/web/templates/pools.html
--rw-r--r--  2.0 unx      554 b- defN 23-Jun-24 15:55 kvirt/web/templates/poolstable.html
--rw-r--r--  2.0 unx     1282 b- defN 23-Jun-24 15:55 kvirt/web/templates/productcreate.html
--rw-r--r--  2.0 unx      484 b- defN 23-Jun-24 15:55 kvirt/web/templates/products.html
--rw-r--r--  2.0 unx      895 b- defN 23-Jun-24 15:55 kvirt/web/templates/productstable.html
--rw-r--r--  2.0 unx      699 b- defN 23-Jun-24 15:55 kvirt/web/templates/repocreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jun-24 15:55 kvirt/web/templates/repos.html
--rw-r--r--  2.0 unx     1203 b- defN 23-Jun-24 15:55 kvirt/web/templates/repostable.html
--rw-r--r--  2.0 unx      958 b- defN 23-Jun-24 15:55 kvirt/web/templates/vmcreate.html
--rw-r--r--  2.0 unx      486 b- defN 23-Jun-24 15:55 kvirt/web/templates/vmprofiles.html
--rw-r--r--  2.0 unx     1420 b- defN 23-Jun-24 15:55 kvirt/web/templates/vmprofilestable.html
--rw-r--r--  2.0 unx      470 b- defN 23-Jun-24 15:55 kvirt/web/templates/vms.html
--rw-r--r--  2.0 unx     4894 b- defN 23-Jun-24 15:55 kvirt/web/templates/vmstable.html
--rw-r--r--  2.0 unx    11358 b- defN 23-Jun-24 15:58 kcli-99.0.202306241558.dist-info/LICENSE
--rw-r--r--  2.0 unx     3024 b- defN 23-Jun-24 15:58 kcli-99.0.202306241558.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-24 15:58 kcli-99.0.202306241558.dist-info/WHEEL
--rw-r--r--  2.0 unx      209 b- defN 23-Jun-24 15:58 kcli-99.0.202306241558.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        6 b- defN 23-Jun-24 15:58 kcli-99.0.202306241558.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    59226 b- defN 23-Jun-24 15:58 kcli-99.0.202306241558.dist-info/RECORD
-604 files, 4590396 bytes uncompressed, 1389390 bytes compressed:  69.7%
+Zip file size: 1490451 bytes, number of entries: 608
+-rw-r--r--  2.0 unx       15 b- defN 23-Jun-25 17:26 kvirt/__init__.py
+-rw-r--r--  2.0 unx   100420 b- defN 23-Jun-25 17:26 kvirt/baseconfig.py
+-rw-r--r--  2.0 unx   171487 b- defN 23-Jun-25 17:26 kvirt/bottle.py
+-rw-r--r--  2.0 unx   253634 b- defN 23-Jun-25 17:26 kvirt/cli.py
+-rw-r--r--  2.0 unx   192064 b- defN 23-Jun-25 17:26 kvirt/config.py
+-rw-r--r--  2.0 unx     2851 b- defN 23-Jun-25 17:26 kvirt/containerconfig.py
+-rw-r--r--  2.0 unx    11612 b- defN 23-Jun-25 17:26 kvirt/defaults.py
+-rw-r--r--  2.0 unx     1478 b- defN 23-Jun-25 17:26 kvirt/ekstoken.py
+-rw-r--r--  2.0 unx    20615 b- defN 23-Jun-25 17:26 kvirt/examples.py
+-rw-r--r--  2.0 unx     4333 b- defN 23-Jun-25 17:26 kvirt/ignitionmerger.py
+-rw-r--r--  2.0 unx     9871 b- defN 23-Jun-25 17:26 kvirt/keywords.yaml
+-rw-r--r--  2.0 unx     3487 b- defN 23-Jun-25 17:26 kvirt/klist.py
+-rw-r--r--  2.0 unx     6009 b- defN 23-Jun-25 17:26 kvirt/ansibleutils/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-25 17:26 kvirt/cluster/__init__.py
+-rw-r--r--  2.0 unx      204 b- defN 23-Jun-25 17:26 kvirt/cluster/sampleprovider.py
+-rw-r--r--  2.0 unx    11371 b- defN 23-Jun-25 17:26 kvirt/cluster/eks/__init__.py
+-rw-r--r--  2.0 unx       16 b- defN 23-Jun-25 17:26 kvirt/cluster/eks/fake.yml
+-rw-r--r--  2.0 unx      169 b- defN 23-Jun-25 17:26 kvirt/cluster/eks/kcli_default.yml
+-rw-r--r--  2.0 unx    12317 b- defN 23-Jun-25 17:26 kvirt/cluster/gke/__init__.py
+-rw-r--r--  2.0 unx       16 b- defN 23-Jun-25 17:26 kvirt/cluster/gke/fake.yml
+-rw-r--r--  2.0 unx      497 b- defN 23-Jun-25 17:26 kvirt/cluster/gke/kcli_default.yml
+-rw-r--r--  2.0 unx      312 b- defN 23-Jun-25 17:26 kvirt/cluster/gke/kubeconfig.j2
+-rw-r--r--  2.0 unx      931 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/99-apps.yaml
+-rw-r--r--  2.0 unx      694 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/99-forcedns
+-rw-r--r--  2.0 unx     1480 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/99-notifications.yaml
+-rw-r--r--  2.0 unx      653 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/Corefile
+-rw-r--r--  2.0 unx    43480 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/__init__.py
+-rw-r--r--  2.0 unx     1121 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/assisted_infra.yml
+-rw-r--r--  2.0 unx     1269 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/assisted_ingress.yml
+-rw-r--r--  2.0 unx     1366 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/autoapprovercron.yml
+-rw-r--r--  2.0 unx     1106 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/bmc.yml.j2
+-rw-r--r--  2.0 unx      511 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/calico.sh.j2
+-rw-r--r--  2.0 unx      200 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/cloud_lb_apps.yml
+-rw-r--r--  2.0 unx     1433 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/disconnected.sh
+-rw-r--r--  2.0 unx      184 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/extras.service
+-rw-r--r--  2.0 unx      839 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/extras.sh
+-rw-r--r--  2.0 unx     3131 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/hostedcluster.yaml
+-rw-r--r--  2.0 unx     1174 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/httpd.yaml
+-rw-r--r--  2.0 unx      889 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/ignition.sh
+-rw-r--r--  2.0 unx     2307 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/kcli_plan.yml
+-rw-r--r--  2.0 unx     2069 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/kcli_plan_default.yml
+-rw-r--r--  2.0 unx      502 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/keepalived.conf
+-rw-r--r--  2.0 unx     1587 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/nmstateconfig.yml.j2
+-rw-r--r--  2.0 unx      752 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/nodepool.yaml
+-rw-r--r--  2.0 unx       60 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/nonlocalbind.conf
+-rw-r--r--  2.0 unx     1890 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/staticpods/coredns.yml
+-rw-r--r--  2.0 unx     2142 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/staticpods/keepalived.yml
+-rw-r--r--  2.0 unx     1619 b- defN 23-Jun-25 17:26 kvirt/cluster/hypershift/staticpods/mdns.yml
+-rw-r--r--  2.0 unx    13415 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/__init__.py
+-rw-r--r--  2.0 unx     1117 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/bootstrap.sh
+-rw-r--r--  2.0 unx     1035 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/bootstrap.yml
+-rw-r--r--  2.0 unx      441 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/cloud_lb_api.yml
+-rw-r--r--  2.0 unx      440 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/ctlplanes.sh
+-rw-r--r--  2.0 unx     1068 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/ctlplanes.yml
+-rw-r--r--  2.0 unx      231 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/join.sh
+-rw-r--r--  2.0 unx     1265 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/kcli_default.yml
+-rw-r--r--  2.0 unx      511 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/keepalived.conf
+-rw-r--r--  2.0 unx      352 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/keepalived.sh
+-rw-r--r--  2.0 unx      166 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/workers.sh
+-rw-r--r--  2.0 unx      709 b- defN 23-Jun-25 17:26 kvirt/cluster/k3s/workers.yml
+-rw-r--r--  2.0 unx    13736 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/__init__.py
+-rwxr-xr-x  2.0 unx     2772 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/bootstrap.sh
+-rw-r--r--  2.0 unx     1550 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/bootstrap.yml
+-rw-r--r--  2.0 unx      338 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/cloud_lb_api.yml
+-rw-r--r--  2.0 unx     1172 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/ctlplanes.yml
+-rwxr-xr-x  2.0 unx      343 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/deploy.sh
+-rwxr-xr-x  2.0 unx      308 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/join.sh
+-rw-r--r--  2.0 unx     1839 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/kcli_default.yml
+-rw-r--r--  2.0 unx      563 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/keepalived.conf
+-rw-r--r--  2.0 unx      424 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/keepalived.sh
+-rw-r--r--  2.0 unx      140 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/kubernetes.repo
+-rw-r--r--  2.0 unx      179 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/multus.sh
+-rw-r--r--  2.0 unx      572 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/nfs.sh
+-rw-r--r--  2.0 unx      226 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/nfs.yml
+-rw-r--r--  2.0 unx     4021 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/pre_el.sh
+-rw-r--r--  2.0 unx     3906 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/pre_ubuntu.sh
+-rw-r--r--  2.0 unx     2127 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/registry.yml
+-rw-r--r--  2.0 unx      949 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/workers.yml
+-rw-r--r--  2.0 unx      487 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/argocd/ingress.yml
+-rw-r--r--  2.0 unx     2134 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/argocd/install.sh
+-rw-r--r--  2.0 unx       71 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/argocd/kcli_default.yml
+-rw-r--r--  2.0 unx      314 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/argocd/uninstall.sh
+-rw-r--r--  2.0 unx       90 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/autolabeller/install.sh
+-rw-r--r--  2.0 unx       91 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/autolabeller/uninstall.sh
+-rw-r--r--  2.0 unx      380 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/certmanager/install.sh
+-rw-r--r--  2.0 unx      317 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/dashboard/admin.yml
+-rw-r--r--  2.0 unx      452 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/dashboard/ingress.yml
+-rw-r--r--  2.0 unx     1433 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/dashboard/install.sh
+-rw-r--r--  2.0 unx       23 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/dashboard/kcli_default.yml
+-rw-r--r--  2.0 unx      373 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/dashboard/user.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/falco/falco_advertisements.yml
+-rw-r--r--  2.0 unx      185 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/falco/falco_ip.yml
+-rw-r--r--  2.0 unx      839 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/falco/install.sh
+-rw-r--r--  2.0 unx       57 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/falco/kcli_default.yml
+-rw-r--r--  2.0 unx      133 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/falco/uninstall.sh
+-rw-r--r--  2.0 unx      175 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/ingress/install.sh
+-rw-r--r--  2.0 unx      176 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/ingress/uninstall.sh
+-rw-r--r--  2.0 unx      112 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/istio/install.sh
+-rw-r--r--  2.0 unx      910 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/istio/istio-minimal-operator.yaml
+-rw-r--r--  2.0 unx      766 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/katacontainer/install.sh
+-rw-r--r--  2.0 unx      913 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/katacontainer/uninstall.sh
+-rw-r--r--  2.0 unx      198 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/knative/cr_eventing.yml
+-rw-r--r--  2.0 unx      194 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/knative/cr_serving.yml
+-rw-r--r--  2.0 unx      253 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/knative/install.sh
+-rw-r--r--  2.0 unx      670 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/kubevirt/install.sh
+-rw-r--r--  2.0 unx       30 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/kubevirt/kcli_default.yml
+-rw-r--r--  2.0 unx      534 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/metallb/install.sh
+-rw-r--r--  2.0 unx       47 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/metallb/kcli_default.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/metallb/metallb_advertisements.yml
+-rw-r--r--  2.0 unx      150 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/metallb/metallb_cr.yml
+-rw-r--r--  2.0 unx      283 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/metallb/uninstall.sh
+-rw-r--r--  2.0 unx      348 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/olm/install.sh
+-rw-r--r--  2.0 unx      350 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/olm/uninstall.sh
+-rw-r--r--  2.0 unx      320 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/policy_as_code/install.sh
+-rw-r--r--  2.0 unx       34 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/policy_as_code/kcli_default.yml
+-rw-r--r--  2.0 unx      322 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/policy_as_code/uninstall.sh
+-rw-r--r--  2.0 unx     1662 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/rancher/install.sh
+-rw-r--r--  2.0 unx      103 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/rancher/kcli_default.yml
+-rw-r--r--  2.0 unx      161 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/rancher/rancher_advertisements.yml
+-rw-r--r--  2.0 unx      191 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/rancher/rancher_ip.yml
+-rw-r--r--  2.0 unx      151 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/rancher/uninstall.sh
+-rw-r--r--  2.0 unx      572 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/rook/install.sh
+-rw-r--r--  2.0 unx      190 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/submariner/install.sh
+-rw-r--r--  2.0 unx       22 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/submariner/kcli_default.yml
+-rw-r--r--  2.0 unx      277 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/tekton/install.sh
+-rw-r--r--  2.0 unx      278 b- defN 23-Jun-25 17:26 kvirt/cluster/kubeadm/apps/tekton/uninstall.sh
+-rw-r--r--  2.0 unx     2970 b- defN 23-Jun-25 17:26 kvirt/cluster/kubecommon/__init__.py
+-rw-r--r--  2.0 unx     9395 b- defN 23-Jun-25 17:26 kvirt/cluster/kubernetes/__init__.py
+-rw-r--r--  2.0 unx     4782 b- defN 23-Jun-25 17:26 kvirt/cluster/microshift/__init__.py
+-rw-r--r--  2.0 unx      603 b- defN 23-Jun-25 17:26 kvirt/cluster/microshift/kcli_plan.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jun-25 17:26 kvirt/cluster/microshift/kcli_plan_default.yml
+-rw-r--r--  2.0 unx      262 b- defN 23-Jun-25 17:26 kvirt/cluster/microshift/scripts/00_sslip.sh
+-rw-r--r--  2.0 unx      799 b- defN 23-Jun-25 17:26 kvirt/cluster/microshift/scripts/01_clients.sh
+-rw-r--r--  2.0 unx      183 b- defN 23-Jun-25 17:26 kvirt/cluster/microshift/scripts/02_crio.sh
+-rw-r--r--  2.0 unx      538 b- defN 23-Jun-25 17:26 kvirt/cluster/microshift/scripts/03_microshift.sh
+-rw-r--r--  2.0 unx      341 b- defN 23-Jun-25 17:26 kvirt/cluster/microshift/scripts/04_kubeconfig.sh
+-rw-r--r--  2.0 unx     2252 b- defN 23-Jun-25 17:26 kvirt/cluster/microshift/scripts/05_acm.sh
+-rw-r--r--  2.0 unx      696 b- defN 23-Jun-25 17:26 kvirt/cluster/microshift/scripts/deploy.sh
+-rw-r--r--  2.0 unx      219 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/01-workload-partitioning
+-rw-r--r--  2.0 unx      573 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/10-node-ip-hint.yaml
+-rw-r--r--  2.0 unx      980 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-apps.yaml
+-rw-r--r--  2.0 unx      618 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-bootstrap-deletion-2.yaml
+-rw-r--r--  2.0 unx     1239 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-bootstrap-deletion.yaml
+-rw-r--r--  2.0 unx      529 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-chrony.yaml
+-rw-r--r--  2.0 unx      646 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-forcedns
+-rw-r--r--  2.0 unx      476 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-forcedns-ibm
+-rw-r--r--  2.0 unx      854 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-kubevirt-fix.yaml
+-rw-r--r--  2.0 unx     1127 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-localhost-fix.yaml
+-rw-r--r--  2.0 unx      250 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-metal3-fake-machine.yaml
+-rw-r--r--  2.0 unx      162 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     1659 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-notifications.yaml
+-rw-r--r--  2.0 unx      118 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-operatorhub.yaml
+-rw-r--r--  2.0 unx      314 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-ovn.yaml
+-rw-r--r--  2.0 unx      912 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/99-sno.yaml
+-rw-r--r--  2.0 unx      762 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/Corefile
+-rw-r--r--  2.0 unx    85605 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/__init__.py
+-rw-r--r--  2.0 unx     1326 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/autoapprovercron.yml
+-rw-r--r--  2.0 unx      987 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/autorules.yml
+-rw-r--r--  2.0 unx     1630 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/bootstrap.yml
+-rw-r--r--  2.0 unx      250 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/calico.sh.j2
+-rw-r--r--  2.0 unx      107 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/chrony.conf
+-rw-r--r--  2.0 unx      629 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/cloud_bootstrap.yml
+-rw-r--r--  2.0 unx      792 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/cloud_ctlplanes.yml
+-rw-r--r--  2.0 unx      217 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/cloud_dns.yml
+-rw-r--r--  2.0 unx      616 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/cloud_lb_api.yml
+-rw-r--r--  2.0 unx      224 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/cloud_lb_apps.yml
+-rw-r--r--  2.0 unx      703 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/cloud_workers.yml
+-rw-r--r--  2.0 unx      123 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/cluster-ingress-02-config.yml
+-rw-r--r--  2.0 unx      159 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/cluster-scheduler-02-config.yml
+-rw-r--r--  2.0 unx      224 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/config.hcl.templ
+-rw-r--r--  2.0 unx       98 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/contrail-ca-patch.service
+-rw-r--r--  2.0 unx      486 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/contrail-ca-patch.sh
+-rw-r--r--  2.0 unx       87 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/contrail.auth
+-rw-r--r--  2.0 unx     1108 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/contrail.sh.j2
+-rw-r--r--  2.0 unx     2278 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/ctlplanes.yml
+-rw-r--r--  2.0 unx      326 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/dhcp.conf
+-rw-r--r--  2.0 unx      106 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/dhcp.sh
+-rw-r--r--  2.0 unx      536 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/dhcp.yml
+-rw-r--r--  2.0 unx      836 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected.yml
+-rw-r--r--  2.0 unx     8945 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/fake_kubeconfig.json
+-rw-r--r--  2.0 unx       35 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/fake_pull.json
+-rw-r--r--  2.0 unx     1792 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/haproxy.cfg
+-rw-r--r--  2.0 unx     2483 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/haproxy.cfg.kubevirt
+-rw-r--r--  2.0 unx      902 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/httpd.yaml
+-rw-r--r--  2.0 unx      524 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/ignition.j2
+-rw-r--r--  2.0 unx     3835 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/install-config.yaml
+-rw-r--r--  2.0 unx     2691 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/iso.sh
+-rw-r--r--  2.0 unx      237 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/kcli-ipv6.conf.j2
+-rw-r--r--  2.0 unx     4489 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/kcli_default.yml
+-rw-r--r--  2.0 unx      982 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/keepalived.conf
+-rw-r--r--  2.0 unx       60 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/nonlocalbind.conf
+-rw-r--r--  2.0 unx       59 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/openshift-workload-pinning
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/relocate-ip-bootstrap.service
+-rw-r--r--  2.0 unx      281 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/relocate-ip-bootstrap.sh
+-rw-r--r--  2.0 unx      690 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/relocate-ip.sh
+-rw-r--r--  2.0 unx      212 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/sno-finish.service
+-rw-r--r--  2.0 unx     2085 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/sno-finish.sh
+-rw-r--r--  2.0 unx      660 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/sno.yml
+-rw-r--r--  2.0 unx     1615 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/workers.yml
+-rw-r--r--  2.0 unx       40 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/cr.sh
+-rw-r--r--  2.0 unx      768 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/install.yml.j2
+-rw-r--r--  2.0 unx      162 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/advanced-cluster-management/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     2913 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sample.yml
+-rwxr-xr-x  2.0 unx     2838 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sh
+-rw-r--r--  2.0 unx      418 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/advanced-cluster-management/cr.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/advanced-cluster-management/gen_registries.py
+-rw-r--r--  2.0 unx      290 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/advanced-cluster-management/kcli_default.yml
+-rw-r--r--  2.0 unx     1219 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/advanced-cluster-management/post.sh
+-rw-r--r--  2.0 unx      645 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/argocd/configmap.yml
+-rw-r--r--  2.0 unx     2423 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/argocd/install.sh
+-rw-r--r--  2.0 unx       49 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/argocd/kcli_default.yml
+-rw-r--r--  2.0 unx     1093 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/autolabeller/cr.yml
+-rw-r--r--  2.0 unx      142 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/autolabeller/install.sh
+-rw-r--r--  2.0 unx     1093 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/autolabeller/install.yml
+-rw-r--r--  2.0 unx      165 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/autolabeller/kcli_default.yml
+-rw-r--r--  2.0 unx       25 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/autolabeller/uninstall.sh
+-rw-r--r--  2.0 unx      873 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/cluster-logging/cr.yml
+-rw-r--r--  2.0 unx       63 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/cluster-logging/kcli_default.yml
+-rw-r--r--  2.0 unx      265 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/istio/install.sh
+-rw-r--r--  2.0 unx      377 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/istio/istio-cni.yaml
+-rw-r--r--  2.0 unx     1039 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/cr.yml
+-rw-r--r--  2.0 unx      154 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/kcli_default.yml
+-rw-r--r--  2.0 unx      775 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/local-storage-operator/cr.yml
+-rw-r--r--  2.0 unx      227 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/local-storage-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      642 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/local-storage-operator/post.sh
+-rw-r--r--  2.0 unx      349 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/lvms-operator/cr.yml
+-rw-r--r--  2.0 unx      137 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/lvms-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      595 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/lvms-operator/post.sh
+-rw-r--r--  2.0 unx      510 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/metallb-operator/cr.yml
+-rw-r--r--  2.0 unx       94 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/metallb-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      162 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/multicluster-engine/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     2913 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sample.yml
+-rwxr-xr-x  2.0 unx     2845 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sh
+-rw-r--r--  2.0 unx      245 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/multicluster-engine/cr.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/multicluster-engine/gen_registries.py
+-rw-r--r--  2.0 unx      149 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/multicluster-engine/kcli_default.yml
+-rwxr-xr-x  2.0 unx       55 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/multicluster-engine/post.sh
+-rwxr-xr-x  2.0 unx     2298 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/nfs/install.sh
+-rw-r--r--  2.0 unx      117 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/nfs/kcli_default.yml
+-rw-r--r--  2.0 unx      185 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/nfs/uninstall.sh
+-rw-r--r--  2.0 unx      849 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/odf-operator/cr.yml
+-rw-r--r--  2.0 unx      298 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/odf-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      364 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/odf-operator/nad_cluster.yml
+-rw-r--r--  2.0 unx      362 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/odf-operator/nad_public.yml
+-rw-r--r--  2.0 unx      745 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/odf-operator/post.sh
+-rw-r--r--  2.0 unx      530 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/odf-operator/pre.sh
+-rw-r--r--  2.0 unx      363 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/serverless-operator/cr.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/serverless-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      278 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/serverless-operator/post.sh
+-rw-r--r--  2.0 unx     1227 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/users/install.sh
+-rw-r--r--  2.0 unx       84 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/users/kcli_default.yml
+-rw-r--r--  2.0 unx      258 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/users/oauth.yml
+-rw-r--r--  2.0 unx      249 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/users/oauth_hypershift.yml
+-rw-r--r--  2.0 unx      422 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/apps/users/uninstall.sh
+-rw-r--r--  2.0 unx       60 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/customisation/00-kcli-namespace.yaml
+-rw-r--r--  2.0 unx       91 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/customisation/97-autoapprovercron-sa.yaml
+-rw-r--r--  2.0 unx      264 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/customisation/98-autoapprovercron-binding.yaml
+-rw-r--r--  2.0 unx      912 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/customisation/99-autoapprovercron-cronjob.yaml
+-rw-r--r--  2.0 unx      389 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/customisation/99-ingress-controller.yaml
+-rw-r--r--  2.0 unx      184 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/customisation/99-monitoring.yaml
+-rw-r--r--  2.0 unx      289 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/customisation/99-registry.yaml
+-rw-r--r--  2.0 unx     1685 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected/haproxy.cfg
+-rw-r--r--  2.0 unx      211 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected/registry.service
+-rwxr-xr-x  2.0 unx      328 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected/bin/sync_image.sh
+-rwxr-xr-x  2.0 unx      201 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected/scripts/01_get_oc.sh
+-rwxr-xr-x  2.0 unx     2381 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected/scripts/03_mirror.sh
+-rwxr-xr-x  2.0 unx     2046 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected/scripts/03_registry.sh
+-rwxr-xr-x  2.0 unx      337 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected/scripts/04_extras.sh
+-rwxr-xr-x  2.0 unx     2319 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected/scripts/05_olm.sh
+-rwxr-xr-x  2.0 unx      241 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected/scripts/06_web.sh
+-rwxr-xr-x  2.0 unx      733 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected/scripts/deploy.sh
+-rw-r--r--  2.0 unx     4223 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/disconnected/scripts/mirror-config.yaml.sample
+-rw-r--r--  2.0 unx     2557 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/staticpods/coredns.yml
+-rw-r--r--  2.0 unx      987 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/staticpods/haproxy.yml
+-rw-r--r--  2.0 unx     2539 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/staticpods/keepalived.yml
+-rw-r--r--  2.0 unx     1721 b- defN 23-Jun-25 17:26 kvirt/cluster/openshift/staticpods/mdns.yml
+-rw-r--r--  2.0 unx      193 b- defN 23-Jun-25 17:26 kvirt/cluster/profiles/sample-kubeadm-default.yml
+-rw-r--r--  2.0 unx      135 b- defN 23-Jun-25 17:26 kvirt/cluster/profiles/sample-openshift-compact.yml
+-rw-r--r--  2.0 unx      210 b- defN 23-Jun-25 17:26 kvirt/cluster/profiles/sample-openshift-contrail.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-25 17:26 kvirt/cluster/profiles/sample-openshift-ipv6.yml
+-rw-r--r--  2.0 unx       55 b- defN 23-Jun-25 17:26 kvirt/cluster/profiles/sample-openshift-sno-bm.yml
+-rw-r--r--  2.0 unx      148 b- defN 23-Jun-25 17:26 kvirt/cluster/profiles/sample-openshift-sno.yml
+-rw-r--r--  2.0 unx     3377 b- defN 23-Jun-25 17:26 kvirt/common/Jenkinsfile.j2
+-rw-r--r--  2.0 unx    98237 b- defN 23-Jun-25 17:26 kvirt/common/__init__.py
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jun-25 17:26 kvirt/common/autoscale.yaml.j2
+-rw-r--r--  2.0 unx     8945 b- defN 23-Jun-25 17:26 kvirt/common/fake_kubeconfig.json
+-rw-r--r--  2.0 unx      669 b- defN 23-Jun-25 17:26 kvirt/common/ignition.j2
+-rw-r--r--  2.0 unx      125 b- defN 23-Jun-25 17:26 kvirt/common/kubevirt_kcli_conf.j2
+-rw-r--r--  2.0 unx       99 b- defN 23-Jun-25 17:26 kvirt/common/local_kcli_conf.j2
+-rw-r--r--  2.0 unx     3068 b- defN 23-Jun-25 17:26 kvirt/common/pipeline.yml.j2
+-rw-r--r--  2.0 unx     2377 b- defN 23-Jun-25 17:26 kvirt/common/pipeline_kube.yml.j2
+-rw-r--r--  2.0 unx     1381 b- defN 23-Jun-25 17:26 kvirt/common/playbook.j2
+-rw-r--r--  2.0 unx      833 b- defN 23-Jun-25 17:26 kvirt/common/storage.sh.aws
+-rw-r--r--  2.0 unx      635 b- defN 23-Jun-25 17:26 kvirt/common/storage.sh.gcp
+-rw-r--r--  2.0 unx       68 b- defN 23-Jun-25 17:26 kvirt/common/storage.sh.ibmcloud
+-rw-r--r--  2.0 unx     4562 b- defN 23-Jun-25 17:26 kvirt/common/vm.ovf.j2
+-rw-r--r--  2.0 unx     2241 b- defN 23-Jun-25 17:26 kvirt/common/workflow.yml.j2
+-rw-r--r--  2.0 unx     2208 b- defN 23-Jun-25 17:26 kvirt/common/workflow_script.yml.j2
+-rw-r--r--  2.0 unx    15041 b- defN 23-Jun-25 17:26 kvirt/container/__init__.py
+-rw-r--r--  2.0 unx    11716 b- defN 23-Jun-25 17:26 kvirt/expose/__init__.py
+-rw-r--r--  2.0 unx     4319 b- defN 23-Jun-25 17:26 kvirt/expose/swagger.yml
+-rw-r--r--  2.0 unx      408 b- defN 23-Jun-25 17:26 kvirt/expose/static/css/bootstrap-notify.css
+-rw-r--r--  2.0 unx   121125 b- defN 23-Jun-25 17:26 kvirt/expose/static/css/bootstrap.min.css
+-rw-r--r--  2.0 unx      399 b- defN 23-Jun-25 17:26 kvirt/expose/static/css/dataTables.checkboxes.css
+-rw-r--r--  2.0 unx    13587 b- defN 23-Jun-25 17:26 kvirt/expose/static/css/jquery.dataTables.min.css
+-rw-r--r--  2.0 unx      868 b- defN 23-Jun-25 17:26 kvirt/expose/static/css/kcli.css
+-rw-r--r--  2.0 unx      269 b- defN 23-Jun-25 17:26 kvirt/expose/static/css/wheel.css
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jun-25 17:26 kvirt/expose/static/images/favicon.ico
+-rw-r--r--  2.0 unx      160 b- defN 23-Jun-25 17:26 kvirt/expose/static/images/sort_asc.png
+-rw-r--r--  2.0 unx      201 b- defN 23-Jun-25 17:26 kvirt/expose/static/images/sort_both.png
+-rw-r--r--  2.0 unx      158 b- defN 23-Jun-25 17:26 kvirt/expose/static/images/sort_desc.png
+-rw-r--r--  2.0 unx    24772 b- defN 23-Jun-25 17:26 kvirt/expose/static/images/wheel.gif
+-rw-r--r--  2.0 unx    12398 b- defN 23-Jun-25 17:26 kvirt/expose/static/js/dataTables.checkboxes.min.js
+-rw-r--r--  2.0 unx      367 b- defN 23-Jun-25 17:26 kvirt/expose/static/js/exposeactions.js
+-rw-r--r--  2.0 unx    83059 b- defN 23-Jun-25 17:26 kvirt/expose/static/js/jquery.dataTables.min.js
+-rw-r--r--  2.0 unx    89795 b- defN 23-Jun-25 17:26 kvirt/expose/static/js/jquery.min.js
+-rw-r--r--  2.0 unx      263 b- defN 23-Jun-25 17:26 kvirt/expose/static/js/list.js
+-rw-r--r--  2.0 unx     1605 b- defN 23-Jun-25 17:26 kvirt/expose/templates/form.html
+-rw-r--r--  2.0 unx     1035 b- defN 23-Jun-25 17:26 kvirt/expose/templates/head.html
+-rw-r--r--  2.0 unx      406 b- defN 23-Jun-25 17:26 kvirt/expose/templates/index.html
+-rw-r--r--  2.0 unx     1220 b- defN 23-Jun-25 17:26 kvirt/expose/templates/infoplan.html
+-rw-r--r--  2.0 unx      574 b- defN 23-Jun-25 17:26 kvirt/expose/templates/planstable.html
+-rw-r--r--  2.0 unx      550 b- defN 23-Jun-25 17:26 kvirt/expose/templates/result.html
+-rw-r--r--  2.0 unx     1754 b- defN 23-Jun-25 17:26 kvirt/internalplans/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-25 17:26 kvirt/jinjafilters/__init__.py
+-rw-r--r--  2.0 unx     5351 b- defN 23-Jun-25 17:26 kvirt/jinjafilters/jinjafilters.py
+-rw-r--r--  2.0 unx     8477 b- defN 23-Jun-25 17:26 kvirt/kfish/__init__.py
+-rw-r--r--  2.0 unx    10384 b- defN 23-Jun-25 17:26 kvirt/ksushy/__init__.py
+-rw-r--r--  2.0 unx      121 b- defN 23-Jun-25 17:26 kvirt/ksushy/main.py
+-rw-r--r--  2.0 unx     1028 b- defN 23-Jun-25 17:26 kvirt/ksushy/templates/bios.json
+-rw-r--r--  2.0 unx      443 b- defN 23-Jun-25 17:26 kvirt/ksushy/templates/interface.json
+-rw-r--r--  2.0 unx      418 b- defN 23-Jun-25 17:26 kvirt/ksushy/templates/interfaces.json
+-rw-r--r--  2.0 unx     1050 b- defN 23-Jun-25 17:26 kvirt/ksushy/templates/manager.json
+-rw-r--r--  2.0 unx      571 b- defN 23-Jun-25 17:26 kvirt/ksushy/templates/managers.json
+-rw-r--r--  2.0 unx      535 b- defN 23-Jun-25 17:26 kvirt/ksushy/templates/root.json
+-rw-r--r--  2.0 unx     2732 b- defN 23-Jun-25 17:26 kvirt/ksushy/templates/system.json
+-rw-r--r--  2.0 unx      511 b- defN 23-Jun-25 17:26 kvirt/ksushy/templates/systems.json
+-rw-r--r--  2.0 unx     1219 b- defN 23-Jun-25 17:26 kvirt/ksushy/templates/virtualmedia_cd.json
+-rw-r--r--  2.0 unx      705 b- defN 23-Jun-25 17:26 kvirt/ksushy/templates/virtualmedias.json
+-rw-r--r--  2.0 unx     2780 b- defN 23-Jun-25 17:26 kvirt/miniconsole/__init__.py
+-rw-r--r--  2.0 unx     3721 b- defN 23-Jun-25 17:26 kvirt/nameutils/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-25 17:26 kvirt/providers/__init__.py
+-rw-r--r--  2.0 unx     9038 b- defN 23-Jun-25 17:26 kvirt/providers/sampleprovider.py
+-rw-r--r--  2.0 unx    67298 b- defN 23-Jun-25 17:26 kvirt/providers/aws/__init__.py
+-rw-r--r--  2.0 unx      479 b- defN 23-Jun-25 17:26 kvirt/providers/fake/__init__.py
+-rw-r--r--  2.0 unx    74801 b- defN 23-Jun-25 17:26 kvirt/providers/gcp/__init__.py
+-rw-r--r--  2.0 unx      175 b- defN 23-Jun-25 17:26 kvirt/providers/gcp/gcp-hack.service
+-rw-r--r--  2.0 unx      231 b- defN 23-Jun-25 17:26 kvirt/providers/gcp/gcp-hack.sh
+-rw-r--r--  2.0 unx    65166 b- defN 23-Jun-25 17:26 kvirt/providers/ibm/__init__.py
+-rw-r--r--  2.0 unx    81078 b- defN 23-Jun-25 17:26 kvirt/providers/kubevirt/__init__.py
+-rw-r--r--  2.0 unx   185506 b- defN 23-Jun-25 17:26 kvirt/providers/kvm/__init__.py
+-rw-r--r--  2.0 unx     1965 b- defN 23-Jun-25 17:26 kvirt/providers/kvm/helpers.py
+-rw-r--r--  2.0 unx    57194 b- defN 23-Jun-25 17:26 kvirt/providers/openstack/__init__.py
+-rw-r--r--  2.0 unx    62662 b- defN 23-Jun-25 17:26 kvirt/providers/ovirt/__init__.py
+-rw-r--r--  2.0 unx    31230 b- defN 23-Jun-25 17:26 kvirt/providers/packet/__init__.py
+-rw-r--r--  2.0 unx    73215 b- defN 23-Jun-25 17:26 kvirt/providers/vsphere/__init__.py
+-rw-r--r--  2.0 unx    13655 b- defN 23-Jun-25 17:26 kvirt/providers/vsphere/helpers.py
+-rw-r--r--  2.0 unx     4893 b- defN 23-Jun-25 17:26 kvirt/providers/vsphere/tagging.py
+-rw-r--r--  2.0 unx    21420 b- defN 23-Jun-25 17:26 kvirt/providers/web/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-25 17:26 kvirt/version/__init__.py
+-rw-r--r--  2.0 unx       19 b- defN 23-Jun-25 17:29 kvirt/version/git
+-rw-r--r--  2.0 unx    46652 b- defN 23-Jun-25 17:26 kvirt/web/__init__.py
+-rw-r--r--  2.0 unx      261 b- defN 23-Jun-25 17:26 kvirt/web/main.py
+-rw-r--r--  2.0 unx      408 b- defN 23-Jun-25 17:26 kvirt/web/static/css/bootstrap-notify.css
+-rw-r--r--  2.0 unx    23409 b- defN 23-Jun-25 17:26 kvirt/web/static/css/bootstrap-theme.min.css
+-rw-r--r--  2.0 unx   121125 b- defN 23-Jun-25 17:26 kvirt/web/static/css/bootstrap.min.css
+-rw-r--r--  2.0 unx      399 b- defN 23-Jun-25 17:26 kvirt/web/static/css/dataTables.checkboxes.css
+-rw-r--r--  2.0 unx    13587 b- defN 23-Jun-25 17:26 kvirt/web/static/css/jquery.dataTables.min.css
+-rw-r--r--  2.0 unx      816 b- defN 23-Jun-25 17:26 kvirt/web/static/css/kcli.css
+-rw-r--r--  2.0 unx     3033 b- defN 23-Jun-25 17:26 kvirt/web/static/css/navbar.css
+-rw-r--r--  2.0 unx     2908 b- defN 23-Jun-25 17:26 kvirt/web/static/css/spice.css
+-rw-r--r--  2.0 unx      271 b- defN 23-Jun-25 17:26 kvirt/web/static/css/wheel.css
+-rw-r--r--  2.0 unx    18028 b- defN 23-Jun-25 17:26 kvirt/web/static/fonts/glyphicons-halflings-regular.woff2
+-rw-r--r--  2.0 unx      715 b- defN 23-Jun-25 17:26 kvirt/web/static/images/Centos.png
+-rw-r--r--  2.0 unx      294 b- defN 23-Jun-25 17:26 kvirt/web/static/images/Debian.png
+-rw-r--r--  2.0 unx      987 b- defN 23-Jun-25 17:26 kvirt/web/static/images/Fedora.png
+-rw-r--r--  2.0 unx      672 b- defN 23-Jun-25 17:26 kvirt/web/static/images/Redhat.png
+-rw-r--r--  2.0 unx     1278 b- defN 23-Jun-25 17:26 kvirt/web/static/images/Suse.png
+-rw-r--r--  2.0 unx     1782 b- defN 23-Jun-25 17:26 kvirt/web/static/images/Tux.png
+-rw-r--r--  2.0 unx      544 b- defN 23-Jun-25 17:26 kvirt/web/static/images/Ubuntu.png
+-rw-r--r--  2.0 unx     4213 b- defN 23-Jun-25 17:26 kvirt/web/static/images/delete.png
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jun-25 17:26 kvirt/web/static/images/favicon.ico
+-rw-r--r--  2.0 unx    23320 b- defN 23-Jun-25 17:26 kvirt/web/static/images/kcli-small.png
+-rw-r--r--  2.0 unx    27185 b- defN 23-Jun-25 17:26 kvirt/web/static/images/kcli.jpg
+-rw-r--r--  2.0 unx   113928 b- defN 23-Jun-25 17:26 kvirt/web/static/images/kcli.png
+-rw-r--r--  2.0 unx    48809 b- defN 23-Jun-25 17:26 kvirt/web/static/images/logo-header.svg
+-rw-r--r--  2.0 unx    48809 b- defN 23-Jun-25 17:26 kvirt/web/static/images/logo-main.svg
+-rw-r--r--  2.0 unx      160 b- defN 23-Jun-25 17:26 kvirt/web/static/images/sort_asc.png
+-rw-r--r--  2.0 unx      201 b- defN 23-Jun-25 17:26 kvirt/web/static/images/sort_both.png
+-rw-r--r--  2.0 unx      158 b- defN 23-Jun-25 17:26 kvirt/web/static/images/sort_desc.png
+-rw-r--r--  2.0 unx     3927 b- defN 23-Jun-25 17:26 kvirt/web/static/images/start.png
+-rw-r--r--  2.0 unx     3631 b- defN 23-Jun-25 17:26 kvirt/web/static/images/stop.png
+-rw-r--r--  2.0 unx    24772 b- defN 23-Jun-25 17:26 kvirt/web/static/images/wheel.gif
+-rw-r--r--  2.0 unx     2933 b- defN 23-Jun-25 17:26 kvirt/web/static/js/bootstrap-notify.js
+-rw-r--r--  2.0 unx    37045 b- defN 23-Jun-25 17:26 kvirt/web/static/js/bootstrap.min.js
+-rw-r--r--  2.0 unx     2523 b- defN 23-Jun-25 17:26 kvirt/web/static/js/containeraction.js
+-rw-r--r--  2.0 unx    12398 b- defN 23-Jun-25 17:26 kvirt/web/static/js/dataTables.checkboxes.min.js
+-rw-r--r--  2.0 unx     1642 b- defN 23-Jun-25 17:26 kvirt/web/static/js/hostaction.js
+-rw-r--r--  2.0 unx     1187 b- defN 23-Jun-25 17:26 kvirt/web/static/js/imageaction.js
+-rw-r--r--  2.0 unx    83059 b- defN 23-Jun-25 17:26 kvirt/web/static/js/jquery.dataTables.min.js
+-rw-r--r--  2.0 unx    87462 b- defN 23-Jun-25 17:26 kvirt/web/static/js/jquery.min.js
+-rw-r--r--  2.0 unx     2704 b- defN 23-Jun-25 17:26 kvirt/web/static/js/kcli.js
+-rw-r--r--  2.0 unx     1594 b- defN 23-Jun-25 17:26 kvirt/web/static/js/kubeaction.js
+-rw-r--r--  2.0 unx     3907 b- defN 23-Jun-25 17:26 kvirt/web/static/js/list.js
+-rw-r--r--  2.0 unx     1376 b- defN 23-Jun-25 17:26 kvirt/web/static/js/networkaction.js
+-rw-r--r--  2.0 unx     2457 b- defN 23-Jun-25 17:26 kvirt/web/static/js/planaction.js
+-rw-r--r--  2.0 unx     1237 b- defN 23-Jun-25 17:26 kvirt/web/static/js/poolaction.js
+-rw-r--r--  2.0 unx      846 b- defN 23-Jun-25 17:26 kvirt/web/static/js/productaction.js
+-rw-r--r--  2.0 unx      270 b- defN 23-Jun-25 17:26 kvirt/web/static/js/refresh.js
+-rw-r--r--  2.0 unx     1835 b- defN 23-Jun-25 17:26 kvirt/web/static/js/repoaction.js
+-rw-r--r--  2.0 unx     3463 b- defN 23-Jun-25 17:26 kvirt/web/static/js/snapshotaction.js
+-rw-r--r--  2.0 unx     2745 b- defN 23-Jun-25 17:26 kvirt/web/static/js/vmaction.js
+-rw-r--r--  2.0 unx      123 b- defN 23-Jun-25 17:26 kvirt/web/static/js/wheel.js
+-rw-r--r--  2.0 unx     9944 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/atKeynames.js
+-rw-r--r--  2.0 unx     2335 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/bitmap.js
+-rw-r--r--  2.0 unx     4795 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/cursor.js
+-rw-r--r--  2.0 unx    49214 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/display.js
+-rw-r--r--  2.0 unx    13253 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/enums.js
+-rw-r--r--  2.0 unx     2847 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/filexfer.js
+-rw-r--r--  2.0 unx     9535 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/inputs.js
+-rw-r--r--  2.0 unx     6176 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/lz.js
+-rw-r--r--  2.0 unx    18370 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/main.js
+-rw-r--r--  2.0 unx    12677 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/playback.js
+-rw-r--r--  2.0 unx     7036 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/png.js
+-rw-r--r--  2.0 unx     3110 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/port.js
+-rw-r--r--  2.0 unx    44531 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/quic.js
+-rw-r--r--  2.0 unx     3030 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/resize.js
+-rw-r--r--  2.0 unx     7282 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/simulatecursor.js
+-rw-r--r--  2.0 unx     1895 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/spicearraybuffer.js
+-rw-r--r--  2.0 unx    18202 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/spiceconn.js
+-rw-r--r--  2.0 unx     3616 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/spicedataview.js
+-rw-r--r--  2.0 unx    33015 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/spicemsg.js
+-rw-r--r--  2.0 unx    12767 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/spicetype.js
+-rw-r--r--  2.0 unx     6808 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/ticket.js
+-rw-r--r--  2.0 unx    13628 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/utils.js
+-rw-r--r--  2.0 unx    21577 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/webm.js
+-rw-r--r--  2.0 unx     4131 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/wire.js
+-rw-r--r--  2.0 unx    16580 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/thirdparty/jsbn.js
+-rw-r--r--  2.0 unx     2529 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/thirdparty/prng4.js
+-rw-r--r--  2.0 unx     3442 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/thirdparty/rng.js
+-rw-r--r--  2.0 unx     4257 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/thirdparty/rsa.js
+-rw-r--r--  2.0 unx    10671 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/thirdparty/sha1.js
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/.npmignore
+-rw-r--r--  2.0 unx      419 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/README.md
+-rw-r--r--  2.0 unx      359 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/rollup.config.js
+-rw-r--r--  2.0 unx     1113 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/babel-worker.js
+-rw-r--r--  2.0 unx     8601 b- defN 23-Jun-25 17:26 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/browser-es-module-loader.js
+-rw-r--r--  2.0 unx     2176 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/error-handler.js
+-rw-r--r--  2.0 unx     5682 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/localization.js
+-rw-r--r--  2.0 unx    56845 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/ui.js
+-rw-r--r--  2.0 unx     6696 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/webutil.js
+-rw-r--r--  2.0 unx     3553 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/alt.svg
+-rw-r--r--  2.0 unx     3980 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/clipboard.svg
+-rw-r--r--  2.0 unx     3430 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/connect.svg
+-rw-r--r--  2.0 unx     4381 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/ctrl.svg
+-rw-r--r--  2.0 unx     3237 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/ctrlaltdel.svg
+-rw-r--r--  2.0 unx     5062 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/disconnect.svg
+-rw-r--r--  2.0 unx     4684 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/drag.svg
+-rw-r--r--  2.0 unx     3106 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/error.svg
+-rw-r--r--  2.0 unx     4522 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/esc.svg
+-rw-r--r--  2.0 unx     3066 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/expander.svg
+-rw-r--r--  2.0 unx     3139 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/fullscreen.svg
+-rw-r--r--  2.0 unx     2559 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/handle.svg
+-rw-r--r--  2.0 unx     6386 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/handle_bg.svg
+-rw-r--r--  2.0 unx     3204 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/info.svg
+-rw-r--r--  2.0 unx     6404 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/keyboard.svg
+-rw-r--r--  2.0 unx     7000 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/mouse_left.svg
+-rw-r--r--  2.0 unx     7002 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/mouse_middle.svg
+-rw-r--r--  2.0 unx     6993 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/mouse_none.svg
+-rw-r--r--  2.0 unx     7001 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/mouse_right.svg
+-rw-r--r--  2.0 unx     3985 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/power.svg
+-rw-r--r--  2.0 unx     3082 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/settings.svg
+-rw-r--r--  2.0 unx     2953 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/tab.svg
+-rw-r--r--  2.0 unx     4441 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/toggleextrakeys.svg
+-rw-r--r--  2.0 unx     3869 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/warning.svg
+-rw-r--r--  2.0 unx     3178 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/windows.svg
+-rw-r--r--  2.0 unx      871 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/Makefile
+-rw-r--r--  2.0 unx     4028 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-120x120.png
+-rw-r--r--  2.0 unx     4582 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-144x144.png
+-rw-r--r--  2.0 unx     5216 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-152x152.png
+-rw-r--r--  2.0 unx      675 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-16x16.png
+-rw-r--r--  2.0 unx     5787 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-192x192.png
+-rw-r--r--  2.0 unx     1000 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-24x24.png
+-rw-r--r--  2.0 unx     1064 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-32x32.png
+-rw-r--r--  2.0 unx     1397 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-48x48.png
+-rw-r--r--  2.0 unx     1932 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-60x60.png
+-rw-r--r--  2.0 unx     1946 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-64x64.png
+-rw-r--r--  2.0 unx     2699 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-72x72.png
+-rw-r--r--  2.0 unx     2874 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-76x76.png
+-rw-r--r--  2.0 unx     2351 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-96x96.png
+-rw-r--r--  2.0 unx    11685 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-icon-sm.svg
+-rw-r--r--  2.0 unx    11549 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/images/icons/novnc-icon.svg
+-rw-r--r--  2.0 unx     2885 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/cs.json
+-rw-r--r--  2.0 unx     2854 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/de.json
+-rw-r--r--  2.0 unx     3906 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/el.json
+-rw-r--r--  2.0 unx     2671 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/es.json
+-rw-r--r--  2.0 unx     3354 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/ja.json
+-rw-r--r--  2.0 unx     2961 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/ko.json
+-rw-r--r--  2.0 unx     3035 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/nl.json
+-rw-r--r--  2.0 unx     2830 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/pl.json
+-rw-r--r--  2.0 unx     3825 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/ru.json
+-rw-r--r--  2.0 unx     2845 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/sv.json
+-rw-r--r--  2.0 unx     2811 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/tr.json
+-rw-r--r--  2.0 unx     2597 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/zh_CN.json
+-rw-r--r--  2.0 unx     2606 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/locale/zh_TW.json
+-rw-r--r--  2.0 unx      157 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/sounds/CREDITS
+-rw-r--r--  2.0 unx     4531 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/sounds/bell.mp3
+-rw-r--r--  2.0 unx     8495 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/sounds/bell.oga
+-rw-r--r--  2.0 unx    38580 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/styles/Orbitron700.ttf
+-rw-r--r--  2.0 unx    17472 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/styles/Orbitron700.woff
+-rw-r--r--  2.0 unx    18450 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/app/styles/base.css
+-rw-r--r--  2.0 unx     4189 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/base64.js
+-rw-r--r--  2.0 unx    11241 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/des.js
+-rw-r--r--  2.0 unx    20381 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/display.js
+-rw-r--r--  2.0 unx     1374 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/encodings.js
+-rw-r--r--  2.0 unx     1170 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/inflator.js
+-rw-r--r--  2.0 unx    74196 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/rfb.js
+-rw-r--r--  2.0 unx     9130 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/websock.js
+-rw-r--r--  2.0 unx      628 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/decoders/copyrect.js
+-rw-r--r--  2.0 unx     4814 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/decoders/hextile.js
+-rw-r--r--  2.0 unx     1739 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/decoders/raw.js
+-rw-r--r--  2.0 unx     1210 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/decoders/rre.js
+-rw-r--r--  2.0 unx     9662 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/decoders/tight.js
+-rw-r--r--  2.0 unx      768 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/decoders/tightpng.js
+-rw-r--r--  2.0 unx    11438 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/input/domkeytable.js
+-rw-r--r--  2.0 unx     3804 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/input/fixedkeys.js
+-rw-r--r--  2.0 unx    13090 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/input/keyboard.js
+-rw-r--r--  2.0 unx    34609 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/input/keysym.js
+-rw-r--r--  2.0 unx    25374 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/input/keysymdef.js
+-rw-r--r--  2.0 unx     9995 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/input/mouse.js
+-rw-r--r--  2.0 unx     5283 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/input/util.js
+-rw-r--r--  2.0 unx     2580 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/input/vkeys.js
+-rw-r--r--  2.0 unx    14256 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/input/xtscancodes.js
+-rw-r--r--  2.0 unx     3155 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/util/browser.js
+-rw-r--r--  2.0 unx     7556 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/util/cursor.js
+-rw-r--r--  2.0 unx     4221 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/util/events.js
+-rw-r--r--  2.0 unx      896 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/util/eventtarget.js
+-rw-r--r--  2.0 unx     1358 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/util/logging.js
+-rw-r--r--  2.0 unx     1866 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/util/polyfill.js
+-rw-r--r--  2.0 unx      301 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/core/util/strings.js
+-rw-r--r--  2.0 unx     7388 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/promise.js
+-rw-r--r--  2.0 unx      419 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/browser-es-module-loader/README.md
+-rw-r--r--  2.0 unx      295 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/browser-es-module-loader/rollup.config.js
+-rw-r--r--  2.0 unx     1113 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/babel-worker.js
+-rw-r--r--  2.0 unx     8498 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/browser-es-module-loader.js
+-rw-r--r--  2.0 unx     1084 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/LICENSE
+-rw-r--r--  2.0 unx      301 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/README.md
+-rw-r--r--  2.0 unx     1062 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/utils/common.js
+-rw-r--r--  2.0 unx      666 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/zlib/adler32.js
+-rw-r--r--  2.0 unx     1334 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/zlib/constants.js
+-rw-r--r--  2.0 unx      764 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/zlib/crc32.js
+-rw-r--r--  2.0 unx    60016 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/zlib/deflate.js
+-rw-r--r--  2.0 unx     1251 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/zlib/gzheader.js
+-rw-r--r--  2.0 unx    11690 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/zlib/inffast.js
+-rw-r--r--  2.0 unx    47128 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/zlib/inflate.js
+-rw-r--r--  2.0 unx    11527 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/zlib/inftrees.js
+-rw-r--r--  2.0 unx      560 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/zlib/messages.js
+-rw-r--r--  2.0 unx    38767 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/zlib/trees.js
+-rw-r--r--  2.0 unx      823 b- defN 23-Jun-25 17:26 kvirt/web/static/vnc/vendor/pako/lib/zlib/zstream.js
+-rw-r--r--  2.0 unx     2509 b- defN 23-Jun-25 17:26 kvirt/web/templates/bootstrap.html
+-rw-r--r--  2.0 unx    14595 b- defN 23-Jun-25 17:26 kvirt/web/templates/console.html
+-rw-r--r--  2.0 unx      717 b- defN 23-Jun-25 17:26 kvirt/web/templates/containercreate.html
+-rw-r--r--  2.0 unx      493 b- defN 23-Jun-25 17:26 kvirt/web/templates/containerprofiles.html
+-rw-r--r--  2.0 unx     1050 b- defN 23-Jun-25 17:26 kvirt/web/templates/containerprofilestable.html
+-rw-r--r--  2.0 unx      490 b- defN 23-Jun-25 17:26 kvirt/web/templates/containers.html
+-rw-r--r--  2.0 unx     1746 b- defN 23-Jun-25 17:26 kvirt/web/templates/containerstable.html
+-rw-r--r--  2.0 unx     2123 b- defN 23-Jun-25 17:26 kvirt/web/templates/head.html
+-rw-r--r--  2.0 unx      473 b- defN 23-Jun-25 17:26 kvirt/web/templates/hosts.html
+-rw-r--r--  2.0 unx     1705 b- defN 23-Jun-25 17:26 kvirt/web/templates/hoststable.html
+-rw-r--r--  2.0 unx     1119 b- defN 23-Jun-25 17:26 kvirt/web/templates/imagecreate.html
+-rw-r--r--  2.0 unx      478 b- defN 23-Jun-25 17:26 kvirt/web/templates/images.html
+-rw-r--r--  2.0 unx      646 b- defN 23-Jun-25 17:26 kvirt/web/templates/imagestable.html
+-rw-r--r--  2.0 unx      472 b- defN 23-Jun-25 17:26 kvirt/web/templates/isos.html
+-rw-r--r--  2.0 unx      261 b- defN 23-Jun-25 17:26 kvirt/web/templates/isostable.html
+-rw-r--r--  2.0 unx      609 b- defN 23-Jun-25 17:26 kvirt/web/templates/kubecreate.html
+-rw-r--r--  2.0 unx      622 b- defN 23-Jun-25 17:26 kvirt/web/templates/kubeinfo.html
+-rw-r--r--  2.0 unx      488 b- defN 23-Jun-25 17:26 kvirt/web/templates/kubeprofiles.html
+-rw-r--r--  2.0 unx      845 b- defN 23-Jun-25 17:26 kvirt/web/templates/kubeprofilestable.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jun-25 17:26 kvirt/web/templates/kubes.html
+-rw-r--r--  2.0 unx     1850 b- defN 23-Jun-25 17:26 kvirt/web/templates/kubestable.html
+-rw-r--r--  2.0 unx      151 b- defN 23-Jun-25 17:26 kvirt/web/templates/layout.html
+-rw-r--r--  2.0 unx     5517 b- defN 23-Jun-25 17:26 kvirt/web/templates/navbar.html
+-rw-r--r--  2.0 unx      882 b- defN 23-Jun-25 17:26 kvirt/web/templates/networkcreate.html
+-rw-r--r--  2.0 unx      537 b- defN 23-Jun-25 17:26 kvirt/web/templates/networks.html
+-rw-r--r--  2.0 unx      845 b- defN 23-Jun-25 17:26 kvirt/web/templates/networkstable.html
+-rw-r--r--  2.0 unx      750 b- defN 23-Jun-25 17:26 kvirt/web/templates/plancreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jun-25 17:26 kvirt/web/templates/plans.html
+-rw-r--r--  2.0 unx     1525 b- defN 23-Jun-25 17:26 kvirt/web/templates/planstable.html
+-rw-r--r--  2.0 unx      859 b- defN 23-Jun-25 17:26 kvirt/web/templates/poolcreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jun-25 17:26 kvirt/web/templates/pools.html
+-rw-r--r--  2.0 unx      554 b- defN 23-Jun-25 17:26 kvirt/web/templates/poolstable.html
+-rw-r--r--  2.0 unx     1282 b- defN 23-Jun-25 17:26 kvirt/web/templates/productcreate.html
+-rw-r--r--  2.0 unx      484 b- defN 23-Jun-25 17:26 kvirt/web/templates/products.html
+-rw-r--r--  2.0 unx      895 b- defN 23-Jun-25 17:26 kvirt/web/templates/productstable.html
+-rw-r--r--  2.0 unx      699 b- defN 23-Jun-25 17:26 kvirt/web/templates/repocreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jun-25 17:26 kvirt/web/templates/repos.html
+-rw-r--r--  2.0 unx     1203 b- defN 23-Jun-25 17:26 kvirt/web/templates/repostable.html
+-rw-r--r--  2.0 unx      958 b- defN 23-Jun-25 17:26 kvirt/web/templates/vmcreate.html
+-rw-r--r--  2.0 unx      486 b- defN 23-Jun-25 17:26 kvirt/web/templates/vmprofiles.html
+-rw-r--r--  2.0 unx     1420 b- defN 23-Jun-25 17:26 kvirt/web/templates/vmprofilestable.html
+-rw-r--r--  2.0 unx      470 b- defN 23-Jun-25 17:26 kvirt/web/templates/vms.html
+-rw-r--r--  2.0 unx     4894 b- defN 23-Jun-25 17:26 kvirt/web/templates/vmstable.html
+-rw-r--r--  2.0 unx    11358 b- defN 23-Jun-25 17:29 kcli-99.0.202306251729.dist-info/LICENSE
+-rw-r--r--  2.0 unx     3024 b- defN 23-Jun-25 17:29 kcli-99.0.202306251729.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jun-25 17:29 kcli-99.0.202306251729.dist-info/WHEEL
+-rw-r--r--  2.0 unx      245 b- defN 23-Jun-25 17:29 kcli-99.0.202306251729.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        6 b- defN 23-Jun-25 17:29 kcli-99.0.202306251729.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    59558 b- defN 23-Jun-25 17:29 kcli-99.0.202306251729.dist-info/RECORD
+608 files, 4610610 bytes uncompressed, 1393809 bytes compressed:  69.8%
```

## zipnote {}

```diff
@@ -15,14 +15,17 @@
 
 Filename: kvirt/containerconfig.py
 Comment: 
 
 Filename: kvirt/defaults.py
 Comment: 
 
+Filename: kvirt/ekstoken.py
+Comment: 
+
 Filename: kvirt/examples.py
 Comment: 
 
 Filename: kvirt/ignitionmerger.py
 Comment: 
 
 Filename: kvirt/keywords.yaml
@@ -36,14 +39,23 @@
 
 Filename: kvirt/cluster/__init__.py
 Comment: 
 
 Filename: kvirt/cluster/sampleprovider.py
 Comment: 
 
+Filename: kvirt/cluster/eks/__init__.py
+Comment: 
+
+Filename: kvirt/cluster/eks/fake.yml
+Comment: 
+
+Filename: kvirt/cluster/eks/kcli_default.yml
+Comment: 
+
 Filename: kvirt/cluster/gke/__init__.py
 Comment: 
 
 Filename: kvirt/cluster/gke/fake.yml
 Comment: 
 
 Filename: kvirt/cluster/gke/kcli_default.yml
@@ -1788,26 +1800,26 @@
 
 Filename: kvirt/web/templates/vms.html
 Comment: 
 
 Filename: kvirt/web/templates/vmstable.html
 Comment: 
 
-Filename: kcli-99.0.202306241558.dist-info/LICENSE
+Filename: kcli-99.0.202306251729.dist-info/LICENSE
 Comment: 
 
-Filename: kcli-99.0.202306241558.dist-info/METADATA
+Filename: kcli-99.0.202306251729.dist-info/METADATA
 Comment: 
 
-Filename: kcli-99.0.202306241558.dist-info/WHEEL
+Filename: kcli-99.0.202306251729.dist-info/WHEEL
 Comment: 
 
-Filename: kcli-99.0.202306241558.dist-info/entry_points.txt
+Filename: kcli-99.0.202306251729.dist-info/entry_points.txt
 Comment: 
 
-Filename: kcli-99.0.202306241558.dist-info/top_level.txt
+Filename: kcli-99.0.202306251729.dist-info/top_level.txt
 Comment: 
 
-Filename: kcli-99.0.202306241558.dist-info/RECORD
+Filename: kcli-99.0.202306251729.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## kvirt/cli.py

```diff
@@ -9,14 +9,15 @@
 from kvirt.examples import plandatacreate, vmdatacreate, hostcreate, _list, plancreate, planinfo, productinfo, start
 from kvirt.examples import repocreate, isocreate, networkupdate
 from kvirt.examples import kubegenericcreate, kubek3screate, kubeopenshiftcreate, kubemicroshiftcreate, kubegkecreate
 from kvirt.examples import dnscreate, diskcreate, diskdelete, vmcreate, vmconsole, vmexport, niccreate, nicdelete
 from kvirt.examples import disconnectedcreate, appopenshiftcreate, plantemplatecreate, kubehypershiftcreate
 from kvirt.examples import workflowcreate, kubegenericscale, kubek3sscale, kubeopenshiftscale, kubegkescale
 from kvirt.examples import changelog, starthosts, stophosts, infohosts, ocdownload, openshiftdownload, ocmirrordownload
+from kvirt.examples import kubeekscreate, kubeeksscale
 from kvirt.examples import networkcreate, securitygroupcreate, profilecreate, vmupdate, vmlist
 from kvirt.baseconfig import Kbaseconfig
 from kvirt.containerconfig import Kcontainerconfig
 from kvirt.defaults import IMAGES, VERSION, LOCAL_OPENSHIFT_APPS, SSH_PUB_LOCATIONS, PLANTYPES
 from prettytable import PrettyTable
 import argcomplete
 import argparse
@@ -1836,14 +1837,20 @@
         sys.exit(0)
     else:
         if 'reason' in result:
             error(result['reason'])
         sys.exit(1)
 
 
+def create_eks_kube(args):
+    """Create Eks kube"""
+    args.type = 'eks'
+    create_kube(args)
+
+
 def create_generic_kube(args):
     """Create Generic kube"""
     args.type = 'generic'
     create_kube(args)
 
 
 def create_gke_kube(args):
@@ -1904,14 +1911,21 @@
         sys.exit(0)
     else:
         if 'reason' in result:
             error(result['reason'])
         sys.exit(1)
 
 
+def scale_eks_kube(args):
+    """Scale eks kube"""
+    args.type = 'eks'
+    args.ctlplanes = 0
+    scale_kube(args)
+
+
 def scale_generic_kube(args):
     """Scale generic kube"""
     args.type = 'generic'
     scale_kube(args)
 
 
 def scale_gke_kube(args):
@@ -2276,21 +2290,23 @@
 def info_kube(args):
     if args.client == 'web':
         info_web_kube(args)
         return
     kubetype = args.kubetype
     output = args.global_output or args.output
     openshift = kubetype == 'openshift'
-    if kubetype == 'gke':
+    if kubetype in ['eks', 'gke']:
         baseconfig = Kconfig(client=args.client, debug=args.debug, region=args.region, zone=args.zone,
                              namespace=args.namespace)
     else:
         baseconfig = Kbaseconfig(client=args.client, debug=args.debug, offline=True)
     if args.cluster is not None:
-        if kubetype == 'gke':
+        if kubetype == 'eks':
+            status = baseconfig.info_specific_eks(args.cluster)
+        elif kubetype == 'gke':
             status = baseconfig.info_specific_gke(args.cluster)
         else:
             status = baseconfig.info_specific_kube(args.cluster, openshift)
         if status is None or not status:
             return
         elif output is not None:
             _list_output(status, output)
@@ -2309,14 +2325,16 @@
             baseconfig.info_kube_hypershift(quiet=True)
         elif kubetype == 'microshift':
             baseconfig.info_kube_microshift(quiet=True)
         elif kubetype == 'k3s':
             baseconfig.info_kube_k3s(quiet=True)
         elif kubetype == 'gke':
             baseconfig.info_kube_gke(quiet=True)
+        elif kubetype == 'eks':
+            baseconfig.info_kube_eks(quiet=True)
         else:
             baseconfig.info_kube_generic(quiet=True)
 
 
 def info_web_kube(args):
     output = args.global_output or args.output
     config = Kconfig(client=args.client, debug=args.debug, region=args.region, zone=args.zone, namespace=args.namespace)
@@ -2331,14 +2349,19 @@
         kubetable.title = f"{status['version'].strip()}"
         for node in status['nodes']:
             kubetable.add_row(node)
         kubetable.align["Kube"] = "l"
         print(kubetable)
 
 
+def info_eks_kube(args):
+    args.kubetype = 'eks'
+    info_kube(args)
+
+
 def info_generic_kube(args):
     args.kubetype = 'generic'
     info_kube(args)
 
 
 def info_gke_kube(args):
     args.kubetype = 'gke'
@@ -3650,14 +3673,25 @@
     vspherehostcreate_parser.set_defaults(func=create_host_vsphere)
 
     kubecreate_desc = 'Create Kube'
     kubecreate_parser = create_subparsers.add_parser('kube', description=kubecreate_desc, help=kubecreate_desc,
                                                      aliases=['cluster'])
     kubecreate_subparsers = kubecreate_parser.add_subparsers(metavar='', dest='subcommand_create_kube')
 
+    kubeekscreate_desc = 'Create Eks Kube'
+    kubeekscreate_epilog = f"examples:\n{kubeekscreate}"
+    kubeekscreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
+    kubeekscreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
+    kubeekscreate_parser.add_argument('-t', '--threaded', help='Run threaded', action='store_true')
+    kubeekscreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
+    kubeekscreate_parser.set_defaults(func=create_eks_kube)
+    kubecreate_subparsers.add_parser('eks', parents=[kubeekscreate_parser], description=kubeekscreate_desc,
+                                     help=kubeekscreate_desc, epilog=kubeekscreate_epilog,
+                                     formatter_class=rawhelp)
+
     kubegenericcreate_desc = 'Create Generic Kube'
     kubegenericcreate_epilog = f"examples:\n{kubegenericcreate}"
     kubegenericcreate_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
     kubegenericcreate_parser.add_argument('-f', '--force', action='store_true', help='Delete existing cluster first')
     kubegenericcreate_parser.add_argument('-t', '--threaded', help='Run threaded', action='store_true')
     kubegenericcreate_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
     kubegenericcreate_parser.set_defaults(func=create_generic_kube)
@@ -4468,14 +4502,21 @@
     keywordinfo_parser.set_defaults(func=info_keyword)
 
     kubeinfo_desc = 'Info Kube'
     kubeinfo_parser = info_subparsers.add_parser('kube', description=kubeinfo_desc, help=kubeinfo_desc,
                                                  aliases=['cluster'])
     kubeinfo_subparsers = kubeinfo_parser.add_subparsers(metavar='', dest='subcommand_info_kube')
 
+    kubeeksinfo_desc = 'Info Eks Kube'
+    kubeeksinfo_parser = kubeinfo_subparsers.add_parser('eks', description=kubeeksinfo_desc,
+                                                        help=kubeeksinfo_desc,
+                                                        parents=[output_parser])
+    kubeeksinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
+    kubeeksinfo_parser.set_defaults(func=info_eks_kube)
+
     kubegenericinfo_desc = 'Info Generic Kube'
     kubegenericinfo_parser = kubeinfo_subparsers.add_parser('generic', description=kubegenericinfo_desc,
                                                             help=kubegenericinfo_desc, aliases=['kubeadm'],
                                                             parents=[output_parser])
     kubegenericinfo_parser.add_argument('cluster', metavar='CLUSTER', nargs='?', type=valid_cluster)
     kubegenericinfo_parser.set_defaults(func=info_generic_kube)
 
@@ -4824,14 +4865,23 @@
     scale_subparsers = scale_parser.add_subparsers(metavar='', dest='subcommand_scale')
 
     kubescale_desc = 'Scale Kube'
     kubescale_parser = scale_subparsers.add_parser('kube', description=kubescale_desc, help=kubescale_desc,
                                                    aliases=['cluster'])
     kubescale_subparsers = kubescale_parser.add_subparsers(metavar='', dest='subcommand_scale_kube')
 
+    kubeeksscale_desc = 'Scale Eks Kube'
+    kubeeksscale_epilog = f"examples:\n{kubeeksscale}"
+    kubeeksscale_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
+    kubeeksscale_parser.add_argument('-w', '--workers', help='Total number of workers', type=int)
+    kubeeksscale_parser.add_argument('cluster', metavar='CLUSTER', type=valid_cluster, default='mykube')
+    kubeeksscale_parser.set_defaults(func=scale_eks_kube)
+    kubescale_subparsers.add_parser('eks', parents=[kubeeksscale_parser], description=kubeeksscale_desc,
+                                    help=kubeeksscale_desc, epilog=kubeeksscale_epilog, formatter_class=rawhelp)
+
     kubegenericscale_desc = 'Scale Generic Kube'
     kubegenericscale_epilog = f"examples:\n{kubegenericscale}"
     kubegenericscale_parser = argparse.ArgumentParser(add_help=False, parents=[parent_parser])
     kubegenericscale_parser.add_argument('-c', '--ctlplanes', help='Total number of ctlplanes', type=int)
     kubegenericscale_parser.add_argument('-w', '--workers', help='Total number of workers', type=int)
     kubegenericscale_parser.add_argument('cluster', metavar='CLUSTER', type=valid_cluster, default='mykube')
     kubegenericscale_parser.set_defaults(func=scale_generic_kube)
```

## kvirt/config.py

```diff
@@ -4578,7265 +4578,7427 @@
 00011e10: 5b5d 7d0a 2020 2020 2020 2020 6966 2073  []}.        if s
 00011e20: 656c 662e 7479 7065 203d 3d20 2767 6370  elf.type == 'gcp
 00011e30: 273a 0a20 2020 2020 2020 2020 2020 2066  ':.            f
 00011e40: 726f 6d20 6b76 6972 742e 636c 7573 7465  rom kvirt.cluste
 00011e50: 7220 696d 706f 7274 2067 6b65 0a20 2020  r import gke.   
 00011e60: 2020 2020 2020 2020 206b 7562 6573 2e75           kubes.u
 00011e70: 7064 6174 6528 676b 652e 6c69 7374 2873  pdate(gke.list(s
-00011e80: 656c 6629 290a 2020 2020 2020 2020 7265  elf)).        re
-00011e90: 7475 726e 206b 7562 6573 0a0a 2020 2020  turn kubes..    
-00011ea0: 6465 6620 6372 6561 7465 5f70 726f 6475  def create_produ
-00011eb0: 6374 2873 656c 662c 206e 616d 652c 2072  ct(self, name, r
-00011ec0: 6570 6f3d 4e6f 6e65 2c20 6772 6f75 703d  epo=None, group=
-00011ed0: 4e6f 6e65 2c20 706c 616e 3d4e 6f6e 652c  None, plan=None,
-00011ee0: 206c 6174 6573 743d 4661 6c73 652c 206f   latest=False, o
-00011ef0: 7665 7272 6964 6573 3d7b 7d29 3a0a 2020  verrides={}):.  
-00011f00: 2020 2020 2020 2222 2243 7265 6174 6520        """Create 
-00011f10: 7072 6f64 7563 7422 2222 0a20 2020 2020  product""".     
-00011f20: 2020 2069 6620 7265 706f 2069 7320 6e6f     if repo is no
-00011f30: 7420 4e6f 6e65 2061 6e64 2067 726f 7570  t None and group
-00011f40: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00011f50: 2020 2020 2020 2020 2020 7072 6f64 7563            produc
-00011f60: 7473 203d 205b 7072 6f64 7563 7420 666f  ts = [product fo
-00011f70: 7220 7072 6f64 7563 7420 696e 2073 656c  r product in sel
-00011f80: 662e 6c69 7374 5f70 726f 6475 6374 7328  f.list_products(
-00011f90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011fa0: 2020 2020 2020 2020 2020 6966 2070 726f            if pro
-00011fb0: 6475 6374 5b27 6e61 6d65 275d 203d 3d20  duct['name'] == 
-00011fc0: 6e61 6d65 2061 6e64 2070 726f 6475 6374  name and product
-00011fd0: 5b27 7265 706f 275d 203d 3d20 7265 706f  ['repo'] == repo
-00011fe0: 2061 6e64 2070 726f 6475 6374 5b27 6772   and product['gr
-00011ff0: 6f75 7027 5d20 3d3d 2067 726f 7570 5d0a  oup'] == group].
-00012000: 2020 2020 2020 2020 656c 6966 2072 6570          elif rep
-00012010: 6f20 6973 206e 6f74 204e 6f6e 653a 0a20  o is not None:. 
-00012020: 2020 2020 2020 2020 2020 2070 726f 6475             produ
-00012030: 6374 7320 3d20 5b70 726f 6475 6374 2066  cts = [product f
-00012040: 6f72 2070 726f 6475 6374 2069 6e20 7365  or product in se
-00012050: 6c66 2e6c 6973 745f 7072 6f64 7563 7473  lf.list_products
-00012060: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00012070: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
-00012080: 6f64 7563 745b 276e 616d 6527 5d20 3d3d  oduct['name'] ==
-00012090: 206e 616d 6520 616e 6420 7072 6f64 7563   name and produc
-000120a0: 745b 2772 6570 6f27 5d20 3d3d 2072 6570  t['repo'] == rep
-000120b0: 6f5d 0a20 2020 2020 2020 2069 6620 6772  o].        if gr
-000120c0: 6f75 7020 6973 206e 6f74 204e 6f6e 653a  oup is not None:
-000120d0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-000120e0: 6475 6374 7320 3d20 5b70 726f 6475 6374  ducts = [product
-000120f0: 2066 6f72 2070 726f 6475 6374 2069 6e20   for product in 
-00012100: 7365 6c66 2e6c 6973 745f 7072 6f64 7563  self.list_produc
-00012110: 7473 2829 0a20 2020 2020 2020 2020 2020  ts().           
-00012120: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00012130: 7072 6f64 7563 745b 276e 616d 6527 5d20  product['name'] 
-00012140: 3d3d 206e 616d 6520 616e 6420 7072 6f64  == name and prod
-00012150: 7563 745b 2767 726f 7570 275d 203d 3d20  uct['group'] == 
-00012160: 6772 6f75 705d 0a20 2020 2020 2020 2065  group].        e
-00012170: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00012180: 2070 726f 6475 6374 7320 3d20 5b70 726f   products = [pro
-00012190: 6475 6374 2066 6f72 2070 726f 6475 6374  duct for product
-000121a0: 2069 6e20 7365 6c66 2e6c 6973 745f 7072   in self.list_pr
-000121b0: 6f64 7563 7473 2829 2069 6620 7072 6f64  oducts() if prod
-000121c0: 7563 745b 276e 616d 6527 5d20 3d3d 206e  uct['name'] == n
-000121d0: 616d 655d 0a20 2020 2020 2020 2069 6620  ame].        if 
-000121e0: 6c65 6e28 7072 6f64 7563 7473 2920 3d3d  len(products) ==
-000121f0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00012200: 6572 726f 7228 2250 726f 6475 6374 206e  error("Product n
-00012210: 6f74 2066 6f75 6e64 2e20 4c65 6176 696e  ot found. Leavin
-00012220: 672e 2e2e 2229 0a20 2020 2020 2020 2020  g...").         
-00012230: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00012240: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
-00012250: 7072 6f64 7563 7473 2920 3e20 313a 0a20  products) > 1:. 
-00012260: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00012270: 2822 5072 6f64 7563 7420 666f 756e 6420  ("Product found 
-00012280: 696e 2073 6576 6572 616c 2072 6570 6f73  in several repos
-00012290: 206f 7220 6772 6f75 7073 2e20 5370 6563   or groups. Spec
-000122a0: 6966 7920 6f6e 652e 2e2e 2229 0a20 2020  ify one...").   
-000122b0: 2020 2020 2020 2020 2066 6f72 2070 726f           for pro
-000122c0: 6475 6374 2069 6e20 7072 6f64 7563 7473  duct in products
-000122d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000122e0: 2020 6772 6f75 7020 3d20 7072 6f64 7563    group = produc
-000122f0: 745b 2767 726f 7570 275d 0a20 2020 2020  t['group'].     
-00012300: 2020 2020 2020 2020 2020 2072 6570 6f20             repo 
-00012310: 3d20 7072 6f64 7563 745b 2772 6570 6f27  = product['repo'
-00012320: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00012330: 2020 7072 696e 7428 6622 7265 706f 3a7b    print(f"repo:{
-00012340: 7265 706f 7d5c 7467 726f 7570 3a7b 6772  repo}\tgroup:{gr
-00012350: 6f75 707d 2229 0a20 2020 2020 2020 2020  oup}").         
-00012360: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-00012370: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00012380: 2020 2020 2020 2020 2070 726f 6475 6374           product
-00012390: 203d 2070 726f 6475 6374 735b 305d 0a20   = products[0]. 
-000123a0: 2020 2020 2020 2020 2020 2070 6c61 6e20             plan 
-000123b0: 3d20 6e61 6d65 7574 696c 732e 6765 745f  = nameutils.get_
-000123c0: 7261 6e64 6f6d 5f6e 616d 6528 2920 6966  random_name() if
-000123d0: 2070 6c61 6e20 6973 204e 6f6e 6520 656c   plan is None el
-000123e0: 7365 2070 6c61 6e0a 2020 2020 2020 2020  se plan.        
-000123f0: 2020 2020 7265 706f 203d 2070 726f 6475      repo = produ
-00012400: 6374 5b27 7265 706f 275d 0a20 2020 2020  ct['repo'].     
-00012410: 2020 2020 2020 2069 6620 2772 6561 6c64         if 'reald
-00012420: 6972 2720 696e 2070 726f 6475 6374 3a0a  ir' in product:.
-00012430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012440: 7265 706f 6469 7220 3d20 2225 732f 2e6b  repodir = "%s/.k
-00012450: 636c 692f 706c 616e 732f 2573 2f25 7322  cli/plans/%s/%s"
-00012460: 2025 2028 6f73 2e65 6e76 6972 6f6e 2e67   % (os.environ.g
-00012470: 6574 2827 484f 4d45 2729 2c20 7265 706f  et('HOME'), repo
-00012480: 2c20 7072 6f64 7563 745b 2772 6561 6c64  , product['reald
-00012490: 6972 275d 290a 2020 2020 2020 2020 2020  ir']).          
-000124a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000124b0: 2020 2020 2020 2020 7265 706f 6469 7220          repodir 
-000124c0: 3d20 2225 732f 2e6b 636c 692f 706c 616e  = "%s/.kcli/plan
-000124d0: 732f 2573 2220 2520 286f 732e 656e 7669  s/%s" % (os.envi
-000124e0: 726f 6e2e 6765 7428 2748 4f4d 4527 292c  ron.get('HOME'),
-000124f0: 2072 6570 6f29 0a20 2020 2020 2020 2020   repo).         
-00012500: 2020 2069 6620 272f 2720 696e 2070 726f     if '/' in pro
-00012510: 6475 6374 5b27 6669 6c65 275d 3a0a 2020  duct['file']:.  
-00012520: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00012530: 7075 7466 696c 6520 3d20 6f73 2e70 6174  putfile = os.pat
-00012540: 682e 6261 7365 6e61 6d65 2870 726f 6475  h.basename(produ
-00012550: 6374 5b27 6669 6c65 275d 290a 2020 2020  ct['file']).    
-00012560: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00012570: 6469 7220 2b3d 2022 2f25 7322 2025 206f  dir += "/%s" % o
-00012580: 732e 7061 7468 2e64 6972 6e61 6d65 2870  s.path.dirname(p
-00012590: 726f 6475 6374 5b27 6669 6c65 275d 290a  roduct['file']).
-000125a0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000125b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000125c0: 2020 696e 7075 7466 696c 6520 3d20 7072    inputfile = pr
-000125d0: 6f64 7563 745b 2766 696c 6527 5d0a 2020  oduct['file'].  
-000125e0: 2020 2020 2020 2020 2020 696d 6167 6520            image 
-000125f0: 3d20 7072 6f64 7563 742e 6765 7428 2769  = product.get('i
-00012600: 6d61 6765 2729 0a20 2020 2020 2020 2020  mage').         
-00012610: 2020 2070 6172 616d 6574 6572 7320 3d20     parameters = 
-00012620: 7072 6f64 7563 742e 6765 7428 2770 6172  product.get('par
-00012630: 616d 6574 6572 7327 290a 2020 2020 2020  ameters').      
-00012640: 2020 2020 2020 6966 2069 6d61 6765 2069        if image i
-00012650: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00012660: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00012670: 7428 6622 4e6f 7465 2074 6861 7420 7468  t(f"Note that th
-00012680: 6973 2070 726f 6475 6374 2075 7365 7320  is product uses 
-00012690: 696d 6167 653a 207b 696d 6167 657d 2229  image: {image}")
-000126a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000126b0: 7061 7261 6d65 7465 7273 2069 7320 6e6f  parameters is no
-000126c0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-000126d0: 2020 2020 2020 2020 666f 7220 7061 7261          for para
-000126e0: 6d65 7465 7220 696e 2070 6172 616d 6574  meter in paramet
-000126f0: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
-00012700: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-00012710: 5f70 6172 616d 6574 6572 203d 206f 7665  _parameter = ove
-00012720: 7272 6964 6573 5b70 6172 616d 6574 6572  rrides[parameter
-00012730: 5d20 6966 2070 6172 616d 6574 6572 2069  ] if parameter i
-00012740: 6e20 6f76 6572 7269 6465 7320 656c 7365  n overrides else
-00012750: 2070 6172 616d 6574 6572 735b 7061 7261   parameters[para
-00012760: 6d65 7465 725d 0a20 2020 2020 2020 2020  meter].         
-00012770: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00012780: 2866 2255 7369 6e67 2070 6172 616d 6574  (f"Using paramet
-00012790: 6572 207b 7061 7261 6d65 7465 727d 3a20  er {parameter}: 
-000127a0: 7b61 7070 6c69 6564 5f70 6172 616d 6574  {applied_paramet
-000127b0: 6572 7d22 290a 2020 2020 2020 2020 2020  er}").          
-000127c0: 2020 6578 7472 6170 6172 616d 6574 6572    extraparameter
-000127d0: 7320 3d20 6c69 7374 2873 6574 286f 7665  s = list(set(ove
-000127e0: 7272 6964 6573 2920 2d20 7365 7428 7061  rrides) - set(pa
-000127f0: 7261 6d65 7465 7273 2929 2069 6620 7061  rameters)) if pa
-00012800: 7261 6d65 7465 7273 2069 7320 6e6f 7420  rameters is not 
-00012810: 4e6f 6e65 2065 6c73 6520 6f76 6572 7269  None else overri
-00012820: 6465 730a 2020 2020 2020 2020 2020 2020  des.            
-00012830: 666f 7220 7061 7261 6d65 7465 7220 696e  for parameter in
-00012840: 2065 7874 7261 7061 7261 6d65 7465 7273   extraparameters
-00012850: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012860: 2020 7072 696e 7428 2255 7369 6e67 2070    print("Using p
-00012870: 6172 616d 6574 6572 2025 733a 2025 7322  arameter %s: %s"
-00012880: 2025 2028 7061 7261 6d65 7465 722c 206f   % (parameter, o
-00012890: 7665 7272 6964 6573 5b70 6172 616d 6574  verrides[paramet
-000128a0: 6572 5d29 290a 2020 2020 2020 2020 2020  er])).          
-000128b0: 2020 6966 206e 6f74 206c 6174 6573 743a    if not latest:
-000128c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000128d0: 2070 7072 696e 7428 6622 5573 696e 6720   pprint(f"Using 
-000128e0: 6469 7265 6374 6f72 7920 7b72 6570 6f64  directory {repod
-000128f0: 6972 7d22 290a 2020 2020 2020 2020 2020  ir}").          
-00012900: 2020 2020 2020 7365 6c66 2e70 6c61 6e28        self.plan(
-00012910: 706c 616e 2c20 7061 7468 3d72 6570 6f64  plan, path=repod
-00012920: 6972 2c20 696e 7075 7466 696c 653d 696e  ir, inputfile=in
-00012930: 7075 7466 696c 652c 206f 7665 7272 6964  putfile, overrid
-00012940: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
-00012950: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00012960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012970: 7365 6c66 2e75 7064 6174 655f 7265 706f  self.update_repo
-00012980: 2872 6570 6f29 0a20 2020 2020 2020 2020  (repo).         
-00012990: 2020 2020 2020 2073 656c 662e 706c 616e         self.plan
-000129a0: 2870 6c61 6e2c 2070 6174 683d 7265 706f  (plan, path=repo
-000129b0: 6469 722c 2069 6e70 7574 6669 6c65 3d69  dir, inputfile=i
-000129c0: 6e70 7574 6669 6c65 2c20 6f76 6572 7269  nputfile, overri
-000129d0: 6465 733d 6f76 6572 7269 6465 7329 0a20  des=overrides). 
-000129e0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-000129f0: 7428 6622 5072 6f64 7563 7420 6361 6e20  t(f"Product can 
-00012a00: 6265 2064 656c 6574 6564 2077 6974 683a  be deleted with:
-00012a10: 206b 636c 6920 6465 6c65 7465 2070 6c61   kcli delete pla
-00012a20: 6e20 2d2d 7965 7320 7b70 6c61 6e7d 2229  n --yes {plan}")
-00012a30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012a40: 7b27 7265 7375 6c74 273a 2027 7375 6363  {'result': 'succ
-00012a50: 6573 7327 2c20 2770 6c61 6e27 3a20 706c  ess', 'plan': pl
-00012a60: 616e 7d0a 0a20 2020 2064 6566 2073 7461  an}..    def sta
-00012a70: 7274 5f70 6c61 6e28 7365 6c66 2c20 706c  rt_plan(self, pl
-00012a80: 616e 2c20 636f 6e74 6169 6e65 723d 4661  an, container=Fa
-00012a90: 6c73 6529 3a0a 2020 2020 2020 2020 6b20  lse):.        k 
-00012aa0: 3d20 7365 6c66 2e6b 0a20 2020 2020 2020  = self.k.       
-00012ab0: 2073 7461 7274 666f 756e 6420 3d20 4661   startfound = Fa
-00012ac0: 6c73 650a 2020 2020 2020 2020 7070 7269  lse.        ppri
-00012ad0: 6e74 2866 2253 7461 7274 696e 6720 766d  nt(f"Starting vm
-00012ae0: 7320 6672 6f6d 2070 6c61 6e20 7b70 6c61  s from plan {pla
-00012af0: 6e7d 2229 0a20 2020 2020 2020 2069 6620  n}").        if 
-00012b00: 6e6f 7420 7365 6c66 2e65 7874 7261 636c  not self.extracl
-00012b10: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
-00012b20: 2020 2073 7461 7274 636c 6965 6e74 7320     startclients 
-00012b30: 3d20 7b73 656c 662e 636c 6965 6e74 3a20  = {self.client: 
-00012b40: 6b7d 0a20 2020 2020 2020 2065 6c73 653a  k}.        else:
-00012b50: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-00012b60: 7274 636c 6965 6e74 7320 3d20 7365 6c66  rtclients = self
-00012b70: 2e65 7874 7261 636c 6965 6e74 730a 2020  .extraclients.  
-00012b80: 2020 2020 2020 2020 2020 7374 6172 7463            startc
-00012b90: 6c69 656e 7473 2e75 7064 6174 6528 7b73  lients.update({s
-00012ba0: 656c 662e 636c 6965 6e74 3a20 6b7d 290a  elf.client: k}).
-00012bb0: 2020 2020 2020 2020 666f 7220 6879 7065          for hype
-00012bc0: 7276 6973 6f72 2069 6e20 7374 6172 7463  rvisor in startc
-00012bd0: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
-00012be0: 2020 2020 6320 3d20 7374 6172 7463 6c69      c = startcli
-00012bf0: 656e 7473 5b68 7970 6572 7669 736f 725d  ents[hypervisor]
-00012c00: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00012c10: 2076 6d20 696e 2073 6f72 7465 6428 632e   vm in sorted(c.
-00012c20: 6c69 7374 2829 2c20 6b65 793d 6c61 6d62  list(), key=lamb
-00012c30: 6461 2078 3a20 785b 276e 616d 6527 5d29  da x: x['name'])
-00012c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012c50: 2020 6e61 6d65 203d 2076 6d5b 276e 616d    name = vm['nam
-00012c60: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-00012c70: 2020 2020 6465 7363 7269 7074 696f 6e20      description 
-00012c80: 3d20 766d 2e67 6574 2827 706c 616e 2729  = vm.get('plan')
-00012c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012ca0: 2069 6620 6465 7363 7269 7074 696f 6e20   if description 
-00012cb0: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
-00012cc0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-00012cd0: 7274 666f 756e 6420 3d20 5472 7565 0a20  rtfound = True. 
-00012ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012cf0: 2020 2063 2e73 7461 7274 286e 616d 6529     c.start(name)
-00012d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012d10: 2020 2020 2073 7563 6365 7373 2866 227b       success(f"{
-00012d20: 6e61 6d65 7d20 7374 6172 7465 6420 6f6e  name} started on
-00012d30: 207b 6879 7065 7276 6973 6f72 7d21 2229   {hypervisor}!")
-00012d40: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
-00012d50: 6169 6e65 723a 0a20 2020 2020 2020 2020  ainer:.         
-00012d60: 2020 2063 6f6e 7420 3d20 4b63 6f6e 7461     cont = Kconta
-00012d70: 696e 6572 636f 6e66 6967 2873 656c 662c  inerconfig(self,
-00012d80: 2063 6c69 656e 743d 7365 6c66 2e63 6f6e   client=self.con
-00012d90: 7461 696e 6572 636c 6965 6e74 292e 636f  tainerclient).co
-00012da0: 6e74 0a20 2020 2020 2020 2020 2020 2066  nt.            f
-00012db0: 6f72 2063 6f6e 7461 2069 6e20 736f 7274  or conta in sort
-00012dc0: 6564 2863 6f6e 742e 6c69 7374 5f63 6f6e  ed(cont.list_con
-00012dd0: 7461 696e 6572 7328 6b29 293a 0a20 2020  tainers(k)):.   
-00012de0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00012df0: 6520 3d20 636f 6e74 615b 305d 0a20 2020  e = conta[0].   
-00012e00: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00012e10: 7461 696e 6572 706c 616e 203d 2063 6f6e  tainerplan = con
-00012e20: 7461 5b33 5d0a 2020 2020 2020 2020 2020  ta[3].          
-00012e30: 2020 2020 2020 6966 2063 6f6e 7461 696e        if contain
-00012e40: 6572 706c 616e 203d 3d20 706c 616e 3a0a  erplan == plan:.
-00012e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e60: 2020 2020 7374 6172 7466 6f75 6e64 203d      startfound =
-00012e70: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00012e80: 2020 2020 2020 2020 2020 636f 6e74 2e73            cont.s
-00012e90: 7461 7274 5f63 6f6e 7461 696e 6572 286e  tart_container(n
-00012ea0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00012eb0: 2020 2020 2020 2020 2073 7563 6365 7373           success
-00012ec0: 2866 2243 6f6e 7461 696e 6572 207b 6e61  (f"Container {na
-00012ed0: 6d65 7d20 7374 6172 7465 6421 2229 0a20  me} started!"). 
-00012ee0: 2020 2020 2020 2069 6620 7374 6172 7466         if startf
-00012ef0: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
-00012f00: 2020 7375 6363 6573 7328 6622 506c 616e    success(f"Plan
-00012f10: 207b 706c 616e 7d20 7374 6172 7465 6421   {plan} started!
-00012f20: 2229 0a20 2020 2020 2020 2065 6c73 653a  ").        else:
-00012f30: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
-00012f40: 6e69 6e67 2822 4e6f 206d 6174 6368 696e  ning("No matchin
-00012f50: 6720 6f62 6a65 6374 7320 666f 756e 6422  g objects found"
-00012f60: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00012f70: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
-00012f80: 6365 7373 277d 0a0a 2020 2020 6465 6620  cess'}..    def 
-00012f90: 7374 6f70 5f70 6c61 6e28 7365 6c66 2c20  stop_plan(self, 
-00012fa0: 706c 616e 2c20 736f 6674 3d46 616c 7365  plan, soft=False
-00012fb0: 2c20 636f 6e74 6169 6e65 723d 4661 6c73  , container=Fals
-00012fc0: 6529 3a0a 2020 2020 2020 2020 6b20 3d20  e):.        k = 
-00012fd0: 7365 6c66 2e6b 0a20 2020 2020 2020 2073  self.k.        s
-00012fe0: 746f 7066 6f75 6e64 203d 2054 7275 650a  topfound = True.
-00012ff0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00013000: 2253 746f 7070 696e 6720 766d 7320 6672  "Stopping vms fr
-00013010: 6f6d 2070 6c61 6e20 7b70 6c61 6e7d 2229  om plan {plan}")
-00013020: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00013030: 7365 6c66 2e65 7874 7261 636c 6965 6e74  self.extraclient
-00013040: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-00013050: 746f 7063 6c69 656e 7473 203d 207b 7365  topclients = {se
-00013060: 6c66 2e63 6c69 656e 743a 206b 7d0a 2020  lf.client: k}.  
-00013070: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00013080: 2020 2020 2020 2020 7374 6f70 636c 6965          stopclie
-00013090: 6e74 7320 3d20 7365 6c66 2e65 7874 7261  nts = self.extra
-000130a0: 636c 6965 6e74 730a 2020 2020 2020 2020  clients.        
-000130b0: 2020 2020 7374 6f70 636c 6965 6e74 732e      stopclients.
-000130c0: 7570 6461 7465 287b 7365 6c66 2e63 6c69  update({self.cli
-000130d0: 656e 743a 206b 7d29 0a20 2020 2020 2020  ent: k}).       
-000130e0: 2066 6f72 2068 7970 6572 7669 736f 7220   for hypervisor 
-000130f0: 696e 2073 746f 7063 6c69 656e 7473 3a0a  in stopclients:.
-00013100: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
-00013110: 7374 6f70 636c 6965 6e74 735b 6879 7065  stopclients[hype
-00013120: 7276 6973 6f72 5d0a 2020 2020 2020 2020  rvisor].        
-00013130: 2020 2020 666f 7220 766d 2069 6e20 736f      for vm in so
-00013140: 7274 6564 2863 2e6c 6973 7428 292c 206b  rted(c.list(), k
-00013150: 6579 3d6c 616d 6264 6120 783a 2078 5b27  ey=lambda x: x['
-00013160: 6e61 6d65 275d 293a 0a20 2020 2020 2020  name']):.       
-00013170: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-00013180: 766d 5b27 6e61 6d65 275d 0a20 2020 2020  vm['name'].     
-00013190: 2020 2020 2020 2020 2020 2064 6573 6372             descr
-000131a0: 6970 7469 6f6e 203d 2076 6d2e 6765 7428  iption = vm.get(
-000131b0: 2770 6c61 6e27 290a 2020 2020 2020 2020  'plan').        
-000131c0: 2020 2020 2020 2020 6966 2064 6573 6372          if descr
-000131d0: 6970 7469 6f6e 203d 3d20 706c 616e 3a0a  iption == plan:.
-000131e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131f0: 2020 2020 7374 6f70 666f 756e 6420 3d20      stopfound = 
-00013200: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00013210: 2020 2020 2020 2020 2063 2e73 746f 7028           c.stop(
-00013220: 6e61 6d65 2c20 736f 6674 3d73 6f66 7429  name, soft=soft)
-00013230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013240: 2020 2020 2073 7563 6365 7373 2866 227b       success(f"{
-00013250: 6e61 6d65 7d20 7374 6f70 7065 6420 6f6e  name} stopped on
-00013260: 207b 6879 7065 7276 6973 6f72 7d21 2229   {hypervisor}!")
-00013270: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
-00013280: 6169 6e65 723a 0a20 2020 2020 2020 2020  ainer:.         
-00013290: 2020 2063 6f6e 7420 3d20 4b63 6f6e 7461     cont = Kconta
-000132a0: 696e 6572 636f 6e66 6967 2873 656c 662c  inerconfig(self,
-000132b0: 2063 6c69 656e 743d 7365 6c66 2e63 6f6e   client=self.con
-000132c0: 7461 696e 6572 636c 6965 6e74 292e 636f  tainerclient).co
-000132d0: 6e74 0a20 2020 2020 2020 2020 2020 2066  nt.            f
-000132e0: 6f72 2063 6f6e 7461 2069 6e20 736f 7274  or conta in sort
-000132f0: 6564 2863 6f6e 742e 6c69 7374 5f63 6f6e  ed(cont.list_con
-00013300: 7461 696e 6572 7328 2929 3a0a 2020 2020  tainers()):.    
-00013310: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00013320: 203d 2063 6f6e 7461 5b30 5d0a 2020 2020   = conta[0].    
-00013330: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00013340: 6169 6e65 7270 6c61 6e20 3d20 636f 6e74  ainerplan = cont
-00013350: 615b 335d 0a20 2020 2020 2020 2020 2020  a[3].           
-00013360: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
-00013370: 7270 6c61 6e20 3d3d 2070 6c61 6e3a 0a20  rplan == plan:. 
+00011e80: 656c 6629 290a 2020 2020 2020 2020 656c  elf)).        el
+00011e90: 6966 2073 656c 662e 7479 7065 203d 3d20  if self.type == 
+00011ea0: 2761 7773 273a 0a20 2020 2020 2020 2020  'aws':.         
+00011eb0: 2020 2066 726f 6d20 6b76 6972 742e 636c     from kvirt.cl
+00011ec0: 7573 7465 7220 696d 706f 7274 2065 6b73  uster import eks
+00011ed0: 0a20 2020 2020 2020 2020 2020 206b 7562  .            kub
+00011ee0: 6573 2e75 7064 6174 6528 656b 732e 6c69  es.update(eks.li
+00011ef0: 7374 2873 656c 6629 290a 2020 2020 2020  st(self)).      
+00011f00: 2020 7265 7475 726e 206b 7562 6573 0a0a    return kubes..
+00011f10: 2020 2020 6465 6620 6372 6561 7465 5f70      def create_p
+00011f20: 726f 6475 6374 2873 656c 662c 206e 616d  roduct(self, nam
+00011f30: 652c 2072 6570 6f3d 4e6f 6e65 2c20 6772  e, repo=None, gr
+00011f40: 6f75 703d 4e6f 6e65 2c20 706c 616e 3d4e  oup=None, plan=N
+00011f50: 6f6e 652c 206c 6174 6573 743d 4661 6c73  one, latest=Fals
+00011f60: 652c 206f 7665 7272 6964 6573 3d7b 7d29  e, overrides={})
+00011f70: 3a0a 2020 2020 2020 2020 2222 2243 7265  :.        """Cre
+00011f80: 6174 6520 7072 6f64 7563 7422 2222 0a20  ate product""". 
+00011f90: 2020 2020 2020 2069 6620 7265 706f 2069         if repo i
+00011fa0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2067  s not None and g
+00011fb0: 726f 7570 2069 7320 6e6f 7420 4e6f 6e65  roup is not None
+00011fc0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00011fd0: 6f64 7563 7473 203d 205b 7072 6f64 7563  oducts = [produc
+00011fe0: 7420 666f 7220 7072 6f64 7563 7420 696e  t for product in
+00011ff0: 2073 656c 662e 6c69 7374 5f70 726f 6475   self.list_produ
+00012000: 6374 7328 290a 2020 2020 2020 2020 2020  cts().          
+00012010: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00012020: 2070 726f 6475 6374 5b27 6e61 6d65 275d   product['name']
+00012030: 203d 3d20 6e61 6d65 2061 6e64 2070 726f   == name and pro
+00012040: 6475 6374 5b27 7265 706f 275d 203d 3d20  duct['repo'] == 
+00012050: 7265 706f 2061 6e64 2070 726f 6475 6374  repo and product
+00012060: 5b27 6772 6f75 7027 5d20 3d3d 2067 726f  ['group'] == gro
+00012070: 7570 5d0a 2020 2020 2020 2020 656c 6966  up].        elif
+00012080: 2072 6570 6f20 6973 206e 6f74 204e 6f6e   repo is not Non
+00012090: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+000120a0: 726f 6475 6374 7320 3d20 5b70 726f 6475  roducts = [produ
+000120b0: 6374 2066 6f72 2070 726f 6475 6374 2069  ct for product i
+000120c0: 6e20 7365 6c66 2e6c 6973 745f 7072 6f64  n self.list_prod
+000120d0: 7563 7473 2829 0a20 2020 2020 2020 2020  ucts().         
+000120e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000120f0: 6620 7072 6f64 7563 745b 276e 616d 6527  f product['name'
+00012100: 5d20 3d3d 206e 616d 6520 616e 6420 7072  ] == name and pr
+00012110: 6f64 7563 745b 2772 6570 6f27 5d20 3d3d  oduct['repo'] ==
+00012120: 2072 6570 6f5d 0a20 2020 2020 2020 2069   repo].        i
+00012130: 6620 6772 6f75 7020 6973 206e 6f74 204e  f group is not N
+00012140: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00012150: 2070 726f 6475 6374 7320 3d20 5b70 726f   products = [pro
+00012160: 6475 6374 2066 6f72 2070 726f 6475 6374  duct for product
+00012170: 2069 6e20 7365 6c66 2e6c 6973 745f 7072   in self.list_pr
+00012180: 6f64 7563 7473 2829 0a20 2020 2020 2020  oducts().       
+00012190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121a0: 2069 6620 7072 6f64 7563 745b 276e 616d   if product['nam
+000121b0: 6527 5d20 3d3d 206e 616d 6520 616e 6420  e'] == name and 
+000121c0: 7072 6f64 7563 745b 2767 726f 7570 275d  product['group']
+000121d0: 203d 3d20 6772 6f75 705d 0a20 2020 2020   == group].     
+000121e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000121f0: 2020 2020 2070 726f 6475 6374 7320 3d20       products = 
+00012200: 5b70 726f 6475 6374 2066 6f72 2070 726f  [product for pro
+00012210: 6475 6374 2069 6e20 7365 6c66 2e6c 6973  duct in self.lis
+00012220: 745f 7072 6f64 7563 7473 2829 2069 6620  t_products() if 
+00012230: 7072 6f64 7563 745b 276e 616d 6527 5d20  product['name'] 
+00012240: 3d3d 206e 616d 655d 0a20 2020 2020 2020  == name].       
+00012250: 2069 6620 6c65 6e28 7072 6f64 7563 7473   if len(products
+00012260: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+00012270: 2020 2020 6572 726f 7228 2250 726f 6475      error("Produ
+00012280: 6374 206e 6f74 2066 6f75 6e64 2e20 4c65  ct not found. Le
+00012290: 6176 696e 672e 2e2e 2229 0a20 2020 2020  aving...").     
+000122a0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+000122b0: 3129 0a20 2020 2020 2020 2065 6c69 6620  1).        elif 
+000122c0: 6c65 6e28 7072 6f64 7563 7473 2920 3e20  len(products) > 
+000122d0: 313a 0a20 2020 2020 2020 2020 2020 2065  1:.            e
+000122e0: 7272 6f72 2822 5072 6f64 7563 7420 666f  rror("Product fo
+000122f0: 756e 6420 696e 2073 6576 6572 616c 2072  und in several r
+00012300: 6570 6f73 206f 7220 6772 6f75 7073 2e20  epos or groups. 
+00012310: 5370 6563 6966 7920 6f6e 652e 2e2e 2229  Specify one...")
+00012320: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00012330: 2070 726f 6475 6374 2069 6e20 7072 6f64   product in prod
+00012340: 7563 7473 3a0a 2020 2020 2020 2020 2020  ucts:.          
+00012350: 2020 2020 2020 6772 6f75 7020 3d20 7072        group = pr
+00012360: 6f64 7563 745b 2767 726f 7570 275d 0a20  oduct['group']. 
+00012370: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00012380: 6570 6f20 3d20 7072 6f64 7563 745b 2772  epo = product['r
+00012390: 6570 6f27 5d0a 2020 2020 2020 2020 2020  epo'].          
+000123a0: 2020 2020 2020 7072 696e 7428 6622 7265        print(f"re
+000123b0: 706f 3a7b 7265 706f 7d5c 7467 726f 7570  po:{repo}\tgroup
+000123c0: 3a7b 6772 6f75 707d 2229 0a20 2020 2020  :{group}").     
+000123d0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+000123e0: 3129 0a20 2020 2020 2020 2065 6c73 653a  1).        else:
+000123f0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+00012400: 6475 6374 203d 2070 726f 6475 6374 735b  duct = products[
+00012410: 305d 0a20 2020 2020 2020 2020 2020 2070  0].            p
+00012420: 6c61 6e20 3d20 6e61 6d65 7574 696c 732e  lan = nameutils.
+00012430: 6765 745f 7261 6e64 6f6d 5f6e 616d 6528  get_random_name(
+00012440: 2920 6966 2070 6c61 6e20 6973 204e 6f6e  ) if plan is Non
+00012450: 6520 656c 7365 2070 6c61 6e0a 2020 2020  e else plan.    
+00012460: 2020 2020 2020 2020 7265 706f 203d 2070          repo = p
+00012470: 726f 6475 6374 5b27 7265 706f 275d 0a20  roduct['repo']. 
+00012480: 2020 2020 2020 2020 2020 2069 6620 2772             if 'r
+00012490: 6561 6c64 6972 2720 696e 2070 726f 6475  ealdir' in produ
+000124a0: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
+000124b0: 2020 2020 7265 706f 6469 7220 3d20 2225      repodir = "%
+000124c0: 732f 2e6b 636c 692f 706c 616e 732f 2573  s/.kcli/plans/%s
+000124d0: 2f25 7322 2025 2028 6f73 2e65 6e76 6972  /%s" % (os.envir
+000124e0: 6f6e 2e67 6574 2827 484f 4d45 2729 2c20  on.get('HOME'), 
+000124f0: 7265 706f 2c20 7072 6f64 7563 745b 2772  repo, product['r
+00012500: 6561 6c64 6972 275d 290a 2020 2020 2020  ealdir']).      
+00012510: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00012520: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00012530: 6469 7220 3d20 2225 732f 2e6b 636c 692f  dir = "%s/.kcli/
+00012540: 706c 616e 732f 2573 2220 2520 286f 732e  plans/%s" % (os.
+00012550: 656e 7669 726f 6e2e 6765 7428 2748 4f4d  environ.get('HOM
+00012560: 4527 292c 2072 6570 6f29 0a20 2020 2020  E'), repo).     
+00012570: 2020 2020 2020 2069 6620 272f 2720 696e         if '/' in
+00012580: 2070 726f 6475 6374 5b27 6669 6c65 275d   product['file']
+00012590: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000125a0: 2020 696e 7075 7466 696c 6520 3d20 6f73    inputfile = os
+000125b0: 2e70 6174 682e 6261 7365 6e61 6d65 2870  .path.basename(p
+000125c0: 726f 6475 6374 5b27 6669 6c65 275d 290a  roduct['file']).
+000125d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125e0: 7265 706f 6469 7220 2b3d 2022 2f25 7322  repodir += "/%s"
+000125f0: 2025 206f 732e 7061 7468 2e64 6972 6e61   % os.path.dirna
+00012600: 6d65 2870 726f 6475 6374 5b27 6669 6c65  me(product['file
+00012610: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+00012620: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00012630: 2020 2020 2020 696e 7075 7466 696c 6520        inputfile 
+00012640: 3d20 7072 6f64 7563 745b 2766 696c 6527  = product['file'
+00012650: 5d0a 2020 2020 2020 2020 2020 2020 696d  ].            im
+00012660: 6167 6520 3d20 7072 6f64 7563 742e 6765  age = product.ge
+00012670: 7428 2769 6d61 6765 2729 0a20 2020 2020  t('image').     
+00012680: 2020 2020 2020 2070 6172 616d 6574 6572         parameter
+00012690: 7320 3d20 7072 6f64 7563 742e 6765 7428  s = product.get(
+000126a0: 2770 6172 616d 6574 6572 7327 290a 2020  'parameters').  
+000126b0: 2020 2020 2020 2020 2020 6966 2069 6d61            if ima
+000126c0: 6765 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ge is not None:.
+000126d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126e0: 7072 696e 7428 6622 4e6f 7465 2074 6861  print(f"Note tha
+000126f0: 7420 7468 6973 2070 726f 6475 6374 2075  t this product u
+00012700: 7365 7320 696d 6167 653a 207b 696d 6167  ses image: {imag
+00012710: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+00012720: 2069 6620 7061 7261 6d65 7465 7273 2069   if parameters i
+00012730: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00012740: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00012750: 7061 7261 6d65 7465 7220 696e 2070 6172  parameter in par
+00012760: 616d 6574 6572 733a 0a20 2020 2020 2020  ameters:.       
+00012770: 2020 2020 2020 2020 2020 2020 2061 7070               app
+00012780: 6c69 6564 5f70 6172 616d 6574 6572 203d  lied_parameter =
+00012790: 206f 7665 7272 6964 6573 5b70 6172 616d   overrides[param
+000127a0: 6574 6572 5d20 6966 2070 6172 616d 6574  eter] if paramet
+000127b0: 6572 2069 6e20 6f76 6572 7269 6465 7320  er in overrides 
+000127c0: 656c 7365 2070 6172 616d 6574 6572 735b  else parameters[
+000127d0: 7061 7261 6d65 7465 725d 0a20 2020 2020  parameter].     
+000127e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000127f0: 7269 6e74 2866 2255 7369 6e67 2070 6172  rint(f"Using par
+00012800: 616d 6574 6572 207b 7061 7261 6d65 7465  ameter {paramete
+00012810: 727d 3a20 7b61 7070 6c69 6564 5f70 6172  r}: {applied_par
+00012820: 616d 6574 6572 7d22 290a 2020 2020 2020  ameter}").      
+00012830: 2020 2020 2020 6578 7472 6170 6172 616d        extraparam
+00012840: 6574 6572 7320 3d20 6c69 7374 2873 6574  eters = list(set
+00012850: 286f 7665 7272 6964 6573 2920 2d20 7365  (overrides) - se
+00012860: 7428 7061 7261 6d65 7465 7273 2929 2069  t(parameters)) i
+00012870: 6620 7061 7261 6d65 7465 7273 2069 7320  f parameters is 
+00012880: 6e6f 7420 4e6f 6e65 2065 6c73 6520 6f76  not None else ov
+00012890: 6572 7269 6465 730a 2020 2020 2020 2020  errides.        
+000128a0: 2020 2020 666f 7220 7061 7261 6d65 7465      for paramete
+000128b0: 7220 696e 2065 7874 7261 7061 7261 6d65  r in extraparame
+000128c0: 7465 7273 3a0a 2020 2020 2020 2020 2020  ters:.          
+000128d0: 2020 2020 2020 7072 696e 7428 2255 7369        print("Usi
+000128e0: 6e67 2070 6172 616d 6574 6572 2025 733a  ng parameter %s:
+000128f0: 2025 7322 2025 2028 7061 7261 6d65 7465   %s" % (paramete
+00012900: 722c 206f 7665 7272 6964 6573 5b70 6172  r, overrides[par
+00012910: 616d 6574 6572 5d29 290a 2020 2020 2020  ameter])).      
+00012920: 2020 2020 2020 6966 206e 6f74 206c 6174        if not lat
+00012930: 6573 743a 0a20 2020 2020 2020 2020 2020  est:.           
+00012940: 2020 2020 2070 7072 696e 7428 6622 5573       pprint(f"Us
+00012950: 696e 6720 6469 7265 6374 6f72 7920 7b72  ing directory {r
+00012960: 6570 6f64 6972 7d22 290a 2020 2020 2020  epodir}").      
+00012970: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00012980: 6c61 6e28 706c 616e 2c20 7061 7468 3d72  lan(plan, path=r
+00012990: 6570 6f64 6972 2c20 696e 7075 7466 696c  epodir, inputfil
+000129a0: 653d 696e 7075 7466 696c 652c 206f 7665  e=inputfile, ove
+000129b0: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+000129c0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+000129d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000129e0: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
+000129f0: 7265 706f 2872 6570 6f29 0a20 2020 2020  repo(repo).     
+00012a00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00012a10: 706c 616e 2870 6c61 6e2c 2070 6174 683d  plan(plan, path=
+00012a20: 7265 706f 6469 722c 2069 6e70 7574 6669  repodir, inputfi
+00012a30: 6c65 3d69 6e70 7574 6669 6c65 2c20 6f76  le=inputfile, ov
+00012a40: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
+00012a50: 7329 0a20 2020 2020 2020 2020 2020 2070  s).            p
+00012a60: 7072 696e 7428 6622 5072 6f64 7563 7420  print(f"Product 
+00012a70: 6361 6e20 6265 2064 656c 6574 6564 2077  can be deleted w
+00012a80: 6974 683a 206b 636c 6920 6465 6c65 7465  ith: kcli delete
+00012a90: 2070 6c61 6e20 2d2d 7965 7320 7b70 6c61   plan --yes {pla
+00012aa0: 6e7d 2229 0a20 2020 2020 2020 2072 6574  n}").        ret
+00012ab0: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00012ac0: 7375 6363 6573 7327 2c20 2770 6c61 6e27  success', 'plan'
+00012ad0: 3a20 706c 616e 7d0a 0a20 2020 2064 6566  : plan}..    def
+00012ae0: 2073 7461 7274 5f70 6c61 6e28 7365 6c66   start_plan(self
+00012af0: 2c20 706c 616e 2c20 636f 6e74 6169 6e65  , plan, containe
+00012b00: 723d 4661 6c73 6529 3a0a 2020 2020 2020  r=False):.      
+00012b10: 2020 6b20 3d20 7365 6c66 2e6b 0a20 2020    k = self.k.   
+00012b20: 2020 2020 2073 7461 7274 666f 756e 6420       startfound 
+00012b30: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00012b40: 7070 7269 6e74 2866 2253 7461 7274 696e  pprint(f"Startin
+00012b50: 6720 766d 7320 6672 6f6d 2070 6c61 6e20  g vms from plan 
+00012b60: 7b70 6c61 6e7d 2229 0a20 2020 2020 2020  {plan}").       
+00012b70: 2069 6620 6e6f 7420 7365 6c66 2e65 7874   if not self.ext
+00012b80: 7261 636c 6965 6e74 733a 0a20 2020 2020  raclients:.     
+00012b90: 2020 2020 2020 2073 7461 7274 636c 6965         startclie
+00012ba0: 6e74 7320 3d20 7b73 656c 662e 636c 6965  nts = {self.clie
+00012bb0: 6e74 3a20 6b7d 0a20 2020 2020 2020 2065  nt: k}.        e
+00012bc0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00012bd0: 2073 7461 7274 636c 6965 6e74 7320 3d20   startclients = 
+00012be0: 7365 6c66 2e65 7874 7261 636c 6965 6e74  self.extraclient
+00012bf0: 730a 2020 2020 2020 2020 2020 2020 7374  s.            st
+00012c00: 6172 7463 6c69 656e 7473 2e75 7064 6174  artclients.updat
+00012c10: 6528 7b73 656c 662e 636c 6965 6e74 3a20  e({self.client: 
+00012c20: 6b7d 290a 2020 2020 2020 2020 666f 7220  k}).        for 
+00012c30: 6879 7065 7276 6973 6f72 2069 6e20 7374  hypervisor in st
+00012c40: 6172 7463 6c69 656e 7473 3a0a 2020 2020  artclients:.    
+00012c50: 2020 2020 2020 2020 6320 3d20 7374 6172          c = star
+00012c60: 7463 6c69 656e 7473 5b68 7970 6572 7669  tclients[hypervi
+00012c70: 736f 725d 0a20 2020 2020 2020 2020 2020  sor].           
+00012c80: 2066 6f72 2076 6d20 696e 2073 6f72 7465   for vm in sorte
+00012c90: 6428 632e 6c69 7374 2829 2c20 6b65 793d  d(c.list(), key=
+00012ca0: 6c61 6d62 6461 2078 3a20 785b 276e 616d  lambda x: x['nam
+00012cb0: 6527 5d29 3a0a 2020 2020 2020 2020 2020  e']):.          
+00012cc0: 2020 2020 2020 6e61 6d65 203d 2076 6d5b        name = vm[
+00012cd0: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
+00012ce0: 2020 2020 2020 2020 6465 7363 7269 7074          descript
+00012cf0: 696f 6e20 3d20 766d 2e67 6574 2827 706c  ion = vm.get('pl
+00012d00: 616e 2729 0a20 2020 2020 2020 2020 2020  an').           
+00012d10: 2020 2020 2069 6620 6465 7363 7269 7074       if descript
+00012d20: 696f 6e20 3d3d 2070 6c61 6e3a 0a20 2020  ion == plan:.   
+00012d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d40: 2073 7461 7274 666f 756e 6420 3d20 5472   startfound = Tr
+00012d50: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00012d60: 2020 2020 2020 2063 2e73 7461 7274 286e         c.start(n
+00012d70: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00012d80: 2020 2020 2020 2020 2073 7563 6365 7373           success
+00012d90: 2866 227b 6e61 6d65 7d20 7374 6172 7465  (f"{name} starte
+00012da0: 6420 6f6e 207b 6879 7065 7276 6973 6f72  d on {hypervisor
+00012db0: 7d21 2229 0a20 2020 2020 2020 2069 6620  }!").        if 
+00012dc0: 636f 6e74 6169 6e65 723a 0a20 2020 2020  container:.     
+00012dd0: 2020 2020 2020 2063 6f6e 7420 3d20 4b63         cont = Kc
+00012de0: 6f6e 7461 696e 6572 636f 6e66 6967 2873  ontainerconfig(s
+00012df0: 656c 662c 2063 6c69 656e 743d 7365 6c66  elf, client=self
+00012e00: 2e63 6f6e 7461 696e 6572 636c 6965 6e74  .containerclient
+00012e10: 292e 636f 6e74 0a20 2020 2020 2020 2020  ).cont.         
+00012e20: 2020 2066 6f72 2063 6f6e 7461 2069 6e20     for conta in 
+00012e30: 736f 7274 6564 2863 6f6e 742e 6c69 7374  sorted(cont.list
+00012e40: 5f63 6f6e 7461 696e 6572 7328 6b29 293a  _containers(k)):
+00012e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012e60: 206e 616d 6520 3d20 636f 6e74 615b 305d   name = conta[0]
+00012e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012e80: 2063 6f6e 7461 696e 6572 706c 616e 203d   containerplan =
+00012e90: 2063 6f6e 7461 5b33 5d0a 2020 2020 2020   conta[3].      
+00012ea0: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
+00012eb0: 7461 696e 6572 706c 616e 203d 3d20 706c  tainerplan == pl
+00012ec0: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
+00012ed0: 2020 2020 2020 2020 7374 6172 7466 6f75          startfou
+00012ee0: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
+00012ef0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00012f00: 6e74 2e73 7461 7274 5f63 6f6e 7461 696e  nt.start_contain
+00012f10: 6572 286e 616d 6529 0a20 2020 2020 2020  er(name).       
+00012f20: 2020 2020 2020 2020 2020 2020 2073 7563               suc
+00012f30: 6365 7373 2866 2243 6f6e 7461 696e 6572  cess(f"Container
+00012f40: 207b 6e61 6d65 7d20 7374 6172 7465 6421   {name} started!
+00012f50: 2229 0a20 2020 2020 2020 2069 6620 7374  ").        if st
+00012f60: 6172 7466 6f75 6e64 3a0a 2020 2020 2020  artfound:.      
+00012f70: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
+00012f80: 506c 616e 207b 706c 616e 7d20 7374 6172  Plan {plan} star
+00012f90: 7465 6421 2229 0a20 2020 2020 2020 2065  ted!").        e
+00012fa0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00012fb0: 2077 6172 6e69 6e67 2822 4e6f 206d 6174   warning("No mat
+00012fc0: 6368 696e 6720 6f62 6a65 6374 7320 666f  ching objects fo
+00012fd0: 756e 6422 290a 2020 2020 2020 2020 7265  und").        re
+00012fe0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+00012ff0: 2773 7563 6365 7373 277d 0a0a 2020 2020  'success'}..    
+00013000: 6465 6620 7374 6f70 5f70 6c61 6e28 7365  def stop_plan(se
+00013010: 6c66 2c20 706c 616e 2c20 736f 6674 3d46  lf, plan, soft=F
+00013020: 616c 7365 2c20 636f 6e74 6169 6e65 723d  alse, container=
+00013030: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+00013040: 6b20 3d20 7365 6c66 2e6b 0a20 2020 2020  k = self.k.     
+00013050: 2020 2073 746f 7066 6f75 6e64 203d 2054     stopfound = T
+00013060: 7275 650a 2020 2020 2020 2020 7070 7269  rue.        ppri
+00013070: 6e74 2866 2253 746f 7070 696e 6720 766d  nt(f"Stopping vm
+00013080: 7320 6672 6f6d 2070 6c61 6e20 7b70 6c61  s from plan {pla
+00013090: 6e7d 2229 0a20 2020 2020 2020 2069 6620  n}").        if 
+000130a0: 6e6f 7420 7365 6c66 2e65 7874 7261 636c  not self.extracl
+000130b0: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
+000130c0: 2020 2073 746f 7063 6c69 656e 7473 203d     stopclients =
+000130d0: 207b 7365 6c66 2e63 6c69 656e 743a 206b   {self.client: k
+000130e0: 7d0a 2020 2020 2020 2020 656c 7365 3a0a  }.        else:.
+000130f0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
+00013100: 636c 6965 6e74 7320 3d20 7365 6c66 2e65  clients = self.e
+00013110: 7874 7261 636c 6965 6e74 730a 2020 2020  xtraclients.    
+00013120: 2020 2020 2020 2020 7374 6f70 636c 6965          stopclie
+00013130: 6e74 732e 7570 6461 7465 287b 7365 6c66  nts.update({self
+00013140: 2e63 6c69 656e 743a 206b 7d29 0a20 2020  .client: k}).   
+00013150: 2020 2020 2066 6f72 2068 7970 6572 7669       for hypervi
+00013160: 736f 7220 696e 2073 746f 7063 6c69 656e  sor in stopclien
+00013170: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00013180: 6320 3d20 7374 6f70 636c 6965 6e74 735b  c = stopclients[
+00013190: 6879 7065 7276 6973 6f72 5d0a 2020 2020  hypervisor].    
+000131a0: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
+000131b0: 6e20 736f 7274 6564 2863 2e6c 6973 7428  n sorted(c.list(
+000131c0: 292c 206b 6579 3d6c 616d 6264 6120 783a  ), key=lambda x:
+000131d0: 2078 5b27 6e61 6d65 275d 293a 0a20 2020   x['name']):.   
+000131e0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+000131f0: 6520 3d20 766d 5b27 6e61 6d65 275d 0a20  e = vm['name']. 
+00013200: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00013210: 6573 6372 6970 7469 6f6e 203d 2076 6d2e  escription = vm.
+00013220: 6765 7428 2770 6c61 6e27 290a 2020 2020  get('plan').    
+00013230: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00013240: 6573 6372 6970 7469 6f6e 203d 3d20 706c  escription == pl
+00013250: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
+00013260: 2020 2020 2020 2020 7374 6f70 666f 756e          stopfoun
+00013270: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+00013280: 2020 2020 2020 2020 2020 2020 2063 2e73               c.s
+00013290: 746f 7028 6e61 6d65 2c20 736f 6674 3d73  top(name, soft=s
+000132a0: 6f66 7429 0a20 2020 2020 2020 2020 2020  oft).           
+000132b0: 2020 2020 2020 2020 2073 7563 6365 7373           success
+000132c0: 2866 227b 6e61 6d65 7d20 7374 6f70 7065  (f"{name} stoppe
+000132d0: 6420 6f6e 207b 6879 7065 7276 6973 6f72  d on {hypervisor
+000132e0: 7d21 2229 0a20 2020 2020 2020 2069 6620  }!").        if 
+000132f0: 636f 6e74 6169 6e65 723a 0a20 2020 2020  container:.     
+00013300: 2020 2020 2020 2063 6f6e 7420 3d20 4b63         cont = Kc
+00013310: 6f6e 7461 696e 6572 636f 6e66 6967 2873  ontainerconfig(s
+00013320: 656c 662c 2063 6c69 656e 743d 7365 6c66  elf, client=self
+00013330: 2e63 6f6e 7461 696e 6572 636c 6965 6e74  .containerclient
+00013340: 292e 636f 6e74 0a20 2020 2020 2020 2020  ).cont.         
+00013350: 2020 2066 6f72 2063 6f6e 7461 2069 6e20     for conta in 
+00013360: 736f 7274 6564 2863 6f6e 742e 6c69 7374  sorted(cont.list
+00013370: 5f63 6f6e 7461 696e 6572 7328 2929 3a0a  _containers()):.
 00013380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013390: 2020 2073 746f 7066 6f75 6e64 203d 2054     stopfound = T
-000133a0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-000133b0: 2020 2020 2020 2020 636f 6e74 2e73 746f          cont.sto
-000133c0: 705f 636f 6e74 6169 6e65 7228 6e61 6d65  p_container(name
-000133d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000133e0: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
-000133f0: 436f 6e74 6169 6e65 7220 7b6e 616d 657d  Container {name}
-00013400: 2073 746f 7070 6564 2122 290a 2020 2020   stopped!").    
-00013410: 2020 2020 6966 2073 746f 7066 6f75 6e64      if stopfound
-00013420: 3a0a 2020 2020 2020 2020 2020 2020 7375  :.            su
-00013430: 6363 6573 7328 6622 506c 616e 207b 706c  ccess(f"Plan {pl
-00013440: 616e 7d20 7374 6f70 7065 6421 2229 0a20  an} stopped!"). 
-00013450: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00013460: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00013470: 2822 4e6f 206d 6174 6368 696e 6720 6f62  ("No matching ob
-00013480: 6a65 6374 7320 666f 756e 6422 290a 2020  jects found").  
-00013490: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-000134a0: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
-000134b0: 277d 0a0a 2020 2020 6465 6620 6175 746f  '}..    def auto
-000134c0: 7374 6172 745f 706c 616e 2873 656c 662c  start_plan(self,
-000134d0: 2070 6c61 6e29 3a0a 2020 2020 2020 2020   plan):.        
-000134e0: 6b20 3d20 7365 6c66 2e6b 0a20 2020 2020  k = self.k.     
-000134f0: 2020 2070 7072 696e 7428 6622 5365 7420     pprint(f"Set 
-00013500: 766d 7320 6672 6f6d 2070 6c61 6e20 7b70  vms from plan {p
-00013510: 6c61 6e7d 2074 6f20 6175 746f 7374 6172  lan} to autostar
-00013520: 7422 290a 2020 2020 2020 2020 666f 7220  t").        for 
-00013530: 766d 2069 6e20 736f 7274 6564 286b 2e6c  vm in sorted(k.l
-00013540: 6973 7428 292c 206b 6579 3d6c 616d 6264  ist(), key=lambd
-00013550: 6120 783a 2078 5b27 6e61 6d65 275d 293a  a x: x['name']):
-00013560: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
-00013570: 6520 3d20 766d 5b27 6e61 6d65 275d 0a20  e = vm['name']. 
-00013580: 2020 2020 2020 2020 2020 2064 6573 6372             descr
-00013590: 6970 7469 6f6e 203d 2076 6d5b 2770 6c61  iption = vm['pla
-000135a0: 6e27 5d0a 2020 2020 2020 2020 2020 2020  n'].            
-000135b0: 6966 2064 6573 6372 6970 7469 6f6e 203d  if description =
-000135c0: 3d20 706c 616e 3a0a 2020 2020 2020 2020  = plan:.        
-000135d0: 2020 2020 2020 2020 6b2e 7570 6461 7465          k.update
-000135e0: 5f73 7461 7274 286e 616d 652c 2073 7461  _start(name, sta
-000135f0: 7274 3d54 7275 6529 0a20 2020 2020 2020  rt=True).       
-00013600: 2020 2020 2020 2020 2073 7563 6365 7373           success
-00013610: 2866 227b 6e61 6d65 7d20 7365 7420 746f  (f"{name} set to
-00013620: 2061 7574 6f73 7461 7274 2122 290a 2020   autostart!").  
-00013630: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-00013640: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
-00013650: 277d 0a0a 2020 2020 6465 6620 6e6f 6175  '}..    def noau
-00013660: 746f 7374 6172 745f 706c 616e 2873 656c  tostart_plan(sel
-00013670: 662c 2070 6c61 6e29 3a0a 2020 2020 2020  f, plan):.      
-00013680: 2020 6b20 3d20 7365 6c66 2e6b 0a20 2020    k = self.k.   
-00013690: 2020 2020 2070 7072 696e 7428 6622 5072       pprint(f"Pr
-000136a0: 6576 656e 7469 6e67 2076 6d73 2066 726f  eventing vms fro
-000136b0: 6d20 706c 616e 207b 706c 616e 7d20 746f  m plan {plan} to
-000136c0: 2061 7574 6f73 7461 7274 2229 0a20 2020   autostart").   
-000136d0: 2020 2020 2066 6f72 2076 6d20 696e 2073       for vm in s
-000136e0: 6f72 7465 6428 6b2e 6c69 7374 2829 2c20  orted(k.list(), 
-000136f0: 6b65 793d 6c61 6d62 6461 2078 3a20 785b  key=lambda x: x[
-00013700: 276e 616d 6527 5d29 3a0a 2020 2020 2020  'name']):.      
-00013710: 2020 2020 2020 6e61 6d65 203d 2076 6d5b        name = vm[
-00013720: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
-00013730: 2020 2020 6465 7363 7269 7074 696f 6e20      description 
-00013740: 3d20 766d 5b27 706c 616e 275d 0a20 2020  = vm['plan'].   
-00013750: 2020 2020 2020 2020 2069 6620 6465 7363           if desc
-00013760: 7269 7074 696f 6e20 3d3d 2070 6c61 6e3a  ription == plan:
-00013770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013780: 206b 2e75 7064 6174 655f 7374 6172 7428   k.update_start(
-00013790: 6e61 6d65 2c20 7374 6172 743d 4661 6c73  name, start=Fals
-000137a0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-000137b0: 2020 2073 7563 6365 7373 2866 227b 6e61     success(f"{na
-000137c0: 6d65 7d20 7072 6576 656e 7465 6420 746f  me} prevented to
-000137d0: 2061 7574 6f73 7461 7274 2122 290a 2020   autostart!").  
-000137e0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-000137f0: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
-00013800: 277d 0a0a 2020 2020 6465 6620 6465 6c65  '}..    def dele
-00013810: 7465 5f70 6c61 6e28 7365 6c66 2c20 706c  te_plan(self, pl
-00013820: 616e 2c20 636f 6e74 6169 6e65 723d 4661  an, container=Fa
-00013830: 6c73 652c 2075 6e72 6567 6973 7465 723d  lse, unregister=
-00013840: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-00013850: 6b20 3d20 7365 6c66 2e6b 0a20 2020 2020  k = self.k.     
-00013860: 2020 2064 656c 6574 6564 766d 7320 3d20     deletedvms = 
-00013870: 5b5d 0a20 2020 2020 2020 2064 656c 6574  [].        delet
-00013880: 6564 6c62 7320 3d20 5b5d 0a20 2020 2020  edlbs = [].     
-00013890: 2020 2064 6e73 636c 6965 6e74 7320 3d20     dnsclients = 
-000138a0: 5b5d 0a20 2020 2020 2020 206e 6574 776f  [].        netwo
-000138b0: 726b 7320 3d20 5b5d 0a20 2020 2020 2020  rks = [].       
-000138c0: 2069 6620 706c 616e 203d 3d20 2727 3a0a   if plan == '':.
-000138d0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-000138e0: 7228 2254 6861 7420 776f 756c 6420 6465  r("That would de
-000138f0: 6c65 7465 2065 7665 7279 2076 6d2e 2e2e  lete every vm...
-00013900: 4e6f 7420 646f 696e 6720 7468 6174 2229  Not doing that")
-00013910: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
-00013920: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-00013930: 2066 6f75 6e64 203d 2046 616c 7365 0a20   found = False. 
-00013940: 2020 2020 2020 2064 656c 6574 6563 6c69         deletecli
-00013950: 656e 7473 203d 207b 7365 6c66 2e63 6c69  ents = {self.cli
-00013960: 656e 743a 206b 7d0a 2020 2020 2020 2020  ent: k}.        
-00013970: 766d 636c 6965 6e74 7320 3d20 5b5d 0a20  vmclients = []. 
-00013980: 2020 2020 2020 2076 6d63 6c69 656e 7473         vmclients
-00013990: 5f66 696c 6520 3d20 6f73 2e70 6174 682e  _file = os.path.
-000139a0: 6578 7061 6e64 7573 6572 2866 277e 2f2e  expanduser(f'~/.
-000139b0: 6b63 6c69 2f76 6d63 6c69 656e 7473 5f7b  kcli/vmclients_{
-000139c0: 706c 616e 7d27 290a 2020 2020 2020 2020  plan}').        
-000139d0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-000139e0: 7328 766d 636c 6965 6e74 735f 6669 6c65  s(vmclients_file
-000139f0: 293a 0a20 2020 2020 2020 2020 2020 2076  ):.            v
-00013a00: 6d63 6c69 656e 7473 203d 2079 616d 6c2e  mclients = yaml.
-00013a10: 7361 6665 5f6c 6f61 6428 6f70 656e 2876  safe_load(open(v
-00013a20: 6d63 6c69 656e 7473 5f66 696c 6529 290a  mclients_file)).
-00013a30: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
-00013a40: 656d 6f76 6528 766d 636c 6965 6e74 735f  emove(vmclients_
-00013a50: 6669 6c65 290a 2020 2020 2020 2020 6966  file).        if
-00013a60: 2073 656c 662e 6578 7472 6163 6c69 656e   self.extraclien
-00013a70: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00013a80: 6465 6c65 7465 636c 6965 6e74 732e 7570  deleteclients.up
-00013a90: 6461 7465 2873 656c 662e 6578 7472 6163  date(self.extrac
-00013aa0: 6c69 656e 7473 290a 2020 2020 2020 2020  lients).        
-00013ab0: 656c 6966 2076 6d63 6c69 656e 7473 3a0a  elif vmclients:.
-00013ac0: 2020 2020 2020 2020 2020 2020 6465 6c65              dele
-00013ad0: 7465 636c 6965 6e74 732e 7570 6461 7465  teclients.update
-00013ae0: 287b 636c 693a 204b 636f 6e66 6967 2863  ({cli: Kconfig(c
-00013af0: 6c69 656e 743d 636c 6929 2e6b 2066 6f72  lient=cli).k for
-00013b00: 2063 6c69 2069 6e20 766d 636c 6965 6e74   cli in vmclient
-00013b10: 7320 6966 2063 6c69 2021 3d20 7365 6c66  s if cli != self
-00013b20: 2e63 6c69 656e 747d 290a 2020 2020 2020  .client}).      
-00013b30: 2020 676b 6520 3d20 4661 6c73 650a 2020    gke = False.  
-00013b40: 2020 2020 2020 6879 7065 7273 6869 6674        hypershift
-00013b50: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00013b60: 2061 7373 6973 7465 6420 3d20 4661 6c73   assisted = Fals
-00013b70: 650a 2020 2020 2020 2020 636c 7573 7465  e.        cluste
-00013b80: 7264 6972 203d 2022 2f66 616b 652f 7878  rdir = "/fake/xx
-00013b90: 7822 0a20 2020 2020 2020 2066 6f72 2068  x".        for h
-00013ba0: 7970 6572 7669 736f 7220 696e 2064 656c  ypervisor in del
-00013bb0: 6574 6563 6c69 656e 7473 3a0a 2020 2020  eteclients:.    
-00013bc0: 2020 2020 2020 2020 6320 3d20 6465 6c65          c = dele
-00013bd0: 7465 636c 6965 6e74 735b 6879 7065 7276  teclients[hyperv
-00013be0: 6973 6f72 5d0a 2020 2020 2020 2020 2020  isor].          
-00013bf0: 2020 666f 7220 766d 2069 6e20 736f 7274    for vm in sort
-00013c00: 6564 2863 2e6c 6973 7428 292c 206b 6579  ed(c.list(), key
-00013c10: 3d6c 616d 6264 6120 783a 2078 5b27 6e61  =lambda x: x['na
-00013c20: 6d65 275d 293a 0a20 2020 2020 2020 2020  me']):.         
-00013c30: 2020 2020 2020 206e 616d 6520 3d20 766d         name = vm
-00013c40: 5b27 6e61 6d65 275d 0a20 2020 2020 2020  ['name'].       
-00013c50: 2020 2020 2020 2020 2064 6573 6372 6970           descrip
-00013c60: 7469 6f6e 203d 2076 6d2e 6765 7428 2770  tion = vm.get('p
-00013c70: 6c61 6e27 290a 2020 2020 2020 2020 2020  lan').          
-00013c80: 2020 2020 2020 6966 2064 6573 6372 6970        if descrip
-00013c90: 7469 6f6e 203d 3d20 706c 616e 3a0a 2020  tion == plan:.  
-00013ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cb0: 2020 6966 2076 6d2e 6765 7428 276b 7562    if vm.get('kub
-00013cc0: 6574 7970 6527 2c20 2767 656e 6572 6963  etype', 'generic
-00013cd0: 2729 203d 3d20 2767 6b65 273a 0a20 2020  ') == 'gke':.   
-00013ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cf0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00013d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d10: 2020 6966 2027 6c6f 6164 6261 6c61 6e63    if 'loadbalanc
-00013d20: 6572 2720 696e 2076 6d3a 0a20 2020 2020  er' in vm:.     
-00013d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d40: 2020 206c 6273 203d 2076 6d5b 276c 6f61     lbs = vm['loa
-00013d50: 6462 616c 616e 6365 7227 5d2e 7370 6c69  dbalancer'].spli
-00013d60: 7428 272c 2729 0a20 2020 2020 2020 2020  t(',').         
-00013d70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00013d80: 6f72 206c 6220 696e 206c 6273 3a0a 2020  or lb in lbs:.  
+00013390: 6e61 6d65 203d 2063 6f6e 7461 5b30 5d0a  name = conta[0].
+000133a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133b0: 636f 6e74 6169 6e65 7270 6c61 6e20 3d20  containerplan = 
+000133c0: 636f 6e74 615b 335d 0a20 2020 2020 2020  conta[3].       
+000133d0: 2020 2020 2020 2020 2069 6620 636f 6e74           if cont
+000133e0: 6169 6e65 7270 6c61 6e20 3d3d 2070 6c61  ainerplan == pla
+000133f0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+00013400: 2020 2020 2020 2073 746f 7066 6f75 6e64         stopfound
+00013410: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00013420: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00013430: 2e73 746f 705f 636f 6e74 6169 6e65 7228  .stop_container(
+00013440: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+00013450: 2020 2020 2020 2020 2020 7375 6363 6573            succes
+00013460: 7328 6622 436f 6e74 6169 6e65 7220 7b6e  s(f"Container {n
+00013470: 616d 657d 2073 746f 7070 6564 2122 290a  ame} stopped!").
+00013480: 2020 2020 2020 2020 6966 2073 746f 7066          if stopf
+00013490: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
+000134a0: 2020 7375 6363 6573 7328 6622 506c 616e    success(f"Plan
+000134b0: 207b 706c 616e 7d20 7374 6f70 7065 6421   {plan} stopped!
+000134c0: 2229 0a20 2020 2020 2020 2065 6c73 653a  ").        else:
+000134d0: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
+000134e0: 6e69 6e67 2822 4e6f 206d 6174 6368 696e  ning("No matchin
+000134f0: 6720 6f62 6a65 6374 7320 666f 756e 6422  g objects found"
+00013500: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00013510: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
+00013520: 6365 7373 277d 0a0a 2020 2020 6465 6620  cess'}..    def 
+00013530: 6175 746f 7374 6172 745f 706c 616e 2873  autostart_plan(s
+00013540: 656c 662c 2070 6c61 6e29 3a0a 2020 2020  elf, plan):.    
+00013550: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
+00013560: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00013570: 5365 7420 766d 7320 6672 6f6d 2070 6c61  Set vms from pla
+00013580: 6e20 7b70 6c61 6e7d 2074 6f20 6175 746f  n {plan} to auto
+00013590: 7374 6172 7422 290a 2020 2020 2020 2020  start").        
+000135a0: 666f 7220 766d 2069 6e20 736f 7274 6564  for vm in sorted
+000135b0: 286b 2e6c 6973 7428 292c 206b 6579 3d6c  (k.list(), key=l
+000135c0: 616d 6264 6120 783a 2078 5b27 6e61 6d65  ambda x: x['name
+000135d0: 275d 293a 0a20 2020 2020 2020 2020 2020  ']):.           
+000135e0: 206e 616d 6520 3d20 766d 5b27 6e61 6d65   name = vm['name
+000135f0: 275d 0a20 2020 2020 2020 2020 2020 2064  '].            d
+00013600: 6573 6372 6970 7469 6f6e 203d 2076 6d5b  escription = vm[
+00013610: 2770 6c61 6e27 5d0a 2020 2020 2020 2020  'plan'].        
+00013620: 2020 2020 6966 2064 6573 6372 6970 7469      if descripti
+00013630: 6f6e 203d 3d20 706c 616e 3a0a 2020 2020  on == plan:.    
+00013640: 2020 2020 2020 2020 2020 2020 6b2e 7570              k.up
+00013650: 6461 7465 5f73 7461 7274 286e 616d 652c  date_start(name,
+00013660: 2073 7461 7274 3d54 7275 6529 0a20 2020   start=True).   
+00013670: 2020 2020 2020 2020 2020 2020 2073 7563               suc
+00013680: 6365 7373 2866 227b 6e61 6d65 7d20 7365  cess(f"{name} se
+00013690: 7420 746f 2061 7574 6f73 7461 7274 2122  t to autostart!"
+000136a0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000136b0: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
+000136c0: 6365 7373 277d 0a0a 2020 2020 6465 6620  cess'}..    def 
+000136d0: 6e6f 6175 746f 7374 6172 745f 706c 616e  noautostart_plan
+000136e0: 2873 656c 662c 2070 6c61 6e29 3a0a 2020  (self, plan):.  
+000136f0: 2020 2020 2020 6b20 3d20 7365 6c66 2e6b        k = self.k
+00013700: 0a20 2020 2020 2020 2070 7072 696e 7428  .        pprint(
+00013710: 6622 5072 6576 656e 7469 6e67 2076 6d73  f"Preventing vms
+00013720: 2066 726f 6d20 706c 616e 207b 706c 616e   from plan {plan
+00013730: 7d20 746f 2061 7574 6f73 7461 7274 2229  } to autostart")
+00013740: 0a20 2020 2020 2020 2066 6f72 2076 6d20  .        for vm 
+00013750: 696e 2073 6f72 7465 6428 6b2e 6c69 7374  in sorted(k.list
+00013760: 2829 2c20 6b65 793d 6c61 6d62 6461 2078  (), key=lambda x
+00013770: 3a20 785b 276e 616d 6527 5d29 3a0a 2020  : x['name']):.  
+00013780: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+00013790: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
+000137a0: 2020 2020 2020 2020 6465 7363 7269 7074          descript
+000137b0: 696f 6e20 3d20 766d 5b27 706c 616e 275d  ion = vm['plan']
+000137c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000137d0: 6465 7363 7269 7074 696f 6e20 3d3d 2070  description == p
+000137e0: 6c61 6e3a 0a20 2020 2020 2020 2020 2020  lan:.           
+000137f0: 2020 2020 206b 2e75 7064 6174 655f 7374       k.update_st
+00013800: 6172 7428 6e61 6d65 2c20 7374 6172 743d  art(name, start=
+00013810: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+00013820: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
+00013830: 227b 6e61 6d65 7d20 7072 6576 656e 7465  "{name} prevente
+00013840: 6420 746f 2061 7574 6f73 7461 7274 2122  d to autostart!"
+00013850: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00013860: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
+00013870: 6365 7373 277d 0a0a 2020 2020 6465 6620  cess'}..    def 
+00013880: 6465 6c65 7465 5f70 6c61 6e28 7365 6c66  delete_plan(self
+00013890: 2c20 706c 616e 2c20 636f 6e74 6169 6e65  , plan, containe
+000138a0: 723d 4661 6c73 652c 2075 6e72 6567 6973  r=False, unregis
+000138b0: 7465 723d 4661 6c73 6529 3a0a 2020 2020  ter=False):.    
+000138c0: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
+000138d0: 2020 2020 2020 2064 656c 6574 6564 766d         deletedvm
+000138e0: 7320 3d20 5b5d 0a20 2020 2020 2020 2064  s = [].        d
+000138f0: 656c 6574 6564 6c62 7320 3d20 5b5d 0a20  eletedlbs = []. 
+00013900: 2020 2020 2020 2064 6e73 636c 6965 6e74         dnsclient
+00013910: 7320 3d20 5b5d 0a20 2020 2020 2020 206e  s = [].        n
+00013920: 6574 776f 726b 7320 3d20 5b5d 0a20 2020  etworks = [].   
+00013930: 2020 2020 2069 6620 706c 616e 203d 3d20       if plan == 
+00013940: 2727 3a0a 2020 2020 2020 2020 2020 2020  '':.            
+00013950: 6572 726f 7228 2254 6861 7420 776f 756c  error("That woul
+00013960: 6420 6465 6c65 7465 2065 7665 7279 2076  d delete every v
+00013970: 6d2e 2e2e 4e6f 7420 646f 696e 6720 7468  m...Not doing th
+00013980: 6174 2229 0a20 2020 2020 2020 2020 2020  at").           
+00013990: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+000139a0: 2020 2020 2066 6f75 6e64 203d 2046 616c       found = Fal
+000139b0: 7365 0a20 2020 2020 2020 2064 656c 6574  se.        delet
+000139c0: 6563 6c69 656e 7473 203d 207b 7365 6c66  eclients = {self
+000139d0: 2e63 6c69 656e 743a 206b 7d0a 2020 2020  .client: k}.    
+000139e0: 2020 2020 766d 636c 6965 6e74 7320 3d20      vmclients = 
+000139f0: 5b5d 0a20 2020 2020 2020 2076 6d63 6c69  [].        vmcli
+00013a00: 656e 7473 5f66 696c 6520 3d20 6f73 2e70  ents_file = os.p
+00013a10: 6174 682e 6578 7061 6e64 7573 6572 2866  ath.expanduser(f
+00013a20: 277e 2f2e 6b63 6c69 2f76 6d63 6c69 656e  '~/.kcli/vmclien
+00013a30: 7473 5f7b 706c 616e 7d27 290a 2020 2020  ts_{plan}').    
+00013a40: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+00013a50: 7869 7374 7328 766d 636c 6965 6e74 735f  xists(vmclients_
+00013a60: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
+00013a70: 2020 2076 6d63 6c69 656e 7473 203d 2079     vmclients = y
+00013a80: 616d 6c2e 7361 6665 5f6c 6f61 6428 6f70  aml.safe_load(op
+00013a90: 656e 2876 6d63 6c69 656e 7473 5f66 696c  en(vmclients_fil
+00013aa0: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+00013ab0: 6f73 2e72 656d 6f76 6528 766d 636c 6965  os.remove(vmclie
+00013ac0: 6e74 735f 6669 6c65 290a 2020 2020 2020  nts_file).      
+00013ad0: 2020 6966 2073 656c 662e 6578 7472 6163    if self.extrac
+00013ae0: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
+00013af0: 2020 2020 6465 6c65 7465 636c 6965 6e74      deleteclient
+00013b00: 732e 7570 6461 7465 2873 656c 662e 6578  s.update(self.ex
+00013b10: 7472 6163 6c69 656e 7473 290a 2020 2020  traclients).    
+00013b20: 2020 2020 656c 6966 2076 6d63 6c69 656e      elif vmclien
+00013b30: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00013b40: 6465 6c65 7465 636c 6965 6e74 732e 7570  deleteclients.up
+00013b50: 6461 7465 287b 636c 693a 204b 636f 6e66  date({cli: Kconf
+00013b60: 6967 2863 6c69 656e 743d 636c 6929 2e6b  ig(client=cli).k
+00013b70: 2066 6f72 2063 6c69 2069 6e20 766d 636c   for cli in vmcl
+00013b80: 6965 6e74 7320 6966 2063 6c69 2021 3d20  ients if cli != 
+00013b90: 7365 6c66 2e63 6c69 656e 747d 290a 2020  self.client}).  
+00013ba0: 2020 2020 2020 656b 7320 3d20 4661 6c73        eks = Fals
+00013bb0: 650a 2020 2020 2020 2020 676b 6520 3d20  e.        gke = 
+00013bc0: 4661 6c73 650a 2020 2020 2020 2020 6879  False.        hy
+00013bd0: 7065 7273 6869 6674 203d 2046 616c 7365  pershift = False
+00013be0: 0a20 2020 2020 2020 2061 7373 6973 7465  .        assiste
+00013bf0: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
+00013c00: 2020 636c 7573 7465 7264 6972 203d 2022    clusterdir = "
+00013c10: 2f66 616b 652f 7878 7822 0a20 2020 2020  /fake/xxx".     
+00013c20: 2020 2066 6f72 2068 7970 6572 7669 736f     for hyperviso
+00013c30: 7220 696e 2064 656c 6574 6563 6c69 656e  r in deleteclien
+00013c40: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00013c50: 6320 3d20 6465 6c65 7465 636c 6965 6e74  c = deleteclient
+00013c60: 735b 6879 7065 7276 6973 6f72 5d0a 2020  s[hypervisor].  
+00013c70: 2020 2020 2020 2020 2020 666f 7220 766d            for vm
+00013c80: 2069 6e20 736f 7274 6564 2863 2e6c 6973   in sorted(c.lis
+00013c90: 7428 292c 206b 6579 3d6c 616d 6264 6120  t(), key=lambda 
+00013ca0: 783a 2078 5b27 6e61 6d65 275d 293a 0a20  x: x['name']):. 
+00013cb0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00013cc0: 616d 6520 3d20 766d 5b27 6e61 6d65 275d  ame = vm['name']
+00013cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013ce0: 2064 6573 6372 6970 7469 6f6e 203d 2076   description = v
+00013cf0: 6d2e 6765 7428 2770 6c61 6e27 290a 2020  m.get('plan').  
+00013d00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00013d10: 2064 6573 6372 6970 7469 6f6e 203d 3d20   description == 
+00013d20: 706c 616e 3a0a 2020 2020 2020 2020 2020  plan:.          
+00013d30: 2020 2020 2020 2020 2020 6966 2076 6d2e            if vm.
+00013d40: 6765 7428 276b 7562 6574 7970 6527 2c20  get('kubetype', 
+00013d50: 2767 656e 6572 6963 2729 2069 6e20 5b27  'generic') in ['
+00013d60: 656b 7327 2c20 2767 6b65 275d 3a0a 2020  eks', 'gke']:.  
+00013d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d80: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
 00013d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013da0: 2020 2020 2020 2020 2020 6966 206c 6220            if lb 
-00013db0: 6e6f 7420 696e 2064 656c 6574 6564 6c62  not in deletedlb
-00013dc0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00013dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013de0: 2020 2064 656c 6574 6564 6c62 732e 6170     deletedlbs.ap
-00013df0: 7065 6e64 286c 6229 0a20 2020 2020 2020  pend(lb).       
-00013e00: 2020 2020 2020 2020 2020 2020 2076 6d6e               vmn
-00013e10: 6574 776f 726b 7320 3d20 632e 766d 5f70  etworks = c.vm_p
-00013e20: 6f72 7473 286e 616d 6529 0a20 2020 2020  orts(name).     
-00013e30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00013e40: 6f72 206e 6574 776f 726b 2069 6e20 766d  or network in vm
-00013e50: 6e65 7477 6f72 6b73 3a0a 2020 2020 2020  networks:.      
+00013da0: 2020 2069 6620 276c 6f61 6462 616c 616e     if 'loadbalan
+00013db0: 6365 7227 2069 6e20 766d 3a0a 2020 2020  cer' in vm:.    
+00013dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013dd0: 2020 2020 6c62 7320 3d20 766d 5b27 6c6f      lbs = vm['lo
+00013de0: 6164 6261 6c61 6e63 6572 275d 2e73 706c  adbalancer'].spl
+00013df0: 6974 2827 2c27 290a 2020 2020 2020 2020  it(',').        
+00013e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e10: 666f 7220 6c62 2069 6e20 6c62 733a 0a20  for lb in lbs:. 
+00013e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e30: 2020 2020 2020 2020 2020 2069 6620 6c62             if lb
+00013e40: 206e 6f74 2069 6e20 6465 6c65 7465 646c   not in deletedl
+00013e50: 6273 3a0a 2020 2020 2020 2020 2020 2020  bs:.            
 00013e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e70: 2020 6966 206e 6574 776f 726b 2021 3d20    if network != 
-00013e80: 2764 6566 6175 6c74 2720 616e 6420 6e65  'default' and ne
-00013e90: 7477 6f72 6b20 6e6f 7420 696e 206e 6574  twork not in net
-00013ea0: 776f 726b 733a 0a20 2020 2020 2020 2020  works:.         
-00013eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ec0: 2020 206e 6574 776f 726b 732e 6170 7065     networks.appe
-00013ed0: 6e64 286e 6574 776f 726b 290a 2020 2020  nd(network).    
-00013ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ef0: 646e 7363 6c69 656e 742c 2064 6f6d 6169  dnsclient, domai
-00013f00: 6e20 3d20 632e 646e 7369 6e66 6f28 6e61  n = c.dnsinfo(na
-00013f10: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00013f20: 2020 2020 2020 2020 6966 2075 6e72 6567          if unreg
-00013f30: 6973 7465 723a 0a20 2020 2020 2020 2020  ister:.         
-00013f40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013f50: 6d61 6765 203d 206b 2e69 6e66 6f28 6e61  mage = k.info(na
-00013f60: 6d65 292e 6765 7428 2769 6d61 6765 2729  me).get('image')
-00013f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013f80: 2020 2020 2020 2020 2069 6620 2772 6865           if 'rhe
-00013f90: 6c27 2069 6e20 696d 6167 653a 0a20 2020  l' in image:.   
-00013fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fb0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00013fc0: 6622 5265 6d6f 7669 6e67 2072 6865 6c20  f"Removing rhel 
-00013fd0: 7375 6273 6372 6970 7469 6f6e 2066 6f72  subscription for
-00013fe0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
-00013ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014000: 2020 2020 2020 6970 2c20 766d 706f 7274        ip, vmport
-00014010: 203d 205f 7373 685f 6372 6564 656e 7469   = _ssh_credenti
-00014020: 616c 7328 6b2c 206e 616d 6529 5b31 3a5d  als(k, name)[1:]
-00014030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014040: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
-00014050: 203d 2022 7375 6273 6372 6970 7469 6f6e   = "subscription
-00014060: 2d6d 616e 6167 6572 2075 6e72 6567 6973  -manager unregis
-00014070: 7465 7222 0a20 2020 2020 2020 2020 2020  ter".           
+00013e70: 2020 2020 6465 6c65 7465 646c 6273 2e61      deletedlbs.a
+00013e80: 7070 656e 6428 6c62 290a 2020 2020 2020  ppend(lb).      
+00013e90: 2020 2020 2020 2020 2020 2020 2020 766d                vm
+00013ea0: 6e65 7477 6f72 6b73 203d 2063 2e76 6d5f  networks = c.vm_
+00013eb0: 706f 7274 7328 6e61 6d65 290a 2020 2020  ports(name).    
+00013ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ed0: 666f 7220 6e65 7477 6f72 6b20 696e 2076  for network in v
+00013ee0: 6d6e 6574 776f 726b 733a 0a20 2020 2020  mnetworks:.     
+00013ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f00: 2020 2069 6620 6e65 7477 6f72 6b20 213d     if network !=
+00013f10: 2027 6465 6661 756c 7427 2061 6e64 206e   'default' and n
+00013f20: 6574 776f 726b 206e 6f74 2069 6e20 6e65  etwork not in ne
+00013f30: 7477 6f72 6b73 3a0a 2020 2020 2020 2020  tworks:.        
+00013f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f50: 2020 2020 6e65 7477 6f72 6b73 2e61 7070      networks.app
+00013f60: 656e 6428 6e65 7477 6f72 6b29 0a20 2020  end(network).   
+00013f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f80: 2064 6e73 636c 6965 6e74 2c20 646f 6d61   dnsclient, doma
+00013f90: 696e 203d 2063 2e64 6e73 696e 666f 286e  in = c.dnsinfo(n
+00013fa0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00013fb0: 2020 2020 2020 2020 2069 6620 756e 7265           if unre
+00013fc0: 6769 7374 6572 3a0a 2020 2020 2020 2020  gister:.        
+00013fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fe0: 696d 6167 6520 3d20 6b2e 696e 666f 286e  image = k.info(n
+00013ff0: 616d 6529 2e67 6574 2827 696d 6167 6527  ame).get('image'
+00014000: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014010: 2020 2020 2020 2020 2020 6966 2027 7268            if 'rh
+00014020: 656c 2720 696e 2069 6d61 6765 3a0a 2020  el' in image:.  
+00014030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014040: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00014050: 2866 2252 656d 6f76 696e 6720 7268 656c  (f"Removing rhel
+00014060: 2073 7562 7363 7269 7074 696f 6e20 666f   subscription fo
+00014070: 7220 7b6e 616d 657d 2229 0a20 2020 2020  r {name}").     
 00014080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014090: 2073 7368 636d 6420 3d20 7373 6828 6e61   sshcmd = ssh(na
-000140a0: 6d65 2c20 6970 3d69 702c 2075 7365 723d  me, ip=ip, user=
-000140b0: 2772 6f6f 7427 2c20 7475 6e6e 656c 3d73  'root', tunnel=s
-000140c0: 656c 662e 7475 6e6e 656c 2c0a 2020 2020  elf.tunnel,.    
-000140d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000140e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000140f0: 2020 2020 2074 756e 6e65 6c68 6f73 743d       tunnelhost=
-00014100: 7365 6c66 2e74 756e 6e65 6c68 6f73 742c  self.tunnelhost,
-00014110: 2074 756e 6e65 6c70 6f72 743d 7365 6c66   tunnelport=self
-00014120: 2e74 756e 6e65 6c70 6f72 742c 0a20 2020  .tunnelport,.   
-00014130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014150: 2020 2020 2020 7475 6e6e 656c 7573 6572        tunneluser
-00014160: 3d73 656c 662e 7475 6e6e 656c 7573 6572  =self.tunneluser
-00014170: 2c20 696e 7365 6375 7265 3d54 7275 652c  , insecure=True,
-00014180: 2063 6d64 3d63 6d64 2c20 766d 706f 7274   cmd=cmd, vmport
-00014190: 3d76 6d70 6f72 7429 0a20 2020 2020 2020  =vmport).       
-000141a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141b0: 2020 2020 206f 732e 7379 7374 656d 2873       os.system(s
-000141c0: 7368 636d 6429 0a20 2020 2020 2020 2020  shcmd).         
-000141d0: 2020 2020 2020 2020 2020 2063 2e64 656c             c.del
-000141e0: 6574 6528 6e61 6d65 2c20 736e 6170 7368  ete(name, snapsh
-000141f0: 6f74 733d 5472 7565 290a 2020 2020 2020  ots=True).      
-00014200: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00014210: 2064 6e73 636c 6965 6e74 2069 7320 6e6f   dnsclient is no
-00014220: 7420 4e6f 6e65 2061 6e64 2064 6f6d 6169  t None and domai
-00014230: 6e20 6973 206e 6f74 204e 6f6e 6520 616e  n is not None an
-00014240: 6420 646e 7363 6c69 656e 7420 696e 2073  d dnsclient in s
-00014250: 656c 662e 636c 6965 6e74 733a 0a20 2020  elf.clients:.   
-00014260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014270: 2020 2020 2069 6620 646e 7363 6c69 656e       if dnsclien
-00014280: 7420 696e 2064 6e73 636c 6965 6e74 733a  t in dnsclients:
-00014290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000142a0: 2020 2020 2020 2020 2020 2020 207a 203d               z =
-000142b0: 2064 6e73 636c 6965 6e74 735b 646e 7363   dnsclients[dnsc
-000142c0: 6c69 656e 745d 0a20 2020 2020 2020 2020  lient].         
-000142d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000142e0: 6c69 6620 646e 7363 6c69 656e 7420 696e  lif dnsclient in
-000142f0: 2073 656c 662e 636c 6965 6e74 733a 0a20   self.clients:. 
-00014300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014310: 2020 2020 2020 2020 2020 207a 203d 204b             z = K
-00014320: 636f 6e66 6967 2863 6c69 656e 743d 646e  config(client=dn
-00014330: 7363 6c69 656e 7429 2e6b 0a20 2020 2020  sclient).k.     
-00014340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014350: 2020 2020 2020 2064 6e73 636c 6965 6e74         dnsclient
-00014360: 735b 646e 7363 6c69 656e 745d 203d 207a  s[dnsclient] = z
-00014370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014380: 2020 2020 2020 2020 207a 2e64 656c 6574           z.delet
-00014390: 655f 646e 7328 646e 7363 6c69 656e 742c  e_dns(dnsclient,
-000143a0: 2064 6f6d 6169 6e29 0a20 2020 2020 2020   domain).       
-000143b0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-000143c0: 6d6f 6e2e 6465 6c65 7465 5f6c 6173 7476  mon.delete_lastv
-000143d0: 6d28 6e61 6d65 2c20 7365 6c66 2e63 6c69  m(name, self.cli
-000143e0: 656e 7429 0a20 2020 2020 2020 2020 2020  ent).           
-000143f0: 2020 2020 2020 2020 2073 7563 6365 7373           success
-00014400: 2866 227b 6e61 6d65 7d20 6465 6c65 7465  (f"{name} delete
-00014410: 6420 6f6e 207b 6879 7065 7276 6973 6f72  d on {hypervisor
-00014420: 7d21 2229 0a20 2020 2020 2020 2020 2020  }!").           
-00014430: 2020 2020 2020 2020 2064 656c 6574 6564           deleted
-00014440: 766d 732e 6170 7065 6e64 286e 616d 6529  vms.append(name)
-00014450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014460: 2020 2020 2066 6f75 6e64 203d 2054 7275       found = Tru
-00014470: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00014480: 2020 2020 2020 636c 7573 7465 7220 3d20        cluster = 
-00014490: 766d 2e67 6574 2827 6b75 6265 2729 0a20  vm.get('kube'). 
-000144a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144b0: 2020 2069 6620 636c 7573 7465 7220 6973     if cluster is
-000144c0: 206e 6f74 204e 6f6e 6520 616e 6420 636c   not None and cl
-000144d0: 7573 7465 7220 213d 2027 273a 0a20 2020  uster != '':.   
-000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144f0: 2020 2020 2063 6c75 7374 6572 6469 7220       clusterdir 
-00014500: 3d20 6f73 2e70 6174 682e 6578 7061 6e64  = os.path.expand
-00014510: 7573 6572 2866 227e 2f2e 6b63 6c69 2f63  user(f"~/.kcli/c
-00014520: 6c75 7374 6572 732f 7b63 6c75 7374 6572  lusters/{cluster
-00014530: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00014540: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00014550: 732e 7061 7468 2e65 7869 7374 7328 636c  s.path.exists(cl
-00014560: 7573 7465 7264 6972 293a 0a20 2020 2020  usterdir):.     
+00014090: 2020 2020 2020 2069 702c 2076 6d70 6f72         ip, vmpor
+000140a0: 7420 3d20 5f73 7368 5f63 7265 6465 6e74  t = _ssh_credent
+000140b0: 6961 6c73 286b 2c20 6e61 6d65 295b 313a  ials(k, name)[1:
+000140c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000140d0: 2020 2020 2020 2020 2020 2020 2020 636d                cm
+000140e0: 6420 3d20 2273 7562 7363 7269 7074 696f  d = "subscriptio
+000140f0: 6e2d 6d61 6e61 6765 7220 756e 7265 6769  n-manager unregi
+00014100: 7374 6572 220a 2020 2020 2020 2020 2020  ster".          
+00014110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014120: 2020 7373 6863 6d64 203d 2073 7368 286e    sshcmd = ssh(n
+00014130: 616d 652c 2069 703d 6970 2c20 7573 6572  ame, ip=ip, user
+00014140: 3d27 726f 6f74 272c 2074 756e 6e65 6c3d  ='root', tunnel=
+00014150: 7365 6c66 2e74 756e 6e65 6c2c 0a20 2020  self.tunnel,.   
+00014160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014180: 2020 2020 2020 7475 6e6e 656c 686f 7374        tunnelhost
+00014190: 3d73 656c 662e 7475 6e6e 656c 686f 7374  =self.tunnelhost
+000141a0: 2c20 7475 6e6e 656c 706f 7274 3d73 656c  , tunnelport=sel
+000141b0: 662e 7475 6e6e 656c 706f 7274 2c0a 2020  f.tunnelport,.  
+000141c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141e0: 2020 2020 2020 2074 756e 6e65 6c75 7365         tunneluse
+000141f0: 723d 7365 6c66 2e74 756e 6e65 6c75 7365  r=self.tunneluse
+00014200: 722c 2069 6e73 6563 7572 653d 5472 7565  r, insecure=True
+00014210: 2c20 636d 643d 636d 642c 2076 6d70 6f72  , cmd=cmd, vmpor
+00014220: 743d 766d 706f 7274 290a 2020 2020 2020  t=vmport).      
+00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014240: 2020 2020 2020 6f73 2e73 7973 7465 6d28        os.system(
+00014250: 7373 6863 6d64 290a 2020 2020 2020 2020  sshcmd).        
+00014260: 2020 2020 2020 2020 2020 2020 632e 6465              c.de
+00014270: 6c65 7465 286e 616d 652c 2073 6e61 7073  lete(name, snaps
+00014280: 686f 7473 3d54 7275 6529 0a20 2020 2020  hots=True).     
+00014290: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000142a0: 6620 646e 7363 6c69 656e 7420 6973 206e  f dnsclient is n
+000142b0: 6f74 204e 6f6e 6520 616e 6420 646f 6d61  ot None and doma
+000142c0: 696e 2069 7320 6e6f 7420 4e6f 6e65 2061  in is not None a
+000142d0: 6e64 2064 6e73 636c 6965 6e74 2069 6e20  nd dnsclient in 
+000142e0: 7365 6c66 2e63 6c69 656e 7473 3a0a 2020  self.clients:.  
+000142f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014300: 2020 2020 2020 6966 2064 6e73 636c 6965        if dnsclie
+00014310: 6e74 2069 6e20 646e 7363 6c69 656e 7473  nt in dnsclients
+00014320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014330: 2020 2020 2020 2020 2020 2020 2020 7a20                z 
+00014340: 3d20 646e 7363 6c69 656e 7473 5b64 6e73  = dnsclients[dns
+00014350: 636c 6965 6e74 5d0a 2020 2020 2020 2020  client].        
+00014360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014370: 656c 6966 2064 6e73 636c 6965 6e74 2069  elif dnsclient i
+00014380: 6e20 7365 6c66 2e63 6c69 656e 7473 3a0a  n self.clients:.
+00014390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143a0: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
+000143b0: 4b63 6f6e 6669 6728 636c 6965 6e74 3d64  Kconfig(client=d
+000143c0: 6e73 636c 6965 6e74 292e 6b0a 2020 2020  nsclient).k.    
+000143d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143e0: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
+000143f0: 7473 5b64 6e73 636c 6965 6e74 5d20 3d20  ts[dnsclient] = 
+00014400: 7a0a 2020 2020 2020 2020 2020 2020 2020  z.              
+00014410: 2020 2020 2020 2020 2020 7a2e 6465 6c65            z.dele
+00014420: 7465 5f64 6e73 2864 6e73 636c 6965 6e74  te_dns(dnsclient
+00014430: 2c20 646f 6d61 696e 290a 2020 2020 2020  , domain).      
+00014440: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00014450: 6d6d 6f6e 2e64 656c 6574 655f 6c61 7374  mmon.delete_last
+00014460: 766d 286e 616d 652c 2073 656c 662e 636c  vm(name, self.cl
+00014470: 6965 6e74 290a 2020 2020 2020 2020 2020  ient).          
+00014480: 2020 2020 2020 2020 2020 7375 6363 6573            succes
+00014490: 7328 6622 7b6e 616d 657d 2064 656c 6574  s(f"{name} delet
+000144a0: 6564 206f 6e20 7b68 7970 6572 7669 736f  ed on {hyperviso
+000144b0: 727d 2122 290a 2020 2020 2020 2020 2020  r}!").          
+000144c0: 2020 2020 2020 2020 2020 6465 6c65 7465            delete
+000144d0: 6476 6d73 2e61 7070 656e 6428 6e61 6d65  dvms.append(name
+000144e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000144f0: 2020 2020 2020 666f 756e 6420 3d20 5472        found = Tr
+00014500: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00014510: 2020 2020 2020 2063 6c75 7374 6572 203d         cluster =
+00014520: 2076 6d2e 6765 7428 276b 7562 6527 290a   vm.get('kube').
+00014530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014540: 2020 2020 6966 2063 6c75 7374 6572 2069      if cluster i
+00014550: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2063  s not None and c
+00014560: 6c75 7374 6572 2021 3d20 2727 3a0a 2020  luster != '':.  
 00014570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014580: 2020 2020 2020 2070 6172 616d 6574 6572         parameter
-00014590: 7366 696c 6520 3d20 6622 7b63 6c75 7374  sfile = f"{clust
-000145a0: 6572 6469 727d 2f6b 636c 695f 7061 7261  erdir}/kcli_para
-000145b0: 6d65 7465 7273 2e79 6d6c 220a 2020 2020  meters.yml".    
-000145c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145d0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-000145e0: 7468 2e65 7869 7374 7328 7061 7261 6d65  th.exists(parame
-000145f0: 7465 7273 6669 6c65 293a 0a20 2020 2020  tersfile):.     
+00014580: 2020 2020 2020 636c 7573 7465 7264 6972        clusterdir
+00014590: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
+000145a0: 6475 7365 7228 6622 7e2f 2e6b 636c 692f  duser(f"~/.kcli/
+000145b0: 636c 7573 7465 7273 2f7b 636c 7573 7465  clusters/{cluste
+000145c0: 727d 2229 0a20 2020 2020 2020 2020 2020  r}").           
+000145d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000145e0: 6f73 2e70 6174 682e 6578 6973 7473 2863  os.path.exists(c
+000145f0: 6c75 7374 6572 6469 7229 3a0a 2020 2020  lusterdir):.    
 00014600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014610: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00014620: 6f70 656e 2870 6172 616d 6574 6572 7366  open(parametersf
-00014630: 696c 6529 2061 7320 663a 0a20 2020 2020  ile) as f:.     
-00014640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014650: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00014660: 6c75 7374 6572 6461 7461 203d 2079 616d  lusterdata = yam
-00014670: 6c2e 7361 6665 5f6c 6f61 6428 6629 0a20  l.safe_load(f). 
-00014680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014610: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
+00014620: 7273 6669 6c65 203d 2066 227b 636c 7573  rsfile = f"{clus
+00014630: 7465 7264 6972 7d2f 6b63 6c69 5f70 6172  terdir}/kcli_par
+00014640: 616d 6574 6572 732e 796d 6c22 0a20 2020  ameters.yml".   
+00014650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014660: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+00014670: 6174 682e 6578 6973 7473 2870 6172 616d  ath.exists(param
+00014680: 6574 6572 7366 696c 6529 3a0a 2020 2020  etersfile):.    
 00014690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146a0: 2020 206b 7562 6574 7970 6520 3d20 636c     kubetype = cl
-000146b0: 7573 7465 7264 6174 612e 6765 7428 276b  usterdata.get('k
-000146c0: 7562 6574 7970 6527 2c20 2767 656e 6572  ubetype', 'gener
-000146d0: 6963 2729 0a20 2020 2020 2020 2020 2020  ic').           
+000146a0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+000146b0: 206f 7065 6e28 7061 7261 6d65 7465 7273   open(parameters
+000146c0: 6669 6c65 2920 6173 2066 3a0a 2020 2020  file) as f:.    
+000146d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000146e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146f0: 2020 2020 2020 2020 2069 6620 6b75 6265           if kube
-00014700: 7479 7065 203d 3d20 2768 7970 6572 7368  type == 'hypersh
-00014710: 6966 7427 3a0a 2020 2020 2020 2020 2020  ift':.          
+000146f0: 636c 7573 7465 7264 6174 6120 3d20 7961  clusterdata = ya
+00014700: 6d6c 2e73 6166 655f 6c6f 6164 2866 290a  ml.safe_load(f).
+00014710: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00014720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014730: 2020 2020 2020 2020 2020 2020 2020 6879                hy
-00014740: 7065 7273 6869 6674 203d 2054 7275 650a  pershift = True.
-00014750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014770: 2020 2020 2020 2020 6173 7369 7374 6564          assisted
-00014780: 203d 2063 6c75 7374 6572 6461 7461 2e67   = clusterdata.g
-00014790: 6574 2861 7373 6973 7465 642c 2046 616c  et(assisted, Fal
-000147a0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+00014730: 2020 2020 6b75 6265 7479 7065 203d 2063      kubetype = c
+00014740: 6c75 7374 6572 6461 7461 2e67 6574 2827  lusterdata.get('
+00014750: 6b75 6265 7479 7065 272c 2027 6765 6e65  kubetype', 'gene
+00014760: 7269 6327 290a 2020 2020 2020 2020 2020  ric').          
+00014770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014780: 2020 2020 2020 2020 2020 6966 206b 7562            if kub
+00014790: 6574 7970 6520 3d3d 2027 6879 7065 7273  etype == 'hypers
+000147a0: 6869 6674 273a 0a20 2020 2020 2020 2020  hift':.         
 000147b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147c0: 2020 2020 2020 2020 646f 6d61 696e 203d          domain =
-000147d0: 2063 6c75 7374 6572 6461 7461 2e67 6574   clusterdata.get
-000147e0: 2827 646f 6d61 696e 272c 2064 6f6d 6169  ('domain', domai
-000147f0: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
-00014800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014810: 2020 2020 2020 2064 6e73 636c 6965 6e74         dnsclient
-00014820: 203d 2063 6c75 7374 6572 6461 7461 2e67   = clusterdata.g
-00014830: 6574 2827 646e 7363 6c69 656e 7427 290a  et('dnsclient').
+000147c0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+000147d0: 7970 6572 7368 6966 7420 3d20 5472 7565  ypershift = True
+000147e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000147f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014800: 2020 2020 2020 2020 2061 7373 6973 7465           assiste
+00014810: 6420 3d20 636c 7573 7465 7264 6174 612e  d = clusterdata.
+00014820: 6765 7428 6173 7369 7374 6564 2c20 4661  get(assisted, Fa
+00014830: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
 00014840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014860: 2020 2020 676b 6520 3d20 6b75 6265 7479      gke = kubety
-00014870: 7065 203d 3d20 2767 6b65 270a 2020 2020  pe == 'gke'.    
-00014880: 2020 2020 6966 2068 7970 6572 7368 6966      if hypershif
-00014890: 743a 0a20 2020 2020 2020 2020 2020 206b  t:.            k
-000148a0: 7562 6563 6f6e 6669 676d 676d 7420 3d20  ubeconfigmgmt = 
-000148b0: 6622 7b63 6c75 7374 6572 6469 727d 2f6b  f"{clusterdir}/k
-000148c0: 7562 6563 6f6e 6669 672e 6d67 6d74 220a  ubeconfig.mgmt".
-000148d0: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-000148e0: 2866 274b 5542 4543 4f4e 4649 473d 7b6b  (f'KUBECONFIG={k
-000148f0: 7562 6563 6f6e 6669 676d 676d 747d 206f  ubeconfigmgmt} o
-00014900: 6320 6465 6c65 7465 202d 6620 7b63 6c75  c delete -f {clu
-00014910: 7374 6572 6469 727d 2f61 7574 6f61 7070  sterdir}/autoapp
-00014920: 726f 7665 7263 726f 6e2e 796d 6c27 2c20  rovercron.yml', 
-00014930: 7368 656c 6c3d 5472 7565 290a 2020 2020  shell=True).    
-00014940: 2020 2020 2020 2020 6361 6c6c 2866 274b          call(f'K
-00014950: 5542 4543 4f4e 4649 473d 7b6b 7562 6563  UBECONFIG={kubec
-00014960: 6f6e 6669 676d 676d 747d 206f 6320 6465  onfigmgmt} oc de
-00014970: 6c65 7465 202d 6620 7b63 6c75 7374 6572  lete -f {cluster
-00014980: 6469 727d 2f6e 6f64 6570 6f6f 6c2e 7961  dir}/nodepool.ya
-00014990: 6d6c 272c 2073 6865 6c6c 3d54 7275 6529  ml', shell=True)
-000149a0: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
-000149b0: 6c28 6627 4b55 4245 434f 4e46 4947 3d7b  l(f'KUBECONFIG={
-000149c0: 6b75 6265 636f 6e66 6967 6d67 6d74 7d20  kubeconfigmgmt} 
-000149d0: 6f63 2064 656c 6574 6520 2d66 207b 636c  oc delete -f {cl
-000149e0: 7573 7465 7264 6972 7d2f 686f 7374 6564  usterdir}/hosted
-000149f0: 636c 7573 7465 722e 7961 6d6c 272c 2073  cluster.yaml', s
-00014a00: 6865 6c6c 3d54 7275 6529 0a20 2020 2020  hell=True).     
-00014a10: 2020 2020 2020 2069 6620 6e6f 7420 6173         if not as
-00014a20: 7369 7374 6564 2061 6e64 2028 2762 6172  sisted and ('bar
-00014a30: 656d 6574 616c 5f69 736f 2720 696e 2063  emetal_iso' in c
-00014a40: 6c75 7374 6572 6461 7461 206f 7220 2762  lusterdata or 'b
-00014a50: 6172 656d 6574 616c 5f68 6f73 7473 2720  aremetal_hosts' 
-00014a60: 696e 2063 6c75 7374 6572 6461 7461 293a  in clusterdata):
-00014a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014a80: 2063 616c 6c28 274b 5542 4543 4f4e 4649   call('KUBECONFI
-00014a90: 473d 7b6b 7562 6563 6f6e 6669 676d 676d  G={kubeconfigmgm
-00014aa0: 747d 206f 6320 2d6e 2064 6566 6175 6c74  t} oc -n default
-00014ab0: 2064 656c 6574 6520 616c 6c20 2d6c 2061   delete all -l a
-00014ac0: 7070 3d68 7474 7064 2d6b 636c 6927 2c20  pp=httpd-kcli', 
-00014ad0: 7368 656c 6c3d 5472 7565 290a 2020 2020  shell=True).    
-00014ae0: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-00014af0: 2827 4b55 4245 434f 4e46 4947 3d7b 6b75  ('KUBECONFIG={ku
-00014b00: 6265 636f 6e66 6967 6d67 6d74 7d20 6f63  beconfigmgmt} oc
-00014b10: 202d 6e20 6465 6661 756c 7420 6465 6c65   -n default dele
-00014b20: 7465 2073 7663 2068 7474 7064 2d6b 636c  te svc httpd-kcl
-00014b30: 692d 7376 6327 2c20 7368 656c 6c3d 5472  i-svc', shell=Tr
-00014b40: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00014b50: 2020 2020 6361 6c6c 2827 4b55 4245 434f      call('KUBECO
-00014b60: 4e46 4947 3d7b 6b75 6265 636f 6e66 6967  NFIG={kubeconfig
-00014b70: 6d67 6d74 7d20 6f63 202d 6e20 6465 6661  mgmt} oc -n defa
-00014b80: 756c 7420 6465 6c65 7465 2070 7663 2068  ult delete pvc h
-00014b90: 7474 7064 2d6b 636c 692d 7076 6327 2c20  ttpd-kcli-pvc', 
-00014ba0: 7368 656c 6c3d 5472 7565 290a 2020 2020  shell=True).    
-00014bb0: 2020 2020 6966 2067 6b65 3a0a 2020 2020      if gke:.    
-00014bc0: 2020 2020 2020 2020 6763 7063 6c69 656e          gcpclien
-00014bd0: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
-00014be0: 2020 2020 2069 6620 2763 6c69 656e 7427       if 'client'
-00014bf0: 2069 6e20 636c 7573 7465 7264 6174 613a   in clusterdata:
-00014c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014c10: 2067 6370 636c 6965 6e74 203d 2063 6c75   gcpclient = clu
-00014c20: 7374 6572 6461 7461 5b27 636c 6965 6e74  sterdata['client
-00014c30: 275d 0a20 2020 2020 2020 2020 2020 2065  '].            e
-00014c40: 6c69 6620 7365 6c66 2e74 7970 6520 3d3d  lif self.type ==
-00014c50: 2027 676b 6527 3a0a 2020 2020 2020 2020   'gke':.        
-00014c60: 2020 2020 2020 2020 6763 7063 6c69 656e          gcpclien
-00014c70: 7420 3d20 7365 6c66 2e63 6c69 656e 740a  t = self.client.
-00014c80: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00014c90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014ca0: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
-00014cb0: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
-00014cc0: 7265 6173 6f6e 273a 2022 4465 6c65 7469  reason': "Deleti
-00014cd0: 6e67 2067 6b65 2063 6c75 7374 6572 2072  ng gke cluster r
-00014ce0: 6571 7569 7265 7320 746f 2069 6e73 7461  equires to insta
-00014cf0: 6e74 6961 7465 2067 6370 2070 726f 7669  ntiate gcp provi
-00014d00: 6465 7222 7d0a 2020 2020 2020 2020 2020  der"}.          
-00014d10: 2020 6672 6f6d 206b 7669 7274 2e63 6c75    from kvirt.clu
-00014d20: 7374 6572 2069 6d70 6f72 7420 676b 650a  ster import gke.
-00014d30: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00014d40: 656e 7463 6f6e 6669 6720 3d20 4b63 6f6e  entconfig = Kcon
-00014d50: 6669 6728 636c 6965 6e74 3d67 6370 636c  fig(client=gcpcl
-00014d60: 6965 6e74 292e 6b20 6966 2067 6370 636c  ient).k if gcpcl
-00014d70: 6965 6e74 2021 3d20 7365 6c66 2e63 6c69  ient != self.cli
-00014d80: 656e 7420 656c 7365 2073 656c 660a 2020  ent else self.  
-00014d90: 2020 2020 2020 2020 2020 7a6f 6e61 6c20            zonal 
-00014da0: 3d20 636c 7573 7465 7264 6174 612e 6765  = clusterdata.ge
-00014db0: 7428 277a 6f6e 616c 272c 2054 7275 6529  t('zonal', True)
-00014dc0: 0a20 2020 2020 2020 2020 2020 2067 6b65  .            gke
-00014dd0: 2e64 656c 6574 6528 6375 7272 656e 7463  .delete(currentc
-00014de0: 6f6e 6669 672c 2063 6c75 7374 6572 2c20  onfig, cluster, 
-00014df0: 7a6f 6e61 6c29 0a20 2020 2020 2020 2069  zonal).        i
-00014e00: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-00014e10: 2863 6c75 7374 6572 6469 7229 3a0a 2020  (clusterdir):.  
-00014e20: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00014e30: 2866 2244 656c 6574 696e 6720 6469 7265  (f"Deleting dire
-00014e40: 6374 6f72 7920 7b63 6c75 7374 6572 6469  ctory {clusterdi
-00014e50: 727d 2229 0a20 2020 2020 2020 2020 2020  r}").           
-00014e60: 2072 6d74 7265 6528 636c 7573 7465 7264   rmtree(clusterd
-00014e70: 6972 2c20 6967 6e6f 7265 5f65 7272 6f72  ir, ignore_error
-00014e80: 733d 5472 7565 290a 2020 2020 2020 2020  s=True).        
-00014e90: 6966 2063 6f6e 7461 696e 6572 3a0a 2020  if container:.  
-00014ea0: 2020 2020 2020 2020 2020 636f 6e74 203d            cont =
-00014eb0: 204b 636f 6e74 6169 6e65 7263 6f6e 6669   Kcontainerconfi
-00014ec0: 6728 7365 6c66 2c20 636c 6965 6e74 3d73  g(self, client=s
-00014ed0: 656c 662e 636f 6e74 6169 6e65 7263 6c69  elf.containercli
-00014ee0: 656e 7429 2e63 6f6e 740a 2020 2020 2020  ent).cont.      
-00014ef0: 2020 2020 2020 666f 7220 636f 6e74 6120        for conta 
-00014f00: 696e 2073 6f72 7465 6428 636f 6e74 2e6c  in sorted(cont.l
-00014f10: 6973 745f 636f 6e74 6169 6e65 7273 286b  ist_containers(k
-00014f20: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00014f30: 2020 2020 6e61 6d65 203d 2063 6f6e 7461      name = conta
-00014f40: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00014f50: 2020 2020 636f 6e74 6169 6e65 725f 706c      container_pl
-00014f60: 616e 203d 2063 6f6e 7461 5b33 5d0a 2020  an = conta[3].  
-00014f70: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00014f80: 2063 6f6e 7461 696e 6572 5f70 6c61 6e20   container_plan 
-00014f90: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
-00014fa0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00014fb0: 742e 6465 6c65 7465 5f63 6f6e 7461 696e  t.delete_contain
-00014fc0: 6572 286e 616d 6529 0a20 2020 2020 2020  er(name).       
-00014fd0: 2020 2020 2020 2020 2020 2020 2073 7563               suc
-00014fe0: 6365 7373 2866 2243 6f6e 7461 696e 6572  cess(f"Container
-00014ff0: 207b 6e61 6d65 7d20 6465 6c65 7465 6421   {name} deleted!
-00015000: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00015010: 2020 2020 2020 2066 6f75 6e64 203d 2054         found = T
-00015020: 7275 650a 2020 2020 2020 2020 6966 206e  rue.        if n
-00015030: 6f74 2073 656c 662e 6b65 6570 5f6e 6574  ot self.keep_net
-00015040: 776f 726b 733a 0a20 2020 2020 2020 2020  works:.         
-00015050: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
-00015060: 3d3d 2027 6b76 6d27 3a0a 2020 2020 2020  == 'kvm':.      
-00015070: 2020 2020 2020 2020 2020 6e65 7477 6f72            networ
-00015080: 6b73 203d 206b 2e6c 6973 745f 6e65 7477  ks = k.list_netw
-00015090: 6f72 6b73 2829 0a20 2020 2020 2020 2020  orks().         
-000150a0: 2020 2020 2020 2066 6f72 206e 6574 776f         for netwo
-000150b0: 726b 2069 6e20 6b2e 6c69 7374 5f6e 6574  rk in k.list_net
-000150c0: 776f 726b 7328 293a 0a20 2020 2020 2020  works():.       
-000150d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000150e0: 2770 6c61 6e27 2069 6e20 6e65 7477 6f72  'plan' in networ
-000150f0: 6b73 5b6e 6574 776f 726b 5d20 616e 6420  ks[network] and 
-00015100: 6e65 7477 6f72 6b73 5b6e 6574 776f 726b  networks[network
-00015110: 5d5b 2770 6c61 6e27 5d20 3d3d 2070 6c61  ]['plan'] == pla
-00015120: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-00015130: 2020 2020 2020 2020 2020 206e 6574 776f             netwo
-00015140: 726b 7265 7375 6c74 203d 206b 2e64 656c  rkresult = k.del
-00015150: 6574 655f 6e65 7477 6f72 6b28 6e65 7477  ete_network(netw
-00015160: 6f72 6b29 0a20 2020 2020 2020 2020 2020  ork).           
-00015170: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00015180: 6e65 7477 6f72 6b72 6573 756c 745b 2772  networkresult['r
-00015190: 6573 756c 7427 5d20 3d3d 2027 7375 6363  esult'] == 'succ
-000151a0: 6573 7327 3a0a 2020 2020 2020 2020 2020  ess':.          
-000151b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151c0: 2020 7375 6363 6573 7328 6622 6e65 7477    success(f"netw
-000151d0: 6f72 6b20 7b6e 6574 776f 726b 7d20 6465  ork {network} de
-000151e0: 6c65 7465 6421 2229 0a20 2020 2020 2020  leted!").       
-000151f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015200: 2020 2020 2066 6f75 6e64 203d 2054 7275       found = Tru
-00015210: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-00015220: 6966 206e 6574 776f 726b 733a 0a20 2020  if networks:.   
-00015230: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
-00015240: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
-00015250: 2020 2020 2020 2020 2020 666f 7220 6e65            for ne
-00015260: 7477 6f72 6b20 696e 206e 6574 776f 726b  twork in network
-00015270: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00015280: 2020 2020 2020 206e 6574 776f 726b 7265         networkre
-00015290: 7375 6c74 203d 206b 2e64 656c 6574 655f  sult = k.delete_
-000152a0: 6e65 7477 6f72 6b28 6e65 7477 6f72 6b29  network(network)
-000152b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000152c0: 2020 2020 2069 6620 6e65 7477 6f72 6b72       if networkr
-000152d0: 6573 756c 745b 2772 6573 756c 7427 5d20  esult['result'] 
-000152e0: 3d3d 2027 7375 6363 6573 7327 3a0a 2020  == 'success':.  
-000152f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015300: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
-00015310: 556e 7573 6564 206e 6574 776f 726b 207b  Unused network {
-00015320: 6e65 7477 6f72 6b7d 2064 656c 6574 6564  network} deleted
-00015330: 2122 290a 2020 2020 2020 2020 666f 7220  !").        for 
-00015340: 6b65 7966 696c 6520 696e 2067 6c6f 622e  keyfile in glob.
-00015350: 676c 6f62 2822 2573 2e6b 6579 2a22 2025  glob("%s.key*" %
-00015360: 2070 6c61 6e29 3a0a 2020 2020 2020 2020   plan):.        
-00015370: 2020 2020 7375 6363 6573 7328 6622 6669      success(f"fi
-00015380: 6c65 207b 6b65 7966 696c 657d 2066 726f  le {keyfile} fro
-00015390: 6d20 7b70 6c61 6e7d 2064 656c 6574 6564  m {plan} deleted
-000153a0: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
-000153b0: 6f73 2e72 656d 6f76 6528 6b65 7966 696c  os.remove(keyfil
-000153c0: 6529 0a20 2020 2020 2020 2066 6f72 2061  e).        for a
-000153d0: 6e73 6962 6c65 6669 6c65 2069 6e20 676c  nsiblefile in gl
-000153e0: 6f62 2e67 6c6f 6228 222f 746d 702f 2573  ob.glob("/tmp/%s
-000153f0: 2a69 6e76 2a22 2025 2070 6c61 6e29 3a0a  *inv*" % plan):.
-00015400: 2020 2020 2020 2020 2020 2020 7375 6363              succ
-00015410: 6573 7328 6622 6669 6c65 207b 616e 7369  ess(f"file {ansi
-00015420: 626c 6566 696c 657d 2066 726f 6d20 7b70  blefile} from {p
-00015430: 6c61 6e7d 2064 656c 6574 6564 2122 290a  lan} deleted!").
-00015440: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
-00015450: 656d 6f76 6528 616e 7369 626c 6566 696c  emove(ansiblefil
-00015460: 6529 0a20 2020 2020 2020 2069 6620 6465  e).        if de
-00015470: 6c65 7465 646c 6273 2061 6e64 2073 656c  letedlbs and sel
-00015480: 662e 7479 7065 2069 6e20 5b27 6177 7327  f.type in ['aws'
-00015490: 2c20 2767 6370 275d 3a0a 2020 2020 2020  , 'gcp']:.      
-000154a0: 2020 2020 2020 666f 7220 6c62 2069 6e20        for lb in 
-000154b0: 6465 6c65 7465 646c 6273 3a0a 2020 2020  deletedlbs:.    
-000154c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000154d0: 2e64 656c 6574 655f 6c6f 6164 6261 6c61  .delete_loadbala
-000154e0: 6e63 6572 286c 6229 0a20 2020 2020 2020  ncer(lb).       
-000154f0: 2069 6620 666f 756e 643a 0a20 2020 2020   if found:.     
-00015500: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
-00015510: 2250 6c61 6e20 7b70 6c61 6e7d 2064 656c  "Plan {plan} del
-00015520: 6574 6564 2122 290a 2020 2020 2020 2020  eted!").        
-00015530: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00015540: 756c 7427 3a20 2773 7563 6365 7373 272c  ult': 'success',
-00015550: 2027 6465 6c65 7465 6476 6d27 3a20 6465   'deletedvm': de
-00015560: 6c65 7465 6476 6d73 7d0a 2020 2020 2020  letedvms}.      
-00015570: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00015580: 2020 2020 6572 726f 7228 6622 4e6f 206f      error(f"No o
-00015590: 626a 6563 7473 2066 6f75 6e64 2064 7572  bjects found dur
-000155a0: 696e 6720 6465 6c65 7469 6f6e 206f 6620  ing deletion of 
-000155b0: 706c 616e 207b 706c 616e 7d22 290a 2020  plan {plan}").  
-000155c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000155d0: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-000155e0: 6c75 7265 277d 0a0a 2020 2020 6465 6620  lure'}..    def 
-000155f0: 736e 6170 7368 6f74 5f70 6c61 6e28 7365  snapshot_plan(se
-00015600: 6c66 2c20 706c 616e 2c20 736e 6170 7368  lf, plan, snapsh
-00015610: 6f74 6e61 6d65 3d4e 6f6e 6529 3a0a 2020  otname=None):.  
-00015620: 2020 2020 2020 6b20 3d20 7365 6c66 2e6b        k = self.k
-00015630: 0a20 2020 2020 2020 2073 6e61 7073 686f  .        snapsho
-00015640: 7466 6f75 6e64 203d 2046 616c 7365 0a20  tfound = False. 
-00015650: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00015660: 536e 6170 7368 6f74 7469 6e67 2076 6d73  Snapshotting vms
-00015670: 2066 726f 6d20 706c 616e 207b 706c 616e   from plan {plan
-00015680: 7d22 290a 2020 2020 2020 2020 6966 2073  }").        if s
-00015690: 6e61 7073 686f 746e 616d 6520 6973 204e  napshotname is N
-000156a0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000156b0: 2077 6172 6e69 6e67 2866 2255 7369 6e67   warning(f"Using
-000156c0: 207b 706c 616e 7d20 6173 2073 6e61 7073   {plan} as snaps
-000156d0: 686f 7420 6e61 6d65 2061 7320 4e6f 6e65  hot name as None
-000156e0: 2077 6173 2070 726f 7669 6465 6422 290a   was provided").
-000156f0: 2020 2020 2020 2020 2020 2020 736e 6170              snap
-00015700: 7368 6f74 6e61 6d65 203d 2070 6c61 6e0a  shotname = plan.
-00015710: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
-00015720: 6e20 736f 7274 6564 286b 2e6c 6973 7428  n sorted(k.list(
-00015730: 292c 206b 6579 3d6c 616d 6264 6120 783a  ), key=lambda x:
-00015740: 2078 5b27 6e61 6d65 275d 293a 0a20 2020   x['name']):.   
-00015750: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-00015760: 766d 5b27 6e61 6d65 275d 0a20 2020 2020  vm['name'].     
-00015770: 2020 2020 2020 2064 6573 6372 6970 7469         descripti
-00015780: 6f6e 203d 2076 6d5b 2770 6c61 6e27 5d0a  on = vm['plan'].
-00015790: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-000157a0: 6573 6372 6970 7469 6f6e 203d 3d20 706c  escription == pl
-000157b0: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
-000157c0: 2020 2020 736e 6170 7368 6f74 666f 756e      snapshotfoun
-000157d0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-000157e0: 2020 2020 2020 2020 206b 2e63 7265 6174           k.creat
-000157f0: 655f 736e 6170 7368 6f74 2873 6e61 7073  e_snapshot(snaps
-00015800: 686f 746e 616d 652c 206e 616d 6529 0a20  hotname, name). 
-00015810: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00015820: 7563 6365 7373 2866 227b 6e61 6d65 7d20  uccess(f"{name} 
-00015830: 736e 6170 7368 6f74 7465 6421 2229 0a20  snapshotted!"). 
-00015840: 2020 2020 2020 2069 6620 736e 6170 7368         if snapsh
-00015850: 6f74 666f 756e 643a 0a20 2020 2020 2020  otfound:.       
-00015860: 2020 2020 2073 7563 6365 7373 2866 2250       success(f"P
-00015870: 6c61 6e20 7b70 6c61 6e7d 2073 6e61 7073  lan {plan} snaps
-00015880: 686f 7474 6564 2122 290a 2020 2020 2020  hotted!").      
-00015890: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000158a0: 2020 2020 7761 726e 696e 6728 224e 6f20      warning("No 
-000158b0: 6d61 7463 6869 6e67 2076 6d73 2066 6f75  matching vms fou
-000158c0: 6e64 2229 0a20 2020 2020 2020 2072 6574  nd").        ret
-000158d0: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-000158e0: 7375 6363 6573 7327 7d0a 0a20 2020 2064  success'}..    d
-000158f0: 6566 2072 6576 6572 745f 706c 616e 2873  ef revert_plan(s
-00015900: 656c 662c 2070 6c61 6e2c 2073 6e61 7073  elf, plan, snaps
-00015910: 686f 746e 616d 653d 4e6f 6e65 293a 0a20  hotname=None):. 
-00015920: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
-00015930: 6b0a 2020 2020 2020 2020 7265 7665 7274  k.        revert
-00015940: 666f 756e 6420 3d20 4661 6c73 650a 2020  found = False.  
-00015950: 2020 2020 2020 7070 7269 6e74 2866 2252        pprint(f"R
-00015960: 6576 6572 7469 6e67 2073 6e61 7073 686f  everting snapsho
-00015970: 7473 206f 6620 766d 7320 6672 6f6d 2070  ts of vms from p
-00015980: 6c61 6e20 7b70 6c61 6e7d 2229 0a20 2020  lan {plan}").   
-00015990: 2020 2020 2069 6620 736e 6170 7368 6f74       if snapshot
-000159a0: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
-000159b0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-000159c0: 6728 6622 5573 696e 6720 7b70 6c61 6e7d  g(f"Using {plan}
-000159d0: c2a0 6173 2073 6e61 7073 686f 7420 6e61  ..as snapshot na
-000159e0: 6d65 2061 7320 4e6f 6e65 2077 6173 2070  me as None was p
-000159f0: 726f 7669 6465 6422 290a 2020 2020 2020  rovided").      
-00015a00: 2020 2020 2020 736e 6170 7368 6f74 6e61        snapshotna
-00015a10: 6d65 203d 2070 6c61 6e0a 2020 2020 2020  me = plan.      
-00015a20: 2020 666f 7220 766d 2069 6e20 736f 7274    for vm in sort
-00015a30: 6564 286b 2e6c 6973 7428 292c 206b 6579  ed(k.list(), key
-00015a40: 3d6c 616d 6264 6120 783a 2078 5b27 6e61  =lambda x: x['na
-00015a50: 6d65 275d 293a 0a20 2020 2020 2020 2020  me']):.         
-00015a60: 2020 206e 616d 6520 3d20 766d 5b27 6e61     name = vm['na
-00015a70: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
-00015a80: 2064 6573 6372 6970 7469 6f6e 203d 2076   description = v
-00015a90: 6d5b 2770 6c61 6e27 5d0a 2020 2020 2020  m['plan'].      
-00015aa0: 2020 2020 2020 6966 2064 6573 6372 6970        if descrip
-00015ab0: 7469 6f6e 203d 3d20 706c 616e 3a0a 2020  tion == plan:.  
-00015ac0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00015ad0: 7665 7274 666f 756e 6420 3d20 5472 7565  vertfound = True
-00015ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015af0: 206b 2e72 6576 6572 745f 736e 6170 7368   k.revert_snapsh
-00015b00: 6f74 2873 6e61 7073 686f 746e 616d 652c  ot(snapshotname,
-00015b10: 206e 616d 6529 0a20 2020 2020 2020 2020   name).         
-00015b20: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
-00015b30: 2273 6e61 7073 686f 7420 6f66 207b 6e61  "snapshot of {na
-00015b40: 6d65 7d20 7265 7665 7274 6564 2122 290a  me} reverted!").
-00015b50: 2020 2020 2020 2020 6966 2072 6576 6572          if rever
-00015b60: 7466 6f75 6e64 3a0a 2020 2020 2020 2020  tfound:.        
-00015b70: 2020 2020 7375 6363 6573 7328 6622 506c      success(f"Pl
-00015b80: 616e 207b 706c 616e 7d20 7265 7665 7274  an {plan} revert
-00015b90: 6564 2077 6974 6820 736e 6170 7368 6f74  ed with snapshot
-00015ba0: 207b 736e 6170 7368 6f74 6e61 6d65 7d21   {snapshotname}!
-00015bb0: 2229 0a20 2020 2020 2020 2065 6c73 653a  ").        else:
-00015bc0: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
-00015bd0: 6e69 6e67 2822 4e6f 206d 6174 6368 696e  ning("No matchin
-00015be0: 6720 766d 7320 666f 756e 6422 290a 2020  g vms found").  
-00015bf0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-00015c00: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
-00015c10: 277d 0a0a 2020 2020 6465 6620 706c 616e  '}..    def plan
-00015c20: 2873 656c 662c 2070 6c61 6e2c 2061 6e73  (self, plan, ans
-00015c30: 6962 6c65 3d46 616c 7365 2c20 7572 6c3d  ible=False, url=
-00015c40: 4e6f 6e65 2c20 7061 7468 3d4e 6f6e 652c  None, path=None,
-00015c50: 2063 6f6e 7461 696e 6572 3d46 616c 7365   container=False
-00015c60: 2c20 696e 7075 7466 696c 653d 4e6f 6e65  , inputfile=None
-00015c70: 2c20 696e 7075 7473 7472 696e 673d 4e6f  , inputstring=No
-00015c80: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00015c90: 206f 7665 7272 6964 6573 3d7b 7d2c 2069   overrides={}, i
-00015ca0: 6e66 6f3d 4661 6c73 652c 2075 7064 6174  nfo=False, updat
-00015cb0: 653d 4661 6c73 652c 2065 6d62 6564 6465  e=False, embedde
-00015cc0: 643d 4661 6c73 652c 2064 6f77 6e6c 6f61  d=False, downloa
-00015cd0: 643d 4661 6c73 652c 2071 7569 6574 3d46  d=False, quiet=F
-00015ce0: 616c 7365 2c20 646f 633d 4661 6c73 652c  alse, doc=False,
-00015cf0: 0a20 2020 2020 2020 2020 2020 2020 6f6e  .             on
-00015d00: 6c79 6173 7365 7473 3d46 616c 7365 2c20  lyassets=False, 
-00015d10: 7072 653d 5472 7565 2c20 706f 7374 3d54  pre=True, post=T
-00015d20: 7275 652c 2065 7863 6c75 6465 766d 733d  rue, excludevms=
-00015d30: 5b5d 2c20 6261 7365 6d6f 6465 3d46 616c  [], basemode=Fal
-00015d40: 7365 2c20 7468 7265 6164 6564 3d46 616c  se, threaded=Fal
-00015d50: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
-00015d60: 4d61 6e61 6765 2070 6c61 6e20 6669 6c65  Manage plan file
-00015d70: 2222 220a 2020 2020 2020 2020 6b20 3d20  """.        k = 
-00015d80: 7365 6c66 2e6b 0a20 2020 2020 2020 206e  self.k.        n
-00015d90: 6f5f 6f76 6572 7269 6465 7320 3d20 6e6f  o_overrides = no
-00015da0: 7420 6f76 6572 7269 6465 730a 2020 2020  t overrides.    
-00015db0: 2020 2020 7468 7265 6164 7320 3d20 5b5d      threads = []
-00015dc0: 0a20 2020 2020 2020 206e 6577 766d 7320  .        newvms 
-00015dd0: 3d20 5b5d 0a20 2020 2020 2020 206e 6577  = [].        new
-00015de0: 6173 7365 7473 203d 205b 5d0a 2020 2020  assets = [].    
-00015df0: 2020 2020 6661 696c 6564 766d 7320 3d20      failedvms = 
-00015e00: 5b5d 0a20 2020 2020 2020 2065 7869 7374  [].        exist
-00015e10: 696e 6776 6d73 203d 205b 5d0a 2020 2020  ingvms = [].    
-00015e20: 2020 2020 6173 796e 6377 6169 7476 6d73      asyncwaitvms
-00015e30: 203d 205b 5d0a 2020 2020 2020 2020 6f6e   = [].        on
-00015e40: 666c 7920 3d20 4e6f 6e65 0a20 2020 2020  fly = None.     
-00015e50: 2020 2074 6f63 6c65 616e 203d 2046 616c     toclean = Fal
-00015e60: 7365 0a20 2020 2020 2020 2067 6574 6261  se.        getba
-00015e70: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
-00015e80: 2020 2076 6d70 726f 6669 6c65 7320 3d20     vmprofiles = 
-00015e90: 7b6b 6579 3a20 7661 6c75 6520 666f 7220  {key: value for 
-00015ea0: 6b65 792c 2076 616c 7565 2069 6e20 7365  key, value in se
-00015eb0: 6c66 2e70 726f 6669 6c65 732e 6974 656d  lf.profiles.item
-00015ec0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-00015ed0: 2020 2020 2020 2020 2020 6966 2027 7479            if 'ty
-00015ee0: 7065 2720 6e6f 7420 696e 2076 616c 7565  pe' not in value
-00015ef0: 206f 7220 7661 6c75 655b 2774 7970 6527   or value['type'
-00015f00: 5d20 3d3d 2027 766d 277d 0a20 2020 2020  ] == 'vm'}.     
-00015f10: 2020 2063 6f6e 7461 696e 6572 7072 6f66     containerprof
-00015f20: 696c 6573 203d 207b 6b65 793a 2076 616c  iles = {key: val
-00015f30: 7565 2066 6f72 206b 6579 2c20 7661 6c75  ue for key, valu
-00015f40: 6520 696e 2073 656c 662e 7072 6f66 696c  e in self.profil
-00015f50: 6573 2e69 7465 6d73 2829 0a20 2020 2020  es.items().     
-00015f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f70: 2020 2020 2020 2020 6966 2027 7479 7065          if 'type
-00015f80: 2720 696e 2076 616c 7565 2061 6e64 2076  ' in value and v
-00015f90: 616c 7565 5b27 7479 7065 275d 203d 3d20  alue['type'] == 
-00015fa0: 2763 6f6e 7461 696e 6572 277d 0a20 2020  'container'}.   
-00015fb0: 2020 2020 2069 6620 706c 616e 2069 7320       if plan is 
-00015fc0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00015fd0: 2020 706c 616e 203d 206e 616d 6575 7469    plan = nameuti
-00015fe0: 6c73 2e67 6574 5f72 616e 646f 6d5f 6e61  ls.get_random_na
-00015ff0: 6d65 2829 0a20 2020 2020 2020 2069 6620  me().        if 
-00016000: 7572 6c20 6973 206e 6f74 204e 6f6e 653a  url is not None:
-00016010: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00016020: 7572 6c2e 7374 6172 7473 7769 7468 2827  url.startswith('
-00016030: 2f27 293a 0a20 2020 2020 2020 2020 2020  /'):.           
-00016040: 2020 2020 2075 726c 203d 2066 2266 696c       url = f"fil
-00016050: 653a 2f2f 7b75 726c 7d22 0a20 2020 2020  e://{url}".     
-00016060: 2020 2020 2020 2069 6620 6e6f 7420 7572         if not ur
-00016070: 6c2e 656e 6473 7769 7468 2827 2e79 6d6c  l.endswith('.yml
-00016080: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-00016090: 2020 2020 7572 6c20 3d20 6622 7b75 726c      url = f"{url
-000160a0: 7d2f 6b63 6c69 5f70 6c61 6e2e 796d 6c22  }/kcli_plan.yml"
-000160b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000160c0: 2070 7072 696e 7428 6622 5472 7969 6e67   pprint(f"Trying
-000160d0: 2074 6f20 7265 7472 6965 7665 207b 7572   to retrieve {ur
-000160e0: 6c7d 2229 0a20 2020 2020 2020 2020 2020  l}").           
-000160f0: 2069 6e70 7574 6669 6c65 203d 206f 732e   inputfile = os.
-00016100: 7061 7468 2e62 6173 656e 616d 6528 7572  path.basename(ur
-00016110: 6c29 0a20 2020 2020 2020 2020 2020 206f  l).            o
-00016120: 6e66 6c79 203d 206f 732e 7061 7468 2e64  nfly = os.path.d
-00016130: 6972 6e61 6d65 2875 726c 290a 2020 2020  irname(url).    
-00016140: 2020 2020 2020 2020 7061 7468 203d 2070          path = p
-00016150: 6c61 6e20 6966 2070 6174 6820 6973 204e  lan if path is N
-00016160: 6f6e 6520 656c 7365 2070 6174 680a 2020  one else path.  
-00016170: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00016180: 2071 7569 6574 3a0a 2020 2020 2020 2020   quiet:.        
-00016190: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-000161a0: 2252 6574 7269 6576 696e 6720 7370 6563  "Retrieving spec
-000161b0: 6966 6965 6420 706c 616e 2066 726f 6d20  ified plan from 
-000161c0: 7b75 726c 7d20 746f 207b 7061 7468 7d22  {url} to {path}"
-000161d0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000161e0: 2063 6f6e 7461 696e 6572 5f6d 6f64 6528   container_mode(
-000161f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00016200: 2020 2070 6174 6820 3d20 6622 2f77 6f72     path = f"/wor
-00016210: 6b64 6972 2f7b 7061 7468 7d22 0a20 2020  kdir/{path}".   
-00016220: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00016230: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
-00016240: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
-00016250: 2020 2020 2020 746f 636c 6561 6e20 3d20        toclean = 
-00016260: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00016270: 2020 2020 2063 6f6d 6d6f 6e2e 6665 7463       common.fetc
-00016280: 6828 7572 6c2c 2070 6174 6829 0a20 2020  h(url, path).   
-00016290: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000162a0: 2064 6566 6175 6c74 5f70 6172 616d 6574   default_paramet
-000162b0: 6572 5f66 696c 6520 696e 205b 272f 6b63  er_file in ['/kc
-000162c0: 6c69 5f64 6566 6175 6c74 2e79 6d6c 272c  li_default.yml',
-000162d0: 2066 272f 7b70 6c61 6e7d 5f64 6566 6175   f'/{plan}_defau
-000162e0: 6c74 2e79 6d6c 272c 0a20 2020 2020 2020  lt.yml',.       
-000162f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016310: 2020 2020 2020 2020 222f 2573 5f64 6566          "/%s_def
-00016320: 6175 6c74 2573 2220 2520 6f73 2e70 6174  ault%s" % os.pat
-00016330: 682e 7370 6c69 7465 7874 286f 732e 7061  h.splitext(os.pa
-00016340: 7468 2e62 6173 656e 616d 6528 7572 6c29  th.basename(url)
-00016350: 295d 3a0a 2020 2020 2020 2020 2020 2020  )]:.            
-00016360: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00016370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016380: 2020 2020 2063 6f6d 6d6f 6e2e 6665 7463       common.fetc
-00016390: 6828 6f73 2e70 6174 682e 6469 726e 616d  h(os.path.dirnam
-000163a0: 6528 7572 6c29 202b 2064 6566 6175 6c74  e(url) + default
-000163b0: 5f70 6172 616d 6574 6572 5f66 696c 652c  _parameter_file,
-000163c0: 2070 6174 6829 0a20 2020 2020 2020 2020   path).         
-000163d0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000163e0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-000163f0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00016400: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00016410: 2064 6f77 6e6c 6f61 643a 0a20 2020 2020   download:.     
-00016420: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
-00016430: 2066 2274 6172 6765 7420 6469 7265 6374   f"target direct
-00016440: 6f72 7920 7b70 6174 687d 2061 6c72 6561  ory {path} alrea
-00016450: 6479 2074 6865 7265 220a 2020 2020 2020  dy there".      
-00016460: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00016470: 6d73 6729 0a20 2020 2020 2020 2020 2020  msg).           
-00016480: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00016490: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
-000164a0: 2c20 2772 6561 736f 6e27 3a20 6d73 677d  , 'reason': msg}
-000164b0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000164c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000164d0: 2020 2070 7072 696e 7428 6622 5573 696e     pprint(f"Usin
-000164e0: 6720 6578 6973 7469 6e67 2064 6972 6563  g existing direc
-000164f0: 746f 7279 207b 7061 7468 7d22 290a 2020  tory {path}").  
-00016500: 2020 2020 2020 2020 2020 6966 2064 6f77            if dow
-00016510: 6e6c 6f61 643a 0a20 2020 2020 2020 2020  nload:.         
-00016520: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
-00016530: 203d 2066 227b 7061 7468 7d2f 7b69 6e70   = f"{path}/{inp
-00016540: 7574 6669 6c65 7d22 0a20 2020 2020 2020  utfile}".       
-00016550: 2020 2020 2020 2020 2065 6e74 7269 6573           entries
-00016560: 2c20 6f76 6572 7269 6465 732c 2062 6173  , overrides, bas
-00016570: 6566 696c 652c 2062 6173 6564 6972 203d  efile, basedir =
-00016580: 2073 656c 662e 7072 6f63 6573 735f 696e   self.process_in
-00016590: 7075 7466 696c 6528 706c 616e 2c20 696e  putfile(plan, in
-000165a0: 7075 7466 696c 652c 206f 7665 7272 6964  putfile, overrid
-000165b0: 6573 3d6f 7665 7272 6964 6573 2c0a 2020  es=overrides,.  
-000165c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014850: 2020 2020 2020 2020 2064 6f6d 6169 6e20           domain 
+00014860: 3d20 636c 7573 7465 7264 6174 612e 6765  = clusterdata.ge
+00014870: 7428 2764 6f6d 6169 6e27 2c20 646f 6d61  t('domain', doma
+00014880: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
+00014890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148a0: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
+000148b0: 7420 3d20 636c 7573 7465 7264 6174 612e  t = clusterdata.
+000148c0: 6765 7428 2764 6e73 636c 6965 6e74 2729  get('dnsclient')
+000148d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000148e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148f0: 2020 2020 2067 6b65 203d 206b 7562 6574       gke = kubet
+00014900: 7970 6520 3d3d 2027 676b 6527 0a20 2020  ype == 'gke'.   
+00014910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014930: 2065 6b73 203d 206b 7562 6574 7970 6520   eks = kubetype 
+00014940: 3d3d 2027 656b 7327 0a20 2020 2020 2020  == 'eks'.       
+00014950: 2069 6620 6879 7065 7273 6869 6674 3a0a   if hypershift:.
+00014960: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
+00014970: 636f 6e66 6967 6d67 6d74 203d 2066 227b  configmgmt = f"{
+00014980: 636c 7573 7465 7264 6972 7d2f 6b75 6265  clusterdir}/kube
+00014990: 636f 6e66 6967 2e6d 676d 7422 0a20 2020  config.mgmt".   
+000149a0: 2020 2020 2020 2020 2063 616c 6c28 6627           call(f'
+000149b0: 4b55 4245 434f 4e46 4947 3d7b 6b75 6265  KUBECONFIG={kube
+000149c0: 636f 6e66 6967 6d67 6d74 7d20 6f63 2064  configmgmt} oc d
+000149d0: 656c 6574 6520 2d66 207b 636c 7573 7465  elete -f {cluste
+000149e0: 7264 6972 7d2f 6175 746f 6170 7072 6f76  rdir}/autoapprov
+000149f0: 6572 6372 6f6e 2e79 6d6c 272c 2073 6865  ercron.yml', she
+00014a00: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+00014a10: 2020 2020 2063 616c 6c28 6627 4b55 4245       call(f'KUBE
+00014a20: 434f 4e46 4947 3d7b 6b75 6265 636f 6e66  CONFIG={kubeconf
+00014a30: 6967 6d67 6d74 7d20 6f63 2064 656c 6574  igmgmt} oc delet
+00014a40: 6520 2d66 207b 636c 7573 7465 7264 6972  e -f {clusterdir
+00014a50: 7d2f 6e6f 6465 706f 6f6c 2e79 616d 6c27  }/nodepool.yaml'
+00014a60: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
+00014a70: 2020 2020 2020 2020 2020 6361 6c6c 2866            call(f
+00014a80: 274b 5542 4543 4f4e 4649 473d 7b6b 7562  'KUBECONFIG={kub
+00014a90: 6563 6f6e 6669 676d 676d 747d 206f 6320  econfigmgmt} oc 
+00014aa0: 6465 6c65 7465 202d 6620 7b63 6c75 7374  delete -f {clust
+00014ab0: 6572 6469 727d 2f68 6f73 7465 6463 6c75  erdir}/hostedclu
+00014ac0: 7374 6572 2e79 616d 6c27 2c20 7368 656c  ster.yaml', shel
+00014ad0: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
+00014ae0: 2020 2020 6966 206e 6f74 2061 7373 6973      if not assis
+00014af0: 7465 6420 616e 6420 2827 6261 7265 6d65  ted and ('bareme
+00014b00: 7461 6c5f 6973 6f27 2069 6e20 636c 7573  tal_iso' in clus
+00014b10: 7465 7264 6174 6120 6f72 2027 6261 7265  terdata or 'bare
+00014b20: 6d65 7461 6c5f 686f 7374 7327 2069 6e20  metal_hosts' in 
+00014b30: 636c 7573 7465 7264 6174 6129 3a0a 2020  clusterdata):.  
+00014b40: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+00014b50: 6c6c 2827 4b55 4245 434f 4e46 4947 3d7b  ll('KUBECONFIG={
+00014b60: 6b75 6265 636f 6e66 6967 6d67 6d74 7d20  kubeconfigmgmt} 
+00014b70: 6f63 202d 6e20 6465 6661 756c 7420 6465  oc -n default de
+00014b80: 6c65 7465 2061 6c6c 202d 6c20 6170 703d  lete all -l app=
+00014b90: 6874 7470 642d 6b63 6c69 272c 2073 6865  httpd-kcli', she
+00014ba0: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+00014bb0: 2020 2020 2020 2020 2063 616c 6c28 274b           call('K
+00014bc0: 5542 4543 4f4e 4649 473d 7b6b 7562 6563  UBECONFIG={kubec
+00014bd0: 6f6e 6669 676d 676d 747d 206f 6320 2d6e  onfigmgmt} oc -n
+00014be0: 2064 6566 6175 6c74 2064 656c 6574 6520   default delete 
+00014bf0: 7376 6320 6874 7470 642d 6b63 6c69 2d73  svc httpd-kcli-s
+00014c00: 7663 272c 2073 6865 6c6c 3d54 7275 6529  vc', shell=True)
+00014c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c20: 2063 616c 6c28 274b 5542 4543 4f4e 4649   call('KUBECONFI
+00014c30: 473d 7b6b 7562 6563 6f6e 6669 676d 676d  G={kubeconfigmgm
+00014c40: 747d 206f 6320 2d6e 2064 6566 6175 6c74  t} oc -n default
+00014c50: 2064 656c 6574 6520 7076 6320 6874 7470   delete pvc http
+00014c60: 642d 6b63 6c69 2d70 7663 272c 2073 6865  d-kcli-pvc', she
+00014c70: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+00014c80: 2069 6620 676b 653a 0a20 2020 2020 2020   if gke:.       
+00014c90: 2020 2020 2067 6370 636c 6965 6e74 203d       gcpclient =
+00014ca0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00014cb0: 2020 6966 2027 636c 6965 6e74 2720 696e    if 'client' in
+00014cc0: 2063 6c75 7374 6572 6461 7461 3a0a 2020   clusterdata:.  
+00014cd0: 2020 2020 2020 2020 2020 2020 2020 6763                gc
+00014ce0: 7063 6c69 656e 7420 3d20 636c 7573 7465  pclient = cluste
+00014cf0: 7264 6174 615b 2763 6c69 656e 7427 5d0a  rdata['client'].
+00014d00: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00014d10: 2073 656c 662e 7479 7065 203d 3d20 2767   self.type == 'g
+00014d20: 6b65 273a 0a20 2020 2020 2020 2020 2020  ke':.           
+00014d30: 2020 2020 2067 6370 636c 6965 6e74 203d       gcpclient =
+00014d40: 2073 656c 662e 636c 6965 6e74 0a20 2020   self.client.   
+00014d50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00014d60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00014d70: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00014d80: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
+00014d90: 736f 6e27 3a20 2244 656c 6574 696e 6720  son': "Deleting 
+00014da0: 676b 6520 636c 7573 7465 7220 7265 7175  gke cluster requ
+00014db0: 6972 6573 2074 6f20 696e 7374 616e 7469  ires to instanti
+00014dc0: 6174 6520 6763 7020 7072 6f76 6964 6572  ate gcp provider
+00014dd0: 227d 0a20 2020 2020 2020 2020 2020 2066  "}.            f
+00014de0: 726f 6d20 6b76 6972 742e 636c 7573 7465  rom kvirt.cluste
+00014df0: 7220 696d 706f 7274 2067 6b65 0a20 2020  r import gke.   
+00014e00: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00014e10: 636f 6e66 6967 203d 204b 636f 6e66 6967  config = Kconfig
+00014e20: 2863 6c69 656e 743d 6763 7063 6c69 656e  (client=gcpclien
+00014e30: 7429 2e6b 2069 6620 6763 7063 6c69 656e  t).k if gcpclien
+00014e40: 7420 213d 2073 656c 662e 636c 6965 6e74  t != self.client
+00014e50: 2065 6c73 6520 7365 6c66 0a20 2020 2020   else self.     
+00014e60: 2020 2020 2020 207a 6f6e 616c 203d 2063         zonal = c
+00014e70: 6c75 7374 6572 6461 7461 2e67 6574 2827  lusterdata.get('
+00014e80: 7a6f 6e61 6c27 2c20 5472 7565 290a 2020  zonal', True).  
+00014e90: 2020 2020 2020 2020 2020 676b 652e 6465            gke.de
+00014ea0: 6c65 7465 2863 7572 7265 6e74 636f 6e66  lete(currentconf
+00014eb0: 6967 2c20 636c 7573 7465 722c 207a 6f6e  ig, cluster, zon
+00014ec0: 616c 290a 2020 2020 2020 2020 656c 6966  al).        elif
+00014ed0: 2065 6b73 3a0a 2020 2020 2020 2020 2020   eks:.          
+00014ee0: 2020 656b 7363 6c69 656e 7420 3d20 4e6f    eksclient = No
+00014ef0: 6e65 0a20 2020 2020 2020 2020 2020 2069  ne.            i
+00014f00: 6620 2763 6c69 656e 7427 2069 6e20 636c  f 'client' in cl
+00014f10: 7573 7465 7264 6174 613a 0a20 2020 2020  usterdata:.     
+00014f20: 2020 2020 2020 2020 2020 2065 6b73 636c             ekscl
+00014f30: 6965 6e74 203d 2063 6c75 7374 6572 6461  ient = clusterda
+00014f40: 7461 5b27 636c 6965 6e74 275d 0a20 2020  ta['client'].   
+00014f50: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
+00014f60: 6c66 2e74 7970 6520 3d3d 2027 6177 7327  lf.type == 'aws'
+00014f70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014f80: 2020 656b 7363 6c69 656e 7420 3d20 7365    eksclient = se
+00014f90: 6c66 2e63 6c69 656e 740a 2020 2020 2020  lf.client.      
+00014fa0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00014fb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00014fc0: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
+00014fd0: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
+00014fe0: 273a 2022 4465 6c65 7469 6e67 2065 6b73  ': "Deleting eks
+00014ff0: 2063 6c75 7374 6572 2072 6571 7569 7265   cluster require
+00015000: 7320 746f 2069 6e73 7461 6e74 6961 7465  s to instantiate
+00015010: 2067 6370 2070 726f 7669 6465 7222 7d0a   gcp provider"}.
+00015020: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+00015030: 206b 7669 7274 2e63 6c75 7374 6572 2069   kvirt.cluster i
+00015040: 6d70 6f72 7420 656b 730a 2020 2020 2020  mport eks.      
+00015050: 2020 2020 2020 6375 7272 656e 7463 6f6e        currentcon
+00015060: 6669 6720 3d20 4b63 6f6e 6669 6728 636c  fig = Kconfig(cl
+00015070: 6965 6e74 3d65 6b73 636c 6965 6e74 292e  ient=eksclient).
+00015080: 6b20 6966 2065 6b73 636c 6965 6e74 2021  k if eksclient !
+00015090: 3d20 7365 6c66 2e63 6c69 656e 7420 656c  = self.client el
+000150a0: 7365 2073 656c 660a 2020 2020 2020 2020  se self.        
+000150b0: 2020 2020 656b 732e 6465 6c65 7465 2863      eks.delete(c
+000150c0: 7572 7265 6e74 636f 6e66 6967 2c20 636c  urrentconfig, cl
+000150d0: 7573 7465 7229 0a20 2020 2020 2020 2069  uster).        i
+000150e0: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+000150f0: 2863 6c75 7374 6572 6469 7229 3a0a 2020  (clusterdir):.  
+00015100: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00015110: 2866 2244 656c 6574 696e 6720 6469 7265  (f"Deleting dire
+00015120: 6374 6f72 7920 7b63 6c75 7374 6572 6469  ctory {clusterdi
+00015130: 727d 2229 0a20 2020 2020 2020 2020 2020  r}").           
+00015140: 2072 6d74 7265 6528 636c 7573 7465 7264   rmtree(clusterd
+00015150: 6972 2c20 6967 6e6f 7265 5f65 7272 6f72  ir, ignore_error
+00015160: 733d 5472 7565 290a 2020 2020 2020 2020  s=True).        
+00015170: 6966 2063 6f6e 7461 696e 6572 3a0a 2020  if container:.  
+00015180: 2020 2020 2020 2020 2020 636f 6e74 203d            cont =
+00015190: 204b 636f 6e74 6169 6e65 7263 6f6e 6669   Kcontainerconfi
+000151a0: 6728 7365 6c66 2c20 636c 6965 6e74 3d73  g(self, client=s
+000151b0: 656c 662e 636f 6e74 6169 6e65 7263 6c69  elf.containercli
+000151c0: 656e 7429 2e63 6f6e 740a 2020 2020 2020  ent).cont.      
+000151d0: 2020 2020 2020 666f 7220 636f 6e74 6120        for conta 
+000151e0: 696e 2073 6f72 7465 6428 636f 6e74 2e6c  in sorted(cont.l
+000151f0: 6973 745f 636f 6e74 6169 6e65 7273 286b  ist_containers(k
+00015200: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00015210: 2020 2020 6e61 6d65 203d 2063 6f6e 7461      name = conta
+00015220: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00015230: 2020 2020 636f 6e74 6169 6e65 725f 706c      container_pl
+00015240: 616e 203d 2063 6f6e 7461 5b33 5d0a 2020  an = conta[3].  
+00015250: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015260: 2063 6f6e 7461 696e 6572 5f70 6c61 6e20   container_plan 
+00015270: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
+00015280: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00015290: 742e 6465 6c65 7465 5f63 6f6e 7461 696e  t.delete_contain
+000152a0: 6572 286e 616d 6529 0a20 2020 2020 2020  er(name).       
+000152b0: 2020 2020 2020 2020 2020 2020 2073 7563               suc
+000152c0: 6365 7373 2866 2243 6f6e 7461 696e 6572  cess(f"Container
+000152d0: 207b 6e61 6d65 7d20 6465 6c65 7465 6421   {name} deleted!
+000152e0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+000152f0: 2020 2020 2020 2066 6f75 6e64 203d 2054         found = T
+00015300: 7275 650a 2020 2020 2020 2020 6966 206e  rue.        if n
+00015310: 6f74 2073 656c 662e 6b65 6570 5f6e 6574  ot self.keep_net
+00015320: 776f 726b 733a 0a20 2020 2020 2020 2020  works:.         
+00015330: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
+00015340: 3d3d 2027 6b76 6d27 3a0a 2020 2020 2020  == 'kvm':.      
+00015350: 2020 2020 2020 2020 2020 6e65 7477 6f72            networ
+00015360: 6b73 203d 206b 2e6c 6973 745f 6e65 7477  ks = k.list_netw
+00015370: 6f72 6b73 2829 0a20 2020 2020 2020 2020  orks().         
+00015380: 2020 2020 2020 2066 6f72 206e 6574 776f         for netwo
+00015390: 726b 2069 6e20 6b2e 6c69 7374 5f6e 6574  rk in k.list_net
+000153a0: 776f 726b 7328 293a 0a20 2020 2020 2020  works():.       
+000153b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000153c0: 2770 6c61 6e27 2069 6e20 6e65 7477 6f72  'plan' in networ
+000153d0: 6b73 5b6e 6574 776f 726b 5d20 616e 6420  ks[network] and 
+000153e0: 6e65 7477 6f72 6b73 5b6e 6574 776f 726b  networks[network
+000153f0: 5d5b 2770 6c61 6e27 5d20 3d3d 2070 6c61  ]['plan'] == pla
+00015400: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+00015410: 2020 2020 2020 2020 2020 206e 6574 776f             netwo
+00015420: 726b 7265 7375 6c74 203d 206b 2e64 656c  rkresult = k.del
+00015430: 6574 655f 6e65 7477 6f72 6b28 6e65 7477  ete_network(netw
+00015440: 6f72 6b29 0a20 2020 2020 2020 2020 2020  ork).           
+00015450: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00015460: 6e65 7477 6f72 6b72 6573 756c 745b 2772  networkresult['r
+00015470: 6573 756c 7427 5d20 3d3d 2027 7375 6363  esult'] == 'succ
+00015480: 6573 7327 3a0a 2020 2020 2020 2020 2020  ess':.          
+00015490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000154a0: 2020 7375 6363 6573 7328 6622 6e65 7477    success(f"netw
+000154b0: 6f72 6b20 7b6e 6574 776f 726b 7d20 6465  ork {network} de
+000154c0: 6c65 7465 6421 2229 0a20 2020 2020 2020  leted!").       
+000154d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000154e0: 2020 2020 2066 6f75 6e64 203d 2054 7275       found = Tru
+000154f0: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+00015500: 6966 206e 6574 776f 726b 733a 0a20 2020  if networks:.   
+00015510: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
+00015520: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
+00015530: 2020 2020 2020 2020 2020 666f 7220 6e65            for ne
+00015540: 7477 6f72 6b20 696e 206e 6574 776f 726b  twork in network
+00015550: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00015560: 2020 2020 2020 206e 6574 776f 726b 7265         networkre
+00015570: 7375 6c74 203d 206b 2e64 656c 6574 655f  sult = k.delete_
+00015580: 6e65 7477 6f72 6b28 6e65 7477 6f72 6b29  network(network)
+00015590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000155a0: 2020 2020 2069 6620 6e65 7477 6f72 6b72       if networkr
+000155b0: 6573 756c 745b 2772 6573 756c 7427 5d20  esult['result'] 
+000155c0: 3d3d 2027 7375 6363 6573 7327 3a0a 2020  == 'success':.  
+000155d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155e0: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
+000155f0: 556e 7573 6564 206e 6574 776f 726b 207b  Unused network {
+00015600: 6e65 7477 6f72 6b7d 2064 656c 6574 6564  network} deleted
+00015610: 2122 290a 2020 2020 2020 2020 666f 7220  !").        for 
+00015620: 6b65 7966 696c 6520 696e 2067 6c6f 622e  keyfile in glob.
+00015630: 676c 6f62 2822 2573 2e6b 6579 2a22 2025  glob("%s.key*" %
+00015640: 2070 6c61 6e29 3a0a 2020 2020 2020 2020   plan):.        
+00015650: 2020 2020 7375 6363 6573 7328 6622 6669      success(f"fi
+00015660: 6c65 207b 6b65 7966 696c 657d 2066 726f  le {keyfile} fro
+00015670: 6d20 7b70 6c61 6e7d 2064 656c 6574 6564  m {plan} deleted
+00015680: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
+00015690: 6f73 2e72 656d 6f76 6528 6b65 7966 696c  os.remove(keyfil
+000156a0: 6529 0a20 2020 2020 2020 2066 6f72 2061  e).        for a
+000156b0: 6e73 6962 6c65 6669 6c65 2069 6e20 676c  nsiblefile in gl
+000156c0: 6f62 2e67 6c6f 6228 222f 746d 702f 2573  ob.glob("/tmp/%s
+000156d0: 2a69 6e76 2a22 2025 2070 6c61 6e29 3a0a  *inv*" % plan):.
+000156e0: 2020 2020 2020 2020 2020 2020 7375 6363              succ
+000156f0: 6573 7328 6622 6669 6c65 207b 616e 7369  ess(f"file {ansi
+00015700: 626c 6566 696c 657d 2066 726f 6d20 7b70  blefile} from {p
+00015710: 6c61 6e7d 2064 656c 6574 6564 2122 290a  lan} deleted!").
+00015720: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
+00015730: 656d 6f76 6528 616e 7369 626c 6566 696c  emove(ansiblefil
+00015740: 6529 0a20 2020 2020 2020 2069 6620 6465  e).        if de
+00015750: 6c65 7465 646c 6273 2061 6e64 2073 656c  letedlbs and sel
+00015760: 662e 7479 7065 2069 6e20 5b27 6177 7327  f.type in ['aws'
+00015770: 2c20 2767 6370 275d 3a0a 2020 2020 2020  , 'gcp']:.      
+00015780: 2020 2020 2020 666f 7220 6c62 2069 6e20        for lb in 
+00015790: 6465 6c65 7465 646c 6273 3a0a 2020 2020  deletedlbs:.    
+000157a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000157b0: 2e64 656c 6574 655f 6c6f 6164 6261 6c61  .delete_loadbala
+000157c0: 6e63 6572 286c 6229 0a20 2020 2020 2020  ncer(lb).       
+000157d0: 2069 6620 666f 756e 643a 0a20 2020 2020   if found:.     
+000157e0: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
+000157f0: 2250 6c61 6e20 7b70 6c61 6e7d 2064 656c  "Plan {plan} del
+00015800: 6574 6564 2122 290a 2020 2020 2020 2020  eted!").        
+00015810: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+00015820: 756c 7427 3a20 2773 7563 6365 7373 272c  ult': 'success',
+00015830: 2027 6465 6c65 7465 6476 6d27 3a20 6465   'deletedvm': de
+00015840: 6c65 7465 6476 6d73 7d0a 2020 2020 2020  letedvms}.      
+00015850: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00015860: 2020 2020 6572 726f 7228 6622 4e6f 206f      error(f"No o
+00015870: 626a 6563 7473 2066 6f75 6e64 2064 7572  bjects found dur
+00015880: 696e 6720 6465 6c65 7469 6f6e 206f 6620  ing deletion of 
+00015890: 706c 616e 207b 706c 616e 7d22 290a 2020  plan {plan}").  
+000158a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000158b0: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
+000158c0: 6c75 7265 277d 0a0a 2020 2020 6465 6620  lure'}..    def 
+000158d0: 736e 6170 7368 6f74 5f70 6c61 6e28 7365  snapshot_plan(se
+000158e0: 6c66 2c20 706c 616e 2c20 736e 6170 7368  lf, plan, snapsh
+000158f0: 6f74 6e61 6d65 3d4e 6f6e 6529 3a0a 2020  otname=None):.  
+00015900: 2020 2020 2020 6b20 3d20 7365 6c66 2e6b        k = self.k
+00015910: 0a20 2020 2020 2020 2073 6e61 7073 686f  .        snapsho
+00015920: 7466 6f75 6e64 203d 2046 616c 7365 0a20  tfound = False. 
+00015930: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00015940: 536e 6170 7368 6f74 7469 6e67 2076 6d73  Snapshotting vms
+00015950: 2066 726f 6d20 706c 616e 207b 706c 616e   from plan {plan
+00015960: 7d22 290a 2020 2020 2020 2020 6966 2073  }").        if s
+00015970: 6e61 7073 686f 746e 616d 6520 6973 204e  napshotname is N
+00015980: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00015990: 2077 6172 6e69 6e67 2866 2255 7369 6e67   warning(f"Using
+000159a0: 207b 706c 616e 7d20 6173 2073 6e61 7073   {plan} as snaps
+000159b0: 686f 7420 6e61 6d65 2061 7320 4e6f 6e65  hot name as None
+000159c0: 2077 6173 2070 726f 7669 6465 6422 290a   was provided").
+000159d0: 2020 2020 2020 2020 2020 2020 736e 6170              snap
+000159e0: 7368 6f74 6e61 6d65 203d 2070 6c61 6e0a  shotname = plan.
+000159f0: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
+00015a00: 6e20 736f 7274 6564 286b 2e6c 6973 7428  n sorted(k.list(
+00015a10: 292c 206b 6579 3d6c 616d 6264 6120 783a  ), key=lambda x:
+00015a20: 2078 5b27 6e61 6d65 275d 293a 0a20 2020   x['name']):.   
+00015a30: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+00015a40: 766d 5b27 6e61 6d65 275d 0a20 2020 2020  vm['name'].     
+00015a50: 2020 2020 2020 2064 6573 6372 6970 7469         descripti
+00015a60: 6f6e 203d 2076 6d5b 2770 6c61 6e27 5d0a  on = vm['plan'].
+00015a70: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00015a80: 6573 6372 6970 7469 6f6e 203d 3d20 706c  escription == pl
+00015a90: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
+00015aa0: 2020 2020 736e 6170 7368 6f74 666f 756e      snapshotfoun
+00015ab0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+00015ac0: 2020 2020 2020 2020 206b 2e63 7265 6174           k.creat
+00015ad0: 655f 736e 6170 7368 6f74 2873 6e61 7073  e_snapshot(snaps
+00015ae0: 686f 746e 616d 652c 206e 616d 6529 0a20  hotname, name). 
+00015af0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00015b00: 7563 6365 7373 2866 227b 6e61 6d65 7d20  uccess(f"{name} 
+00015b10: 736e 6170 7368 6f74 7465 6421 2229 0a20  snapshotted!"). 
+00015b20: 2020 2020 2020 2069 6620 736e 6170 7368         if snapsh
+00015b30: 6f74 666f 756e 643a 0a20 2020 2020 2020  otfound:.       
+00015b40: 2020 2020 2073 7563 6365 7373 2866 2250       success(f"P
+00015b50: 6c61 6e20 7b70 6c61 6e7d 2073 6e61 7073  lan {plan} snaps
+00015b60: 686f 7474 6564 2122 290a 2020 2020 2020  hotted!").      
+00015b70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00015b80: 2020 2020 7761 726e 696e 6728 224e 6f20      warning("No 
+00015b90: 6d61 7463 6869 6e67 2076 6d73 2066 6f75  matching vms fou
+00015ba0: 6e64 2229 0a20 2020 2020 2020 2072 6574  nd").        ret
+00015bb0: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00015bc0: 7375 6363 6573 7327 7d0a 0a20 2020 2064  success'}..    d
+00015bd0: 6566 2072 6576 6572 745f 706c 616e 2873  ef revert_plan(s
+00015be0: 656c 662c 2070 6c61 6e2c 2073 6e61 7073  elf, plan, snaps
+00015bf0: 686f 746e 616d 653d 4e6f 6e65 293a 0a20  hotname=None):. 
+00015c00: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
+00015c10: 6b0a 2020 2020 2020 2020 7265 7665 7274  k.        revert
+00015c20: 666f 756e 6420 3d20 4661 6c73 650a 2020  found = False.  
+00015c30: 2020 2020 2020 7070 7269 6e74 2866 2252        pprint(f"R
+00015c40: 6576 6572 7469 6e67 2073 6e61 7073 686f  everting snapsho
+00015c50: 7473 206f 6620 766d 7320 6672 6f6d 2070  ts of vms from p
+00015c60: 6c61 6e20 7b70 6c61 6e7d 2229 0a20 2020  lan {plan}").   
+00015c70: 2020 2020 2069 6620 736e 6170 7368 6f74       if snapshot
+00015c80: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
+00015c90: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00015ca0: 6728 6622 5573 696e 6720 7b70 6c61 6e7d  g(f"Using {plan}
+00015cb0: c2a0 6173 2073 6e61 7073 686f 7420 6e61  ..as snapshot na
+00015cc0: 6d65 2061 7320 4e6f 6e65 2077 6173 2070  me as None was p
+00015cd0: 726f 7669 6465 6422 290a 2020 2020 2020  rovided").      
+00015ce0: 2020 2020 2020 736e 6170 7368 6f74 6e61        snapshotna
+00015cf0: 6d65 203d 2070 6c61 6e0a 2020 2020 2020  me = plan.      
+00015d00: 2020 666f 7220 766d 2069 6e20 736f 7274    for vm in sort
+00015d10: 6564 286b 2e6c 6973 7428 292c 206b 6579  ed(k.list(), key
+00015d20: 3d6c 616d 6264 6120 783a 2078 5b27 6e61  =lambda x: x['na
+00015d30: 6d65 275d 293a 0a20 2020 2020 2020 2020  me']):.         
+00015d40: 2020 206e 616d 6520 3d20 766d 5b27 6e61     name = vm['na
+00015d50: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
+00015d60: 2064 6573 6372 6970 7469 6f6e 203d 2076   description = v
+00015d70: 6d5b 2770 6c61 6e27 5d0a 2020 2020 2020  m['plan'].      
+00015d80: 2020 2020 2020 6966 2064 6573 6372 6970        if descrip
+00015d90: 7469 6f6e 203d 3d20 706c 616e 3a0a 2020  tion == plan:.  
+00015da0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00015db0: 7665 7274 666f 756e 6420 3d20 5472 7565  vertfound = True
+00015dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015dd0: 206b 2e72 6576 6572 745f 736e 6170 7368   k.revert_snapsh
+00015de0: 6f74 2873 6e61 7073 686f 746e 616d 652c  ot(snapshotname,
+00015df0: 206e 616d 6529 0a20 2020 2020 2020 2020   name).         
+00015e00: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
+00015e10: 2273 6e61 7073 686f 7420 6f66 207b 6e61  "snapshot of {na
+00015e20: 6d65 7d20 7265 7665 7274 6564 2122 290a  me} reverted!").
+00015e30: 2020 2020 2020 2020 6966 2072 6576 6572          if rever
+00015e40: 7466 6f75 6e64 3a0a 2020 2020 2020 2020  tfound:.        
+00015e50: 2020 2020 7375 6363 6573 7328 6622 506c      success(f"Pl
+00015e60: 616e 207b 706c 616e 7d20 7265 7665 7274  an {plan} revert
+00015e70: 6564 2077 6974 6820 736e 6170 7368 6f74  ed with snapshot
+00015e80: 207b 736e 6170 7368 6f74 6e61 6d65 7d21   {snapshotname}!
+00015e90: 2229 0a20 2020 2020 2020 2065 6c73 653a  ").        else:
+00015ea0: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
+00015eb0: 6e69 6e67 2822 4e6f 206d 6174 6368 696e  ning("No matchin
+00015ec0: 6720 766d 7320 666f 756e 6422 290a 2020  g vms found").  
+00015ed0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+00015ee0: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
+00015ef0: 277d 0a0a 2020 2020 6465 6620 706c 616e  '}..    def plan
+00015f00: 2873 656c 662c 2070 6c61 6e2c 2061 6e73  (self, plan, ans
+00015f10: 6962 6c65 3d46 616c 7365 2c20 7572 6c3d  ible=False, url=
+00015f20: 4e6f 6e65 2c20 7061 7468 3d4e 6f6e 652c  None, path=None,
+00015f30: 2063 6f6e 7461 696e 6572 3d46 616c 7365   container=False
+00015f40: 2c20 696e 7075 7466 696c 653d 4e6f 6e65  , inputfile=None
+00015f50: 2c20 696e 7075 7473 7472 696e 673d 4e6f  , inputstring=No
+00015f60: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+00015f70: 206f 7665 7272 6964 6573 3d7b 7d2c 2069   overrides={}, i
+00015f80: 6e66 6f3d 4661 6c73 652c 2075 7064 6174  nfo=False, updat
+00015f90: 653d 4661 6c73 652c 2065 6d62 6564 6465  e=False, embedde
+00015fa0: 643d 4661 6c73 652c 2064 6f77 6e6c 6f61  d=False, downloa
+00015fb0: 643d 4661 6c73 652c 2071 7569 6574 3d46  d=False, quiet=F
+00015fc0: 616c 7365 2c20 646f 633d 4661 6c73 652c  alse, doc=False,
+00015fd0: 0a20 2020 2020 2020 2020 2020 2020 6f6e  .             on
+00015fe0: 6c79 6173 7365 7473 3d46 616c 7365 2c20  lyassets=False, 
+00015ff0: 7072 653d 5472 7565 2c20 706f 7374 3d54  pre=True, post=T
+00016000: 7275 652c 2065 7863 6c75 6465 766d 733d  rue, excludevms=
+00016010: 5b5d 2c20 6261 7365 6d6f 6465 3d46 616c  [], basemode=Fal
+00016020: 7365 2c20 7468 7265 6164 6564 3d46 616c  se, threaded=Fal
+00016030: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
+00016040: 4d61 6e61 6765 2070 6c61 6e20 6669 6c65  Manage plan file
+00016050: 2222 220a 2020 2020 2020 2020 6b20 3d20  """.        k = 
+00016060: 7365 6c66 2e6b 0a20 2020 2020 2020 206e  self.k.        n
+00016070: 6f5f 6f76 6572 7269 6465 7320 3d20 6e6f  o_overrides = no
+00016080: 7420 6f76 6572 7269 6465 730a 2020 2020  t overrides.    
+00016090: 2020 2020 7468 7265 6164 7320 3d20 5b5d      threads = []
+000160a0: 0a20 2020 2020 2020 206e 6577 766d 7320  .        newvms 
+000160b0: 3d20 5b5d 0a20 2020 2020 2020 206e 6577  = [].        new
+000160c0: 6173 7365 7473 203d 205b 5d0a 2020 2020  assets = [].    
+000160d0: 2020 2020 6661 696c 6564 766d 7320 3d20      failedvms = 
+000160e0: 5b5d 0a20 2020 2020 2020 2065 7869 7374  [].        exist
+000160f0: 696e 6776 6d73 203d 205b 5d0a 2020 2020  ingvms = [].    
+00016100: 2020 2020 6173 796e 6377 6169 7476 6d73      asyncwaitvms
+00016110: 203d 205b 5d0a 2020 2020 2020 2020 6f6e   = [].        on
+00016120: 666c 7920 3d20 4e6f 6e65 0a20 2020 2020  fly = None.     
+00016130: 2020 2074 6f63 6c65 616e 203d 2046 616c     toclean = Fal
+00016140: 7365 0a20 2020 2020 2020 2067 6574 6261  se.        getba
+00016150: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
+00016160: 2020 2076 6d70 726f 6669 6c65 7320 3d20     vmprofiles = 
+00016170: 7b6b 6579 3a20 7661 6c75 6520 666f 7220  {key: value for 
+00016180: 6b65 792c 2076 616c 7565 2069 6e20 7365  key, value in se
+00016190: 6c66 2e70 726f 6669 6c65 732e 6974 656d  lf.profiles.item
+000161a0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+000161b0: 2020 2020 2020 2020 2020 6966 2027 7479            if 'ty
+000161c0: 7065 2720 6e6f 7420 696e 2076 616c 7565  pe' not in value
+000161d0: 206f 7220 7661 6c75 655b 2774 7970 6527   or value['type'
+000161e0: 5d20 3d3d 2027 766d 277d 0a20 2020 2020  ] == 'vm'}.     
+000161f0: 2020 2063 6f6e 7461 696e 6572 7072 6f66     containerprof
+00016200: 696c 6573 203d 207b 6b65 793a 2076 616c  iles = {key: val
+00016210: 7565 2066 6f72 206b 6579 2c20 7661 6c75  ue for key, valu
+00016220: 6520 696e 2073 656c 662e 7072 6f66 696c  e in self.profil
+00016230: 6573 2e69 7465 6d73 2829 0a20 2020 2020  es.items().     
+00016240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016250: 2020 2020 2020 2020 6966 2027 7479 7065          if 'type
+00016260: 2720 696e 2076 616c 7565 2061 6e64 2076  ' in value and v
+00016270: 616c 7565 5b27 7479 7065 275d 203d 3d20  alue['type'] == 
+00016280: 2763 6f6e 7461 696e 6572 277d 0a20 2020  'container'}.   
+00016290: 2020 2020 2069 6620 706c 616e 2069 7320       if plan is 
+000162a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000162b0: 2020 706c 616e 203d 206e 616d 6575 7469    plan = nameuti
+000162c0: 6c73 2e67 6574 5f72 616e 646f 6d5f 6e61  ls.get_random_na
+000162d0: 6d65 2829 0a20 2020 2020 2020 2069 6620  me().        if 
+000162e0: 7572 6c20 6973 206e 6f74 204e 6f6e 653a  url is not None:
+000162f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016300: 7572 6c2e 7374 6172 7473 7769 7468 2827  url.startswith('
+00016310: 2f27 293a 0a20 2020 2020 2020 2020 2020  /'):.           
+00016320: 2020 2020 2075 726c 203d 2066 2266 696c       url = f"fil
+00016330: 653a 2f2f 7b75 726c 7d22 0a20 2020 2020  e://{url}".     
+00016340: 2020 2020 2020 2069 6620 6e6f 7420 7572         if not ur
+00016350: 6c2e 656e 6473 7769 7468 2827 2e79 6d6c  l.endswith('.yml
+00016360: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+00016370: 2020 2020 7572 6c20 3d20 6622 7b75 726c      url = f"{url
+00016380: 7d2f 6b63 6c69 5f70 6c61 6e2e 796d 6c22  }/kcli_plan.yml"
+00016390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000163a0: 2070 7072 696e 7428 6622 5472 7969 6e67   pprint(f"Trying
+000163b0: 2074 6f20 7265 7472 6965 7665 207b 7572   to retrieve {ur
+000163c0: 6c7d 2229 0a20 2020 2020 2020 2020 2020  l}").           
+000163d0: 2069 6e70 7574 6669 6c65 203d 206f 732e   inputfile = os.
+000163e0: 7061 7468 2e62 6173 656e 616d 6528 7572  path.basename(ur
+000163f0: 6c29 0a20 2020 2020 2020 2020 2020 206f  l).            o
+00016400: 6e66 6c79 203d 206f 732e 7061 7468 2e64  nfly = os.path.d
+00016410: 6972 6e61 6d65 2875 726c 290a 2020 2020  irname(url).    
+00016420: 2020 2020 2020 2020 7061 7468 203d 2070          path = p
+00016430: 6c61 6e20 6966 2070 6174 6820 6973 204e  lan if path is N
+00016440: 6f6e 6520 656c 7365 2070 6174 680a 2020  one else path.  
+00016450: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00016460: 2071 7569 6574 3a0a 2020 2020 2020 2020   quiet:.        
+00016470: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00016480: 2252 6574 7269 6576 696e 6720 7370 6563  "Retrieving spec
+00016490: 6966 6965 6420 706c 616e 2066 726f 6d20  ified plan from 
+000164a0: 7b75 726c 7d20 746f 207b 7061 7468 7d22  {url} to {path}"
+000164b0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000164c0: 2063 6f6e 7461 696e 6572 5f6d 6f64 6528   container_mode(
+000164d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000164e0: 2020 2070 6174 6820 3d20 6622 2f77 6f72     path = f"/wor
+000164f0: 6b64 6972 2f7b 7061 7468 7d22 0a20 2020  kdir/{path}".   
+00016500: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00016510: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
+00016520: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
+00016530: 2020 2020 2020 746f 636c 6561 6e20 3d20        toclean = 
+00016540: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00016550: 2020 2020 2063 6f6d 6d6f 6e2e 6665 7463       common.fetc
+00016560: 6828 7572 6c2c 2070 6174 6829 0a20 2020  h(url, path).   
+00016570: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00016580: 2064 6566 6175 6c74 5f70 6172 616d 6574   default_paramet
+00016590: 6572 5f66 696c 6520 696e 205b 272f 6b63  er_file in ['/kc
+000165a0: 6c69 5f64 6566 6175 6c74 2e79 6d6c 272c  li_default.yml',
+000165b0: 2066 272f 7b70 6c61 6e7d 5f64 6566 6175   f'/{plan}_defau
+000165c0: 6c74 2e79 6d6c 272c 0a20 2020 2020 2020  lt.yml',.       
 000165d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000165e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016600: 2020 2020 2020 2020 2020 2020 206f 6e66               onf
-00016610: 6c79 3d6f 6e66 6c79 2c20 6675 6c6c 3d54  ly=onfly, full=T
-00016620: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-00016630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165f0: 2020 2020 2020 2020 222f 2573 5f64 6566          "/%s_def
+00016600: 6175 6c74 2573 2220 2520 6f73 2e70 6174  ault%s" % os.pat
+00016610: 682e 7370 6c69 7465 7874 286f 732e 7061  h.splitext(os.pa
+00016620: 7468 2e62 6173 656e 616d 6528 7572 6c29  th.basename(url)
+00016630: 295d 3a0a 2020 2020 2020 2020 2020 2020  )]:.            
+00016640: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
 00016650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016670: 2020 2020 646f 776e 6c6f 6164 5f6d 6f64      download_mod
-00016680: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00016690: 2020 2020 2020 2020 6f73 2e63 6864 6972          os.chdir
-000166a0: 2870 6174 6829 0a20 2020 2020 2020 2020  (path).         
-000166b0: 2020 2020 2020 2066 6f72 2065 6e74 7279         for entry
-000166c0: 2069 6e20 656e 7472 6965 733a 0a20 2020   in entries:.   
-000166d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000166e0: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
-000166f0: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
-00016700: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
-00016710: 2774 7970 6527 5d20 213d 2027 766d 273a  'type'] != 'vm':
-00016720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016730: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00016740: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00016750: 2020 2020 2020 766d 656e 7472 7920 3d20        vmentry = 
-00016760: 656e 7472 6965 735b 656e 7472 795d 0a20  entries[entry]. 
-00016770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016780: 2020 2076 6d66 696c 6573 203d 2076 6d65     vmfiles = vme
-00016790: 6e74 7279 2e67 6574 2827 6669 6c65 7327  ntry.get('files'
-000167a0: 2c20 5b5d 290a 2020 2020 2020 2020 2020  , []).          
-000167b0: 2020 2020 2020 2020 2020 7363 7269 7074            script
-000167c0: 6669 6c65 7320 3d20 766d 656e 7472 792e  files = vmentry.
-000167d0: 6765 7428 2773 6372 6970 7473 272c 205b  get('scripts', [
-000167e0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-000167f0: 2020 2020 2020 2066 6f72 2066 696c 2069         for fil i
-00016800: 6e20 766d 6669 6c65 733a 0a20 2020 2020  n vmfiles:.     
-00016810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016820: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00016830: 2866 696c 2c20 7374 7229 3a0a 2020 2020  (fil, str):.    
-00016840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016850: 2020 2020 2020 2020 6f72 6967 696e 203d          origin =
-00016860: 2066 696c 0a20 2020 2020 2020 2020 2020   fil.           
-00016870: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00016880: 6620 6973 696e 7374 616e 6365 2866 696c  f isinstance(fil
-00016890: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
+00016660: 2020 2020 2063 6f6d 6d6f 6e2e 6665 7463       common.fetc
+00016670: 6828 6f73 2e70 6174 682e 6469 726e 616d  h(os.path.dirnam
+00016680: 6528 7572 6c29 202b 2064 6566 6175 6c74  e(url) + default
+00016690: 5f70 6172 616d 6574 6572 5f66 696c 652c  _parameter_file,
+000166a0: 2070 6174 6829 0a20 2020 2020 2020 2020   path).         
+000166b0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+000166c0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+000166d0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+000166e0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000166f0: 2064 6f77 6e6c 6f61 643a 0a20 2020 2020   download:.     
+00016700: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
+00016710: 2066 2274 6172 6765 7420 6469 7265 6374   f"target direct
+00016720: 6f72 7920 7b70 6174 687d 2061 6c72 6561  ory {path} alrea
+00016730: 6479 2074 6865 7265 220a 2020 2020 2020  dy there".      
+00016740: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+00016750: 6d73 6729 0a20 2020 2020 2020 2020 2020  msg).           
+00016760: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00016770: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
+00016780: 2c20 2772 6561 736f 6e27 3a20 6d73 677d  , 'reason': msg}
+00016790: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000167a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000167b0: 2020 2070 7072 696e 7428 6622 5573 696e     pprint(f"Usin
+000167c0: 6720 6578 6973 7469 6e67 2064 6972 6563  g existing direc
+000167d0: 746f 7279 207b 7061 7468 7d22 290a 2020  tory {path}").  
+000167e0: 2020 2020 2020 2020 2020 6966 2064 6f77            if dow
+000167f0: 6e6c 6f61 643a 0a20 2020 2020 2020 2020  nload:.         
+00016800: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
+00016810: 203d 2066 227b 7061 7468 7d2f 7b69 6e70   = f"{path}/{inp
+00016820: 7574 6669 6c65 7d22 0a20 2020 2020 2020  utfile}".       
+00016830: 2020 2020 2020 2020 2065 6e74 7269 6573           entries
+00016840: 2c20 6f76 6572 7269 6465 732c 2062 6173  , overrides, bas
+00016850: 6566 696c 652c 2062 6173 6564 6972 203d  efile, basedir =
+00016860: 2073 656c 662e 7072 6f63 6573 735f 696e   self.process_in
+00016870: 7075 7466 696c 6528 706c 616e 2c20 696e  putfile(plan, in
+00016880: 7075 7466 696c 652c 206f 7665 7272 6964  putfile, overrid
+00016890: 6573 3d6f 7665 7272 6964 6573 2c0a 2020  es=overrides,.  
 000168a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168b0: 2020 2020 206f 7269 6769 6e20 3d20 6669       origin = fi
-000168c0: 6c2e 6765 7428 276f 7269 6769 6e27 290a  l.get('origin').
+000168b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000168c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000168d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000168f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016900: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00016910: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-00016920: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-00016930: 2022 496e 636f 7272 6563 7420 6669 6c65   "Incorrect file
-00016940: 2065 6e74 7279 227d 0a20 2020 2020 2020   entry"}.       
-00016950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016960: 2069 6620 277e 2720 6e6f 7420 696e 206f   if '~' not in o
-00016970: 7269 6769 6e3a 0a20 2020 2020 2020 2020  rigin:.         
-00016980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016990: 2020 2064 6573 7464 6972 203d 2022 2e22     destdir = "."
-000169a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000169b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000169c0: 272f 2720 696e 206f 7269 6769 6e3a 0a20  '/' in origin:. 
-000169d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000169e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000169f0: 6573 7464 6972 203d 206f 732e 7061 7468  estdir = os.path
-00016a00: 2e64 6972 6e61 6d65 286f 7269 6769 6e29  .dirname(origin)
-00016a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a30: 206f 732e 6d61 6b65 6469 7273 2864 6573   os.makedirs(des
-00016a40: 7464 6972 2c20 6578 6973 745f 6f6b 3d54  tdir, exist_ok=T
-00016a50: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00016a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a70: 2070 7072 696e 7428 6622 5265 7472 6965   pprint(f"Retrie
-00016a80: 7669 6e67 2066 696c 6520 7b6f 6e66 6c79  ving file {onfly
-00016a90: 7d2f 7b6f 7269 6769 6e7d 2229 0a20 2020  }/{origin}").   
-00016aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ab0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00016ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ad0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00016ae0: 6d6d 6f6e 2e66 6574 6368 2866 227b 6f6e  mmon.fetch(f"{on
-00016af0: 666c 797d 2f7b 6f72 6967 696e 7d22 2c20  fly}/{origin}", 
-00016b00: 6465 7374 6469 7229 0a20 2020 2020 2020  destdir).       
-00016b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b20: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-00016b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00016b50: 636f 6d6d 6f6e 2e75 726c 5f65 7869 7374  common.url_exist
-00016b60: 7328 6622 7b6f 6e66 6c79 7d2f 7b6f 7269  s(f"{onfly}/{ori
-00016b70: 6769 6e7d 2f52 4541 444d 452e 6d64 2229  gin}/README.md")
-00016b80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ba0: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
-00016bb0: 7328 6f72 6967 696e 2c20 6578 6973 745f  s(origin, exist_
-00016bc0: 6f6b 3d54 7275 6529 0a20 2020 2020 2020  ok=True).       
+000168e0: 2020 2020 2020 2020 2020 2020 206f 6e66               onf
+000168f0: 6c79 3d6f 6e66 6c79 2c20 6675 6c6c 3d54  ly=onfly, full=T
+00016900: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+00016910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016950: 2020 2020 646f 776e 6c6f 6164 5f6d 6f64      download_mod
+00016960: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+00016970: 2020 2020 2020 2020 6f73 2e63 6864 6972          os.chdir
+00016980: 2870 6174 6829 0a20 2020 2020 2020 2020  (path).         
+00016990: 2020 2020 2020 2066 6f72 2065 6e74 7279         for entry
+000169a0: 2069 6e20 656e 7472 6965 733a 0a20 2020   in entries:.   
+000169b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169c0: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
+000169d0: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
+000169e0: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
+000169f0: 2774 7970 6527 5d20 213d 2027 766d 273a  'type'] != 'vm':
+00016a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016a10: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00016a20: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00016a30: 2020 2020 2020 766d 656e 7472 7920 3d20        vmentry = 
+00016a40: 656e 7472 6965 735b 656e 7472 795d 0a20  entries[entry]. 
+00016a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a60: 2020 2076 6d66 696c 6573 203d 2076 6d65     vmfiles = vme
+00016a70: 6e74 7279 2e67 6574 2827 6669 6c65 7327  ntry.get('files'
+00016a80: 2c20 5b5d 290a 2020 2020 2020 2020 2020  , []).          
+00016a90: 2020 2020 2020 2020 2020 7363 7269 7074            script
+00016aa0: 6669 6c65 7320 3d20 766d 656e 7472 792e  files = vmentry.
+00016ab0: 6765 7428 2773 6372 6970 7473 272c 205b  get('scripts', [
+00016ac0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00016ad0: 2020 2020 2020 2066 6f72 2066 696c 2069         for fil i
+00016ae0: 6e20 766d 6669 6c65 733a 0a20 2020 2020  n vmfiles:.     
+00016af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b00: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00016b10: 2866 696c 2c20 7374 7229 3a0a 2020 2020  (fil, str):.    
+00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b30: 2020 2020 2020 2020 6f72 6967 696e 203d          origin =
+00016b40: 2066 696c 0a20 2020 2020 2020 2020 2020   fil.           
+00016b50: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+00016b60: 6620 6973 696e 7374 616e 6365 2866 696c  f isinstance(fil
+00016b70: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
+00016b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b90: 2020 2020 206f 7269 6769 6e20 3d20 6669       origin = fi
+00016ba0: 6c2e 6765 7428 276f 7269 6769 6e27 290a  l.get('origin').
+00016bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bc0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
 00016bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016be0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00016bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c10: 2020 2070 7072 696e 7428 6622 6669 6c65     pprint(f"file
-00016c20: 207b 6f6e 666c 797d 2f7b 6f72 6967 696e   {onfly}/{origin
-00016c30: 7d20 736b 6970 7065 6422 290a 2020 2020  } skipped").    
-00016c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c50: 666f 7220 7363 7269 7074 2069 6e20 7363  for script in sc
-00016c60: 7269 7074 6669 6c65 733a 0a20 2020 2020  riptfiles:.     
-00016c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c80: 2020 2069 6620 277e 2720 6e6f 7420 696e     if '~' not in
-00016c90: 2073 6372 6970 743a 0a20 2020 2020 2020   script:.       
-00016ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cb0: 2020 2020 2064 6573 7464 6972 203d 2022       destdir = "
-00016cc0: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
-00016cd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00016ce0: 6620 272f 2720 696e 2073 6372 6970 743a  f '/' in script:
+00016be0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00016bf0: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
+00016c00: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
+00016c10: 2022 496e 636f 7272 6563 7420 6669 6c65   "Incorrect file
+00016c20: 2065 6e74 7279 227d 0a20 2020 2020 2020   entry"}.       
+00016c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c40: 2069 6620 277e 2720 6e6f 7420 696e 206f   if '~' not in o
+00016c50: 7269 6769 6e3a 0a20 2020 2020 2020 2020  rigin:.         
+00016c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c70: 2020 2064 6573 7464 6972 203d 2022 2e22     destdir = "."
+00016c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016c90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016ca0: 272f 2720 696e 206f 7269 6769 6e3a 0a20  '/' in origin:. 
+00016cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cc0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00016cd0: 6573 7464 6972 203d 206f 732e 7061 7468  estdir = os.path
+00016ce0: 2e64 6972 6e61 6d65 286f 7269 6769 6e29  .dirname(origin)
 00016cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00016d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d10: 2064 6573 7464 6972 203d 206f 732e 7061   destdir = os.pa
-00016d20: 7468 2e64 6972 6e61 6d65 2873 6372 6970  th.dirname(scrip
-00016d30: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00016d10: 206f 732e 6d61 6b65 6469 7273 2864 6573   os.makedirs(des
+00016d20: 7464 6972 2c20 6578 6973 745f 6f6b 3d54  tdir, exist_ok=T
+00016d30: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
 00016d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d50: 2020 206f 732e 6d61 6b65 6469 7273 2864     os.makedirs(d
-00016d60: 6573 7464 6972 2c20 6578 6973 745f 6f6b  estdir, exist_ok
-00016d70: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00016d50: 2070 7072 696e 7428 6622 5265 7472 6965   pprint(f"Retrie
+00016d60: 7669 6e67 2066 696c 6520 7b6f 6e66 6c79  ving file {onfly
+00016d70: 7d2f 7b6f 7269 6769 6e7d 2229 0a20 2020  }/{origin}").   
 00016d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d90: 2020 2070 7072 696e 7428 6622 5265 7472     pprint(f"Retr
-00016da0: 6965 7669 6e67 2073 6372 6970 7420 7b6f  ieving script {o
-00016db0: 6e66 6c79 7d2f 7b73 6372 6970 747d 2229  nfly}/{script}")
-00016dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016dd0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00016de0: 6d6f 6e2e 6665 7463 6828 6622 7b6f 6e66  mon.fetch(f"{onf
-00016df0: 6c79 7d2f 7b73 6372 6970 747d 222c 2064  ly}/{script}", d
-00016e00: 6573 7464 6972 290a 2020 2020 2020 2020  estdir).        
-00016e10: 2020 2020 2020 2020 6f73 2e63 6864 6972          os.chdir
-00016e20: 2827 2e2e 2729 0a20 2020 2020 2020 2020  ('..').         
-00016e30: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-00016e40: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-00016e50: 7327 7d0a 2020 2020 2020 2020 6966 2069  s'}.        if i
-00016e60: 6e70 7574 7374 7269 6e67 2069 7320 6e6f  nputstring is no
-00016e70: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00016e80: 2020 2020 696e 7075 7466 696c 6520 3d20      inputfile = 
-00016e90: 6622 7465 6d70 5f70 6c61 6e5f 7b70 6c61  f"temp_plan_{pla
-00016ea0: 6e7d 2e79 6d6c 220a 2020 2020 2020 2020  n}.yml".        
-00016eb0: 2020 2020 7769 7468 206f 7065 6e28 696e      with open(in
-00016ec0: 7075 7466 696c 652c 2022 7722 2920 6173  putfile, "w") as
-00016ed0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-00016ee0: 2020 2020 662e 7772 6974 6528 696e 7075      f.write(inpu
-00016ef0: 7473 7472 696e 6729 0a20 2020 2020 2020  tstring).       
-00016f00: 2069 6620 696e 7075 7466 696c 6520 6973   if inputfile is
-00016f10: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00016f20: 2020 2069 6e70 7574 6669 6c65 203d 2027     inputfile = '
-00016f30: 6b63 6c69 5f70 6c61 6e2e 796d 6c27 0a20  kcli_plan.yml'. 
-00016f40: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00016f50: 7428 2275 7369 6e67 2064 6566 6175 6c74  t("using default
-00016f60: 2069 6e70 7574 2066 696c 6520 6b63 6c69   input file kcli
-00016f70: 5f70 6c61 6e2e 796d 6c22 290a 2020 2020  _plan.yml").    
-00016f80: 2020 2020 6966 2070 6174 6820 6973 206e      if path is n
-00016f90: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00016fa0: 2020 2020 206f 732e 6368 6469 7228 7061       os.chdir(pa
-00016fb0: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
-00016fc0: 6765 7462 6163 6b20 3d20 5472 7565 0a20  getback = True. 
-00016fd0: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
-00016fe0: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
-00016ff0: 6475 7365 7228 696e 7075 7466 696c 6529  duser(inputfile)
-00017000: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00017010: 6f73 2e70 6174 682e 6578 6973 7473 2869  os.path.exists(i
-00017020: 6e70 7574 6669 6c65 293a 0a20 2020 2020  nputfile):.     
-00017030: 2020 2020 2020 2065 7272 6f72 2866 2249         error(f"I
-00017040: 6e70 7574 2066 696c 6520 7b69 6e70 7574  nput file {input
-00017050: 6669 6c65 7d20 6e6f 7420 666f 756e 642e  file} not found.
-00017060: 4c65 6176 696e 672e 2e2e 2e22 290a 2020  Leaving....").  
-00017070: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-00017080: 6974 2831 290a 2020 2020 2020 2020 656c  it(1).        el
-00017090: 6966 206f 732e 7061 7468 2e69 7364 6972  if os.path.isdir
-000170a0: 2869 6e70 7574 6669 6c65 293a 0a20 2020  (inputfile):.   
-000170b0: 2020 2020 2020 2020 2069 6e70 7574 6669           inputfi
-000170c0: 6c65 203d 2066 227b 696e 7075 7466 696c  le = f"{inputfil
-000170d0: 657d 2f6b 636c 695f 706c 616e 2e79 6d6c  e}/kcli_plan.yml
-000170e0: 220a 2020 2020 2020 2020 6966 2069 6e66  ".        if inf
-000170f0: 6f3a 0a20 2020 2020 2020 2020 2020 2073  o:.            s
-00017100: 656c 662e 696e 666f 5f70 6c61 6e28 696e  elf.info_plan(in
-00017110: 7075 7466 696c 652c 206f 6e66 6c79 3d6f  putfile, onfly=o
-00017120: 6e66 6c79 2c20 7175 6965 743d 7175 6965  nfly, quiet=quie
-00017130: 742c 2064 6f63 3d64 6f63 290a 2020 2020  t, doc=doc).    
-00017140: 2020 2020 2020 2020 6966 2074 6f63 6c65          if tocle
-00017150: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
-00017160: 2020 2020 6f73 2e63 6864 6972 2827 2e2e      os.chdir('..
-00017170: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00017180: 2020 2072 6d74 7265 6528 7061 7468 290a     rmtree(path).
-00017190: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000171a0: 726e 207b 2772 6573 756c 7427 3a20 2773  rn {'result': 's
-000171b0: 7563 6365 7373 277d 0a20 2020 2020 2020  uccess'}.       
-000171c0: 2062 6173 6565 6e74 7269 6573 203d 207b   baseentries = {
-000171d0: 7d0a 2020 2020 2020 2020 656e 7472 6965  }.        entrie
-000171e0: 732c 206f 7665 7272 6964 6573 2c20 6261  s, overrides, ba
-000171f0: 7365 6669 6c65 2c20 6261 7365 6469 7220  sefile, basedir 
-00017200: 3d20 7365 6c66 2e70 726f 6365 7373 5f69  = self.process_i
-00017210: 6e70 7574 6669 6c65 2870 6c61 6e2c 2069  nputfile(plan, i
-00017220: 6e70 7574 6669 6c65 2c20 6f76 6572 7269  nputfile, overri
-00017230: 6465 733d 6f76 6572 7269 6465 732c 0a20  des=overrides,. 
-00017240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017280: 2020 2020 2020 6f6e 666c 793d 6f6e 666c        onfly=onfl
-00017290: 792c 2066 756c 6c3d 5472 7565 290a 2020  y, full=True).  
-000172a0: 2020 2020 2020 6966 2062 6173 6566 696c        if basefil
-000172b0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-000172c0: 2020 2020 2020 2020 2020 2062 6173 6569             basei
-000172d0: 6e66 6f20 3d20 7365 6c66 2e70 726f 6365  nfo = self.proce
-000172e0: 7373 5f69 6e70 7574 6669 6c65 2870 6c61  ss_inputfile(pla
-000172f0: 6e2c 2066 227b 6261 7365 6469 727d 2f7b  n, f"{basedir}/{
-00017300: 6261 7365 6669 6c65 7d22 2c20 6f76 6572  basefile}", over
-00017310: 7269 6465 733d 6f76 6572 7269 6465 732c  rides=overrides,
-00017320: 2066 756c 6c3d 5472 7565 290a 2020 2020   full=True).    
-00017330: 2020 2020 2020 2020 6261 7365 656e 7472          baseentr
-00017340: 6965 732c 2062 6173 656f 7665 7272 6964  ies, baseoverrid
-00017350: 6573 203d 2062 6173 6569 6e66 6f5b 305d  es = baseinfo[0]
-00017360: 2c20 6261 7365 696e 666f 5b31 5d0a 2020  , baseinfo[1].  
-00017370: 2020 2020 2020 2020 2020 6966 2062 6173            if bas
-00017380: 656f 7665 7272 6964 6573 3a0a 2020 2020  eoverrides:.    
-00017390: 2020 2020 2020 2020 2020 2020 6f76 6572              over
-000173a0: 7269 6465 732e 7570 6461 7465 287b 6b65  rides.update({ke
-000173b0: 793a 2062 6173 656f 7665 7272 6964 6573  y: baseoverrides
-000173c0: 5b6b 6579 5d20 666f 7220 6b65 7920 696e  [key] for key in
-000173d0: 2062 6173 656f 7665 7272 6964 6573 2069   baseoverrides i
-000173e0: 6620 6b65 7920 6e6f 7420 696e 206f 7665  f key not in ove
-000173f0: 7272 6964 6573 7d29 0a20 2020 2020 2020  rrides}).       
-00017400: 2069 6620 656e 7472 6965 7320 6973 204e   if entries is N
-00017410: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00017420: 2065 6e74 7269 6573 203d 207b 7d0a 2020   entries = {}.  
-00017430: 2020 2020 2020 6966 2073 656c 662e 6465        if self.de
-00017440: 6275 673a 0a20 2020 2020 2020 2020 2020  bug:.           
-00017450: 2070 7269 6e74 2879 616d 6c2e 6475 6d70   print(yaml.dump
-00017460: 2865 6e74 7269 6573 2929 0a20 2020 2020  (entries)).     
-00017470: 2020 2070 6172 616d 6574 6572 7320 3d20     parameters = 
-00017480: 656e 7472 6965 732e 6765 7428 2770 6172  entries.get('par
-00017490: 616d 6574 6572 7327 290a 2020 2020 2020  ameters').      
-000174a0: 2020 6966 2070 6172 616d 6574 6572 7320    if parameters 
-000174b0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000174c0: 2020 2020 2020 2020 2064 656c 2065 6e74           del ent
-000174d0: 7269 6573 5b27 7061 7261 6d65 7465 7273  ries['parameters
-000174e0: 275d 0a20 2020 2020 2020 2064 6963 745f  '].        dict_
-000174f0: 7479 7065 7320 3d20 5b65 6e74 7279 2066  types = [entry f
-00017500: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
-00017510: 6965 7320 6966 2069 7369 6e73 7461 6e63  ies if isinstanc
-00017520: 6528 656e 7472 6965 735b 656e 7472 795d  e(entries[entry]
-00017530: 2c20 6469 6374 295d 0a20 2020 2020 2020  , dict)].       
-00017540: 2069 6620 6e6f 7420 6469 6374 5f74 7970   if not dict_typ
-00017550: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00017560: 6966 2062 6173 656d 6f64 653a 0a20 2020  if basemode:.   
-00017570: 2020 2020 2020 2020 2020 2020 2077 6172               war
-00017580: 6e69 6e67 2866 227b 696e 7075 7466 696c  ning(f"{inputfil
-00017590: 657d 2064 6f65 736e 2774 206c 6f6f 6b20  e} doesn't look 
-000175a0: 6c69 6b65 2061 2076 616c 6964 2070 6c61  like a valid pla
-000175b0: 6e2e 536b 6970 7069 6e67 2e2e 2e2e 2229  n.Skipping....")
-000175c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000175d0: 2072 6574 7572 6e20 7b22 7265 7375 6c74   return {"result
-000175e0: 223a 2022 7375 6363 6573 7322 7d0a 2020  ": "success"}.  
-000175f0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00017600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017610: 6d73 6720 3d20 6622 7b69 6e70 7574 6669  msg = f"{inputfi
-00017620: 6c65 7d20 646f 6573 6e27 7420 6c6f 6f6b  le} doesn't look
-00017630: 206c 696b 6520 6120 7661 6c69 6420 706c   like a valid pl
-00017640: 616e 2066 696c 652e 204d 6179 6265 2079  an file. Maybe y
-00017650: 6f75 2070 726f 7669 6465 6420 6120 7061  ou provided a pa
-00017660: 7261 6d65 7465 7220 6669 6c65 203f 220a  rameter file ?".
-00017670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017680: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-00017690: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
-000176a0: 6173 6f6e 273a 206d 7367 7d0a 2020 2020  ason': msg}.    
-000176b0: 2020 2020 696e 7075 7464 6972 203d 206f      inputdir = o
-000176c0: 732e 7061 7468 2e64 6972 6e61 6d65 2869  s.path.dirname(i
-000176d0: 6e70 7574 6669 6c65 2920 6966 206f 732e  nputfile) if os.
-000176e0: 7061 7468 2e64 6972 6e61 6d65 2869 6e70  path.dirname(inp
-000176f0: 7574 6669 6c65 2920 213d 2027 2720 616e  utfile) != '' an
-00017700: 6420 6f73 2e70 6174 682e 6973 6162 7328  d os.path.isabs(
-00017710: 696e 7075 7466 696c 6529 2065 6c73 6520  inputfile) else 
-00017720: 272e 270a 2020 2020 2020 2020 7072 655f  '.'.        pre_
-00017730: 6261 7365 203d 206f 732e 7061 7468 2e73  base = os.path.s
-00017740: 706c 6974 6578 7428 6f73 2e70 6174 682e  plitext(os.path.
-00017750: 6261 7365 6e61 6d65 2869 6e70 7574 6669  basename(inputfi
-00017760: 6c65 2929 5b30 5d0a 2020 2020 2020 2020  le))[0].        
-00017770: 7072 655f 7363 7269 7074 203d 2066 277b  pre_script = f'{
-00017780: 696e 7075 7464 6972 7d2f 6b63 6c69 5f70  inputdir}/kcli_p
-00017790: 7265 2e73 6827 2069 6620 7072 655f 6261  re.sh' if pre_ba
-000177a0: 7365 203d 3d20 276b 636c 695f 706c 616e  se == 'kcli_plan
-000177b0: 2720 656c 7365 2066 227b 696e 7075 7464  ' else f"{inputd
-000177c0: 6972 7d2f 7b70 7265 5f62 6173 657d 5f70  ir}/{pre_base}_p
-000177d0: 7265 2e73 6822 0a20 2020 2020 2020 2069  re.sh".        i
-000177e0: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-000177f0: 2870 7265 5f73 6372 6970 7429 3a0a 2020  (pre_script):.  
-00017800: 2020 2020 2020 2020 2020 7072 655f 7363            pre_sc
-00017810: 7269 7074 5f73 686f 7274 203d 206f 732e  ript_short = os.
-00017820: 7061 7468 2e62 6173 656e 616d 6528 7072  path.basename(pr
-00017830: 655f 7363 7269 7074 290a 2020 2020 2020  e_script).      
-00017840: 2020 2020 2020 6966 2070 7265 3a0a 2020        if pre:.  
-00017850: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-00017860: 7269 6e74 2866 2252 756e 6e69 6e67 207b  rint(f"Running {
-00017870: 7072 655f 7363 7269 7074 5f73 686f 7274  pre_script_short
-00017880: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00017890: 2020 2020 7769 7468 2054 656d 706f 7261      with Tempora
-000178a0: 7279 4469 7265 6374 6f72 7928 2920 6173  ryDirectory() as
-000178b0: 2074 6d70 6469 723a 0a20 2020 2020 2020   tmpdir:.       
-000178c0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-000178d0: 5f73 6372 6970 7420 3d20 7365 6c66 2e70  _script = self.p
-000178e0: 726f 6365 7373 5f69 6e70 7574 6669 6c65  rocess_inputfile
-000178f0: 2827 7878 7827 2c20 7072 655f 7363 7269  ('xxx', pre_scri
-00017900: 7074 2c20 6f76 6572 7269 6465 733d 6f76  pt, overrides=ov
-00017910: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
-00017920: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-00017930: 6820 6f70 656e 2866 227b 746d 7064 6972  h open(f"{tmpdir
-00017940: 7d2f 7072 652e 7368 222c 2027 7727 2920  }/pre.sh", 'w') 
-00017950: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-00017960: 2020 2020 2020 2020 2020 2020 2020 662e                f.
-00017970: 7772 6974 6528 7072 655f 7363 7269 7074  write(pre_script
-00017980: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017990: 2020 2020 2020 7072 655f 7275 6e20 3d20        pre_run = 
-000179a0: 7275 6e28 6627 6261 7368 207b 746d 7064  run(f'bash {tmpd
-000179b0: 6972 7d2f 7072 652e 7368 272c 2073 6865  ir}/pre.sh', she
-000179c0: 6c6c 3d54 7275 652c 2073 7464 6f75 743d  ll=True, stdout=
-000179d0: 5049 5045 2c20 7374 6465 7272 3d53 5444  PIPE, stderr=STD
-000179e0: 4f55 542c 0a20 2020 2020 2020 2020 2020  OUT,.           
-000179f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a00: 2020 2020 2020 2075 6e69 7665 7273 616c         universal
-00017a10: 5f6e 6577 6c69 6e65 733d 5472 7565 290a  _newlines=True).
-00017a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a30: 2020 2020 6966 2070 7265 5f72 756e 2e72      if pre_run.r
-00017a40: 6574 7572 6e63 6f64 6520 213d 2030 3a0a  eturncode != 0:.
-00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a60: 2020 2020 2020 2020 6d73 6720 3d20 6622          msg = f"
-00017a70: 4973 7375 6520 7768 656e 2072 756e 6e69  Issue when runni
-00017a80: 6e67 207b 7072 655f 7363 7269 7074 5f73  ng {pre_script_s
-00017a90: 686f 7274 7d20 3a5c 6e7b 7072 655f 7275  hort} :\n{pre_ru
-00017aa0: 6e2e 7374 646f 7574 7d22 0a20 2020 2020  n.stdout}".     
-00017ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ac0: 2020 2065 7272 6f72 286d 7367 290a 2020     error(msg).  
-00017ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ae0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-00017af0: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
-00017b00: 272c 2027 7265 6173 6f6e 273a 206d 7367  ', 'reason': msg
-00017b10: 7d0a 2020 2020 2020 2020 2020 2020 656c  }.            el
-00017b20: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00017b30: 2020 2020 7761 726e 696e 6728 6622 536b      warning(f"Sk
-00017b40: 6970 7069 6e67 207b 7072 655f 7363 7269  ipping {pre_scri
-00017b50: 7074 5f73 686f 7274 7d20 6173 2072 6571  pt_short} as req
-00017b60: 7565 7374 6564 2229 0a20 2020 2020 2020  uested").       
-00017b70: 206b 6579 776f 7264 7320 3d20 7365 6c66   keywords = self
-00017b80: 2e6c 6973 745f 6b65 7977 6f72 6473 2829  .list_keywords()
-00017b90: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
-00017ba0: 2069 6e20 736f 7274 6564 286f 7665 7272   in sorted(overr
-00017bb0: 6964 6573 293a 0a20 2020 2020 2020 2020  ides):.         
-00017bc0: 2020 2069 6620 6b65 7920 696e 206b 6579     if key in key
-00017bd0: 776f 7264 733a 0a20 2020 2020 2020 2020  words:.         
-00017be0: 2020 2020 2020 206b 6579 5f76 616c 7565         key_value
-00017bf0: 203d 2067 6574 6174 7472 2873 656c 662c   = getattr(self,
-00017c00: 206b 6579 290a 2020 2020 2020 2020 2020   key).          
-00017c10: 2020 2020 2020 6b65 795f 7479 7065 203d        key_type =
-00017c20: 2074 7970 6528 6b65 795f 7661 6c75 6529   type(key_value)
-00017c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017c40: 206f 7665 7272 6964 655f 6b65 795f 7479   override_key_ty
-00017c50: 7065 203d 2074 7970 6528 6f76 6572 7269  pe = type(overri
-00017c60: 6465 735b 6b65 795d 290a 2020 2020 2020  des[key]).      
-00017c70: 2020 2020 2020 2020 2020 6966 206b 6579            if key
-00017c80: 5f76 616c 7565 2069 7320 6e6f 7420 4e6f  _value is not No
-00017c90: 6e65 2061 6e64 206f 7665 7272 6964 6573  ne and overrides
-00017ca0: 5b6b 6579 5d20 6973 206e 6f74 204e 6f6e  [key] is not Non
-00017cb0: 6520 616e 6420 6b65 795f 7479 7065 2021  e and key_type !
-00017cc0: 3d20 6f76 6572 7269 6465 5f6b 6579 5f74  = override_key_t
-00017cd0: 7970 653a 0a20 2020 2020 2020 2020 2020  ype:.           
-00017ce0: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
-00017cf0: 2254 6865 2070 726f 7669 6465 6420 7061  "The provided pa
-00017d00: 7261 6d65 7465 7220 7b6b 6579 7d20 6861  rameter {key} ha
-00017d10: 7320 6120 7772 6f6e 6720 7479 7065 207b  s a wrong type {
-00017d20: 6f76 6572 7269 6465 5f6b 6579 5f74 7970  override_key_typ
-00017d30: 657d 2c20 6974 2073 686f 756c 6420 6265  e}, it should be
-00017d40: 207b 6b65 795f 7479 7065 7d22 290a 2020   {key_type}").  
-00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d60: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
-00017d70: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00017d80: 6966 206f 7665 7272 6964 6573 5b6b 6579  if overrides[key
-00017d90: 5d20 6973 206e 6f74 204e 6f6e 653a 0a20  ] is not None:. 
-00017da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017db0: 2020 2073 6574 6174 7472 2873 656c 662c     setattr(self,
-00017dc0: 206b 6579 2c20 6f76 6572 7269 6465 735b   key, overrides[
-00017dd0: 6b65 795d 290a 2020 2020 2020 2020 766d  key]).        vm
-00017de0: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
-00017df0: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
-00017e00: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
-00017e10: 6e6f 7420 696e 2065 6e74 7269 6573 5b65  not in entries[e
-00017e20: 6e74 7279 5d20 6f72 2065 6e74 7269 6573  ntry] or entries
-00017e30: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
-00017e40: 3d3d 2027 766d 275d 0a20 2020 2020 2020  == 'vm'].       
-00017e50: 2064 6973 6b65 6e74 7269 6573 203d 205b   diskentries = [
-00017e60: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
-00017e70: 696e 2065 6e74 7269 6573 2069 6620 2774  in entries if 't
-00017e80: 7970 6527 2069 6e20 656e 7472 6965 735b  ype' in entries[
-00017e90: 656e 7472 795d 2061 6e64 2065 6e74 7269  entry] and entri
-00017ea0: 6573 5b65 6e74 7279 5d5b 2774 7970 6527  es[entry]['type'
-00017eb0: 5d20 3d3d 2027 6469 736b 275d 0a20 2020  ] == 'disk'].   
-00017ec0: 2020 2020 206e 6574 776f 726b 656e 7472       networkentr
-00017ed0: 6965 7320 3d20 5b65 6e74 7279 2066 6f72  ies = [entry for
-00017ee0: 2065 6e74 7279 2069 6e20 656e 7472 6965   entry in entrie
-00017ef0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00017f00: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00017f10: 7479 7065 2720 696e 2065 6e74 7269 6573  type' in entries
-00017f20: 5b65 6e74 7279 5d20 616e 6420 656e 7472  [entry] and entr
-00017f30: 6965 735b 656e 7472 795d 5b27 7479 7065  ies[entry]['type
-00017f40: 275d 203d 3d20 276e 6574 776f 726b 275d  '] == 'network']
-00017f50: 0a20 2020 2020 2020 2063 6f6e 7461 696e  .        contain
-00017f60: 6572 656e 7472 6965 7320 3d20 5b65 6e74  erentries = [ent
-00017f70: 7279 2066 6f72 2065 6e74 7279 2069 6e20  ry for entry in 
-00017f80: 656e 7472 6965 730a 2020 2020 2020 2020  entries.        
-00017f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fa0: 2020 2020 6966 2027 7479 7065 2720 696e      if 'type' in
-00017fb0: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
-00017fc0: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
-00017fd0: 795d 5b27 7479 7065 275d 203d 3d20 2763  y]['type'] == 'c
-00017fe0: 6f6e 7461 696e 6572 275d 0a20 2020 2020  ontainer'].     
-00017ff0: 2020 2061 6e73 6962 6c65 656e 7472 6965     ansibleentrie
-00018000: 7320 3d20 5b65 6e74 7279 2066 6f72 2065  s = [entry for e
-00018010: 6e74 7279 2069 6e20 656e 7472 6965 730a  ntry in entries.
-00018020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018030: 2020 2020 2020 2020 2020 6966 2027 7479            if 'ty
-00018040: 7065 2720 696e 2065 6e74 7269 6573 5b65  pe' in entries[e
-00018050: 6e74 7279 5d20 616e 6420 656e 7472 6965  ntry] and entrie
-00018060: 735b 656e 7472 795d 5b27 7479 7065 275d  s[entry]['type']
-00018070: 203d 3d20 2761 6e73 6962 6c65 275d 0a20   == 'ansible']. 
-00018080: 2020 2020 2020 2070 726f 6669 6c65 656e         profileen
-00018090: 7472 6965 7320 3d20 5b65 6e74 7279 2066  tries = [entry f
-000180a0: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
-000180b0: 6965 730a 2020 2020 2020 2020 2020 2020  ies.            
-000180c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000180d0: 2027 7479 7065 2720 696e 2065 6e74 7269   'type' in entri
-000180e0: 6573 5b65 6e74 7279 5d20 616e 6420 656e  es[entry] and en
-000180f0: 7472 6965 735b 656e 7472 795d 5b27 7479  tries[entry]['ty
-00018100: 7065 275d 203d 3d20 2770 726f 6669 6c65  pe'] == 'profile
-00018110: 275d 0a20 2020 2020 2020 2069 6d61 6765  '].        image
-00018120: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
-00018130: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
-00018140: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
-00018150: 696e 0a20 2020 2020 2020 2020 2020 2020  in.             
-00018160: 2020 2020 2020 2020 2020 2065 6e74 7269             entri
-00018170: 6573 5b65 6e74 7279 5d20 616e 6420 2865  es[entry] and (e
-00018180: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
-00018190: 7970 6527 5d20 3d3d 2027 696d 6167 6527  ype'] == 'image'
-000181a0: 206f 7220 656e 7472 6965 735b 656e 7472   or entries[entr
-000181b0: 795d 5b27 7479 7065 275d 203d 3d20 2774  y]['type'] == 't
-000181c0: 656d 706c 6174 6527 295d 0a20 2020 2020  emplate')].     
-000181d0: 2020 2070 6f6f 6c65 6e74 7269 6573 203d     poolentries =
-000181e0: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
-000181f0: 7920 696e 2065 6e74 7269 6573 2069 6620  y in entries if 
-00018200: 2774 7970 6527 2069 6e20 656e 7472 6965  'type' in entrie
-00018210: 735b 656e 7472 795d 2061 6e64 2065 6e74  s[entry] and ent
-00018220: 7269 6573 5b65 6e74 7279 5d5b 2774 7970  ries[entry]['typ
-00018230: 6527 5d20 3d3d 2027 706f 6f6c 275d 0a20  e'] == 'pool']. 
-00018240: 2020 2020 2020 2070 6c61 6e65 6e74 7269         planentri
-00018250: 6573 203d 205b 656e 7472 7920 666f 7220  es = [entry for 
-00018260: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
-00018270: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
-00018280: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
-00018290: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
-000182a0: 2774 7970 6527 5d20 3d3d 2027 706c 616e  'type'] == 'plan
-000182b0: 275d 0a20 2020 2020 2020 2064 6e73 656e  '].        dnsen
-000182c0: 7472 6965 7320 3d20 5b65 6e74 7279 2066  tries = [entry f
-000182d0: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
-000182e0: 6965 7320 6966 2027 7479 7065 2720 696e  ies if 'type' in
-000182f0: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
-00018300: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
-00018310: 795d 5b27 7479 7065 275d 203d 3d20 2764  y]['type'] == 'd
-00018320: 6e73 275d 0a20 2020 2020 2020 206b 7562  ns'].        kub
-00018330: 6573 203d 205b 276b 7562 6527 2c20 2763  es = ['kube', 'c
-00018340: 6c75 7374 6572 275d 0a20 2020 2020 2020  luster'].       
-00018350: 206b 7562 6565 6e74 7269 6573 203d 205b   kubeentries = [
-00018360: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
-00018370: 696e 2065 6e74 7269 6573 2069 6620 2774  in entries if 't
-00018380: 7970 6527 2069 6e20 656e 7472 6965 735b  ype' in entries[
-00018390: 656e 7472 795d 2061 6e64 2065 6e74 7269  entry] and entri
-000183a0: 6573 5b65 6e74 7279 5d5b 2774 7970 6527  es[entry]['type'
-000183b0: 5d20 696e 206b 7562 6573 5d0a 2020 2020  ] in kubes].    
-000183c0: 2020 2020 6c62 7320 3d20 5b65 6e74 7279      lbs = [entry
-000183d0: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
-000183e0: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
-000183f0: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
-00018400: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
-00018410: 7472 795d 5b27 7479 7065 275d 203d 3d20  try]['type'] == 
-00018420: 276c 6f61 6462 616c 616e 6365 7227 5d0a  'loadbalancer'].
-00018430: 2020 2020 2020 2020 7367 7320 3d20 5b65          sgs = [e
-00018440: 6e74 7279 2066 6f72 2065 6e74 7279 2069  ntry for entry i
-00018450: 6e20 656e 7472 6965 7320 6966 2027 7479  n entries if 'ty
-00018460: 7065 2720 696e 2065 6e74 7269 6573 5b65  pe' in entries[e
-00018470: 6e74 7279 5d20 616e 6420 656e 7472 6965  ntry] and entrie
-00018480: 735b 656e 7472 795d 5b27 7479 7065 275d  s[entry]['type']
-00018490: 203d 3d20 2773 6563 7572 6974 7967 726f   == 'securitygro
-000184a0: 7570 275d 0a20 2020 2020 2020 2062 7563  up'].        buc
-000184b0: 6b65 7465 6e74 7269 6573 203d 205b 656e  ketentries = [en
-000184c0: 7472 7920 666f 7220 656e 7472 7920 696e  try for entry in
-000184d0: 2065 6e74 7269 6573 2069 6620 2774 7970   entries if 'typ
-000184e0: 6527 2069 6e20 656e 7472 6965 735b 656e  e' in entries[en
-000184f0: 7472 795d 2061 6e64 2065 6e74 7269 6573  try] and entries
-00018500: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
-00018510: 3d3d 2027 6275 636b 6574 275d 0a20 2020  == 'bucket'].   
-00018520: 2020 2020 2077 6f72 6b66 6c6f 7765 6e74       workflowent
-00018530: 7269 6573 203d 205b 656e 7472 7920 666f  ries = [entry fo
-00018540: 7220 656e 7472 7920 696e 2065 6e74 7269  r entry in entri
-00018550: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00018560: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00018570: 2027 7479 7065 2720 696e 2065 6e74 7269   'type' in entri
-00018580: 6573 5b65 6e74 7279 5d20 616e 6420 656e  es[entry] and en
-00018590: 7472 6965 735b 656e 7472 795d 5b27 7479  tries[entry]['ty
-000185a0: 7065 275d 203d 3d20 2777 6f72 6b66 6c6f  pe'] == 'workflo
-000185b0: 7727 5d0a 2020 2020 2020 2020 666f 7220  w'].        for 
-000185c0: 7020 696e 2070 726f 6669 6c65 656e 7472  p in profileentr
-000185d0: 6965 733a 0a20 2020 2020 2020 2020 2020  ies:.           
-000185e0: 2076 6d70 726f 6669 6c65 735b 705d 203d   vmprofiles[p] =
-000185f0: 2065 6e74 7269 6573 5b70 5d0a 2020 2020   entries[p].    
-00018600: 2020 2020 6966 206e 6574 776f 726b 656e      if networken
-00018610: 7472 6965 7320 616e 6420 6e6f 7420 6f6e  tries and not on
-00018620: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
-00018630: 2020 2020 2020 7070 7269 6e74 2822 4465        pprint("De
-00018640: 706c 6f79 696e 6720 4e65 7477 6f72 6b73  ploying Networks
-00018650: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00018660: 2020 666f 7220 6e65 7420 696e 206e 6574    for net in net
-00018670: 776f 726b 656e 7472 6965 733a 0a20 2020  workentries:.   
-00018680: 2020 2020 2020 2020 2020 2020 206e 6574               net
-00018690: 7072 6f66 696c 6520 3d20 656e 7472 6965  profile = entrie
-000186a0: 735b 6e65 745d 0a20 2020 2020 2020 2020  s[net].         
-000186b0: 2020 2020 2020 2069 6620 6b2e 6e65 745f         if k.net_
-000186c0: 6578 6973 7473 286e 6574 293a 0a20 2020  exists(net):.   
-000186d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186e0: 2070 7072 696e 7428 6622 4e65 7477 6f72   pprint(f"Networ
-000186f0: 6b20 7b6e 6574 7d20 736b 6970 7065 6421  k {net} skipped!
-00018700: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00018710: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00018720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018730: 6369 6472 203d 206e 6574 7072 6f66 696c  cidr = netprofil
-00018740: 652e 6765 7428 2763 6964 7227 290a 2020  e.get('cidr').  
-00018750: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-00018760: 7420 3d20 626f 6f6c 286e 6574 7072 6f66  t = bool(netprof
-00018770: 696c 652e 6765 7428 276e 6174 272c 2054  ile.get('nat', T
-00018780: 7275 6529 290a 2020 2020 2020 2020 2020  rue)).          
-00018790: 2020 2020 2020 6966 2063 6964 7220 6973        if cidr is
-000187a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000187b0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-000187c0: 6e67 2866 224d 6973 7369 6e67 2043 6964  ng(f"Missing Cid
-000187d0: 7220 666f 7220 6e65 7477 6f72 6b20 7b6e  r for network {n
-000187e0: 6574 7d2e 204e 6f74 2063 7265 6174 696e  et}. Not creatin
-000187f0: 6720 6974 2e2e 2e22 290a 2020 2020 2020  g it...").      
-00018800: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00018810: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-00018820: 2020 2020 2020 2064 6863 7020 3d20 6e65         dhcp = ne
-00018830: 7470 726f 6669 6c65 2e67 6574 2827 6468  tprofile.get('dh
-00018840: 6370 272c 2054 7275 6529 0a20 2020 2020  cp', True).     
-00018850: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
-00018860: 6e20 3d20 6e65 7470 726f 6669 6c65 2e67  n = netprofile.g
-00018870: 6574 2827 646f 6d61 696e 2729 0a20 2020  et('domain').   
-00018880: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00018890: 756c 7420 3d20 6b2e 6372 6561 7465 5f6e  ult = k.create_n
-000188a0: 6574 776f 726b 286e 616d 653d 6e65 742c  etwork(name=net,
-000188b0: 2063 6964 723d 6369 6472 2c20 6468 6370   cidr=cidr, dhcp
-000188c0: 3d64 6863 702c 206e 6174 3d6e 6174 2c20  =dhcp, nat=nat, 
-000188d0: 646f 6d61 696e 3d64 6f6d 6169 6e2c 2070  domain=domain, p
-000188e0: 6c61 6e3d 706c 616e 2c0a 2020 2020 2020  lan=plan,.      
-000188f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018910: 2020 2020 6f76 6572 7269 6465 733d 6e65      overrides=ne
-00018920: 7470 726f 6669 6c65 290a 2020 2020 2020  tprofile).      
-00018930: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
-00018940: 2e68 616e 646c 655f 7265 7370 6f6e 7365  .handle_response
-00018950: 2872 6573 756c 742c 206e 6574 2c20 656c  (result, net, el
-00018960: 656d 656e 743d 274e 6574 776f 726b 2027  ement='Network '
-00018970: 290a 2020 2020 2020 2020 6966 2070 6f6f  ).        if poo
-00018980: 6c65 6e74 7269 6573 2061 6e64 206e 6f74  lentries and not
-00018990: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
-000189a0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-000189b0: 2244 6570 6c6f 7969 6e67 2050 6f6f 6c73  "Deploying Pools
-000189c0: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-000189d0: 2020 706f 6f6c 7320 3d20 6b2e 6c69 7374    pools = k.list
-000189e0: 5f70 6f6f 6c73 2829 0a20 2020 2020 2020  _pools().       
-000189f0: 2020 2020 2066 6f72 2070 6f6f 6c20 696e       for pool in
-00018a00: 2070 6f6f 6c65 6e74 7269 6573 3a0a 2020   poolentries:.  
-00018a10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00018a20: 2070 6f6f 6c20 696e 2070 6f6f 6c73 3a0a   pool in pools:.
-00018a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a40: 2020 2020 7070 7269 6e74 2866 2250 6f6f      pprint(f"Poo
-00018a50: 6c20 7b70 6f6f 6c7d 2073 6b69 7070 6564  l {pool} skipped
-00018a60: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
-00018a70: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00018a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018a90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00018aa0: 2020 2020 2020 2020 2020 2070 6f6f 6c70             poolp
-00018ab0: 726f 6669 6c65 203d 2065 6e74 7269 6573  rofile = entries
-00018ac0: 5b70 6f6f 6c5d 0a20 2020 2020 2020 2020  [pool].         
-00018ad0: 2020 2020 2020 2020 2020 2070 6f6f 6c70             poolp
-00018ae0: 6174 6820 3d20 706f 6f6c 7072 6f66 696c  ath = poolprofil
-00018af0: 652e 6765 7428 2770 6174 6827 290a 2020  e.get('path').  
-00018b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b10: 2020 6966 2070 6f6f 6c70 6174 6820 6973    if poolpath is
-00018b20: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00018b30: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00018b40: 6172 6e69 6e67 2866 2250 6f6f 6c20 7b70  arning(f"Pool {p
-00018b50: 6f6f 6c7d 2073 6b69 7070 6564 2061 7320  ool} skipped as 
-00018b60: 7061 7468 2069 7320 6d69 7373 696e 6721  path is missing!
-00018b70: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00018b80: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00018b90: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00018ba0: 2020 2020 2020 2020 6b2e 6372 6561 7465          k.create
-00018bb0: 5f70 6f6f 6c28 706f 6f6c 2c20 706f 6f6c  _pool(pool, pool
-00018bc0: 7061 7468 290a 2020 2020 2020 2020 6966  path).        if
-00018bd0: 2069 6d61 6765 656e 7472 6965 7320 616e   imageentries an
-00018be0: 6420 6e6f 7420 6f6e 6c79 6173 7365 7473  d not onlyassets
-00018bf0: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
-00018c00: 7269 6e74 2822 4465 706c 6f79 696e 6720  rint("Deploying 
-00018c10: 496d 6167 6573 2e2e 2e22 290a 2020 2020  Images...").    
-00018c20: 2020 2020 2020 2020 696d 6167 6573 203d          images =
-00018c30: 205b 6f73 2e70 6174 682e 6261 7365 6e61   [os.path.basena
-00018c40: 6d65 2874 2920 666f 7220 7420 696e 206b  me(t) for t in k
-00018c50: 2e76 6f6c 756d 6573 2829 5d0a 2020 2020  .volumes()].    
-00018c60: 2020 2020 2020 2020 666f 7220 696d 6167          for imag
-00018c70: 6520 696e 2069 6d61 6765 656e 7472 6965  e in imageentrie
-00018c80: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00018c90: 2020 2069 6d61 6765 7072 6f66 696c 6520     imageprofile 
-00018ca0: 3d20 656e 7472 6965 735b 696d 6167 655d  = entries[image]
-00018cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018cc0: 2070 6f6f 6c20 3d20 696d 6167 6570 726f   pool = imagepro
-00018cd0: 6669 6c65 2e67 6574 2827 706f 6f6c 272c  file.get('pool',
-00018ce0: 2073 656c 662e 706f 6f6c 290a 2020 2020   self.pool).    
-00018cf0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-00018d00: 6573 697a 6520 3d20 696d 6167 6570 726f  esize = imagepro
-00018d10: 6669 6c65 2e67 6574 2827 7369 7a65 2729  file.get('size')
-00018d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018d30: 2069 6d61 6765 7572 6c20 3d20 696d 6167   imageurl = imag
-00018d40: 6570 726f 6669 6c65 2e67 6574 2827 7572  eprofile.get('ur
-00018d50: 6c27 290a 2020 2020 2020 2020 2020 2020  l').            
-00018d60: 2020 2020 6966 2069 6d61 6765 2069 6e20      if image in 
-00018d70: 696d 6167 6573 3a0a 2020 2020 2020 2020  images:.        
-00018d80: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-00018d90: 6e74 2866 2249 6d61 6765 207b 696d 6167  nt(f"Image {imag
-00018da0: 657d 2073 6b69 7070 6564 2122 290a 2020  e} skipped!").  
-00018db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018dc0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00018dd0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00018de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018df0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00018e00: 6365 2869 6d61 6765 7572 6c2c 2073 7472  ce(imageurl, str
-00018e10: 2920 616e 6420 696d 6167 6575 726c 203d  ) and imageurl =
-00018e20: 3d20 224e 6f6e 6522 3a0a 2020 2020 2020  = "None":.      
-00018e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e40: 2020 696d 6167 6575 726c 203d 204e 6f6e    imageurl = Non
-00018e50: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00018e60: 2020 2020 2020 636d 6420 3d20 696d 6167        cmd = imag
-00018e70: 6570 726f 6669 6c65 2e67 6574 2827 636d  eprofile.get('cm
-00018e80: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
-00018e90: 2020 2020 2020 2020 7365 6c66 2e68 616e          self.han
-00018ea0: 646c 655f 686f 7374 2870 6f6f 6c3d 706f  dle_host(pool=po
-00018eb0: 6f6c 2c20 696d 6167 653d 696d 6167 652c  ol, image=image,
-00018ec0: 2064 6f77 6e6c 6f61 643d 5472 7565 2c20   download=True, 
-00018ed0: 636d 643d 636d 642c 2075 726c 3d69 6d61  cmd=cmd, url=ima
-00018ee0: 6765 7572 6c2c 2073 697a 653d 696d 6167  geurl, size=imag
-00018ef0: 6573 697a 6529 0a20 2020 2020 2020 2069  esize).        i
-00018f00: 6620 6275 636b 6574 656e 7472 6965 7320  f bucketentries 
-00018f10: 616e 6420 6e6f 7420 6f6e 6c79 6173 7365  and not onlyasse
-00018f20: 7473 2061 6e64 2073 656c 662e 7479 7065  ts and self.type
-00018f30: 2069 6e20 5b27 6177 7327 2c20 2767 6370   in ['aws', 'gcp
-00018f40: 272c 2027 6f70 656e 7374 6163 6b27 5d3a  ', 'openstack']:
-00018f50: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
-00018f60: 696e 7428 2244 6570 6c6f 7969 6e67 2042  int("Deploying B
-00018f70: 7563 6b65 7420 456e 7472 6965 732e 2e2e  ucket Entries...
-00018f80: 2229 0a20 2020 2020 2020 2020 2020 2066  ").            f
-00018f90: 6f72 2062 7563 6b65 7465 6e74 7279 2069  or bucketentry i
-00018fa0: 6e20 6275 636b 6574 656e 7472 6965 733a  n bucketentries:
-00018fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018fc0: 2062 7563 6b65 7470 726f 6669 6c65 203d   bucketprofile =
-00018fd0: 2065 6e74 7269 6573 5b62 7563 6b65 7465   entries[buckete
-00018fe0: 6e74 7279 5d0a 2020 2020 2020 2020 2020  ntry].          
-00018ff0: 2020 2020 2020 5f66 696c 6573 203d 2062        _files = b
-00019000: 7563 6b65 7470 726f 6669 6c65 2e67 6574  ucketprofile.get
-00019010: 2827 6669 6c65 7327 2c20 5b5d 290a 2020  ('files', []).  
-00019020: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00019030: 6c66 2e6b 2e63 7265 6174 655f 6275 636b  lf.k.create_buck
-00019040: 6574 2862 7563 6b65 7465 6e74 7279 290a  et(bucketentry).
-00019050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019060: 666f 7220 5f66 696c 2069 6e20 5f66 696c  for _fil in _fil
-00019070: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00019080: 2020 2020 2020 2020 7365 6c66 2e6b 2e75          self.k.u
-00019090: 706c 6f61 645f 746f 5f62 7563 6b65 7428  pload_to_bucket(
-000190a0: 6275 636b 6574 656e 7472 792c 205f 6669  bucketentry, _fi
-000190b0: 6c29 0a20 2020 2020 2020 2074 656d 706b  l).        tempk
-000190c0: 6579 203d 206f 7665 7272 6964 6573 2e67  ey = overrides.g
-000190d0: 6574 2827 7465 6d70 6b65 7927 2c20 4661  et('tempkey', Fa
-000190e0: 6c73 6529 206f 7220 7365 6c66 2e74 656d  lse) or self.tem
-000190f0: 706b 6579 0a20 2020 2020 2020 2069 6620  pkey.        if 
-00019100: 7465 6d70 6b65 793a 0a20 2020 2020 2020  tempkey:.       
-00019110: 2020 2020 2074 656d 706b 6579 6469 7220       tempkeydir 
-00019120: 3d20 5465 6d70 6f72 6172 7944 6972 6563  = TemporaryDirec
-00019130: 746f 7279 2829 0a20 2020 2020 2020 2020  tory().         
-00019140: 2020 206f 7665 7272 6964 6573 5b27 7465     overrides['te
-00019150: 6d70 6b65 7964 6972 275d 203d 2074 656d  mpkeydir'] = tem
-00019160: 706b 6579 6469 720a 2020 2020 2020 2020  pkeydir.        
-00019170: 2020 2020 6f76 6572 7269 6465 735b 2774      overrides['t
-00019180: 656d 706b 6579 6469 726b 6565 7027 5d20  empkeydirkeep'] 
-00019190: 3d20 5472 7565 0a20 2020 2020 2020 2069  = True.        i
-000191a0: 6620 706c 616e 656e 7472 6965 733a 0a20  f planentries:. 
-000191b0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-000191c0: 7428 2244 6570 6c6f 7969 6e67 2050 6c61  t("Deploying Pla
-000191d0: 6e73 2e2e 2e22 290a 2020 2020 2020 2020  ns...").        
-000191e0: 2020 2020 666f 7220 706c 616e 656e 7472      for planentr
-000191f0: 7920 696e 2070 6c61 6e65 6e74 7269 6573  y in planentries
-00019200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019210: 2020 6465 7461 696c 7320 3d20 656e 7472    details = entr
-00019220: 6965 735b 706c 616e 656e 7472 795d 0a20  ies[planentry]. 
-00019230: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00019240: 6c61 6e75 726c 203d 2064 6574 6169 6c73  lanurl = details
-00019250: 2e67 6574 2827 7572 6c27 290a 2020 2020  .get('url').    
-00019260: 2020 2020 2020 2020 2020 2020 706c 616e              plan
-00019270: 6669 6c65 203d 2064 6574 6169 6c73 2e67  file = details.g
-00019280: 6574 2827 6669 6c65 2729 0a20 2020 2020  et('file').     
-00019290: 2020 2020 2020 2020 2020 2069 6620 706c             if pl
-000192a0: 616e 7572 6c20 6973 204e 6f6e 6520 616e  anurl is None an
-000192b0: 6420 706c 616e 6669 6c65 2069 7320 4e6f  d planfile is No
-000192c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000192d0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-000192e0: 6622 4d69 7373 696e 6720 5572 6c2f 4669  f"Missing Url/Fi
-000192f0: 6c65 2066 6f72 2070 6c61 6e20 7b70 6c61  le for plan {pla
-00019300: 6e65 6e74 7279 7d2e 204e 6f74 2063 7265  nentry}. Not cre
-00019310: 6174 696e 6720 6974 2e2e 2e22 290a 2020  ating it...").  
-00019320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019330: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00019340: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00019350: 706c 616e 7572 6c20 6973 206e 6f74 204e  planurl is not N
-00019360: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00019370: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
-00019380: 706c 616e 656e 7472 790a 2020 2020 2020  planentry.      
-00019390: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000193a0: 206e 6f74 2070 6c61 6e75 726c 2e65 6e64   not planurl.end
-000193b0: 7377 6974 6828 2779 6d6c 2729 3a0a 2020  swith('yml'):.  
-000193c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193d0: 2020 2020 2020 706c 616e 7572 6c20 3d20        planurl = 
-000193e0: 6622 7b70 6c61 6e75 726c 7d2f 6b63 6c69  f"{planurl}/kcli
-000193f0: 5f70 6c61 6e2e 796d 6c22 0a20 2020 2020  _plan.yml".     
-00019400: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00019410: 272f 2720 696e 2070 6c61 6e66 696c 653a  '/' in planfile:
-00019420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019430: 2020 2020 2070 6174 6820 3d20 6f73 2e70       path = os.p
-00019440: 6174 682e 6469 726e 616d 6528 706c 616e  ath.dirname(plan
-00019450: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
-00019460: 2020 2020 2020 2020 2020 696e 7075 7466            inputf
-00019470: 696c 6520 3d20 6f73 2e70 6174 682e 6261  ile = os.path.ba
-00019480: 7365 6e61 6d65 2870 6c61 6e66 696c 6529  sename(planfile)
-00019490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000194a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000194b0: 2020 2020 2020 2020 2020 2070 6174 6820             path 
-000194c0: 3d20 272e 270a 2020 2020 2020 2020 2020  = '.'.          
-000194d0: 2020 2020 2020 2020 2020 696e 7075 7466            inputf
-000194e0: 696c 6520 3d20 706c 616e 656e 7472 790a  ile = planentry.
-000194f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019500: 6966 206e 6f5f 6f76 6572 7269 6465 7320  if no_overrides 
-00019510: 616e 6420 7061 7261 6d65 7465 7273 3a0a  and parameters:.
-00019520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019530: 2020 2020 7070 7269 6e74 2822 5573 696e      pprint("Usin
-00019540: 6720 7061 7261 6d65 7465 7273 2066 726f  g parameters fro
-00019550: 6d20 6661 7468 6572 2070 6c61 6e20 696e  m father plan in
-00019560: 2063 6869 6c64 206f 6e65 7322 290a 2020   child ones").  
-00019570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019580: 2020 666f 7220 6f76 6572 7269 6465 2069    for override i
-00019590: 6e20 6f76 6572 7269 6465 733a 0a20 2020  n overrides:.   
-000195a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195b0: 2020 2020 2070 7269 6e74 2822 5573 696e       print("Usin
-000195c0: 6720 7061 7261 6d65 7465 7220 2573 3a20  g parameter %s: 
-000195d0: 2573 2220 2520 286f 7665 7272 6964 652c  %s" % (override,
-000195e0: 206f 7665 7272 6964 6573 5b6f 7665 7272   overrides[overr
-000195f0: 6964 655d 2929 0a20 2020 2020 2020 2020  ide])).         
-00019600: 2020 2020 2020 2073 656c 662e 706c 616e         self.plan
-00019610: 2870 6c61 6e2c 2061 6e73 6962 6c65 3d46  (plan, ansible=F
-00019620: 616c 7365 2c20 7572 6c3d 706c 616e 7572  alse, url=planur
-00019630: 6c2c 2070 6174 683d 7061 7468 2c20 636f  l, path=path, co
-00019640: 6e74 6169 6e65 723d 4661 6c73 652c 2069  ntainer=False, i
-00019650: 6e70 7574 6669 6c65 3d69 6e70 7574 6669  nputfile=inputfi
-00019660: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-00019670: 2020 2020 2020 2020 2020 2020 2020 6f76                ov
-00019680: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-00019690: 732c 2065 6d62 6564 6465 643d 656d 6265  s, embedded=embe
-000196a0: 6464 6564 2c20 646f 776e 6c6f 6164 3d64  dded, download=d
-000196b0: 6f77 6e6c 6f61 6429 0a20 2020 2020 2020  ownload).       
-000196c0: 2069 6620 6b75 6265 656e 7472 6965 7320   if kubeentries 
-000196d0: 616e 6420 6e6f 7420 6f6e 6c79 6173 7365  and not onlyasse
-000196e0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-000196f0: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
-00019700: 6720 4b75 6265 2045 6e74 7269 6573 2e2e  g Kube Entries..
-00019710: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00019720: 646e 7363 6c69 656e 7473 203d 207b 7d0a  dnsclients = {}.
-00019730: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
-00019740: 7468 7265 6164 6564 203d 2054 7275 6520  threaded = True 
-00019750: 6966 206c 656e 286b 7562 6565 6e74 7269  if len(kubeentri
-00019760: 6573 2920 3e20 3120 656c 7365 2046 616c  es) > 1 else Fal
-00019770: 7365 0a20 2020 2020 2020 2020 2020 2069  se.            i
-00019780: 6620 6b75 6265 7468 7265 6164 6564 3a0a  f kubethreaded:.
-00019790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197a0: 7761 726e 696e 6728 224c 6175 6e63 6869  warning("Launchi
-000197b0: 6e67 2065 6163 6820 636c 7573 7465 7220  ng each cluster 
-000197c0: 696e 2061 2074 6872 6561 6420 6173 2074  in a thread as t
-000197d0: 6865 7265 2069 7320 6d6f 7265 2074 6861  here is more tha
-000197e0: 6e20 6f6e 6520 656e 7472 792e 2e2e 2229  n one entry...")
-000197f0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00019800: 2063 6c75 7374 6572 2069 6e20 6b75 6265   cluster in kube
-00019810: 656e 7472 6965 733a 0a20 2020 2020 2020  entries:.       
-00019820: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00019830: 6622 4465 706c 6f79 696e 6720 436c 7573  f"Deploying Clus
-00019840: 7465 7220 7b63 6c75 7374 6572 7d2e 2e2e  ter {cluster}...
-00019850: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00019860: 2020 206b 7562 6570 726f 6669 6c65 203d     kubeprofile =
-00019870: 2065 6e74 7269 6573 5b63 6c75 7374 6572   entries[cluster
-00019880: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00019890: 2020 6b75 6265 636c 6965 6e74 203d 206b    kubeclient = k
-000198a0: 7562 6570 726f 6669 6c65 2e67 6574 2827  ubeprofile.get('
-000198b0: 636c 6965 6e74 2729 0a20 2020 2020 2020  client').       
-000198c0: 2020 2020 2020 2020 2069 6620 6b75 6265           if kube
-000198d0: 636c 6965 6e74 2069 7320 4e6f 6e65 3a0a  client is None:.
-000198e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198f0: 2020 2020 6375 7272 656e 7463 6f6e 6669      currentconfi
-00019900: 6720 3d20 7365 6c66 0a20 2020 2020 2020  g = self.       
-00019910: 2020 2020 2020 2020 2065 6c69 6620 6b75           elif ku
-00019920: 6265 636c 6965 6e74 2069 6e20 7365 6c66  beclient in self
-00019930: 2e63 6c69 656e 7473 3a0a 2020 2020 2020  .clients:.      
-00019940: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-00019950: 7272 656e 7463 6f6e 6669 6720 3d20 4b63  rrentconfig = Kc
-00019960: 6f6e 6669 6728 636c 6965 6e74 3d6b 7562  onfig(client=kub
-00019970: 6563 6c69 656e 7429 0a20 2020 2020 2020  eclient).       
-00019980: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00019990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000199a0: 2020 2065 7272 6f72 2866 2243 6c69 656e     error(f"Clien
-000199b0: 7420 7b6b 7562 6563 6c69 656e 747d 206e  t {kubeclient} n
-000199c0: 6f74 2066 6f75 6e64 2e20 736b 6970 7065  ot found. skippe
-000199d0: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
-000199e0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-000199f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019a00: 206b 7562 6574 7970 6520 3d20 6b75 6265   kubetype = kube
-00019a10: 7072 6f66 696c 652e 6765 7428 276b 7562  profile.get('kub
-00019a20: 6574 7970 6527 2920 6f72 206b 7562 6570  etype') or kubep
-00019a30: 726f 6669 6c65 2e67 6574 2827 636c 7573  rofile.get('clus
-00019a40: 7465 7274 7970 6527 2c20 2767 656e 6572  tertype', 'gener
-00019a50: 6963 2729 0a20 2020 2020 2020 2020 2020  ic').           
-00019a60: 2020 2020 206b 7562 655f 6f76 6572 7269       kube_overri
-00019a70: 6465 7320 3d20 6f76 6572 7269 6465 732e  des = overrides.
-00019a80: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
-00019a90: 2020 2020 2020 206b 7562 655f 6f76 6572         kube_over
-00019aa0: 7269 6465 732e 7570 6461 7465 286b 7562  rides.update(kub
-00019ab0: 6570 726f 6669 6c65 290a 2020 2020 2020  eprofile).      
-00019ac0: 2020 2020 2020 2020 2020 6b75 6265 5f6f            kube_o
-00019ad0: 7665 7272 6964 6573 5b27 636c 7573 7465  verrides['cluste
-00019ae0: 7227 5d20 3d20 636c 7573 7465 720a 2020  r'] = cluster.  
-00019af0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00019b00: 6973 7469 6e67 5f63 746c 706c 616e 6573  isting_ctlplanes
-00019b10: 203d 205b 7620 666f 7220 7620 696e 2063   = [v for v in c
-00019b20: 7572 7265 6e74 636f 6e66 6967 2e6b 2e6c  urrentconfig.k.l
-00019b30: 6973 7428 2920 6966 2066 277b 636c 7573  ist() if f'{clus
-00019b40: 7465 727d 2d63 746c 706c 616e 6527 2069  ter}-ctlplane' i
-00019b50: 6e20 765b 276e 616d 6527 5d5d 0a20 2020  n v['name']].   
-00019b60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00019b70: 6578 6973 7469 6e67 5f63 746c 706c 616e  existing_ctlplan
-00019b80: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00019b90: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00019ba0: 2243 6c75 7374 6572 207b 636c 7573 7465  "Cluster {cluste
-00019bb0: 727d 2066 6f75 6e64 2e20 736b 6970 7065  r} found. skippe
-00019bc0: 6421 2229 0a20 2020 2020 2020 2020 2020  d!").           
-00019bd0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00019be0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00019bf0: 2020 6966 206b 7562 6574 7970 6520 6e6f    if kubetype no
-00019c00: 7420 696e 205b 2767 656e 6572 6963 272c  t in ['generic',
-00019c10: 2027 6f70 656e 7368 6966 7427 2c20 2768   'openshift', 'h
-00019c20: 7970 6572 7368 6966 7427 2c20 276d 6963  ypershift', 'mic
-00019c30: 726f 7368 6966 7427 2c20 276b 3373 272c  roshift', 'k3s',
-00019c40: 2027 676b 6527 5d3a 0a20 2020 2020 2020   'gke']:.       
-00019c50: 2020 2020 2020 2020 2020 2020 2077 6172               war
-00019c60: 6e69 6e67 2866 2249 6e63 6f72 7265 6374  ning(f"Incorrect
-00019c70: 206b 7562 6574 7970 6520 7b6b 7562 6574   kubetype {kubet
-00019c80: 7970 657d 2073 7065 6369 6669 6564 2e20  ype} specified. 
-00019c90: 736b 6970 7065 6421 2229 0a20 2020 2020  skipped!").     
-00019ca0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00019cb0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00019cc0: 2020 2020 2020 2020 6966 206b 7562 6574          if kubet
-00019cd0: 6872 6561 6465 643a 0a20 2020 2020 2020  hreaded:.       
-00019ce0: 2020 2020 2020 2020 2020 2020 206b 7562               kub
-00019cf0: 655f 6f76 6572 7269 6465 735b 2775 7365  e_overrides['use
-00019d00: 5f65 7869 7374 696e 675f 6f70 656e 7368  _existing_opensh
-00019d10: 6966 7427 5d20 3d20 5472 7565 0a20 2020  ift'] = True.   
-00019d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d30: 206e 6577 5f61 7267 7320 3d20 2870 6c61   new_args = (pla
-00019d40: 6e2c 206b 7562 6574 7970 652c 206b 7562  n, kubetype, kub
-00019d50: 655f 6f76 6572 7269 6465 7329 0a20 2020  e_overrides).   
-00019d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d70: 2074 203d 2074 6872 6561 6469 6e67 2e54   t = threading.T
-00019d80: 6872 6561 6428 7461 7267 6574 3d73 656c  hread(target=sel
-00019d90: 662e 7468 7265 6164 6564 5f63 7265 6174  f.threaded_creat
-00019da0: 655f 6b75 6265 2c20 6172 6773 3d6e 6577  e_kube, args=new
-00019db0: 5f61 7267 7329 0a20 2020 2020 2020 2020  _args).         
-00019dc0: 2020 2020 2020 2020 2020 2074 6872 6561             threa
-00019dd0: 6473 2e61 7070 656e 6428 7429 0a20 2020  ds.append(t).   
-00019de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019df0: 2074 2e73 7461 7274 2829 0a20 2020 2020   t.start().     
-00019e00: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00019e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019e20: 2020 2020 2063 7572 7265 6e74 636f 6e66       currentconf
-00019e30: 6967 2e63 7265 6174 655f 6b75 6265 2870  ig.create_kube(p
-00019e40: 6c61 6e2c 206b 7562 6574 7970 652c 206f  lan, kubetype, o
-00019e50: 7665 7272 6964 6573 3d6b 7562 655f 6f76  verrides=kube_ov
-00019e60: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
-00019e70: 2076 6d63 6c69 656e 7473 203d 205b 5d0a   vmclients = [].
-00019e80: 2020 2020 2020 2020 6966 2076 6d65 6e74          if vment
-00019e90: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
-00019ea0: 2020 6966 206e 6f74 206f 6e6c 7961 7373    if not onlyass
-00019eb0: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
-00019ec0: 2020 2020 2070 7072 696e 7428 2244 6570       pprint("Dep
-00019ed0: 6c6f 7969 6e67 2056 6d73 2e2e 2e22 290a  loying Vms...").
-00019ee0: 2020 2020 2020 2020 2020 2020 766d 636f              vmco
-00019ef0: 756e 7465 7220 3d20 300a 2020 2020 2020  unter = 0.      
-00019f00: 2020 2020 2020 686f 7374 7320 3d20 7b7d        hosts = {}
-00019f10: 0a20 2020 2020 2020 2020 2020 2076 6d73  .            vms
-00019f20: 5f74 6f5f 686f 7374 203d 207b 7d0a 2020  _to_host = {}.  
-00019f30: 2020 2020 2020 2020 2020 6261 7365 706c            basepl
-00019f40: 616e 7320 3d20 5b5d 0a20 2020 2020 2020  ans = [].       
-00019f50: 2020 2020 2076 6d6e 616d 6573 203d 205b       vmnames = [
-00019f60: 6e61 6d65 2066 6f72 206e 616d 6520 696e  name for name in
-00019f70: 2076 6d65 6e74 7269 6573 5d0a 2020 2020   vmentries].    
-00019f80: 2020 2020 2020 2020 6966 2062 6173 6566          if basef
-00019f90: 696c 6520 6973 206e 6f74 204e 6f6e 653a  ile is not None:
-00019fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019fb0: 2062 6173 6564 6972 203d 206f 732e 7061   basedir = os.pa
-00019fc0: 7468 2e64 6972 6e61 6d65 2869 6e70 7574  th.dirname(input
-00019fd0: 6669 6c65 2920 6966 206f 732e 7061 7468  file) if os.path
-00019fe0: 2e69 7361 6273 2869 6e70 7574 6669 6c65  .isabs(inputfile
-00019ff0: 2920 656c 7365 2027 2e27 0a20 2020 2020  ) else '.'.     
-0001a000: 2020 2020 2020 2020 2020 2062 6173 6569             basei
-0001a010: 6e70 7574 6669 6c65 203d 2066 227b 6261  nputfile = f"{ba
-0001a020: 7365 6469 727d 2f7b 6261 7365 6669 6c65  sedir}/{basefile
-0001a030: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0001a040: 2020 2069 6620 636f 6e74 6169 6e65 725f     if container_
-0001a050: 6d6f 6465 2829 2061 6e64 206e 6f74 206f  mode() and not o
-0001a060: 732e 7061 7468 2e69 7361 6273 2862 6173  s.path.isabs(bas
-0001a070: 6566 696c 6529 2061 6e64 2027 2f77 6f72  efile) and '/wor
-0001a080: 6b64 6972 2720 6e6f 7420 696e 2062 6173  kdir' not in bas
-0001a090: 6564 6972 3a0a 2020 2020 2020 2020 2020  edir:.          
-0001a0a0: 2020 2020 2020 2020 2020 6261 7365 696e            basein
-0001a0b0: 7075 7466 696c 6520 3d20 6622 2f77 6f72  putfile = f"/wor
-0001a0c0: 6b64 6972 2f7b 6261 7365 6469 727d 2f7b  kdir/{basedir}/{
-0001a0d0: 6261 7365 6669 6c65 7d22 0a20 2020 2020  basefile}".     
-0001a0e0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0001a0f0: 7420 3d20 7365 6c66 2e70 6c61 6e28 706c  t = self.plan(pl
-0001a100: 616e 2c20 696e 7075 7466 696c 653d 6261  an, inputfile=ba
-0001a110: 7365 696e 7075 7466 696c 652c 206f 7665  seinputfile, ove
-0001a120: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-0001a130: 2c20 6578 636c 7564 6576 6d73 3d76 6d6e  , excludevms=vmn
-0001a140: 616d 6573 2c0a 2020 2020 2020 2020 2020  ames,.          
-0001a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a160: 2020 2020 2020 2020 2062 6173 656d 6f64           basemod
-0001a170: 653d 5472 7565 2c20 6f6e 6c79 6173 7365  e=True, onlyasse
-0001a180: 7473 3d6f 6e6c 7961 7373 6574 7329 0a20  ts=onlyassets). 
-0001a190: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001a1a0: 6620 7265 7375 6c74 5b27 7265 7375 6c74  f result['result
-0001a1b0: 275d 2021 3d20 2773 7563 6365 7373 273a  '] != 'success':
-0001a1c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a1d0: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-0001a1e0: 6c74 0a20 2020 2020 2020 2020 2020 2020  lt.             
-0001a1f0: 2020 2062 6173 6570 6c61 6e73 2e61 7070     baseplans.app
-0001a200: 656e 6428 6261 7365 6669 6c65 290a 2020  end(basefile).  
-0001a210: 2020 2020 2020 2020 2020 766d 7275 6c65            vmrule
-0001a220: 735f 7374 7269 6374 203d 206f 7665 7272  s_strict = overr
-0001a230: 6964 6573 2e67 6574 2827 766d 7275 6c65  ides.get('vmrule
-0001a240: 735f 7374 7269 6374 272c 2073 656c 662e  s_strict', self.
-0001a250: 766d 7275 6c65 735f 7374 7269 6374 290a  vmrules_strict).
-0001a260: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001a270: 6e61 6d65 2069 6e20 766d 656e 7472 6965  name in vmentrie
-0001a280: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001a290: 2020 2069 6620 6e61 6d65 2069 6e20 6578     if name in ex
-0001a2a0: 636c 7564 6576 6d73 3a0a 2020 2020 2020  cludevms:.      
-0001a2b0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001a2c0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-0001a2d0: 2020 2020 2020 2063 7572 7265 6e74 706c         currentpl
-0001a2e0: 616e 6469 7220 3d20 6261 7365 6469 720a  andir = basedir.
-0001a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a300: 6966 206c 656e 2876 6d65 6e74 7269 6573  if len(vmentries
-0001a310: 2920 3d3d 2031 2061 6e64 2027 6e61 6d65  ) == 1 and 'name
-0001a320: 2720 696e 206f 7665 7272 6964 6573 3a0a  ' in overrides:.
-0001a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a340: 2020 2020 6e65 776e 616d 6520 3d20 6f76      newname = ov
-0001a350: 6572 7269 6465 735b 276e 616d 6527 5d0a  errides['name'].
-0001a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a370: 2020 2020 7072 6f66 696c 6520 3d20 656e      profile = en
-0001a380: 7472 6965 735b 6e61 6d65 5d0a 2020 2020  tries[name].    
-0001a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3a0: 6e61 6d65 203d 206e 6577 6e61 6d65 0a20  name = newname. 
-0001a3b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001a3c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001a3d0: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
-0001a3e0: 203d 2065 6e74 7269 6573 5b6e 616d 655d   = entries[name]
-0001a3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a400: 2069 6620 276e 616d 6527 2069 6e20 7072   if 'name' in pr
-0001a410: 6f66 696c 653a 0a20 2020 2020 2020 2020  ofile:.         
-0001a420: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-0001a430: 3d20 7072 6f66 696c 655b 276e 616d 6527  = profile['name'
-0001a440: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001a450: 2020 6966 2027 6261 7365 766d 2720 696e    if 'basevm' in
-0001a460: 2070 726f 6669 6c65 206f 7220 2762 6173   profile or 'bas
-0001a470: 6570 6c61 6e27 2069 6e20 7072 6f66 696c  eplan' in profil
-0001a480: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001a490: 2020 2020 2020 2062 6173 6570 726f 6669         baseprofi
-0001a4a0: 6c65 203d 207b 7d0a 2020 2020 2020 2020  le = {}.        
-0001a4b0: 2020 2020 2020 2020 2020 2020 6170 7065              appe
-0001a4c0: 6e64 6b65 7973 203d 205b 2764 6973 6b73  ndkeys = ['disks
-0001a4d0: 272c 2027 6e65 7473 272c 2027 6669 6c65  ', 'nets', 'file
-0001a4e0: 7327 2c20 2773 6372 6970 7473 272c 2027  s', 'scripts', '
-0001a4f0: 636d 6473 275d 0a20 2020 2020 2020 2020  cmds'].         
-0001a500: 2020 2020 2020 2020 2020 2069 6620 2762             if 'b
-0001a510: 6173 6570 6c61 6e27 2069 6e20 7072 6f66  aseplan' in prof
-0001a520: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-0001a530: 2020 2020 2020 2020 2020 2020 2062 6173               bas
-0001a540: 6570 6c61 6e20 3d20 7072 6f66 696c 655b  eplan = profile[
-0001a550: 2762 6173 6570 6c61 6e27 5d0a 2020 2020  'baseplan'].    
-0001a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a570: 2020 2020 6261 7365 6469 7220 3d20 6f73      basedir = os
-0001a580: 2e70 6174 682e 6469 726e 616d 6528 696e  .path.dirname(in
-0001a590: 7075 7466 696c 6529 2069 6620 272f 2720  putfile) if '/' 
-0001a5a0: 696e 2069 6e70 7574 6669 6c65 2065 6c73  in inputfile els
-0001a5b0: 6520 272e 270a 2020 2020 2020 2020 2020  e '.'.          
-0001a5c0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-0001a5d0: 7365 696e 7075 7466 696c 6520 3d20 6622  seinputfile = f"
-0001a5e0: 7b62 6173 6564 6972 7d2f 7b62 6173 6570  {basedir}/{basep
-0001a5f0: 6c61 6e7d 220a 2020 2020 2020 2020 2020  lan}".          
-0001a600: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001a610: 2063 6f6e 7461 696e 6572 5f6d 6f64 6528   container_mode(
-0001a620: 2920 616e 6420 6e6f 7420 6f73 2e70 6174  ) and not os.pat
-0001a630: 682e 6973 6162 7328 6261 7365 706c 616e  h.isabs(baseplan
-0001a640: 2920 616e 6420 272f 776f 726b 6469 7227  ) and '/workdir'
-0001a650: 206e 6f74 2069 6e20 6261 7365 6469 723a   not in basedir:
-0001a660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a670: 2020 2020 2020 2020 2020 2020 2062 6173               bas
-0001a680: 6569 6e70 7574 6669 6c65 203d 2066 222f  einputfile = f"/
-0001a690: 776f 726b 6469 722f 7b62 6173 6564 6972  workdir/{basedir
-0001a6a0: 7d2f 7b62 6173 6570 6c61 6e7d 220a 2020  }/{baseplan}".  
+00016d90: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00016da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016db0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00016dc0: 6d6d 6f6e 2e66 6574 6368 2866 227b 6f6e  mmon.fetch(f"{on
+00016dd0: 666c 797d 2f7b 6f72 6967 696e 7d22 2c20  fly}/{origin}", 
+00016de0: 6465 7374 6469 7229 0a20 2020 2020 2020  destdir).       
+00016df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e00: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+00016e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016e30: 636f 6d6d 6f6e 2e75 726c 5f65 7869 7374  common.url_exist
+00016e40: 7328 6622 7b6f 6e66 6c79 7d2f 7b6f 7269  s(f"{onfly}/{ori
+00016e50: 6769 6e7d 2f52 4541 444d 452e 6d64 2229  gin}/README.md")
+00016e60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e80: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
+00016e90: 7328 6f72 6967 696e 2c20 6578 6973 745f  s(origin, exist_
+00016ea0: 6f6b 3d54 7275 6529 0a20 2020 2020 2020  ok=True).       
+00016eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ec0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ef0: 2020 2070 7072 696e 7428 6622 6669 6c65     pprint(f"file
+00016f00: 207b 6f6e 666c 797d 2f7b 6f72 6967 696e   {onfly}/{origin
+00016f10: 7d20 736b 6970 7065 6422 290a 2020 2020  } skipped").    
+00016f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f30: 666f 7220 7363 7269 7074 2069 6e20 7363  for script in sc
+00016f40: 7269 7074 6669 6c65 733a 0a20 2020 2020  riptfiles:.     
+00016f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f60: 2020 2069 6620 277e 2720 6e6f 7420 696e     if '~' not in
+00016f70: 2073 6372 6970 743a 0a20 2020 2020 2020   script:.       
+00016f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f90: 2020 2020 2064 6573 7464 6972 203d 2022       destdir = "
+00016fa0: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+00016fb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00016fc0: 6620 272f 2720 696e 2073 6372 6970 743a  f '/' in script:
+00016fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ff0: 2064 6573 7464 6972 203d 206f 732e 7061   destdir = os.pa
+00017000: 7468 2e64 6972 6e61 6d65 2873 6372 6970  th.dirname(scrip
+00017010: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00017020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017030: 2020 206f 732e 6d61 6b65 6469 7273 2864     os.makedirs(d
+00017040: 6573 7464 6972 2c20 6578 6973 745f 6f6b  estdir, exist_ok
+00017050: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00017060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017070: 2020 2070 7072 696e 7428 6622 5265 7472     pprint(f"Retr
+00017080: 6965 7669 6e67 2073 6372 6970 7420 7b6f  ieving script {o
+00017090: 6e66 6c79 7d2f 7b73 6372 6970 747d 2229  nfly}/{script}")
+000170a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000170b0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+000170c0: 6d6f 6e2e 6665 7463 6828 6622 7b6f 6e66  mon.fetch(f"{onf
+000170d0: 6c79 7d2f 7b73 6372 6970 747d 222c 2064  ly}/{script}", d
+000170e0: 6573 7464 6972 290a 2020 2020 2020 2020  estdir).        
+000170f0: 2020 2020 2020 2020 6f73 2e63 6864 6972          os.chdir
+00017100: 2827 2e2e 2729 0a20 2020 2020 2020 2020  ('..').         
+00017110: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00017120: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
+00017130: 7327 7d0a 2020 2020 2020 2020 6966 2069  s'}.        if i
+00017140: 6e70 7574 7374 7269 6e67 2069 7320 6e6f  nputstring is no
+00017150: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00017160: 2020 2020 696e 7075 7466 696c 6520 3d20      inputfile = 
+00017170: 6622 7465 6d70 5f70 6c61 6e5f 7b70 6c61  f"temp_plan_{pla
+00017180: 6e7d 2e79 6d6c 220a 2020 2020 2020 2020  n}.yml".        
+00017190: 2020 2020 7769 7468 206f 7065 6e28 696e      with open(in
+000171a0: 7075 7466 696c 652c 2022 7722 2920 6173  putfile, "w") as
+000171b0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+000171c0: 2020 2020 662e 7772 6974 6528 696e 7075      f.write(inpu
+000171d0: 7473 7472 696e 6729 0a20 2020 2020 2020  tstring).       
+000171e0: 2069 6620 696e 7075 7466 696c 6520 6973   if inputfile is
+000171f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00017200: 2020 2069 6e70 7574 6669 6c65 203d 2027     inputfile = '
+00017210: 6b63 6c69 5f70 6c61 6e2e 796d 6c27 0a20  kcli_plan.yml'. 
+00017220: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00017230: 7428 2275 7369 6e67 2064 6566 6175 6c74  t("using default
+00017240: 2069 6e70 7574 2066 696c 6520 6b63 6c69   input file kcli
+00017250: 5f70 6c61 6e2e 796d 6c22 290a 2020 2020  _plan.yml").    
+00017260: 2020 2020 6966 2070 6174 6820 6973 206e      if path is n
+00017270: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00017280: 2020 2020 206f 732e 6368 6469 7228 7061       os.chdir(pa
+00017290: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
+000172a0: 6765 7462 6163 6b20 3d20 5472 7565 0a20  getback = True. 
+000172b0: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
+000172c0: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
+000172d0: 6475 7365 7228 696e 7075 7466 696c 6529  duser(inputfile)
+000172e0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000172f0: 6f73 2e70 6174 682e 6578 6973 7473 2869  os.path.exists(i
+00017300: 6e70 7574 6669 6c65 293a 0a20 2020 2020  nputfile):.     
+00017310: 2020 2020 2020 2065 7272 6f72 2866 2249         error(f"I
+00017320: 6e70 7574 2066 696c 6520 7b69 6e70 7574  nput file {input
+00017330: 6669 6c65 7d20 6e6f 7420 666f 756e 642e  file} not found.
+00017340: 4c65 6176 696e 672e 2e2e 2e22 290a 2020  Leaving....").  
+00017350: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+00017360: 6974 2831 290a 2020 2020 2020 2020 656c  it(1).        el
+00017370: 6966 206f 732e 7061 7468 2e69 7364 6972  if os.path.isdir
+00017380: 2869 6e70 7574 6669 6c65 293a 0a20 2020  (inputfile):.   
+00017390: 2020 2020 2020 2020 2069 6e70 7574 6669           inputfi
+000173a0: 6c65 203d 2066 227b 696e 7075 7466 696c  le = f"{inputfil
+000173b0: 657d 2f6b 636c 695f 706c 616e 2e79 6d6c  e}/kcli_plan.yml
+000173c0: 220a 2020 2020 2020 2020 6966 2069 6e66  ".        if inf
+000173d0: 6f3a 0a20 2020 2020 2020 2020 2020 2073  o:.            s
+000173e0: 656c 662e 696e 666f 5f70 6c61 6e28 696e  elf.info_plan(in
+000173f0: 7075 7466 696c 652c 206f 6e66 6c79 3d6f  putfile, onfly=o
+00017400: 6e66 6c79 2c20 7175 6965 743d 7175 6965  nfly, quiet=quie
+00017410: 742c 2064 6f63 3d64 6f63 290a 2020 2020  t, doc=doc).    
+00017420: 2020 2020 2020 2020 6966 2074 6f63 6c65          if tocle
+00017430: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
+00017440: 2020 2020 6f73 2e63 6864 6972 2827 2e2e      os.chdir('..
+00017450: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00017460: 2020 2072 6d74 7265 6528 7061 7468 290a     rmtree(path).
+00017470: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00017480: 726e 207b 2772 6573 756c 7427 3a20 2773  rn {'result': 's
+00017490: 7563 6365 7373 277d 0a20 2020 2020 2020  uccess'}.       
+000174a0: 2062 6173 6565 6e74 7269 6573 203d 207b   baseentries = {
+000174b0: 7d0a 2020 2020 2020 2020 656e 7472 6965  }.        entrie
+000174c0: 732c 206f 7665 7272 6964 6573 2c20 6261  s, overrides, ba
+000174d0: 7365 6669 6c65 2c20 6261 7365 6469 7220  sefile, basedir 
+000174e0: 3d20 7365 6c66 2e70 726f 6365 7373 5f69  = self.process_i
+000174f0: 6e70 7574 6669 6c65 2870 6c61 6e2c 2069  nputfile(plan, i
+00017500: 6e70 7574 6669 6c65 2c20 6f76 6572 7269  nputfile, overri
+00017510: 6465 733d 6f76 6572 7269 6465 732c 0a20  des=overrides,. 
+00017520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017560: 2020 2020 2020 6f6e 666c 793d 6f6e 666c        onfly=onfl
+00017570: 792c 2066 756c 6c3d 5472 7565 290a 2020  y, full=True).  
+00017580: 2020 2020 2020 6966 2062 6173 6566 696c        if basefil
+00017590: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+000175a0: 2020 2020 2020 2020 2020 2062 6173 6569             basei
+000175b0: 6e66 6f20 3d20 7365 6c66 2e70 726f 6365  nfo = self.proce
+000175c0: 7373 5f69 6e70 7574 6669 6c65 2870 6c61  ss_inputfile(pla
+000175d0: 6e2c 2066 227b 6261 7365 6469 727d 2f7b  n, f"{basedir}/{
+000175e0: 6261 7365 6669 6c65 7d22 2c20 6f76 6572  basefile}", over
+000175f0: 7269 6465 733d 6f76 6572 7269 6465 732c  rides=overrides,
+00017600: 2066 756c 6c3d 5472 7565 290a 2020 2020   full=True).    
+00017610: 2020 2020 2020 2020 6261 7365 656e 7472          baseentr
+00017620: 6965 732c 2062 6173 656f 7665 7272 6964  ies, baseoverrid
+00017630: 6573 203d 2062 6173 6569 6e66 6f5b 305d  es = baseinfo[0]
+00017640: 2c20 6261 7365 696e 666f 5b31 5d0a 2020  , baseinfo[1].  
+00017650: 2020 2020 2020 2020 2020 6966 2062 6173            if bas
+00017660: 656f 7665 7272 6964 6573 3a0a 2020 2020  eoverrides:.    
+00017670: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+00017680: 7269 6465 732e 7570 6461 7465 287b 6b65  rides.update({ke
+00017690: 793a 2062 6173 656f 7665 7272 6964 6573  y: baseoverrides
+000176a0: 5b6b 6579 5d20 666f 7220 6b65 7920 696e  [key] for key in
+000176b0: 2062 6173 656f 7665 7272 6964 6573 2069   baseoverrides i
+000176c0: 6620 6b65 7920 6e6f 7420 696e 206f 7665  f key not in ove
+000176d0: 7272 6964 6573 7d29 0a20 2020 2020 2020  rrides}).       
+000176e0: 2069 6620 656e 7472 6965 7320 6973 204e   if entries is N
+000176f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00017700: 2065 6e74 7269 6573 203d 207b 7d0a 2020   entries = {}.  
+00017710: 2020 2020 2020 6966 2073 656c 662e 6465        if self.de
+00017720: 6275 673a 0a20 2020 2020 2020 2020 2020  bug:.           
+00017730: 2070 7269 6e74 2879 616d 6c2e 6475 6d70   print(yaml.dump
+00017740: 2865 6e74 7269 6573 2929 0a20 2020 2020  (entries)).     
+00017750: 2020 2070 6172 616d 6574 6572 7320 3d20     parameters = 
+00017760: 656e 7472 6965 732e 6765 7428 2770 6172  entries.get('par
+00017770: 616d 6574 6572 7327 290a 2020 2020 2020  ameters').      
+00017780: 2020 6966 2070 6172 616d 6574 6572 7320    if parameters 
+00017790: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000177a0: 2020 2020 2020 2020 2064 656c 2065 6e74           del ent
+000177b0: 7269 6573 5b27 7061 7261 6d65 7465 7273  ries['parameters
+000177c0: 275d 0a20 2020 2020 2020 2064 6963 745f  '].        dict_
+000177d0: 7479 7065 7320 3d20 5b65 6e74 7279 2066  types = [entry f
+000177e0: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
+000177f0: 6965 7320 6966 2069 7369 6e73 7461 6e63  ies if isinstanc
+00017800: 6528 656e 7472 6965 735b 656e 7472 795d  e(entries[entry]
+00017810: 2c20 6469 6374 295d 0a20 2020 2020 2020  , dict)].       
+00017820: 2069 6620 6e6f 7420 6469 6374 5f74 7970   if not dict_typ
+00017830: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00017840: 6966 2062 6173 656d 6f64 653a 0a20 2020  if basemode:.   
+00017850: 2020 2020 2020 2020 2020 2020 2077 6172               war
+00017860: 6e69 6e67 2866 227b 696e 7075 7466 696c  ning(f"{inputfil
+00017870: 657d 2064 6f65 736e 2774 206c 6f6f 6b20  e} doesn't look 
+00017880: 6c69 6b65 2061 2076 616c 6964 2070 6c61  like a valid pla
+00017890: 6e2e 536b 6970 7069 6e67 2e2e 2e2e 2229  n.Skipping....")
+000178a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000178b0: 2072 6574 7572 6e20 7b22 7265 7375 6c74   return {"result
+000178c0: 223a 2022 7375 6363 6573 7322 7d0a 2020  ": "success"}.  
+000178d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000178e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178f0: 6d73 6720 3d20 6622 7b69 6e70 7574 6669  msg = f"{inputfi
+00017900: 6c65 7d20 646f 6573 6e27 7420 6c6f 6f6b  le} doesn't look
+00017910: 206c 696b 6520 6120 7661 6c69 6420 706c   like a valid pl
+00017920: 616e 2066 696c 652e 204d 6179 6265 2079  an file. Maybe y
+00017930: 6f75 2070 726f 7669 6465 6420 6120 7061  ou provided a pa
+00017940: 7261 6d65 7465 7220 6669 6c65 203f 220a  rameter file ?".
+00017950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017960: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+00017970: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
+00017980: 6173 6f6e 273a 206d 7367 7d0a 2020 2020  ason': msg}.    
+00017990: 2020 2020 696e 7075 7464 6972 203d 206f      inputdir = o
+000179a0: 732e 7061 7468 2e64 6972 6e61 6d65 2869  s.path.dirname(i
+000179b0: 6e70 7574 6669 6c65 2920 6966 206f 732e  nputfile) if os.
+000179c0: 7061 7468 2e64 6972 6e61 6d65 2869 6e70  path.dirname(inp
+000179d0: 7574 6669 6c65 2920 213d 2027 2720 616e  utfile) != '' an
+000179e0: 6420 6f73 2e70 6174 682e 6973 6162 7328  d os.path.isabs(
+000179f0: 696e 7075 7466 696c 6529 2065 6c73 6520  inputfile) else 
+00017a00: 272e 270a 2020 2020 2020 2020 7072 655f  '.'.        pre_
+00017a10: 6261 7365 203d 206f 732e 7061 7468 2e73  base = os.path.s
+00017a20: 706c 6974 6578 7428 6f73 2e70 6174 682e  plitext(os.path.
+00017a30: 6261 7365 6e61 6d65 2869 6e70 7574 6669  basename(inputfi
+00017a40: 6c65 2929 5b30 5d0a 2020 2020 2020 2020  le))[0].        
+00017a50: 7072 655f 7363 7269 7074 203d 2066 277b  pre_script = f'{
+00017a60: 696e 7075 7464 6972 7d2f 6b63 6c69 5f70  inputdir}/kcli_p
+00017a70: 7265 2e73 6827 2069 6620 7072 655f 6261  re.sh' if pre_ba
+00017a80: 7365 203d 3d20 276b 636c 695f 706c 616e  se == 'kcli_plan
+00017a90: 2720 656c 7365 2066 227b 696e 7075 7464  ' else f"{inputd
+00017aa0: 6972 7d2f 7b70 7265 5f62 6173 657d 5f70  ir}/{pre_base}_p
+00017ab0: 7265 2e73 6822 0a20 2020 2020 2020 2069  re.sh".        i
+00017ac0: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+00017ad0: 2870 7265 5f73 6372 6970 7429 3a0a 2020  (pre_script):.  
+00017ae0: 2020 2020 2020 2020 2020 7072 655f 7363            pre_sc
+00017af0: 7269 7074 5f73 686f 7274 203d 206f 732e  ript_short = os.
+00017b00: 7061 7468 2e62 6173 656e 616d 6528 7072  path.basename(pr
+00017b10: 655f 7363 7269 7074 290a 2020 2020 2020  e_script).      
+00017b20: 2020 2020 2020 6966 2070 7265 3a0a 2020        if pre:.  
+00017b30: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00017b40: 7269 6e74 2866 2252 756e 6e69 6e67 207b  rint(f"Running {
+00017b50: 7072 655f 7363 7269 7074 5f73 686f 7274  pre_script_short
+00017b60: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00017b70: 2020 2020 7769 7468 2054 656d 706f 7261      with Tempora
+00017b80: 7279 4469 7265 6374 6f72 7928 2920 6173  ryDirectory() as
+00017b90: 2074 6d70 6469 723a 0a20 2020 2020 2020   tmpdir:.       
+00017ba0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+00017bb0: 5f73 6372 6970 7420 3d20 7365 6c66 2e70  _script = self.p
+00017bc0: 726f 6365 7373 5f69 6e70 7574 6669 6c65  rocess_inputfile
+00017bd0: 2827 7878 7827 2c20 7072 655f 7363 7269  ('xxx', pre_scri
+00017be0: 7074 2c20 6f76 6572 7269 6465 733d 6f76  pt, overrides=ov
+00017bf0: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
+00017c00: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+00017c10: 6820 6f70 656e 2866 227b 746d 7064 6972  h open(f"{tmpdir
+00017c20: 7d2f 7072 652e 7368 222c 2027 7727 2920  }/pre.sh", 'w') 
+00017c30: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+00017c40: 2020 2020 2020 2020 2020 2020 2020 662e                f.
+00017c50: 7772 6974 6528 7072 655f 7363 7269 7074  write(pre_script
+00017c60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017c70: 2020 2020 2020 7072 655f 7275 6e20 3d20        pre_run = 
+00017c80: 7275 6e28 6627 6261 7368 207b 746d 7064  run(f'bash {tmpd
+00017c90: 6972 7d2f 7072 652e 7368 272c 2073 6865  ir}/pre.sh', she
+00017ca0: 6c6c 3d54 7275 652c 2073 7464 6f75 743d  ll=True, stdout=
+00017cb0: 5049 5045 2c20 7374 6465 7272 3d53 5444  PIPE, stderr=STD
+00017cc0: 4f55 542c 0a20 2020 2020 2020 2020 2020  OUT,.           
+00017cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ce0: 2020 2020 2020 2075 6e69 7665 7273 616c         universal
+00017cf0: 5f6e 6577 6c69 6e65 733d 5472 7565 290a  _newlines=True).
+00017d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d10: 2020 2020 6966 2070 7265 5f72 756e 2e72      if pre_run.r
+00017d20: 6574 7572 6e63 6f64 6520 213d 2030 3a0a  eturncode != 0:.
+00017d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d40: 2020 2020 2020 2020 6d73 6720 3d20 6622          msg = f"
+00017d50: 4973 7375 6520 7768 656e 2072 756e 6e69  Issue when runni
+00017d60: 6e67 207b 7072 655f 7363 7269 7074 5f73  ng {pre_script_s
+00017d70: 686f 7274 7d20 3a5c 6e7b 7072 655f 7275  hort} :\n{pre_ru
+00017d80: 6e2e 7374 646f 7574 7d22 0a20 2020 2020  n.stdout}".     
+00017d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017da0: 2020 2065 7272 6f72 286d 7367 290a 2020     error(msg).  
+00017db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017dc0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+00017dd0: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
+00017de0: 272c 2027 7265 6173 6f6e 273a 206d 7367  ', 'reason': msg
+00017df0: 7d0a 2020 2020 2020 2020 2020 2020 656c  }.            el
+00017e00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00017e10: 2020 2020 7761 726e 696e 6728 6622 536b      warning(f"Sk
+00017e20: 6970 7069 6e67 207b 7072 655f 7363 7269  ipping {pre_scri
+00017e30: 7074 5f73 686f 7274 7d20 6173 2072 6571  pt_short} as req
+00017e40: 7565 7374 6564 2229 0a20 2020 2020 2020  uested").       
+00017e50: 206b 6579 776f 7264 7320 3d20 7365 6c66   keywords = self
+00017e60: 2e6c 6973 745f 6b65 7977 6f72 6473 2829  .list_keywords()
+00017e70: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
+00017e80: 2069 6e20 736f 7274 6564 286f 7665 7272   in sorted(overr
+00017e90: 6964 6573 293a 0a20 2020 2020 2020 2020  ides):.         
+00017ea0: 2020 2069 6620 6b65 7920 696e 206b 6579     if key in key
+00017eb0: 776f 7264 733a 0a20 2020 2020 2020 2020  words:.         
+00017ec0: 2020 2020 2020 206b 6579 5f76 616c 7565         key_value
+00017ed0: 203d 2067 6574 6174 7472 2873 656c 662c   = getattr(self,
+00017ee0: 206b 6579 290a 2020 2020 2020 2020 2020   key).          
+00017ef0: 2020 2020 2020 6b65 795f 7479 7065 203d        key_type =
+00017f00: 2074 7970 6528 6b65 795f 7661 6c75 6529   type(key_value)
+00017f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017f20: 206f 7665 7272 6964 655f 6b65 795f 7479   override_key_ty
+00017f30: 7065 203d 2074 7970 6528 6f76 6572 7269  pe = type(overri
+00017f40: 6465 735b 6b65 795d 290a 2020 2020 2020  des[key]).      
+00017f50: 2020 2020 2020 2020 2020 6966 206b 6579            if key
+00017f60: 5f76 616c 7565 2069 7320 6e6f 7420 4e6f  _value is not No
+00017f70: 6e65 2061 6e64 206f 7665 7272 6964 6573  ne and overrides
+00017f80: 5b6b 6579 5d20 6973 206e 6f74 204e 6f6e  [key] is not Non
+00017f90: 6520 616e 6420 6b65 795f 7479 7065 2021  e and key_type !
+00017fa0: 3d20 6f76 6572 7269 6465 5f6b 6579 5f74  = override_key_t
+00017fb0: 7970 653a 0a20 2020 2020 2020 2020 2020  ype:.           
+00017fc0: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
+00017fd0: 2254 6865 2070 726f 7669 6465 6420 7061  "The provided pa
+00017fe0: 7261 6d65 7465 7220 7b6b 6579 7d20 6861  rameter {key} ha
+00017ff0: 7320 6120 7772 6f6e 6720 7479 7065 207b  s a wrong type {
+00018000: 6f76 6572 7269 6465 5f6b 6579 5f74 7970  override_key_typ
+00018010: 657d 2c20 6974 2073 686f 756c 6420 6265  e}, it should be
+00018020: 207b 6b65 795f 7479 7065 7d22 290a 2020   {key_type}").  
+00018030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018040: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
+00018050: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00018060: 6966 206f 7665 7272 6964 6573 5b6b 6579  if overrides[key
+00018070: 5d20 6973 206e 6f74 204e 6f6e 653a 0a20  ] is not None:. 
+00018080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018090: 2020 2073 6574 6174 7472 2873 656c 662c     setattr(self,
+000180a0: 206b 6579 2c20 6f76 6572 7269 6465 735b   key, overrides[
+000180b0: 6b65 795d 290a 2020 2020 2020 2020 766d  key]).        vm
+000180c0: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
+000180d0: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
+000180e0: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
+000180f0: 6e6f 7420 696e 2065 6e74 7269 6573 5b65  not in entries[e
+00018100: 6e74 7279 5d20 6f72 2065 6e74 7269 6573  ntry] or entries
+00018110: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
+00018120: 3d3d 2027 766d 275d 0a20 2020 2020 2020  == 'vm'].       
+00018130: 2064 6973 6b65 6e74 7269 6573 203d 205b   diskentries = [
+00018140: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
+00018150: 696e 2065 6e74 7269 6573 2069 6620 2774  in entries if 't
+00018160: 7970 6527 2069 6e20 656e 7472 6965 735b  ype' in entries[
+00018170: 656e 7472 795d 2061 6e64 2065 6e74 7269  entry] and entri
+00018180: 6573 5b65 6e74 7279 5d5b 2774 7970 6527  es[entry]['type'
+00018190: 5d20 3d3d 2027 6469 736b 275d 0a20 2020  ] == 'disk'].   
+000181a0: 2020 2020 206e 6574 776f 726b 656e 7472       networkentr
+000181b0: 6965 7320 3d20 5b65 6e74 7279 2066 6f72  ies = [entry for
+000181c0: 2065 6e74 7279 2069 6e20 656e 7472 6965   entry in entrie
+000181d0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+000181e0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+000181f0: 7479 7065 2720 696e 2065 6e74 7269 6573  type' in entries
+00018200: 5b65 6e74 7279 5d20 616e 6420 656e 7472  [entry] and entr
+00018210: 6965 735b 656e 7472 795d 5b27 7479 7065  ies[entry]['type
+00018220: 275d 203d 3d20 276e 6574 776f 726b 275d  '] == 'network']
+00018230: 0a20 2020 2020 2020 2063 6f6e 7461 696e  .        contain
+00018240: 6572 656e 7472 6965 7320 3d20 5b65 6e74  erentries = [ent
+00018250: 7279 2066 6f72 2065 6e74 7279 2069 6e20  ry for entry in 
+00018260: 656e 7472 6965 730a 2020 2020 2020 2020  entries.        
+00018270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018280: 2020 2020 6966 2027 7479 7065 2720 696e      if 'type' in
+00018290: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
+000182a0: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
+000182b0: 795d 5b27 7479 7065 275d 203d 3d20 2763  y]['type'] == 'c
+000182c0: 6f6e 7461 696e 6572 275d 0a20 2020 2020  ontainer'].     
+000182d0: 2020 2061 6e73 6962 6c65 656e 7472 6965     ansibleentrie
+000182e0: 7320 3d20 5b65 6e74 7279 2066 6f72 2065  s = [entry for e
+000182f0: 6e74 7279 2069 6e20 656e 7472 6965 730a  ntry in entries.
+00018300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018310: 2020 2020 2020 2020 2020 6966 2027 7479            if 'ty
+00018320: 7065 2720 696e 2065 6e74 7269 6573 5b65  pe' in entries[e
+00018330: 6e74 7279 5d20 616e 6420 656e 7472 6965  ntry] and entrie
+00018340: 735b 656e 7472 795d 5b27 7479 7065 275d  s[entry]['type']
+00018350: 203d 3d20 2761 6e73 6962 6c65 275d 0a20   == 'ansible']. 
+00018360: 2020 2020 2020 2070 726f 6669 6c65 656e         profileen
+00018370: 7472 6965 7320 3d20 5b65 6e74 7279 2066  tries = [entry f
+00018380: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
+00018390: 6965 730a 2020 2020 2020 2020 2020 2020  ies.            
+000183a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000183b0: 2027 7479 7065 2720 696e 2065 6e74 7269   'type' in entri
+000183c0: 6573 5b65 6e74 7279 5d20 616e 6420 656e  es[entry] and en
+000183d0: 7472 6965 735b 656e 7472 795d 5b27 7479  tries[entry]['ty
+000183e0: 7065 275d 203d 3d20 2770 726f 6669 6c65  pe'] == 'profile
+000183f0: 275d 0a20 2020 2020 2020 2069 6d61 6765  '].        image
+00018400: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
+00018410: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
+00018420: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
+00018430: 696e 0a20 2020 2020 2020 2020 2020 2020  in.             
+00018440: 2020 2020 2020 2020 2020 2065 6e74 7269             entri
+00018450: 6573 5b65 6e74 7279 5d20 616e 6420 2865  es[entry] and (e
+00018460: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
+00018470: 7970 6527 5d20 3d3d 2027 696d 6167 6527  ype'] == 'image'
+00018480: 206f 7220 656e 7472 6965 735b 656e 7472   or entries[entr
+00018490: 795d 5b27 7479 7065 275d 203d 3d20 2774  y]['type'] == 't
+000184a0: 656d 706c 6174 6527 295d 0a20 2020 2020  emplate')].     
+000184b0: 2020 2070 6f6f 6c65 6e74 7269 6573 203d     poolentries =
+000184c0: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
+000184d0: 7920 696e 2065 6e74 7269 6573 2069 6620  y in entries if 
+000184e0: 2774 7970 6527 2069 6e20 656e 7472 6965  'type' in entrie
+000184f0: 735b 656e 7472 795d 2061 6e64 2065 6e74  s[entry] and ent
+00018500: 7269 6573 5b65 6e74 7279 5d5b 2774 7970  ries[entry]['typ
+00018510: 6527 5d20 3d3d 2027 706f 6f6c 275d 0a20  e'] == 'pool']. 
+00018520: 2020 2020 2020 2070 6c61 6e65 6e74 7269         planentri
+00018530: 6573 203d 205b 656e 7472 7920 666f 7220  es = [entry for 
+00018540: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
+00018550: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
+00018560: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
+00018570: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
+00018580: 2774 7970 6527 5d20 3d3d 2027 706c 616e  'type'] == 'plan
+00018590: 275d 0a20 2020 2020 2020 2064 6e73 656e  '].        dnsen
+000185a0: 7472 6965 7320 3d20 5b65 6e74 7279 2066  tries = [entry f
+000185b0: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
+000185c0: 6965 7320 6966 2027 7479 7065 2720 696e  ies if 'type' in
+000185d0: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
+000185e0: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
+000185f0: 795d 5b27 7479 7065 275d 203d 3d20 2764  y]['type'] == 'd
+00018600: 6e73 275d 0a20 2020 2020 2020 206b 7562  ns'].        kub
+00018610: 6573 203d 205b 276b 7562 6527 2c20 2763  es = ['kube', 'c
+00018620: 6c75 7374 6572 275d 0a20 2020 2020 2020  luster'].       
+00018630: 206b 7562 6565 6e74 7269 6573 203d 205b   kubeentries = [
+00018640: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
+00018650: 696e 2065 6e74 7269 6573 2069 6620 2774  in entries if 't
+00018660: 7970 6527 2069 6e20 656e 7472 6965 735b  ype' in entries[
+00018670: 656e 7472 795d 2061 6e64 2065 6e74 7269  entry] and entri
+00018680: 6573 5b65 6e74 7279 5d5b 2774 7970 6527  es[entry]['type'
+00018690: 5d20 696e 206b 7562 6573 5d0a 2020 2020  ] in kubes].    
+000186a0: 2020 2020 6c62 7320 3d20 5b65 6e74 7279      lbs = [entry
+000186b0: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
+000186c0: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
+000186d0: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
+000186e0: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
+000186f0: 7472 795d 5b27 7479 7065 275d 203d 3d20  try]['type'] == 
+00018700: 276c 6f61 6462 616c 616e 6365 7227 5d0a  'loadbalancer'].
+00018710: 2020 2020 2020 2020 7367 7320 3d20 5b65          sgs = [e
+00018720: 6e74 7279 2066 6f72 2065 6e74 7279 2069  ntry for entry i
+00018730: 6e20 656e 7472 6965 7320 6966 2027 7479  n entries if 'ty
+00018740: 7065 2720 696e 2065 6e74 7269 6573 5b65  pe' in entries[e
+00018750: 6e74 7279 5d20 616e 6420 656e 7472 6965  ntry] and entrie
+00018760: 735b 656e 7472 795d 5b27 7479 7065 275d  s[entry]['type']
+00018770: 203d 3d20 2773 6563 7572 6974 7967 726f   == 'securitygro
+00018780: 7570 275d 0a20 2020 2020 2020 2062 7563  up'].        buc
+00018790: 6b65 7465 6e74 7269 6573 203d 205b 656e  ketentries = [en
+000187a0: 7472 7920 666f 7220 656e 7472 7920 696e  try for entry in
+000187b0: 2065 6e74 7269 6573 2069 6620 2774 7970   entries if 'typ
+000187c0: 6527 2069 6e20 656e 7472 6965 735b 656e  e' in entries[en
+000187d0: 7472 795d 2061 6e64 2065 6e74 7269 6573  try] and entries
+000187e0: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
+000187f0: 3d3d 2027 6275 636b 6574 275d 0a20 2020  == 'bucket'].   
+00018800: 2020 2020 2077 6f72 6b66 6c6f 7765 6e74       workflowent
+00018810: 7269 6573 203d 205b 656e 7472 7920 666f  ries = [entry fo
+00018820: 7220 656e 7472 7920 696e 2065 6e74 7269  r entry in entri
+00018830: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00018840: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00018850: 2027 7479 7065 2720 696e 2065 6e74 7269   'type' in entri
+00018860: 6573 5b65 6e74 7279 5d20 616e 6420 656e  es[entry] and en
+00018870: 7472 6965 735b 656e 7472 795d 5b27 7479  tries[entry]['ty
+00018880: 7065 275d 203d 3d20 2777 6f72 6b66 6c6f  pe'] == 'workflo
+00018890: 7727 5d0a 2020 2020 2020 2020 666f 7220  w'].        for 
+000188a0: 7020 696e 2070 726f 6669 6c65 656e 7472  p in profileentr
+000188b0: 6965 733a 0a20 2020 2020 2020 2020 2020  ies:.           
+000188c0: 2076 6d70 726f 6669 6c65 735b 705d 203d   vmprofiles[p] =
+000188d0: 2065 6e74 7269 6573 5b70 5d0a 2020 2020   entries[p].    
+000188e0: 2020 2020 6966 206e 6574 776f 726b 656e      if networken
+000188f0: 7472 6965 7320 616e 6420 6e6f 7420 6f6e  tries and not on
+00018900: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
+00018910: 2020 2020 2020 7070 7269 6e74 2822 4465        pprint("De
+00018920: 706c 6f79 696e 6720 4e65 7477 6f72 6b73  ploying Networks
+00018930: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00018940: 2020 666f 7220 6e65 7420 696e 206e 6574    for net in net
+00018950: 776f 726b 656e 7472 6965 733a 0a20 2020  workentries:.   
+00018960: 2020 2020 2020 2020 2020 2020 206e 6574               net
+00018970: 7072 6f66 696c 6520 3d20 656e 7472 6965  profile = entrie
+00018980: 735b 6e65 745d 0a20 2020 2020 2020 2020  s[net].         
+00018990: 2020 2020 2020 2069 6620 6b2e 6e65 745f         if k.net_
+000189a0: 6578 6973 7473 286e 6574 293a 0a20 2020  exists(net):.   
+000189b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189c0: 2070 7072 696e 7428 6622 4e65 7477 6f72   pprint(f"Networ
+000189d0: 6b20 7b6e 6574 7d20 736b 6970 7065 6421  k {net} skipped!
+000189e0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+000189f0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00018a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a10: 6369 6472 203d 206e 6574 7072 6f66 696c  cidr = netprofil
+00018a20: 652e 6765 7428 2763 6964 7227 290a 2020  e.get('cidr').  
+00018a30: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+00018a40: 7420 3d20 626f 6f6c 286e 6574 7072 6f66  t = bool(netprof
+00018a50: 696c 652e 6765 7428 276e 6174 272c 2054  ile.get('nat', T
+00018a60: 7275 6529 290a 2020 2020 2020 2020 2020  rue)).          
+00018a70: 2020 2020 2020 6966 2063 6964 7220 6973        if cidr is
+00018a80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00018a90: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+00018aa0: 6e67 2866 224d 6973 7369 6e67 2043 6964  ng(f"Missing Cid
+00018ab0: 7220 666f 7220 6e65 7477 6f72 6b20 7b6e  r for network {n
+00018ac0: 6574 7d2e 204e 6f74 2063 7265 6174 696e  et}. Not creatin
+00018ad0: 6720 6974 2e2e 2e22 290a 2020 2020 2020  g it...").      
+00018ae0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00018af0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+00018b00: 2020 2020 2020 2064 6863 7020 3d20 6e65         dhcp = ne
+00018b10: 7470 726f 6669 6c65 2e67 6574 2827 6468  tprofile.get('dh
+00018b20: 6370 272c 2054 7275 6529 0a20 2020 2020  cp', True).     
+00018b30: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
+00018b40: 6e20 3d20 6e65 7470 726f 6669 6c65 2e67  n = netprofile.g
+00018b50: 6574 2827 646f 6d61 696e 2729 0a20 2020  et('domain').   
+00018b60: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00018b70: 756c 7420 3d20 6b2e 6372 6561 7465 5f6e  ult = k.create_n
+00018b80: 6574 776f 726b 286e 616d 653d 6e65 742c  etwork(name=net,
+00018b90: 2063 6964 723d 6369 6472 2c20 6468 6370   cidr=cidr, dhcp
+00018ba0: 3d64 6863 702c 206e 6174 3d6e 6174 2c20  =dhcp, nat=nat, 
+00018bb0: 646f 6d61 696e 3d64 6f6d 6169 6e2c 2070  domain=domain, p
+00018bc0: 6c61 6e3d 706c 616e 2c0a 2020 2020 2020  lan=plan,.      
+00018bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018bf0: 2020 2020 6f76 6572 7269 6465 733d 6e65      overrides=ne
+00018c00: 7470 726f 6669 6c65 290a 2020 2020 2020  tprofile).      
+00018c10: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
+00018c20: 2e68 616e 646c 655f 7265 7370 6f6e 7365  .handle_response
+00018c30: 2872 6573 756c 742c 206e 6574 2c20 656c  (result, net, el
+00018c40: 656d 656e 743d 274e 6574 776f 726b 2027  ement='Network '
+00018c50: 290a 2020 2020 2020 2020 6966 2070 6f6f  ).        if poo
+00018c60: 6c65 6e74 7269 6573 2061 6e64 206e 6f74  lentries and not
+00018c70: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
+00018c80: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00018c90: 2244 6570 6c6f 7969 6e67 2050 6f6f 6c73  "Deploying Pools
+00018ca0: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00018cb0: 2020 706f 6f6c 7320 3d20 6b2e 6c69 7374    pools = k.list
+00018cc0: 5f70 6f6f 6c73 2829 0a20 2020 2020 2020  _pools().       
+00018cd0: 2020 2020 2066 6f72 2070 6f6f 6c20 696e       for pool in
+00018ce0: 2070 6f6f 6c65 6e74 7269 6573 3a0a 2020   poolentries:.  
+00018cf0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00018d00: 2070 6f6f 6c20 696e 2070 6f6f 6c73 3a0a   pool in pools:.
+00018d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d20: 2020 2020 7070 7269 6e74 2866 2250 6f6f      pprint(f"Poo
+00018d30: 6c20 7b70 6f6f 6c7d 2073 6b69 7070 6564  l {pool} skipped
+00018d40: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
+00018d50: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00018d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018d70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00018d80: 2020 2020 2020 2020 2020 2070 6f6f 6c70             poolp
+00018d90: 726f 6669 6c65 203d 2065 6e74 7269 6573  rofile = entries
+00018da0: 5b70 6f6f 6c5d 0a20 2020 2020 2020 2020  [pool].         
+00018db0: 2020 2020 2020 2020 2020 2070 6f6f 6c70             poolp
+00018dc0: 6174 6820 3d20 706f 6f6c 7072 6f66 696c  ath = poolprofil
+00018dd0: 652e 6765 7428 2770 6174 6827 290a 2020  e.get('path').  
+00018de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018df0: 2020 6966 2070 6f6f 6c70 6174 6820 6973    if poolpath is
+00018e00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00018e10: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00018e20: 6172 6e69 6e67 2866 2250 6f6f 6c20 7b70  arning(f"Pool {p
+00018e30: 6f6f 6c7d 2073 6b69 7070 6564 2061 7320  ool} skipped as 
+00018e40: 7061 7468 2069 7320 6d69 7373 696e 6721  path is missing!
+00018e50: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00018e60: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00018e70: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+00018e80: 2020 2020 2020 2020 6b2e 6372 6561 7465          k.create
+00018e90: 5f70 6f6f 6c28 706f 6f6c 2c20 706f 6f6c  _pool(pool, pool
+00018ea0: 7061 7468 290a 2020 2020 2020 2020 6966  path).        if
+00018eb0: 2069 6d61 6765 656e 7472 6965 7320 616e   imageentries an
+00018ec0: 6420 6e6f 7420 6f6e 6c79 6173 7365 7473  d not onlyassets
+00018ed0: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
+00018ee0: 7269 6e74 2822 4465 706c 6f79 696e 6720  rint("Deploying 
+00018ef0: 496d 6167 6573 2e2e 2e22 290a 2020 2020  Images...").    
+00018f00: 2020 2020 2020 2020 696d 6167 6573 203d          images =
+00018f10: 205b 6f73 2e70 6174 682e 6261 7365 6e61   [os.path.basena
+00018f20: 6d65 2874 2920 666f 7220 7420 696e 206b  me(t) for t in k
+00018f30: 2e76 6f6c 756d 6573 2829 5d0a 2020 2020  .volumes()].    
+00018f40: 2020 2020 2020 2020 666f 7220 696d 6167          for imag
+00018f50: 6520 696e 2069 6d61 6765 656e 7472 6965  e in imageentrie
+00018f60: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00018f70: 2020 2069 6d61 6765 7072 6f66 696c 6520     imageprofile 
+00018f80: 3d20 656e 7472 6965 735b 696d 6167 655d  = entries[image]
+00018f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018fa0: 2070 6f6f 6c20 3d20 696d 6167 6570 726f   pool = imagepro
+00018fb0: 6669 6c65 2e67 6574 2827 706f 6f6c 272c  file.get('pool',
+00018fc0: 2073 656c 662e 706f 6f6c 290a 2020 2020   self.pool).    
+00018fd0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+00018fe0: 6573 697a 6520 3d20 696d 6167 6570 726f  esize = imagepro
+00018ff0: 6669 6c65 2e67 6574 2827 7369 7a65 2729  file.get('size')
+00019000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019010: 2069 6d61 6765 7572 6c20 3d20 696d 6167   imageurl = imag
+00019020: 6570 726f 6669 6c65 2e67 6574 2827 7572  eprofile.get('ur
+00019030: 6c27 290a 2020 2020 2020 2020 2020 2020  l').            
+00019040: 2020 2020 6966 2069 6d61 6765 2069 6e20      if image in 
+00019050: 696d 6167 6573 3a0a 2020 2020 2020 2020  images:.        
+00019060: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00019070: 6e74 2866 2249 6d61 6765 207b 696d 6167  nt(f"Image {imag
+00019080: 657d 2073 6b69 7070 6564 2122 290a 2020  e} skipped!").  
+00019090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190a0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+000190b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000190c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000190d0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+000190e0: 6365 2869 6d61 6765 7572 6c2c 2073 7472  ce(imageurl, str
+000190f0: 2920 616e 6420 696d 6167 6575 726c 203d  ) and imageurl =
+00019100: 3d20 224e 6f6e 6522 3a0a 2020 2020 2020  = "None":.      
+00019110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019120: 2020 696d 6167 6575 726c 203d 204e 6f6e    imageurl = Non
+00019130: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00019140: 2020 2020 2020 636d 6420 3d20 696d 6167        cmd = imag
+00019150: 6570 726f 6669 6c65 2e67 6574 2827 636d  eprofile.get('cm
+00019160: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
+00019170: 2020 2020 2020 2020 7365 6c66 2e68 616e          self.han
+00019180: 646c 655f 686f 7374 2870 6f6f 6c3d 706f  dle_host(pool=po
+00019190: 6f6c 2c20 696d 6167 653d 696d 6167 652c  ol, image=image,
+000191a0: 2064 6f77 6e6c 6f61 643d 5472 7565 2c20   download=True, 
+000191b0: 636d 643d 636d 642c 2075 726c 3d69 6d61  cmd=cmd, url=ima
+000191c0: 6765 7572 6c2c 2073 697a 653d 696d 6167  geurl, size=imag
+000191d0: 6573 697a 6529 0a20 2020 2020 2020 2069  esize).        i
+000191e0: 6620 6275 636b 6574 656e 7472 6965 7320  f bucketentries 
+000191f0: 616e 6420 6e6f 7420 6f6e 6c79 6173 7365  and not onlyasse
+00019200: 7473 2061 6e64 2073 656c 662e 7479 7065  ts and self.type
+00019210: 2069 6e20 5b27 6177 7327 2c20 2767 6370   in ['aws', 'gcp
+00019220: 272c 2027 6f70 656e 7374 6163 6b27 5d3a  ', 'openstack']:
+00019230: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+00019240: 696e 7428 2244 6570 6c6f 7969 6e67 2042  int("Deploying B
+00019250: 7563 6b65 7420 456e 7472 6965 732e 2e2e  ucket Entries...
+00019260: 2229 0a20 2020 2020 2020 2020 2020 2066  ").            f
+00019270: 6f72 2062 7563 6b65 7465 6e74 7279 2069  or bucketentry i
+00019280: 6e20 6275 636b 6574 656e 7472 6965 733a  n bucketentries:
+00019290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000192a0: 2062 7563 6b65 7470 726f 6669 6c65 203d   bucketprofile =
+000192b0: 2065 6e74 7269 6573 5b62 7563 6b65 7465   entries[buckete
+000192c0: 6e74 7279 5d0a 2020 2020 2020 2020 2020  ntry].          
+000192d0: 2020 2020 2020 5f66 696c 6573 203d 2062        _files = b
+000192e0: 7563 6b65 7470 726f 6669 6c65 2e67 6574  ucketprofile.get
+000192f0: 2827 6669 6c65 7327 2c20 5b5d 290a 2020  ('files', []).  
+00019300: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00019310: 6c66 2e6b 2e63 7265 6174 655f 6275 636b  lf.k.create_buck
+00019320: 6574 2862 7563 6b65 7465 6e74 7279 290a  et(bucketentry).
+00019330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019340: 666f 7220 5f66 696c 2069 6e20 5f66 696c  for _fil in _fil
+00019350: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00019360: 2020 2020 2020 2020 7365 6c66 2e6b 2e75          self.k.u
+00019370: 706c 6f61 645f 746f 5f62 7563 6b65 7428  pload_to_bucket(
+00019380: 6275 636b 6574 656e 7472 792c 205f 6669  bucketentry, _fi
+00019390: 6c29 0a20 2020 2020 2020 2074 656d 706b  l).        tempk
+000193a0: 6579 203d 206f 7665 7272 6964 6573 2e67  ey = overrides.g
+000193b0: 6574 2827 7465 6d70 6b65 7927 2c20 4661  et('tempkey', Fa
+000193c0: 6c73 6529 206f 7220 7365 6c66 2e74 656d  lse) or self.tem
+000193d0: 706b 6579 0a20 2020 2020 2020 2069 6620  pkey.        if 
+000193e0: 7465 6d70 6b65 793a 0a20 2020 2020 2020  tempkey:.       
+000193f0: 2020 2020 2074 656d 706b 6579 6469 7220       tempkeydir 
+00019400: 3d20 5465 6d70 6f72 6172 7944 6972 6563  = TemporaryDirec
+00019410: 746f 7279 2829 0a20 2020 2020 2020 2020  tory().         
+00019420: 2020 206f 7665 7272 6964 6573 5b27 7465     overrides['te
+00019430: 6d70 6b65 7964 6972 275d 203d 2074 656d  mpkeydir'] = tem
+00019440: 706b 6579 6469 720a 2020 2020 2020 2020  pkeydir.        
+00019450: 2020 2020 6f76 6572 7269 6465 735b 2774      overrides['t
+00019460: 656d 706b 6579 6469 726b 6565 7027 5d20  empkeydirkeep'] 
+00019470: 3d20 5472 7565 0a20 2020 2020 2020 2069  = True.        i
+00019480: 6620 706c 616e 656e 7472 6965 733a 0a20  f planentries:. 
+00019490: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+000194a0: 7428 2244 6570 6c6f 7969 6e67 2050 6c61  t("Deploying Pla
+000194b0: 6e73 2e2e 2e22 290a 2020 2020 2020 2020  ns...").        
+000194c0: 2020 2020 666f 7220 706c 616e 656e 7472      for planentr
+000194d0: 7920 696e 2070 6c61 6e65 6e74 7269 6573  y in planentries
+000194e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000194f0: 2020 6465 7461 696c 7320 3d20 656e 7472    details = entr
+00019500: 6965 735b 706c 616e 656e 7472 795d 0a20  ies[planentry]. 
+00019510: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00019520: 6c61 6e75 726c 203d 2064 6574 6169 6c73  lanurl = details
+00019530: 2e67 6574 2827 7572 6c27 290a 2020 2020  .get('url').    
+00019540: 2020 2020 2020 2020 2020 2020 706c 616e              plan
+00019550: 6669 6c65 203d 2064 6574 6169 6c73 2e67  file = details.g
+00019560: 6574 2827 6669 6c65 2729 0a20 2020 2020  et('file').     
+00019570: 2020 2020 2020 2020 2020 2069 6620 706c             if pl
+00019580: 616e 7572 6c20 6973 204e 6f6e 6520 616e  anurl is None an
+00019590: 6420 706c 616e 6669 6c65 2069 7320 4e6f  d planfile is No
+000195a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000195b0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+000195c0: 6622 4d69 7373 696e 6720 5572 6c2f 4669  f"Missing Url/Fi
+000195d0: 6c65 2066 6f72 2070 6c61 6e20 7b70 6c61  le for plan {pla
+000195e0: 6e65 6e74 7279 7d2e 204e 6f74 2063 7265  nentry}. Not cre
+000195f0: 6174 696e 6720 6974 2e2e 2e22 290a 2020  ating it...").  
+00019600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019610: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+00019620: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00019630: 706c 616e 7572 6c20 6973 206e 6f74 204e  planurl is not N
+00019640: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00019650: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
+00019660: 706c 616e 656e 7472 790a 2020 2020 2020  planentry.      
+00019670: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00019680: 206e 6f74 2070 6c61 6e75 726c 2e65 6e64   not planurl.end
+00019690: 7377 6974 6828 2779 6d6c 2729 3a0a 2020  swith('yml'):.  
+000196a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196b0: 2020 2020 2020 706c 616e 7572 6c20 3d20        planurl = 
+000196c0: 6622 7b70 6c61 6e75 726c 7d2f 6b63 6c69  f"{planurl}/kcli
+000196d0: 5f70 6c61 6e2e 796d 6c22 0a20 2020 2020  _plan.yml".     
+000196e0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000196f0: 272f 2720 696e 2070 6c61 6e66 696c 653a  '/' in planfile:
+00019700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019710: 2020 2020 2070 6174 6820 3d20 6f73 2e70       path = os.p
+00019720: 6174 682e 6469 726e 616d 6528 706c 616e  ath.dirname(plan
+00019730: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+00019740: 2020 2020 2020 2020 2020 696e 7075 7466            inputf
+00019750: 696c 6520 3d20 6f73 2e70 6174 682e 6261  ile = os.path.ba
+00019760: 7365 6e61 6d65 2870 6c61 6e66 696c 6529  sename(planfile)
+00019770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019780: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00019790: 2020 2020 2020 2020 2020 2070 6174 6820             path 
+000197a0: 3d20 272e 270a 2020 2020 2020 2020 2020  = '.'.          
+000197b0: 2020 2020 2020 2020 2020 696e 7075 7466            inputf
+000197c0: 696c 6520 3d20 706c 616e 656e 7472 790a  ile = planentry.
+000197d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197e0: 6966 206e 6f5f 6f76 6572 7269 6465 7320  if no_overrides 
+000197f0: 616e 6420 7061 7261 6d65 7465 7273 3a0a  and parameters:.
+00019800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019810: 2020 2020 7070 7269 6e74 2822 5573 696e      pprint("Usin
+00019820: 6720 7061 7261 6d65 7465 7273 2066 726f  g parameters fro
+00019830: 6d20 6661 7468 6572 2070 6c61 6e20 696e  m father plan in
+00019840: 2063 6869 6c64 206f 6e65 7322 290a 2020   child ones").  
+00019850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019860: 2020 666f 7220 6f76 6572 7269 6465 2069    for override i
+00019870: 6e20 6f76 6572 7269 6465 733a 0a20 2020  n overrides:.   
+00019880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019890: 2020 2020 2070 7269 6e74 2822 5573 696e       print("Usin
+000198a0: 6720 7061 7261 6d65 7465 7220 2573 3a20  g parameter %s: 
+000198b0: 2573 2220 2520 286f 7665 7272 6964 652c  %s" % (override,
+000198c0: 206f 7665 7272 6964 6573 5b6f 7665 7272   overrides[overr
+000198d0: 6964 655d 2929 0a20 2020 2020 2020 2020  ide])).         
+000198e0: 2020 2020 2020 2073 656c 662e 706c 616e         self.plan
+000198f0: 2870 6c61 6e2c 2061 6e73 6962 6c65 3d46  (plan, ansible=F
+00019900: 616c 7365 2c20 7572 6c3d 706c 616e 7572  alse, url=planur
+00019910: 6c2c 2070 6174 683d 7061 7468 2c20 636f  l, path=path, co
+00019920: 6e74 6169 6e65 723d 4661 6c73 652c 2069  ntainer=False, i
+00019930: 6e70 7574 6669 6c65 3d69 6e70 7574 6669  nputfile=inputfi
+00019940: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+00019950: 2020 2020 2020 2020 2020 2020 2020 6f76                ov
+00019960: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
+00019970: 732c 2065 6d62 6564 6465 643d 656d 6265  s, embedded=embe
+00019980: 6464 6564 2c20 646f 776e 6c6f 6164 3d64  dded, download=d
+00019990: 6f77 6e6c 6f61 6429 0a20 2020 2020 2020  ownload).       
+000199a0: 2069 6620 6b75 6265 656e 7472 6965 7320   if kubeentries 
+000199b0: 616e 6420 6e6f 7420 6f6e 6c79 6173 7365  and not onlyasse
+000199c0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+000199d0: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
+000199e0: 6720 4b75 6265 2045 6e74 7269 6573 2e2e  g Kube Entries..
+000199f0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00019a00: 646e 7363 6c69 656e 7473 203d 207b 7d0a  dnsclients = {}.
+00019a10: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
+00019a20: 7468 7265 6164 6564 203d 2054 7275 6520  threaded = True 
+00019a30: 6966 206c 656e 286b 7562 6565 6e74 7269  if len(kubeentri
+00019a40: 6573 2920 3e20 3120 656c 7365 2046 616c  es) > 1 else Fal
+00019a50: 7365 0a20 2020 2020 2020 2020 2020 2069  se.            i
+00019a60: 6620 6b75 6265 7468 7265 6164 6564 3a0a  f kubethreaded:.
+00019a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a80: 7761 726e 696e 6728 224c 6175 6e63 6869  warning("Launchi
+00019a90: 6e67 2065 6163 6820 636c 7573 7465 7220  ng each cluster 
+00019aa0: 696e 2061 2074 6872 6561 6420 6173 2074  in a thread as t
+00019ab0: 6865 7265 2069 7320 6d6f 7265 2074 6861  here is more tha
+00019ac0: 6e20 6f6e 6520 656e 7472 792e 2e2e 2229  n one entry...")
+00019ad0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00019ae0: 2063 6c75 7374 6572 2069 6e20 6b75 6265   cluster in kube
+00019af0: 656e 7472 6965 733a 0a20 2020 2020 2020  entries:.       
+00019b00: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00019b10: 6622 4465 706c 6f79 696e 6720 436c 7573  f"Deploying Clus
+00019b20: 7465 7220 7b63 6c75 7374 6572 7d2e 2e2e  ter {cluster}...
+00019b30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00019b40: 2020 206b 7562 6570 726f 6669 6c65 203d     kubeprofile =
+00019b50: 2065 6e74 7269 6573 5b63 6c75 7374 6572   entries[cluster
+00019b60: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00019b70: 2020 6b75 6265 636c 6965 6e74 203d 206b    kubeclient = k
+00019b80: 7562 6570 726f 6669 6c65 2e67 6574 2827  ubeprofile.get('
+00019b90: 636c 6965 6e74 2729 0a20 2020 2020 2020  client').       
+00019ba0: 2020 2020 2020 2020 2069 6620 6b75 6265           if kube
+00019bb0: 636c 6965 6e74 2069 7320 4e6f 6e65 3a0a  client is None:.
+00019bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019bd0: 2020 2020 6375 7272 656e 7463 6f6e 6669      currentconfi
+00019be0: 6720 3d20 7365 6c66 0a20 2020 2020 2020  g = self.       
+00019bf0: 2020 2020 2020 2020 2065 6c69 6620 6b75           elif ku
+00019c00: 6265 636c 6965 6e74 2069 6e20 7365 6c66  beclient in self
+00019c10: 2e63 6c69 656e 7473 3a0a 2020 2020 2020  .clients:.      
+00019c20: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+00019c30: 7272 656e 7463 6f6e 6669 6720 3d20 4b63  rrentconfig = Kc
+00019c40: 6f6e 6669 6728 636c 6965 6e74 3d6b 7562  onfig(client=kub
+00019c50: 6563 6c69 656e 7429 0a20 2020 2020 2020  eclient).       
+00019c60: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00019c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c80: 2020 2065 7272 6f72 2866 2243 6c69 656e     error(f"Clien
+00019c90: 7420 7b6b 7562 6563 6c69 656e 747d 206e  t {kubeclient} n
+00019ca0: 6f74 2066 6f75 6e64 2e20 736b 6970 7065  ot found. skippe
+00019cb0: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
+00019cc0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00019cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019ce0: 206b 7562 6574 7970 6520 3d20 6b75 6265   kubetype = kube
+00019cf0: 7072 6f66 696c 652e 6765 7428 276b 7562  profile.get('kub
+00019d00: 6574 7970 6527 2920 6f72 206b 7562 6570  etype') or kubep
+00019d10: 726f 6669 6c65 2e67 6574 2827 636c 7573  rofile.get('clus
+00019d20: 7465 7274 7970 6527 2c20 2767 656e 6572  tertype', 'gener
+00019d30: 6963 2729 0a20 2020 2020 2020 2020 2020  ic').           
+00019d40: 2020 2020 206b 7562 655f 6f76 6572 7269       kube_overri
+00019d50: 6465 7320 3d20 6f76 6572 7269 6465 732e  des = overrides.
+00019d60: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
+00019d70: 2020 2020 2020 206b 7562 655f 6f76 6572         kube_over
+00019d80: 7269 6465 732e 7570 6461 7465 286b 7562  rides.update(kub
+00019d90: 6570 726f 6669 6c65 290a 2020 2020 2020  eprofile).      
+00019da0: 2020 2020 2020 2020 2020 6b75 6265 5f6f            kube_o
+00019db0: 7665 7272 6964 6573 5b27 636c 7573 7465  verrides['cluste
+00019dc0: 7227 5d20 3d20 636c 7573 7465 720a 2020  r'] = cluster.  
+00019dd0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00019de0: 6973 7469 6e67 5f63 746c 706c 616e 6573  isting_ctlplanes
+00019df0: 203d 205b 7620 666f 7220 7620 696e 2063   = [v for v in c
+00019e00: 7572 7265 6e74 636f 6e66 6967 2e6b 2e6c  urrentconfig.k.l
+00019e10: 6973 7428 2920 6966 2066 277b 636c 7573  ist() if f'{clus
+00019e20: 7465 727d 2d63 746c 706c 616e 6527 2069  ter}-ctlplane' i
+00019e30: 6e20 765b 276e 616d 6527 5d5d 0a20 2020  n v['name']].   
+00019e40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00019e50: 6578 6973 7469 6e67 5f63 746c 706c 616e  existing_ctlplan
+00019e60: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00019e70: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00019e80: 2243 6c75 7374 6572 207b 636c 7573 7465  "Cluster {cluste
+00019e90: 727d 2066 6f75 6e64 2e20 736b 6970 7065  r} found. skippe
+00019ea0: 6421 2229 0a20 2020 2020 2020 2020 2020  d!").           
+00019eb0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00019ec0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00019ed0: 2020 6966 206b 7562 6574 7970 6520 6e6f    if kubetype no
+00019ee0: 7420 696e 205b 2767 656e 6572 6963 272c  t in ['generic',
+00019ef0: 2027 6f70 656e 7368 6966 7427 2c20 2768   'openshift', 'h
+00019f00: 7970 6572 7368 6966 7427 2c20 276d 6963  ypershift', 'mic
+00019f10: 726f 7368 6966 7427 2c20 276b 3373 272c  roshift', 'k3s',
+00019f20: 2027 676b 6527 2c20 2765 6b73 275d 3a0a   'gke', 'eks']:.
+00019f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f40: 2020 2020 7761 726e 696e 6728 6622 496e      warning(f"In
+00019f50: 636f 7272 6563 7420 6b75 6265 7479 7065  correct kubetype
+00019f60: 207b 6b75 6265 7479 7065 7d20 7370 6563   {kubetype} spec
+00019f70: 6966 6965 642e 2073 6b69 7070 6564 2122  ified. skipped!"
+00019f80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019f90: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00019fa0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00019fb0: 6620 6b75 6265 7468 7265 6164 6564 3a0a  f kubethreaded:.
+00019fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fd0: 2020 2020 6b75 6265 5f6f 7665 7272 6964      kube_overrid
+00019fe0: 6573 5b27 7573 655f 6578 6973 7469 6e67  es['use_existing
+00019ff0: 5f6f 7065 6e73 6869 6674 275d 203d 2054  _openshift'] = T
+0001a000: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0001a010: 2020 2020 2020 2020 6e65 775f 6172 6773          new_args
+0001a020: 203d 2028 706c 616e 2c20 6b75 6265 7479   = (plan, kubety
+0001a030: 7065 2c20 6b75 6265 5f6f 7665 7272 6964  pe, kube_overrid
+0001a040: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+0001a050: 2020 2020 2020 2020 7420 3d20 7468 7265          t = thre
+0001a060: 6164 696e 672e 5468 7265 6164 2874 6172  ading.Thread(tar
+0001a070: 6765 743d 7365 6c66 2e74 6872 6561 6465  get=self.threade
+0001a080: 645f 6372 6561 7465 5f6b 7562 652c 2061  d_create_kube, a
+0001a090: 7267 733d 6e65 775f 6172 6773 290a 2020  rgs=new_args).  
+0001a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0b0: 2020 7468 7265 6164 732e 6170 7065 6e64    threads.append
+0001a0c0: 2874 290a 2020 2020 2020 2020 2020 2020  (t).            
+0001a0d0: 2020 2020 2020 2020 742e 7374 6172 7428          t.start(
+0001a0e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a0f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001a100: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0001a110: 656e 7463 6f6e 6669 672e 6372 6561 7465  entconfig.create
+0001a120: 5f6b 7562 6528 706c 616e 2c20 6b75 6265  _kube(plan, kube
+0001a130: 7479 7065 2c20 6f76 6572 7269 6465 733d  type, overrides=
+0001a140: 6b75 6265 5f6f 7665 7272 6964 6573 290a  kube_overrides).
+0001a150: 2020 2020 2020 2020 766d 636c 6965 6e74          vmclient
+0001a160: 7320 3d20 5b5d 0a20 2020 2020 2020 2069  s = [].        i
+0001a170: 6620 766d 656e 7472 6965 733a 0a20 2020  f vmentries:.   
+0001a180: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0001a190: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
+0001a1a0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0001a1b0: 6e74 2822 4465 706c 6f79 696e 6720 566d  nt("Deploying Vm
+0001a1c0: 732e 2e2e 2229 0a20 2020 2020 2020 2020  s...").         
+0001a1d0: 2020 2076 6d63 6f75 6e74 6572 203d 2030     vmcounter = 0
+0001a1e0: 0a20 2020 2020 2020 2020 2020 2068 6f73  .            hos
+0001a1f0: 7473 203d 207b 7d0a 2020 2020 2020 2020  ts = {}.        
+0001a200: 2020 2020 766d 735f 746f 5f68 6f73 7420      vms_to_host 
+0001a210: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0001a220: 2062 6173 6570 6c61 6e73 203d 205b 5d0a   baseplans = [].
+0001a230: 2020 2020 2020 2020 2020 2020 766d 6e61              vmna
+0001a240: 6d65 7320 3d20 5b6e 616d 6520 666f 7220  mes = [name for 
+0001a250: 6e61 6d65 2069 6e20 766d 656e 7472 6965  name in vmentrie
+0001a260: 735d 0a20 2020 2020 2020 2020 2020 2069  s].            i
+0001a270: 6620 6261 7365 6669 6c65 2069 7320 6e6f  f basefile is no
+0001a280: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0001a290: 2020 2020 2020 2020 6261 7365 6469 7220          basedir 
+0001a2a0: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
+0001a2b0: 6528 696e 7075 7466 696c 6529 2069 6620  e(inputfile) if 
+0001a2c0: 6f73 2e70 6174 682e 6973 6162 7328 696e  os.path.isabs(in
+0001a2d0: 7075 7466 696c 6529 2065 6c73 6520 272e  putfile) else '.
+0001a2e0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0001a2f0: 2020 6261 7365 696e 7075 7466 696c 6520    baseinputfile 
+0001a300: 3d20 6622 7b62 6173 6564 6972 7d2f 7b62  = f"{basedir}/{b
+0001a310: 6173 6566 696c 657d 220a 2020 2020 2020  asefile}".      
+0001a320: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
+0001a330: 7461 696e 6572 5f6d 6f64 6528 2920 616e  tainer_mode() an
+0001a340: 6420 6e6f 7420 6f73 2e70 6174 682e 6973  d not os.path.is
+0001a350: 6162 7328 6261 7365 6669 6c65 2920 616e  abs(basefile) an
+0001a360: 6420 272f 776f 726b 6469 7227 206e 6f74  d '/workdir' not
+0001a370: 2069 6e20 6261 7365 6469 723a 0a20 2020   in basedir:.   
+0001a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a390: 2062 6173 6569 6e70 7574 6669 6c65 203d   baseinputfile =
+0001a3a0: 2066 222f 776f 726b 6469 722f 7b62 6173   f"/workdir/{bas
+0001a3b0: 6564 6972 7d2f 7b62 6173 6566 696c 657d  edir}/{basefile}
+0001a3c0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0001a3d0: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
+0001a3e0: 706c 616e 2870 6c61 6e2c 2069 6e70 7574  plan(plan, input
+0001a3f0: 6669 6c65 3d62 6173 6569 6e70 7574 6669  file=baseinputfi
+0001a400: 6c65 2c20 6f76 6572 7269 6465 733d 6f76  le, overrides=ov
+0001a410: 6572 7269 6465 732c 2065 7863 6c75 6465  errides, exclude
+0001a420: 766d 733d 766d 6e61 6d65 732c 0a20 2020  vms=vmnames,.   
+0001a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a450: 6261 7365 6d6f 6465 3d54 7275 652c 206f  basemode=True, o
+0001a460: 6e6c 7961 7373 6574 733d 6f6e 6c79 6173  nlyassets=onlyas
+0001a470: 7365 7473 290a 2020 2020 2020 2020 2020  sets).          
+0001a480: 2020 2020 2020 6966 2072 6573 756c 745b        if result[
+0001a490: 2772 6573 756c 7427 5d20 213d 2027 7375  'result'] != 'su
+0001a4a0: 6363 6573 7327 3a0a 2020 2020 2020 2020  ccess':.        
+0001a4b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001a4c0: 726e 2072 6573 756c 740a 2020 2020 2020  rn result.      
+0001a4d0: 2020 2020 2020 2020 2020 6261 7365 706c            basepl
+0001a4e0: 616e 732e 6170 7065 6e64 2862 6173 6566  ans.append(basef
+0001a4f0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+0001a500: 2076 6d72 756c 6573 5f73 7472 6963 7420   vmrules_strict 
+0001a510: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+0001a520: 2776 6d72 756c 6573 5f73 7472 6963 7427  'vmrules_strict'
+0001a530: 2c20 7365 6c66 2e76 6d72 756c 6573 5f73  , self.vmrules_s
+0001a540: 7472 6963 7429 0a20 2020 2020 2020 2020  trict).         
+0001a550: 2020 2066 6f72 206e 616d 6520 696e 2076     for name in v
+0001a560: 6d65 6e74 7269 6573 3a0a 2020 2020 2020  mentries:.      
+0001a570: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+0001a580: 6520 696e 2065 7863 6c75 6465 766d 733a  e in excludevms:
+0001a590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a5a0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+0001a5b0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001a5c0: 7272 656e 7470 6c61 6e64 6972 203d 2062  rrentplandir = b
+0001a5d0: 6173 6564 6972 0a20 2020 2020 2020 2020  asedir.         
+0001a5e0: 2020 2020 2020 2069 6620 6c65 6e28 766d         if len(vm
+0001a5f0: 656e 7472 6965 7329 203d 3d20 3120 616e  entries) == 1 an
+0001a600: 6420 276e 616d 6527 2069 6e20 6f76 6572  d 'name' in over
+0001a610: 7269 6465 733a 0a20 2020 2020 2020 2020  rides:.         
+0001a620: 2020 2020 2020 2020 2020 206e 6577 6e61             newna
+0001a630: 6d65 203d 206f 7665 7272 6964 6573 5b27  me = overrides['
+0001a640: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
+0001a650: 2020 2020 2020 2020 2020 2070 726f 6669             profi
+0001a660: 6c65 203d 2065 6e74 7269 6573 5b6e 616d  le = entries[nam
+0001a670: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+0001a680: 2020 2020 2020 206e 616d 6520 3d20 6e65         name = ne
+0001a690: 776e 616d 650a 2020 2020 2020 2020 2020  wname.          
+0001a6a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
 0001a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6c0: 2020 2020 2020 6261 7365 766d 203d 2070        basevm = p
-0001a6d0: 726f 6669 6c65 5b27 6261 7365 766d 275d  rofile['basevm']
-0001a6e0: 2069 6620 2762 6173 6576 6d27 2069 6e20   if 'basevm' in 
-0001a6f0: 7072 6f66 696c 6520 656c 7365 206e 616d  profile else nam
-0001a700: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001a710: 2020 2020 2020 2020 2020 6966 2062 6173            if bas
-0001a720: 6570 6c61 6e20 6e6f 7420 696e 2062 6173  eplan not in bas
-0001a730: 6570 6c61 6e73 3a0a 2020 2020 2020 2020  eplans:.        
-0001a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a750: 2020 2020 7365 6c66 2e70 6c61 6e28 706c      self.plan(pl
-0001a760: 616e 2c20 696e 7075 7466 696c 653d 6261  an, inputfile=ba
-0001a770: 7365 696e 7075 7466 696c 652c 206f 7665  seinputfile, ove
-0001a780: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-0001a790: 2c20 6578 636c 7564 6576 6d73 3d76 6d6e  , excludevms=vmn
-0001a7a0: 616d 6573 2c0a 2020 2020 2020 2020 2020  ames,.          
-0001a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7c0: 2020 2020 2020 2020 2020 2020 6261 7365              base
-0001a7d0: 6d6f 6465 3d54 7275 652c 206f 6e6c 7961  mode=True, onlya
-0001a7e0: 7373 6574 733d 6f6e 6c79 6173 7365 7473  ssets=onlyassets
-0001a7f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a800: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-0001a810: 7365 706c 616e 732e 6170 7065 6e64 2862  seplans.append(b
-0001a820: 6173 6570 6c61 6e29 0a20 2020 2020 2020  aseplan).       
-0001a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a840: 2062 6173 6569 6e66 6f20 3d20 7365 6c66   baseinfo = self
-0001a850: 2e70 726f 6365 7373 5f69 6e70 7574 6669  .process_inputfi
-0001a860: 6c65 2870 6c61 6e2c 2062 6173 6569 6e70  le(plan, baseinp
-0001a870: 7574 6669 6c65 2c20 6f76 6572 7269 6465  utfile, override
-0001a880: 733d 6f76 6572 7269 6465 732c 2066 756c  s=overrides, ful
-0001a890: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
+0001a6c0: 7072 6f66 696c 6520 3d20 656e 7472 6965  profile = entrie
+0001a6d0: 735b 6e61 6d65 5d0a 2020 2020 2020 2020  s[name].        
+0001a6e0: 2020 2020 2020 2020 6966 2027 6e61 6d65          if 'name
+0001a6f0: 2720 696e 2070 726f 6669 6c65 3a0a 2020  ' in profile:.  
+0001a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a710: 2020 6e61 6d65 203d 2070 726f 6669 6c65    name = profile
+0001a720: 5b27 6e61 6d65 275d 0a20 2020 2020 2020  ['name'].       
+0001a730: 2020 2020 2020 2020 2069 6620 2762 6173           if 'bas
+0001a740: 6576 6d27 2069 6e20 7072 6f66 696c 6520  evm' in profile 
+0001a750: 6f72 2027 6261 7365 706c 616e 2720 696e  or 'baseplan' in
+0001a760: 2070 726f 6669 6c65 3a0a 2020 2020 2020   profile:.      
+0001a770: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0001a780: 7365 7072 6f66 696c 6520 3d20 7b7d 0a20  seprofile = {}. 
+0001a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7a0: 2020 2061 7070 656e 646b 6579 7320 3d20     appendkeys = 
+0001a7b0: 5b27 6469 736b 7327 2c20 276e 6574 7327  ['disks', 'nets'
+0001a7c0: 2c20 2766 696c 6573 272c 2027 7363 7269  , 'files', 'scri
+0001a7d0: 7074 7327 2c20 2763 6d64 7327 5d0a 2020  pts', 'cmds'].  
+0001a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7f0: 2020 6966 2027 6261 7365 706c 616e 2720    if 'baseplan' 
+0001a800: 696e 2070 726f 6669 6c65 3a0a 2020 2020  in profile:.    
+0001a810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a820: 2020 2020 6261 7365 706c 616e 203d 2070      baseplan = p
+0001a830: 726f 6669 6c65 5b27 6261 7365 706c 616e  rofile['baseplan
+0001a840: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+0001a850: 2020 2020 2020 2020 2020 2062 6173 6564             based
+0001a860: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
+0001a870: 6e61 6d65 2869 6e70 7574 6669 6c65 2920  name(inputfile) 
+0001a880: 6966 2027 2f27 2069 6e20 696e 7075 7466  if '/' in inputf
+0001a890: 696c 6520 656c 7365 2027 2e27 0a20 2020  ile else '.'.   
 0001a8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8b0: 6261 7365 7072 6f66 696c 6520 3d20 6261  baseprofile = ba
-0001a8c0: 7365 696e 666f 5b30 5d5b 6261 7365 766d  seinfo[0][basevm
-0001a8d0: 5d20 6966 2062 6173 6576 6d20 696e 2062  ] if basevm in b
-0001a8e0: 6173 6569 6e66 6f5b 305d 2065 6c73 6520  aseinfo[0] else 
-0001a8f0: 7b7d 0a20 2020 2020 2020 2020 2020 2020  {}.             
-0001a900: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0001a910: 6e74 706c 616e 6469 7220 3d20 6261 7365  ntplandir = base
-0001a920: 696e 666f 5b33 5d20 6966 206f 732e 7061  info[3] if os.pa
-0001a930: 7468 2e69 7361 6273 2862 6173 6569 6e66  th.isabs(baseinf
-0001a940: 6f5b 335d 2920 656c 7365 2027 2e27 0a20  o[3]) else '.'. 
+0001a8b0: 2020 2020 2062 6173 6569 6e70 7574 6669       baseinputfi
+0001a8c0: 6c65 203d 2066 227b 6261 7365 6469 727d  le = f"{basedir}
+0001a8d0: 2f7b 6261 7365 706c 616e 7d22 0a20 2020  /{baseplan}".   
+0001a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8f0: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
+0001a900: 725f 6d6f 6465 2829 2061 6e64 206e 6f74  r_mode() and not
+0001a910: 206f 732e 7061 7468 2e69 7361 6273 2862   os.path.isabs(b
+0001a920: 6173 6570 6c61 6e29 2061 6e64 2027 2f77  aseplan) and '/w
+0001a930: 6f72 6b64 6972 2720 6e6f 7420 696e 2062  orkdir' not in b
+0001a940: 6173 6564 6972 3a0a 2020 2020 2020 2020  asedir:.        
 0001a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a960: 2020 2065 6c69 6620 2762 6173 6576 6d27     elif 'basevm'
-0001a970: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
-0001a980: 7072 6f66 696c 655b 2762 6173 6576 6d27  profile['basevm'
-0001a990: 5d20 696e 2062 6173 6565 6e74 7269 6573  ] in baseentries
-0001a9a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a9b0: 2020 2020 2020 2020 2020 6261 7365 7072            basepr
-0001a9c0: 6f66 696c 6520 3d20 6261 7365 656e 7472  ofile = baseentr
-0001a9d0: 6965 735b 7072 6f66 696c 655b 2762 6173  ies[profile['bas
-0001a9e0: 6576 6d27 5d5d 0a20 2020 2020 2020 2020  evm']].         
-0001a9f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001aa00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aa10: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0001aa20: 2866 2249 6e63 6f72 7265 6374 2062 6173  (f"Incorrect bas
-0001aa30: 6520 656e 7472 7920 666f 7220 7b6e 616d  e entry for {nam
-0001aa40: 657d 2e20 536b 6970 7069 6e67 2e2e 2e22  e}. Skipping..."
-0001aa50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001aa60: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001aa70: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0001aa80: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
-0001aa90: 6e20 6261 7365 7072 6f66 696c 653a 0a20  n baseprofile:. 
+0001a960: 2020 2020 6261 7365 696e 7075 7466 696c      baseinputfil
+0001a970: 6520 3d20 6622 2f77 6f72 6b64 6972 2f7b  e = f"/workdir/{
+0001a980: 6261 7365 6469 727d 2f7b 6261 7365 706c  basedir}/{basepl
+0001a990: 616e 7d22 0a20 2020 2020 2020 2020 2020  an}".           
+0001a9a0: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+0001a9b0: 6576 6d20 3d20 7072 6f66 696c 655b 2762  evm = profile['b
+0001a9c0: 6173 6576 6d27 5d20 6966 2027 6261 7365  asevm'] if 'base
+0001a9d0: 766d 2720 696e 2070 726f 6669 6c65 2065  vm' in profile e
+0001a9e0: 6c73 6520 6e61 6d65 0a20 2020 2020 2020  lse name.       
+0001a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa00: 2069 6620 6261 7365 706c 616e 206e 6f74   if baseplan not
+0001aa10: 2069 6e20 6261 7365 706c 616e 733a 0a20   in baseplans:. 
+0001aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001aa40: 706c 616e 2870 6c61 6e2c 2069 6e70 7574  plan(plan, input
+0001aa50: 6669 6c65 3d62 6173 6569 6e70 7574 6669  file=baseinputfi
+0001aa60: 6c65 2c20 6f76 6572 7269 6465 733d 6f76  le, overrides=ov
+0001aa70: 6572 7269 6465 732c 2065 7863 6c75 6465  errides, exclude
+0001aa80: 766d 733d 766d 6e61 6d65 732c 0a20 2020  vms=vmnames,.   
+0001aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aab0: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
-0001aac0: 7420 696e 2070 726f 6669 6c65 3a0a 2020  t in profile:.  
-0001aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aae0: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
-0001aaf0: 655b 6b65 795d 203d 2062 6173 6570 726f  e[key] = basepro
-0001ab00: 6669 6c65 5b6b 6579 5d0a 2020 2020 2020  file[key].      
+0001aab0: 2020 2062 6173 656d 6f64 653d 5472 7565     basemode=True
+0001aac0: 2c20 6f6e 6c79 6173 7365 7473 3d6f 6e6c  , onlyassets=onl
+0001aad0: 7961 7373 6574 7329 0a20 2020 2020 2020  yassets).       
+0001aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aaf0: 2020 2020 2062 6173 6570 6c61 6e73 2e61       baseplans.a
+0001ab00: 7070 656e 6428 6261 7365 706c 616e 290a  ppend(baseplan).
 0001ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab20: 2020 656c 6966 206b 6579 2069 6e20 6261    elif key in ba
-0001ab30: 7365 7072 6f66 696c 6520 616e 6420 6b65  seprofile and ke
-0001ab40: 7920 696e 2070 726f 6669 6c65 2061 6e64  y in profile and
-0001ab50: 206b 6579 2069 6e20 6170 7065 6e64 6b65   key in appendke
-0001ab60: 7973 3a0a 2020 2020 2020 2020 2020 2020  ys:.            
-0001ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab80: 7072 6f66 696c 655b 6b65 795d 203d 2062  profile[key] = b
-0001ab90: 6173 6570 726f 6669 6c65 5b6b 6579 5d20  aseprofile[key] 
-0001aba0: 2b20 7072 6f66 696c 655b 6b65 795d 0a20  + profile[key]. 
-0001abb0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001abc0: 756c 6566 6f75 6e64 203d 2046 616c 7365  ulefound = False
-0001abd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001abe0: 2066 6f72 2065 6e74 7279 2069 6e20 6f76   for entry in ov
-0001abf0: 6572 7269 6465 732e 6765 7428 2776 6d72  errides.get('vmr
-0001ac00: 756c 6573 272c 2073 656c 662e 766d 7275  ules', self.vmru
-0001ac10: 6c65 7329 3a0a 2020 2020 2020 2020 2020  les):.          
-0001ac20: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0001ac30: 2865 6e74 7279 2920 213d 2031 3a0a 2020  (entry) != 1:.  
-0001ac40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac50: 2020 2020 2020 6572 726f 7228 6622 5772        error(f"Wr
-0001ac60: 6f6e 6720 766d 2072 756c 6520 7b65 6e74  ong vm rule {ent
-0001ac70: 7279 7d22 290a 2020 2020 2020 2020 2020  ry}").          
-0001ac80: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0001ac90: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
-0001aca0: 2020 2020 2020 2020 2020 2020 2020 7275                ru
-0001acb0: 6c65 203d 206c 6973 7428 656e 7472 792e  le = list(entry.
-0001acc0: 6b65 7973 2829 295b 305d 0a20 2020 2020  keys())[0].     
-0001acd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001ace0: 6620 2872 652e 6d61 7463 6828 7275 6c65  f (re.match(rule
-0001acf0: 2c20 6e61 6d65 2920 6f72 2066 6e6d 6174  , name) or fnmat
-0001ad00: 6368 286e 616d 652c 2072 756c 6529 2920  ch(name, rule)) 
-0001ad10: 616e 6420 6973 696e 7374 616e 6365 2865  and isinstance(e
-0001ad20: 6e74 7279 5b72 756c 655d 2c20 6469 6374  ntry[rule], dict
-0001ad30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001ad40: 2020 2020 2020 2020 2020 2072 756c 6566             rulef
-0001ad50: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
-0001ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad70: 2020 2020 6c69 7374 6b65 7973 203d 205b      listkeys = [
-0001ad80: 2763 6d64 7327 2c20 2766 696c 6573 272c  'cmds', 'files',
-0001ad90: 2027 7363 7269 7074 7327 5d0a 2020 2020   'scripts'].    
-0001ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001adb0: 2020 2020 666f 7220 7275 6c65 2069 6e20      for rule in 
-0001adc0: 656e 7472 793a 0a20 2020 2020 2020 2020  entry:.         
-0001add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ade0: 2020 2063 7572 7265 6e74 203d 2065 6e74     current = ent
-0001adf0: 7279 5b72 756c 655d 0a20 2020 2020 2020  ry[rule].       
-0001ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae10: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
-0001ae20: 6375 7272 656e 743a 0a20 2020 2020 2020  current:.       
-0001ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae40: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
-0001ae50: 696e 206c 6973 746b 6579 7320 616e 6420  in listkeys and 
-0001ae60: 6973 696e 7374 616e 6365 2863 7572 7265  isinstance(curre
-0001ae70: 6e74 5b6b 6579 5d2c 206c 6973 7429 2061  nt[key], list) a
-0001ae80: 6e64 206b 6579 2069 6e20 7072 6f66 696c  nd key in profil
-0001ae90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aeb0: 2020 2020 2020 2063 7572 7265 6e74 5b6b         current[k
-0001aec0: 6579 5d20 3d20 7072 6f66 696c 655b 6b65  ey] = profile[ke
-0001aed0: 795d 202b 2063 7572 7265 6e74 5b6b 6579  y] + current[key
-0001aee0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001aef0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001af00: 6f66 696c 652e 7570 6461 7465 2865 6e74  ofile.update(ent
-0001af10: 7279 5b72 756c 655d 290a 2020 2020 2020  ry[rule]).      
-0001af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af30: 2020 2020 2020 6966 2027 6e61 6d65 2720        if 'name' 
-0001af40: 696e 2065 6e74 7279 5b72 756c 655d 3a0a  in entry[rule]:.
-0001af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab20: 2020 2020 2020 2020 6261 7365 696e 666f          baseinfo
+0001ab30: 203d 2073 656c 662e 7072 6f63 6573 735f   = self.process_
+0001ab40: 696e 7075 7466 696c 6528 706c 616e 2c20  inputfile(plan, 
+0001ab50: 6261 7365 696e 7075 7466 696c 652c 206f  baseinputfile, o
+0001ab60: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+0001ab70: 6573 2c20 6675 6c6c 3d54 7275 6529 0a20  es, full=True). 
+0001ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab90: 2020 2020 2020 2062 6173 6570 726f 6669         baseprofi
+0001aba0: 6c65 203d 2062 6173 6569 6e66 6f5b 305d  le = baseinfo[0]
+0001abb0: 5b62 6173 6576 6d5d 2069 6620 6261 7365  [basevm] if base
+0001abc0: 766d 2069 6e20 6261 7365 696e 666f 5b30  vm in baseinfo[0
+0001abd0: 5d20 656c 7365 207b 7d0a 2020 2020 2020  ] else {}.      
+0001abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abf0: 2020 6375 7272 656e 7470 6c61 6e64 6972    currentplandir
+0001ac00: 203d 2062 6173 6569 6e66 6f5b 335d 2069   = baseinfo[3] i
+0001ac10: 6620 6f73 2e70 6174 682e 6973 6162 7328  f os.path.isabs(
+0001ac20: 6261 7365 696e 666f 5b33 5d29 2065 6c73  baseinfo[3]) els
+0001ac30: 6520 272e 270a 2020 2020 2020 2020 2020  e '.'.          
+0001ac40: 2020 2020 2020 2020 2020 656c 6966 2027            elif '
+0001ac50: 6261 7365 766d 2720 696e 2070 726f 6669  basevm' in profi
+0001ac60: 6c65 2061 6e64 2070 726f 6669 6c65 5b27  le and profile['
+0001ac70: 6261 7365 766d 275d 2069 6e20 6261 7365  basevm'] in base
+0001ac80: 656e 7472 6965 733a 0a20 2020 2020 2020  entries:.       
+0001ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aca0: 2062 6173 6570 726f 6669 6c65 203d 2062   baseprofile = b
+0001acb0: 6173 6565 6e74 7269 6573 5b70 726f 6669  aseentries[profi
+0001acc0: 6c65 5b27 6261 7365 766d 275d 5d0a 2020  le['basevm']].  
+0001acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ace0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad00: 7761 726e 696e 6728 6622 496e 636f 7272  warning(f"Incorr
+0001ad10: 6563 7420 6261 7365 2065 6e74 7279 2066  ect base entry f
+0001ad20: 6f72 207b 6e61 6d65 7d2e 2053 6b69 7070  or {name}. Skipp
+0001ad30: 696e 672e 2e2e 2229 0a20 2020 2020 2020  ing...").       
+0001ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad50: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+0001ad60: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001ad70: 7220 6b65 7920 696e 2062 6173 6570 726f  r key in basepro
+0001ad80: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+0001ad90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001ada0: 206b 6579 206e 6f74 2069 6e20 7072 6f66   key not in prof
+0001adb0: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+0001adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001add0: 2070 726f 6669 6c65 5b6b 6579 5d20 3d20   profile[key] = 
+0001ade0: 6261 7365 7072 6f66 696c 655b 6b65 795d  baseprofile[key]
+0001adf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ae00: 2020 2020 2020 2020 2065 6c69 6620 6b65           elif ke
+0001ae10: 7920 696e 2062 6173 6570 726f 6669 6c65  y in baseprofile
+0001ae20: 2061 6e64 206b 6579 2069 6e20 7072 6f66   and key in prof
+0001ae30: 696c 6520 616e 6420 6b65 7920 696e 2061  ile and key in a
+0001ae40: 7070 656e 646b 6579 733a 0a20 2020 2020  ppendkeys:.     
+0001ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae60: 2020 2020 2020 2070 726f 6669 6c65 5b6b         profile[k
+0001ae70: 6579 5d20 3d20 6261 7365 7072 6f66 696c  ey] = baseprofil
+0001ae80: 655b 6b65 795d 202b 2070 726f 6669 6c65  e[key] + profile
+0001ae90: 5b6b 6579 5d0a 2020 2020 2020 2020 2020  [key].          
+0001aea0: 2020 2020 2020 7275 6c65 666f 756e 6420        rulefound 
+0001aeb0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0001aec0: 2020 2020 2020 2020 666f 7220 656e 7472          for entr
+0001aed0: 7920 696e 206f 7665 7272 6964 6573 2e67  y in overrides.g
+0001aee0: 6574 2827 766d 7275 6c65 7327 2c20 7365  et('vmrules', se
+0001aef0: 6c66 2e76 6d72 756c 6573 293a 0a20 2020  lf.vmrules):.   
+0001af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af10: 2069 6620 6c65 6e28 656e 7472 7929 2021   if len(entry) !
+0001af20: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+0001af30: 2020 2020 2020 2020 2020 2020 2065 7272               err
+0001af40: 6f72 2866 2257 726f 6e67 2076 6d20 7275  or(f"Wrong vm ru
+0001af50: 6c65 207b 656e 7472 797d 2229 0a20 2020  le {entry}").   
 0001af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af70: 7761 726e 696e 6728 6622 5265 6e61 6d69  warning(f"Renami
-0001af80: 6e67 207b 6e61 6d65 7d20 746f 207b 656e  ng {name} to {en
-0001af90: 7472 795b 7275 6c65 5d5b 276e 616d 6527  try[rule]['name'
-0001afa0: 5d7d 2229 0a20 2020 2020 2020 2020 2020  ]}").           
-0001afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afc0: 2020 2020 206e 616d 6520 3d20 656e 7472       name = entr
-0001afd0: 795b 7275 6c65 5d5b 276e 616d 6527 5d0a  y[rule]['name'].
-0001afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aff0: 6966 2076 6d72 756c 6573 5f73 7472 6963  if vmrules_stric
-0001b000: 7420 616e 6420 6e6f 7420 7275 6c65 666f  t and not rulefo
-0001b010: 756e 643a 0a20 2020 2020 2020 2020 2020  und:.           
-0001b020: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0001b030: 2866 224e 6f20 766d 7275 6c65 7320 666f  (f"No vmrules fo
-0001b040: 756e 6420 666f 7220 7b6e 616d 657d 2e20  und for {name}. 
-0001b050: 536b 6970 7069 6e67 2e2e 2e22 290a 2020  Skipping...").  
-0001b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b070: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0001b080: 2020 2020 2020 2020 2020 2076 6d63 6c69             vmcli
-0001b090: 656e 7420 3d20 7072 6f66 696c 652e 6765  ent = profile.ge
-0001b0a0: 7428 2763 6c69 656e 7427 290a 2020 2020  t('client').    
-0001b0b0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-0001b0c0: 6d63 6c69 656e 7420 6973 206e 6f74 204e  mclient is not N
-0001b0d0: 6f6e 6520 616e 6420 766d 636c 6965 6e74  one and vmclient
-0001b0e0: 206e 6f74 2069 6e20 766d 636c 6965 6e74   not in vmclient
-0001b0f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001b100: 2020 2020 2020 2076 6d63 6c69 656e 7473         vmclients
-0001b110: 2e61 7070 656e 6428 766d 636c 6965 6e74  .append(vmclient
-0001b120: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001b130: 2020 6966 2076 6d63 6c69 656e 7420 6973    if vmclient is
-0001b140: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001b150: 2020 2020 2020 2020 2020 207a 203d 206b             z = k
-0001b160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b170: 2020 2020 2076 6d63 6c69 656e 7420 3d20       vmclient = 
-0001b180: 7365 6c66 2e63 6c69 656e 740a 2020 2020  self.client.    
-0001b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1a0: 6966 2076 6d63 6c69 656e 7420 6e6f 7420  if vmclient not 
-0001b1b0: 696e 2068 6f73 7473 3a0a 2020 2020 2020  in hosts:.      
-0001b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1d0: 2020 686f 7374 735b 766d 636c 6965 6e74    hosts[vmclient
-0001b1e0: 5d20 3d20 7365 6c66 0a20 2020 2020 2020  ] = self.       
-0001b1f0: 2020 2020 2020 2020 2065 6c69 6620 766d           elif vm
-0001b200: 636c 6965 6e74 2069 6e20 686f 7374 733a  client in hosts:
-0001b210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b220: 2020 2020 207a 203d 2068 6f73 7473 5b76       z = hosts[v
-0001b230: 6d63 6c69 656e 745d 2e6b 0a20 2020 2020  mclient].k.     
-0001b240: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0001b250: 766d 636c 6965 6e74 2069 6e20 7365 6c66  vmclient in self
-0001b260: 2e63 6c69 656e 7473 3a0a 2020 2020 2020  .clients:.      
-0001b270: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0001b280: 7763 6c69 656e 7420 3d20 4b63 6f6e 6669  wclient = Kconfi
-0001b290: 6728 636c 6965 6e74 3d76 6d63 6c69 656e  g(client=vmclien
-0001b2a0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-0001b2b0: 2020 2020 2020 207a 203d 206e 6577 636c         z = newcl
-0001b2c0: 6965 6e74 2e6b 0a20 2020 2020 2020 2020  ient.k.         
-0001b2d0: 2020 2020 2020 2020 2020 2068 6f73 7473             hosts
-0001b2e0: 5b76 6d63 6c69 656e 745d 203d 206e 6577  [vmclient] = new
-0001b2f0: 636c 6965 6e74 0a20 2020 2020 2020 2020  client.         
-0001b300: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b320: 2077 6172 6e69 6e67 2866 2243 6c69 656e   warning(f"Clien
-0001b330: 7420 7b76 6d63 6c69 656e 747d 206e 6f74  t {vmclient} not
-0001b340: 2066 6f75 6e64 2e20 5573 696e 6720 6465   found. Using de
-0001b350: 6661 756c 7420 6f6e 6522 290a 2020 2020  fault one").    
-0001b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b370: 7a20 3d20 6b0a 2020 2020 2020 2020 2020  z = k.          
-0001b380: 2020 2020 2020 2020 2020 766d 636c 6965            vmclie
-0001b390: 6e74 203d 2073 656c 662e 636c 6965 6e74  nt = self.client
-0001b3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b3b0: 2020 2020 2069 6620 766d 636c 6965 6e74       if vmclient
-0001b3c0: 206e 6f74 2069 6e20 686f 7374 733a 0a20   not in hosts:. 
-0001b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3e0: 2020 2020 2020 2068 6f73 7473 5b76 6d63         hosts[vmc
-0001b3f0: 6c69 656e 745d 203d 2073 656c 660a 2020  lient] = self.  
-0001b400: 2020 2020 2020 2020 2020 2020 2020 766d                vm
-0001b410: 735f 746f 5f68 6f73 745b 6e61 6d65 5d20  s_to_host[name] 
-0001b420: 3d20 686f 7374 735b 766d 636c 6965 6e74  = hosts[vmclient
-0001b430: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001b440: 2020 6966 2027 7072 6f66 696c 6527 2069    if 'profile' i
-0001b450: 6e20 7072 6f66 696c 6520 616e 6420 7072  n profile and pr
-0001b460: 6f66 696c 655b 2770 726f 6669 6c65 275d  ofile['profile']
-0001b470: 2069 6e20 766d 7072 6f66 696c 6573 3a0a   in vmprofiles:.
-0001b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b490: 2020 2020 6375 7374 6f6d 7072 6f66 696c      customprofil
-0001b4a0: 6520 3d20 766d 7072 6f66 696c 6573 5b70  e = vmprofiles[p
-0001b4b0: 726f 6669 6c65 5b27 7072 6f66 696c 6527  rofile['profile'
-0001b4c0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-0001b4d0: 2020 2020 2020 2070 726f 6669 6c65 6e61         profilena
-0001b4e0: 6d65 203d 2070 726f 6669 6c65 5b27 7072  me = profile['pr
-0001b4f0: 6f66 696c 6527 5d0a 2020 2020 2020 2020  ofile'].        
-0001b500: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b520: 2020 6375 7374 6f6d 7072 6f66 696c 6520    customprofile 
-0001b530: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
-0001b540: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
-0001b550: 6e61 6d65 203d 2027 6b76 6972 7427 0a20  name = 'kvirt'. 
-0001b560: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001b570: 6620 6375 7374 6f6d 7072 6f66 696c 653a  f customprofile:
-0001b580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b590: 2020 2020 2063 7573 746f 6d70 726f 6669       customprofi
-0001b5a0: 6c65 2e75 7064 6174 6528 7072 6f66 696c  le.update(profil
-0001b5b0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001b5c0: 2020 2020 2020 2070 726f 6669 6c65 203d         profile =
-0001b5d0: 2063 7573 746f 6d70 726f 6669 6c65 0a20   customprofile. 
-0001b5e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001b5f0: 6620 2770 6c61 7962 6f6f 6b27 2069 6e20  f 'playbook' in 
-0001b600: 7072 6f66 696c 6520 616e 6420 7072 6f66  profile and prof
-0001b610: 696c 655b 2770 6c61 7962 6f6f 6b27 5d3a  ile['playbook']:
-0001b620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b630: 2020 2020 2069 6620 2773 6372 6970 7473       if 'scripts
-0001b640: 2720 6e6f 7420 696e 2070 726f 6669 6c65  ' not in profile
-0001b650: 2061 6e64 2027 6669 6c65 7327 206e 6f74   and 'files' not
-0001b660: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
-0001b670: 2763 6d64 7327 206e 6f74 2069 6e20 7072  'cmds' not in pr
-0001b680: 6f66 696c 653a 0a20 2020 2020 2020 2020  ofile:.         
-0001b690: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001b6a0: 7072 696e 7428 6622 536b 6970 7069 6e67  print(f"Skipping
-0001b6b0: 2065 6d70 7479 2070 6c61 7962 6f6f 6b20   empty playbook 
-0001b6c0: 666f 7220 7b6e 616d 657d 2229 0a20 2020  for {name}").   
-0001b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b6e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001b6f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001b700: 6620 2769 6d61 6765 2720 696e 2070 726f  f 'image' in pro
-0001b710: 6669 6c65 2061 6e64 2027 7268 656c 2720  file and 'rhel' 
-0001b720: 696e 2070 726f 6669 6c65 5b27 696d 6167  in profile['imag
-0001b730: 6527 5d5c 0a20 2020 2020 2020 2020 2020  e']\.           
-0001b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b750: 2020 2020 2061 6e64 2027 7268 6e72 6567       and 'rhnreg
-0001b760: 6973 7465 7227 2069 6e20 7072 6f66 696c  ister' in profil
-0001b770: 6520 616e 6420 7072 6f66 696c 655b 2772  e and profile['r
-0001b780: 686e 7265 6769 7374 6572 275d 3a0a 2020  hnregister']:.  
-0001b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b7a0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0001b7b0: 6728 6622 4d61 6b65 2073 7572 6520 746f  g(f"Make sure to
-0001b7c0: 2073 7562 7363 7269 6265 207b 6e61 6d65   subscribe {name
-0001b7d0: 7d20 746f 2052 6564 2048 6174 206e 6574  } to Red Hat net
-0001b7e0: 776f 726b 2229 0a20 2020 2020 2020 2020  work").         
-0001b7f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001b800: 6620 2770 7269 7661 7465 6b65 7927 2069  f 'privatekey' i
-0001b810: 6e20 7072 6f66 696c 6520 616e 6420 7072  n profile and pr
-0001b820: 6f66 696c 655b 2770 7269 7661 7465 6b65  ofile['privateke
-0001b830: 7927 5d3a 0a20 2020 2020 2020 2020 2020  y']:.           
-0001b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b850: 2077 6172 6e69 6e67 2866 2243 6f70 7920   warning(f"Copy 
-0001b860: 796f 7572 2070 7269 7661 7465 206b 6579  your private key
-0001b870: 2074 6f20 7b6e 616d 657d 2229 0a20 2020   to {name}").   
-0001b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b890: 2020 2020 2066 6f72 206e 6574 2069 6e20       for net in 
-0001b8a0: 7072 6f66 696c 652e 6765 7428 276e 6574  profile.get('net
-0001b8b0: 7327 2c20 5b5d 293a 0a20 2020 2020 2020  s', []):.       
-0001b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8d0: 2020 2020 2069 6620 2769 7027 2069 6e20       if 'ip' in 
-0001b8e0: 6e65 7420 616e 6420 276d 6173 6b27 2069  net and 'mask' i
-0001b8f0: 6e20 6e65 7420 616e 6420 2767 6174 6577  n net and 'gatew
-0001b900: 6179 2720 696e 206e 6574 3a0a 2020 2020  ay' in net:.    
-0001b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b920: 2020 2020 2020 2020 2020 2020 6970 2c20              ip, 
-0001b930: 6d61 736b 2c20 6761 7465 7761 7920 3d20  mask, gateway = 
-0001b940: 6e65 745b 2769 7027 5d2c 206e 6574 5b27  net['ip'], net['
-0001b950: 6d61 736b 275d 2c20 6e65 745b 2767 6174  mask'], net['gat
-0001b960: 6577 6179 275d 0a20 2020 2020 2020 2020  eway'].         
+0001af70: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+0001af80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001af90: 2020 2020 2072 756c 6520 3d20 6c69 7374       rule = list
+0001afa0: 2865 6e74 7279 2e6b 6579 7328 2929 5b30  (entry.keys())[0
+0001afb0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001afc0: 2020 2020 2020 6966 2028 7265 2e6d 6174        if (re.mat
+0001afd0: 6368 2872 756c 652c 206e 616d 6529 206f  ch(rule, name) o
+0001afe0: 7220 666e 6d61 7463 6828 6e61 6d65 2c20  r fnmatch(name, 
+0001aff0: 7275 6c65 2929 2061 6e64 2069 7369 6e73  rule)) and isins
+0001b000: 7461 6e63 6528 656e 7472 795b 7275 6c65  tance(entry[rule
+0001b010: 5d2c 2064 6963 7429 3a0a 2020 2020 2020  ], dict):.      
+0001b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b030: 2020 7275 6c65 666f 756e 6420 3d20 5472    rulefound = Tr
+0001b040: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0001b050: 2020 2020 2020 2020 2020 206c 6973 746b             listk
+0001b060: 6579 7320 3d20 5b27 636d 6473 272c 2027  eys = ['cmds', '
+0001b070: 6669 6c65 7327 2c20 2773 6372 6970 7473  files', 'scripts
+0001b080: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+0001b090: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+0001b0a0: 756c 6520 696e 2065 6e74 7279 3a0a 2020  ule in entry:.  
+0001b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0c0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+0001b0d0: 7420 3d20 656e 7472 795b 7275 6c65 5d0a  t = entry[rule].
+0001b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0f0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001b100: 6b65 7920 696e 2063 7572 7265 6e74 3a0a  key in current:.
+0001b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b130: 6966 206b 6579 2069 6e20 6c69 7374 6b65  if key in listke
+0001b140: 7973 2061 6e64 2069 7369 6e73 7461 6e63  ys and isinstanc
+0001b150: 6528 6375 7272 656e 745b 6b65 795d 2c20  e(current[key], 
+0001b160: 6c69 7374 2920 616e 6420 6b65 7920 696e  list) and key in
+0001b170: 2070 726f 6669 6c65 3a0a 2020 2020 2020   profile:.      
+0001b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b190: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001b1a0: 7272 656e 745b 6b65 795d 203d 2070 726f  rrent[key] = pro
+0001b1b0: 6669 6c65 5b6b 6579 5d20 2b20 6375 7272  file[key] + curr
+0001b1c0: 656e 745b 6b65 795d 0a20 2020 2020 2020  ent[key].       
+0001b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1e0: 2020 2020 2070 726f 6669 6c65 2e75 7064       profile.upd
+0001b1f0: 6174 6528 656e 7472 795b 7275 6c65 5d29  ate(entry[rule])
+0001b200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b210: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b220: 276e 616d 6527 2069 6e20 656e 7472 795b  'name' in entry[
+0001b230: 7275 6c65 5d3a 0a20 2020 2020 2020 2020  rule]:.         
+0001b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b250: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+0001b260: 2252 656e 616d 696e 6720 7b6e 616d 657d  "Renaming {name}
+0001b270: 2074 6f20 7b65 6e74 7279 5b72 756c 655d   to {entry[rule]
+0001b280: 5b27 6e61 6d65 275d 7d22 290a 2020 2020  ['name']}").    
+0001b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2a0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0001b2b0: 203d 2065 6e74 7279 5b72 756c 655d 5b27   = entry[rule]['
+0001b2c0: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
+0001b2d0: 2020 2020 2020 2069 6620 766d 7275 6c65         if vmrule
+0001b2e0: 735f 7374 7269 6374 2061 6e64 206e 6f74  s_strict and not
+0001b2f0: 2072 756c 6566 6f75 6e64 3a0a 2020 2020   rulefound:.    
+0001b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b310: 7761 726e 696e 6728 6622 4e6f 2076 6d72  warning(f"No vmr
+0001b320: 756c 6573 2066 6f75 6e64 2066 6f72 207b  ules found for {
+0001b330: 6e61 6d65 7d2e 2053 6b69 7070 696e 672e  name}. Skipping.
+0001b340: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+0001b350: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+0001b360: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001b370: 2020 766d 636c 6965 6e74 203d 2070 726f    vmclient = pro
+0001b380: 6669 6c65 2e67 6574 2827 636c 6965 6e74  file.get('client
+0001b390: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0001b3a0: 2020 2069 6620 766d 636c 6965 6e74 2069     if vmclient i
+0001b3b0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2076  s not None and v
+0001b3c0: 6d63 6c69 656e 7420 6e6f 7420 696e 2076  mclient not in v
+0001b3d0: 6d63 6c69 656e 7473 3a0a 2020 2020 2020  mclients:.      
+0001b3e0: 2020 2020 2020 2020 2020 2020 2020 766d                vm
+0001b3f0: 636c 6965 6e74 732e 6170 7065 6e64 2876  clients.append(v
+0001b400: 6d63 6c69 656e 7429 0a20 2020 2020 2020  mclient).       
+0001b410: 2020 2020 2020 2020 2069 6620 766d 636c           if vmcl
+0001b420: 6965 6e74 2069 7320 4e6f 6e65 3a0a 2020  ient is None:.  
+0001b430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b440: 2020 7a20 3d20 6b0a 2020 2020 2020 2020    z = k.        
+0001b450: 2020 2020 2020 2020 2020 2020 766d 636c              vmcl
+0001b460: 6965 6e74 203d 2073 656c 662e 636c 6965  ient = self.clie
+0001b470: 6e74 0a20 2020 2020 2020 2020 2020 2020  nt.             
+0001b480: 2020 2020 2020 2069 6620 766d 636c 6965         if vmclie
+0001b490: 6e74 206e 6f74 2069 6e20 686f 7374 733a  nt not in hosts:
+0001b4a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b4b0: 2020 2020 2020 2020 2068 6f73 7473 5b76           hosts[v
+0001b4c0: 6d63 6c69 656e 745d 203d 2073 656c 660a  mclient] = self.
+0001b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b4e0: 656c 6966 2076 6d63 6c69 656e 7420 696e  elif vmclient in
+0001b4f0: 2068 6f73 7473 3a0a 2020 2020 2020 2020   hosts:.        
+0001b500: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
+0001b510: 686f 7374 735b 766d 636c 6965 6e74 5d2e  hosts[vmclient].
+0001b520: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+0001b530: 2020 656c 6966 2076 6d63 6c69 656e 7420    elif vmclient 
+0001b540: 696e 2073 656c 662e 636c 6965 6e74 733a  in self.clients:
+0001b550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b560: 2020 2020 206e 6577 636c 6965 6e74 203d       newclient =
+0001b570: 204b 636f 6e66 6967 2863 6c69 656e 743d   Kconfig(client=
+0001b580: 766d 636c 6965 6e74 290a 2020 2020 2020  vmclient).      
+0001b590: 2020 2020 2020 2020 2020 2020 2020 7a20                z 
+0001b5a0: 3d20 6e65 7763 6c69 656e 742e 6b0a 2020  = newclient.k.  
+0001b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5c0: 2020 686f 7374 735b 766d 636c 6965 6e74    hosts[vmclient
+0001b5d0: 5d20 3d20 6e65 7763 6c69 656e 740a 2020  ] = newclient.  
+0001b5e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001b5f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001b600: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+0001b610: 6622 436c 6965 6e74 207b 766d 636c 6965  f"Client {vmclie
+0001b620: 6e74 7d20 6e6f 7420 666f 756e 642e 2055  nt} not found. U
+0001b630: 7369 6e67 2064 6566 6175 6c74 206f 6e65  sing default one
+0001b640: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001b650: 2020 2020 2020 207a 203d 206b 0a20 2020         z = k.   
+0001b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b670: 2076 6d63 6c69 656e 7420 3d20 7365 6c66   vmclient = self
+0001b680: 2e63 6c69 656e 740a 2020 2020 2020 2020  .client.        
+0001b690: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+0001b6a0: 6d63 6c69 656e 7420 6e6f 7420 696e 2068  mclient not in h
+0001b6b0: 6f73 7473 3a0a 2020 2020 2020 2020 2020  osts:.          
+0001b6c0: 2020 2020 2020 2020 2020 2020 2020 686f                ho
+0001b6d0: 7374 735b 766d 636c 6965 6e74 5d20 3d20  sts[vmclient] = 
+0001b6e0: 7365 6c66 0a20 2020 2020 2020 2020 2020  self.           
+0001b6f0: 2020 2020 2076 6d73 5f74 6f5f 686f 7374       vms_to_host
+0001b700: 5b6e 616d 655d 203d 2068 6f73 7473 5b76  [name] = hosts[v
+0001b710: 6d63 6c69 656e 745d 0a20 2020 2020 2020  mclient].       
+0001b720: 2020 2020 2020 2020 2069 6620 2770 726f           if 'pro
+0001b730: 6669 6c65 2720 696e 2070 726f 6669 6c65  file' in profile
+0001b740: 2061 6e64 2070 726f 6669 6c65 5b27 7072   and profile['pr
+0001b750: 6f66 696c 6527 5d20 696e 2076 6d70 726f  ofile'] in vmpro
+0001b760: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
+0001b770: 2020 2020 2020 2020 2020 2063 7573 746f             custo
+0001b780: 6d70 726f 6669 6c65 203d 2076 6d70 726f  mprofile = vmpro
+0001b790: 6669 6c65 735b 7072 6f66 696c 655b 2770  files[profile['p
+0001b7a0: 726f 6669 6c65 275d 5d0a 2020 2020 2020  rofile']].      
+0001b7b0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001b7c0: 6f66 696c 656e 616d 6520 3d20 7072 6f66  ofilename = prof
+0001b7d0: 696c 655b 2770 726f 6669 6c65 275d 0a20  ile['profile']. 
+0001b7e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001b7f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001b800: 2020 2020 2020 2020 2063 7573 746f 6d70           customp
+0001b810: 726f 6669 6c65 203d 207b 7d0a 2020 2020  rofile = {}.    
+0001b820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b830: 7072 6f66 696c 656e 616d 6520 3d20 276b  profilename = 'k
+0001b840: 7669 7274 270a 2020 2020 2020 2020 2020  virt'.          
+0001b850: 2020 2020 2020 6966 2063 7573 746f 6d70        if customp
+0001b860: 726f 6669 6c65 3a0a 2020 2020 2020 2020  rofile:.        
+0001b870: 2020 2020 2020 2020 2020 2020 6375 7374              cust
+0001b880: 6f6d 7072 6f66 696c 652e 7570 6461 7465  omprofile.update
+0001b890: 2870 726f 6669 6c65 290a 2020 2020 2020  (profile).      
+0001b8a0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001b8b0: 6f66 696c 6520 3d20 6375 7374 6f6d 7072  ofile = custompr
+0001b8c0: 6f66 696c 650a 2020 2020 2020 2020 2020  ofile.          
+0001b8d0: 2020 2020 2020 6966 2027 706c 6179 626f        if 'playbo
+0001b8e0: 6f6b 2720 696e 2070 726f 6669 6c65 2061  ok' in profile a
+0001b8f0: 6e64 2070 726f 6669 6c65 5b27 706c 6179  nd profile['play
+0001b900: 626f 6f6b 275d 3a0a 2020 2020 2020 2020  book']:.        
+0001b910: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+0001b920: 7363 7269 7074 7327 206e 6f74 2069 6e20  scripts' not in 
+0001b930: 7072 6f66 696c 6520 616e 6420 2766 696c  profile and 'fil
+0001b940: 6573 2720 6e6f 7420 696e 2070 726f 6669  es' not in profi
+0001b950: 6c65 2061 6e64 2027 636d 6473 2720 6e6f  le and 'cmds' no
+0001b960: 7420 696e 2070 726f 6669 6c65 3a0a 2020  t in profile:.  
 0001b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b980: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
-0001b990: 2241 6464 206d 616e 7561 6c6c 7920 7468  "Add manually th
-0001b9a0: 6973 206e 6574 776f 726b 207b 6970 7d2f  is network {ip}/
-0001b9b0: 7b6d 6173 6b7d 2077 6974 6820 6761 7465  {mask} with gate
-0001b9c0: 7761 7920 7b67 6174 6577 6179 7d22 290a  way {gateway}").
+0001b980: 2020 2020 2020 7070 7269 6e74 2866 2253        pprint(f"S
+0001b990: 6b69 7070 696e 6720 656d 7074 7920 706c  kipping empty pl
+0001b9a0: 6179 626f 6f6b 2066 6f72 207b 6e61 6d65  aybook for {name
+0001b9b0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001b9c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
 0001b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9e0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-0001b9f0: 7669 7073 2720 696e 206e 6574 3a0a 2020  vips' in net:.  
-0001ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba10: 2020 2020 2020 2020 2020 2020 2020 7669                vi
-0001ba20: 7073 203d 2027 2c27 2e6a 6f69 6e28 6e65  ps = ','.join(ne
-0001ba30: 745b 2776 6970 7327 5d29 0a20 2020 2020  t['vips']).     
-0001ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba50: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0001ba60: 6e67 2866 2241 6464 206d 616e 7561 6c6c  ng(f"Add manuall
-0001ba70: 7920 7669 7073 207b 7669 7073 7d22 290a  y vips {vips}").
+0001b9e0: 2020 2020 2020 6966 2027 696d 6167 6527        if 'image'
+0001b9f0: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
+0001ba00: 2772 6865 6c27 2069 6e20 7072 6f66 696c  'rhel' in profil
+0001ba10: 655b 2769 6d61 6765 275d 5c0a 2020 2020  e['image']\.    
+0001ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba30: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0001ba40: 2772 686e 7265 6769 7374 6572 2720 696e  'rhnregister' in
+0001ba50: 2070 726f 6669 6c65 2061 6e64 2070 726f   profile and pro
+0001ba60: 6669 6c65 5b27 7268 6e72 6567 6973 7465  file['rhnregiste
+0001ba70: 7227 5d3a 0a20 2020 2020 2020 2020 2020  r']:.           
 0001ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba90: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
-0001baa0: 4d61 6b65 2073 7572 6520 746f 2065 7870  Make sure to exp
-0001bab0: 6f72 7420 414e 5349 424c 455f 4a49 4e4a  ort ANSIBLE_JINJ
-0001bac0: 4132 5f45 5854 454e 5349 4f4e 533d 6a69  A2_EXTENSIONS=ji
-0001bad0: 6e6a 6132 2e65 7874 2e64 6f22 290a 2020  nja2.ext.do").  
-0001bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001baf0: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
-0001bb00: 655f 766d 5f70 6c61 7962 6f6f 6b28 6e61  e_vm_playbook(na
-0001bb10: 6d65 2c20 7072 6f66 696c 652c 206f 7665  me, profile, ove
-0001bb20: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-0001bb30: 2c20 7374 6f72 653d 5472 7565 290a 2020  , store=True).  
-0001bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb50: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0001bb60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001bb70: 6620 7a2e 6578 6973 7473 286e 616d 6529  f z.exists(name)
-0001bb80: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
-0001bb90: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
-0001bba0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0001bbb0: 7570 6461 7465 3a0a 2020 2020 2020 2020  update:.        
-0001bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbd0: 7070 7269 6e74 2866 227b 6e61 6d65 7dc2  pprint(f"{name}.
-0001bbe0: a073 6b69 7070 6564 206f 6e20 7b76 6d63  .skipped on {vmc
-0001bbf0: 6c69 656e 747d 2122 290a 2020 2020 2020  lient}!").      
-0001bc00: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001bc10: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001bc20: 2020 2020 2020 2020 2020 2020 7570 6461              upda
-0001bc30: 7465 6420 3d20 4661 6c73 650a 2020 2020  ted = False.    
-0001bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc50: 2020 2020 6375 7272 656e 7476 6d20 3d20      currentvm = 
-0001bc60: 7a2e 696e 666f 286e 616d 6529 0a20 2020  z.info(name).   
-0001bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc80: 2020 2020 2063 7572 7265 6e74 7374 6172       currentstar
-0001bc90: 7420 3d20 6375 7272 656e 7476 6d2e 6765  t = currentvm.ge
-0001bca0: 7428 2761 7574 6f73 7461 7274 272c 2046  t('autostart', F
-0001bcb0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-0001bcc0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0001bcd0: 7272 656e 746d 656d 6f72 7920 3d20 6375  rrentmemory = cu
-0001bce0: 7272 656e 7476 6d5b 276d 656d 6f72 7927  rrentvm['memory'
-0001bcf0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001bd00: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-0001bd10: 7469 6d61 6765 203d 2063 7572 7265 6e74  timage = current
-0001bd20: 766d 2e67 6574 2827 7465 6d70 6c61 7465  vm.get('template
-0001bd30: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0001bd40: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0001bd50: 6e74 696d 6167 6520 3d20 6375 7272 656e  ntimage = curren
-0001bd60: 7476 6d2e 6765 7428 2769 6d61 6765 272c  tvm.get('image',
-0001bd70: 2063 7572 7265 6e74 696d 6167 6529 0a20   currentimage). 
-0001bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd90: 2020 2020 2020 2063 7572 7265 6e74 6370         currentcp
-0001bda0: 7573 203d 2069 6e74 2863 7572 7265 6e74  us = int(current
-0001bdb0: 766d 5b27 6370 7573 275d 290a 2020 2020  vm['cpus']).    
-0001bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bdd0: 2020 2020 6375 7272 656e 746e 6574 7320      currentnets 
-0001bde0: 3d20 6375 7272 656e 7476 6d5b 276e 6574  = currentvm['net
-0001bdf0: 7327 5d0a 2020 2020 2020 2020 2020 2020  s'].            
-0001be00: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0001be10: 656e 7464 6973 6b73 203d 2063 7572 7265  entdisks = curre
-0001be20: 6e74 766d 5b27 6469 736b 7327 5d0a 2020  ntvm['disks'].  
-0001be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be40: 2020 2020 2020 6375 7272 656e 7466 6c61        currentfla
-0001be50: 766f 7220 3d20 6375 7272 656e 7476 6d2e  vor = currentvm.
-0001be60: 6765 7428 2766 6c61 766f 7227 290a 2020  get('flavor').  
-0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be80: 2020 2020 2020 6966 2027 6175 746f 7374        if 'autost
-0001be90: 6172 7427 2069 6e20 7072 6f66 696c 6520  art' in profile 
-0001bea0: 616e 6420 6375 7272 656e 7473 7461 7274  and currentstart
-0001beb0: 2021 3d20 7072 6f66 696c 655b 2761 7574   != profile['aut
-0001bec0: 6f73 7461 7274 275d 3a0a 2020 2020 2020  ostart']:.      
-0001bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bee0: 2020 2020 2020 7570 6461 7465 6420 3d20        updated = 
-0001bef0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0001ba90: 2077 6172 6e69 6e67 2866 224d 616b 6520   warning(f"Make 
+0001baa0: 7375 7265 2074 6f20 7375 6273 6372 6962  sure to subscrib
+0001bab0: 6520 7b6e 616d 657d 2074 6f20 5265 6420  e {name} to Red 
+0001bac0: 4861 7420 6e65 7477 6f72 6b22 290a 2020  Hat network").  
+0001bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bae0: 2020 2020 2020 6966 2027 7072 6976 6174        if 'privat
+0001baf0: 656b 6579 2720 696e 2070 726f 6669 6c65  ekey' in profile
+0001bb00: 2061 6e64 2070 726f 6669 6c65 5b27 7072   and profile['pr
+0001bb10: 6976 6174 656b 6579 275d 3a0a 2020 2020  ivatekey']:.    
+0001bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb30: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+0001bb40: 6622 436f 7079 2079 6f75 7220 7072 6976  f"Copy your priv
+0001bb50: 6174 6520 6b65 7920 746f 207b 6e61 6d65  ate key to {name
+0001bb60: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001bb70: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001bb80: 6e65 7420 696e 2070 726f 6669 6c65 2e67  net in profile.g
+0001bb90: 6574 2827 6e65 7473 272c 205b 5d29 3a0a  et('nets', []):.
+0001bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbb0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+0001bbc0: 6970 2720 696e 206e 6574 2061 6e64 2027  ip' in net and '
+0001bbd0: 6d61 736b 2720 696e 206e 6574 2061 6e64  mask' in net and
+0001bbe0: 2027 6761 7465 7761 7927 2069 6e20 6e65   'gateway' in ne
+0001bbf0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0001bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc10: 2020 2069 702c 206d 6173 6b2c 2067 6174     ip, mask, gat
+0001bc20: 6577 6179 203d 206e 6574 5b27 6970 275d  eway = net['ip']
+0001bc30: 2c20 6e65 745b 276d 6173 6b27 5d2c 206e  , net['mask'], n
+0001bc40: 6574 5b27 6761 7465 7761 7927 5d0a 2020  et['gateway'].  
+0001bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc60: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0001bc70: 726e 696e 6728 6622 4164 6420 6d61 6e75  rning(f"Add manu
+0001bc80: 616c 6c79 2074 6869 7320 6e65 7477 6f72  ally this networ
+0001bc90: 6b20 7b69 707d 2f7b 6d61 736b 7d20 7769  k {ip}/{mask} wi
+0001bca0: 7468 2067 6174 6577 6179 207b 6761 7465  th gateway {gate
+0001bcb0: 7761 797d 2229 0a20 2020 2020 2020 2020  way}").         
+0001bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bcd0: 2020 2069 6620 2776 6970 7327 2069 6e20     if 'vips' in 
+0001bce0: 6e65 743a 0a20 2020 2020 2020 2020 2020  net:.           
+0001bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd00: 2020 2020 2076 6970 7320 3d20 272c 272e       vips = ','.
+0001bd10: 6a6f 696e 286e 6574 5b27 7669 7073 275d  join(net['vips']
+0001bd20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd40: 2020 7761 726e 696e 6728 6622 4164 6420    warning(f"Add 
+0001bd50: 6d61 6e75 616c 6c79 2076 6970 7320 7b76  manually vips {v
+0001bd60: 6970 737d 2229 0a20 2020 2020 2020 2020  ips}").         
+0001bd70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001bd80: 7072 696e 7428 224d 616b 6520 7375 7265  print("Make sure
+0001bd90: 2074 6f20 6578 706f 7274 2041 4e53 4942   to export ANSIB
+0001bda0: 4c45 5f4a 494e 4a41 325f 4558 5445 4e53  LE_JINJA2_EXTENS
+0001bdb0: 494f 4e53 3d6a 696e 6a61 322e 6578 742e  IONS=jinja2.ext.
+0001bdc0: 646f 2229 0a20 2020 2020 2020 2020 2020  do").           
+0001bdd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001bde0: 662e 6372 6561 7465 5f76 6d5f 706c 6179  f.create_vm_play
+0001bdf0: 626f 6f6b 286e 616d 652c 2070 726f 6669  book(name, profi
+0001be00: 6c65 2c20 6f76 6572 7269 6465 733d 6f76  le, overrides=ov
+0001be10: 6572 7269 6465 732c 2073 746f 7265 3d54  errides, store=T
+0001be20: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0001be30: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001be40: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+0001be50: 2020 2020 2020 6966 207a 2e65 7869 7374        if z.exist
+0001be60: 7328 6e61 6d65 2920 616e 6420 6e6f 7420  s(name) and not 
+0001be70: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
+0001be80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be90: 6966 206e 6f74 2075 7064 6174 653a 0a20  if not update:. 
+0001bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001beb0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+0001bec0: 7b6e 616d 657d c2a0 736b 6970 7065 6420  {name}..skipped 
+0001bed0: 6f6e 207b 766d 636c 6965 6e74 7d21 2229  on {vmclient}!")
+0001bee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bef0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
 0001bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf10: 2070 7072 696e 7428 6622 5570 6461 7469   pprint(f"Updati
-0001bf20: 6e67 2061 7574 6f73 7461 7274 206f 6620  ng autostart of 
-0001bf30: 7b6e 616d 657d 2074 6f20 7b70 726f 6669  {name} to {profi
-0001bf40: 6c65 5b27 6175 746f 7374 6172 7427 5d7d  le['autostart']}
-0001bf50: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001bf60: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-0001bf70: 2e75 7064 6174 655f 7374 6172 7428 6e61  .update_start(na
-0001bf80: 6d65 2c20 7072 6f66 696c 655b 2761 7574  me, profile['aut
-0001bf90: 6f73 7461 7274 275d 290a 2020 2020 2020  ostart']).      
+0001bf10: 2020 2075 7064 6174 6564 203d 2046 616c     updated = Fal
+0001bf20: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+0001bf30: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+0001bf40: 6e74 766d 203d 207a 2e69 6e66 6f28 6e61  ntvm = z.info(na
+0001bf50: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0001bf60: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0001bf70: 656e 7473 7461 7274 203d 2063 7572 7265  entstart = curre
+0001bf80: 6e74 766d 2e67 6574 2827 6175 746f 7374  ntvm.get('autost
+0001bf90: 6172 7427 2c20 4661 6c73 6529 0a20 2020  art', False).   
 0001bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfb0: 2020 6966 2027 666c 6176 6f72 2720 696e    if 'flavor' in
-0001bfc0: 2070 726f 6669 6c65 2061 6e64 2063 7572   profile and cur
-0001bfd0: 7265 6e74 666c 6176 6f72 2021 3d20 7072  rentflavor != pr
-0001bfe0: 6f66 696c 655b 2766 6c61 766f 7227 5d3a  ofile['flavor']:
-0001bff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c000: 2020 2020 2020 2020 2020 2020 2075 7064               upd
-0001c010: 6174 6564 203d 2054 7275 650a 2020 2020  ated = True.    
+0001bfb0: 2020 2020 2063 7572 7265 6e74 6d65 6d6f       currentmemo
+0001bfc0: 7279 203d 2063 7572 7265 6e74 766d 5b27  ry = currentvm['
+0001bfd0: 6d65 6d6f 7279 275d 0a20 2020 2020 2020  memory'].       
+0001bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bff0: 2063 7572 7265 6e74 696d 6167 6520 3d20   currentimage = 
+0001c000: 6375 7272 656e 7476 6d2e 6765 7428 2774  currentvm.get('t
+0001c010: 656d 706c 6174 6527 290a 2020 2020 2020  emplate').      
 0001c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c030: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-0001c040: 2255 7064 6174 696e 6720 666c 6176 6f72  "Updating flavor
-0001c050: 206f 6620 7b6e 616d 657d 2074 6f20 7b70   of {name} to {p
-0001c060: 726f 6669 6c65 5b27 666c 6176 6f72 275d  rofile['flavor']
-0001c070: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0001c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c090: 7a2e 7570 6461 7465 5f66 6c61 766f 7228  z.update_flavor(
-0001c0a0: 6e61 6d65 2c20 7072 6f66 696c 655b 2766  name, profile['f
-0001c0b0: 6c61 766f 7227 5d29 0a20 2020 2020 2020  lavor']).       
-0001c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001c030: 2020 6375 7272 656e 7469 6d61 6765 203d    currentimage =
+0001c040: 2063 7572 7265 6e74 766d 2e67 6574 2827   currentvm.get('
+0001c050: 696d 6167 6527 2c20 6375 7272 656e 7469  image', currenti
+0001c060: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
+0001c070: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001c080: 7272 656e 7463 7075 7320 3d20 696e 7428  rrentcpus = int(
+0001c090: 6375 7272 656e 7476 6d5b 2763 7075 7327  currentvm['cpus'
+0001c0a0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0001c0b0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+0001c0c0: 6e74 6e65 7473 203d 2063 7572 7265 6e74  ntnets = current
+0001c0d0: 766d 5b27 6e65 7473 275d 0a20 2020 2020  vm['nets'].     
 0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0f0: 2020 2069 6620 276d 656d 6f72 7927 2069     if 'memory' i
-0001c100: 6e20 7072 6f66 696c 6520 616e 6420 6375  n profile and cu
-0001c110: 7272 656e 746d 656d 6f72 7920 213d 2070  rrentmemory != p
-0001c120: 726f 6669 6c65 5b27 6d65 6d6f 7279 275d  rofile['memory']
-0001c130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c150: 2020 7570 6461 7465 6420 3d20 5472 7565    updated = True
-0001c160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c180: 2070 7072 696e 7428 6622 5570 6461 7469   pprint(f"Updati
-0001c190: 6e67 206d 656d 6f72 7920 6f66 207b 6e61  ng memory of {na
-0001c1a0: 6d65 7d20 746f 207b 7072 6f66 696c 655b  me} to {profile[
-0001c1b0: 276d 656d 6f72 7927 5d7d 2229 0a20 2020  'memory']}").   
-0001c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1d0: 2020 2020 2020 2020 2020 2020 207a 2e75               z.u
-0001c1e0: 7064 6174 655f 6d65 6d6f 7279 286e 616d  pdate_memory(nam
-0001c1f0: 652c 2070 726f 6669 6c65 5b27 6d65 6d6f  e, profile['memo
-0001c200: 7279 275d 290a 2020 2020 2020 2020 2020  ry']).          
-0001c210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c220: 2020 6966 2027 6e75 6d63 7075 7327 2069    if 'numcpus' i
-0001c230: 6e20 7072 6f66 696c 6520 616e 6420 6375  n profile and cu
-0001c240: 7272 656e 7463 7075 7320 213d 2070 726f  rrentcpus != pro
-0001c250: 6669 6c65 5b27 6e75 6d63 7075 7327 5d3a  file['numcpus']:
-0001c260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c280: 2075 7064 6174 6564 203d 2054 7275 650a   updated = True.
-0001c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2b0: 7070 7269 6e74 2866 2255 7064 6174 696e  pprint(f"Updatin
-0001c2c0: 6720 6370 7573 206f 6620 7b6e 616d 657d  g cpus of {name}
-0001c2d0: 2074 6f20 7b70 726f 6669 6c65 5b27 6e75   to {profile['nu
-0001c2e0: 6d63 7075 7327 5d7d 2229 0a20 2020 2020  mcpus']}").     
-0001c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c300: 2020 2020 2020 2020 2020 207a 2e75 7064             z.upd
-0001c310: 6174 655f 6370 7573 286e 616d 652c 2070  ate_cpus(name, p
-0001c320: 726f 6669 6c65 5b27 6e75 6d63 7075 7327  rofile['numcpus'
-0001c330: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0001c340: 2020 2020 2020 2020 2020 2069 6620 2764             if 'd
-0001c350: 6973 6b73 2720 696e 2070 726f 6669 6c65  isks' in profile
-0001c360: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c370: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001c380: 206c 656e 2863 7572 7265 6e74 6469 736b   len(currentdisk
-0001c390: 7329 203c 206c 656e 2870 726f 6669 6c65  s) < len(profile
-0001c3a0: 5b27 6469 736b 7327 5d29 3a0a 2020 2020  ['disks']):.    
-0001c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3c0: 2020 2020 2020 2020 2020 2020 7570 6461              upda
-0001c3d0: 7465 6420 3d20 5472 7565 0a20 2020 2020  ted = True.     
-0001c3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3f0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0001c400: 7428 6622 4164 6469 6e67 2044 6973 6b73  t(f"Adding Disks
-0001c410: 2074 6f20 7b6e 616d 657d 2229 0a20 2020   to {name}").   
+0001c0f0: 2020 2063 7572 7265 6e74 6469 736b 7320     currentdisks 
+0001c100: 3d20 6375 7272 656e 7476 6d5b 2764 6973  = currentvm['dis
+0001c110: 6b73 275d 0a20 2020 2020 2020 2020 2020  ks'].           
+0001c120: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+0001c130: 7265 6e74 666c 6176 6f72 203d 2063 7572  rentflavor = cur
+0001c140: 7265 6e74 766d 2e67 6574 2827 666c 6176  rentvm.get('flav
+0001c150: 6f72 2729 0a20 2020 2020 2020 2020 2020  or').           
+0001c160: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001c170: 2761 7574 6f73 7461 7274 2720 696e 2070  'autostart' in p
+0001c180: 726f 6669 6c65 2061 6e64 2063 7572 7265  rofile and curre
+0001c190: 6e74 7374 6172 7420 213d 2070 726f 6669  ntstart != profi
+0001c1a0: 6c65 5b27 6175 746f 7374 6172 7427 5d3a  le['autostart']:
+0001c1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c1c0: 2020 2020 2020 2020 2020 2020 2075 7064               upd
+0001c1d0: 6174 6564 203d 2054 7275 650a 2020 2020  ated = True.    
+0001c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1f0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0001c200: 2255 7064 6174 696e 6720 6175 746f 7374  "Updating autost
+0001c210: 6172 7420 6f66 207b 6e61 6d65 7d20 746f  art of {name} to
+0001c220: 207b 7072 6f66 696c 655b 2761 7574 6f73   {profile['autos
+0001c230: 7461 7274 275d 7d22 290a 2020 2020 2020  tart']}").      
+0001c240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c250: 2020 2020 2020 7a2e 7570 6461 7465 5f73        z.update_s
+0001c260: 7461 7274 286e 616d 652c 2070 726f 6669  tart(name, profi
+0001c270: 6c65 5b27 6175 746f 7374 6172 7427 5d29  le['autostart'])
+0001c280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c290: 2020 2020 2020 2020 2069 6620 2766 6c61           if 'fla
+0001c2a0: 766f 7227 2069 6e20 7072 6f66 696c 6520  vor' in profile 
+0001c2b0: 616e 6420 6375 7272 656e 7466 6c61 766f  and currentflavo
+0001c2c0: 7220 213d 2070 726f 6669 6c65 5b27 666c  r != profile['fl
+0001c2d0: 6176 6f72 275d 3a0a 2020 2020 2020 2020  avor']:.        
+0001c2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c2f0: 2020 2020 7570 6461 7465 6420 3d20 5472      updated = Tr
+0001c300: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0001c310: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001c320: 7072 696e 7428 6622 5570 6461 7469 6e67  print(f"Updating
+0001c330: 2066 6c61 766f 7220 6f66 207b 6e61 6d65   flavor of {name
+0001c340: 7d20 746f 207b 7072 6f66 696c 655b 2766  } to {profile['f
+0001c350: 6c61 766f 7227 5d7d 2229 0a20 2020 2020  lavor']}").     
+0001c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c370: 2020 2020 2020 207a 2e75 7064 6174 655f         z.update_
+0001c380: 666c 6176 6f72 286e 616d 652c 2070 726f  flavor(name, pro
+0001c390: 6669 6c65 5b27 666c 6176 6f72 275d 290a  file['flavor']).
+0001c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3d0: 2020 2020 2020 2020 2020 6966 2027 6d65            if 'me
+0001c3e0: 6d6f 7279 2720 696e 2070 726f 6669 6c65  mory' in profile
+0001c3f0: 2061 6e64 2063 7572 7265 6e74 6d65 6d6f   and currentmemo
+0001c400: 7279 2021 3d20 7072 6f66 696c 655b 276d  ry != profile['m
+0001c410: 656d 6f72 7927 5d3a 0a20 2020 2020 2020  emory']:.       
 0001c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c430: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001c440: 2064 6973 6b20 696e 2070 726f 6669 6c65   disk in profile
-0001c450: 5b27 6469 736b 7327 5d5b 6c65 6e28 6375  ['disks'][len(cu
-0001c460: 7272 656e 7464 6973 6b73 293a 5d3a 0a20  rrentdisks):]:. 
-0001c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c490: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0001c4a0: 2864 6973 6b2c 2069 6e74 293a 0a20 2020  (disk, int):.   
+0001c430: 2020 2020 2020 2020 2075 7064 6174 6564           updated
+0001c440: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0001c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c460: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0001c470: 2255 7064 6174 696e 6720 6d65 6d6f 7279  "Updating memory
+0001c480: 206f 6620 7b6e 616d 657d 2074 6f20 7b70   of {name} to {p
+0001c490: 726f 6669 6c65 5b27 6d65 6d6f 7279 275d  rofile['memory']
+0001c4a0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
 0001c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4d0: 2020 2020 2073 697a 6520 3d20 6469 736b       size = disk
-0001c4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c4c0: 2020 2020 7a2e 7570 6461 7465 5f6d 656d      z.update_mem
+0001c4d0: 6f72 7928 6e61 6d65 2c20 7072 6f66 696c  ory(name, profil
+0001c4e0: 655b 276d 656d 6f72 7927 5d29 0a20 2020  e['memory']).   
 0001c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c500: 2020 2020 2020 2020 2070 6f6f 6c20 3d20           pool = 
-0001c510: 7365 6c66 2e70 6f6f 6c0a 2020 2020 2020  self.pool.      
-0001c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c530: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001c540: 6966 2069 7369 6e73 7461 6e63 6528 6469  if isinstance(di
-0001c550: 736b 2c20 7374 7229 2061 6e64 2064 6973  sk, str) and dis
-0001c560: 6b2e 6973 6469 6769 7428 293a 0a20 2020  k.isdigit():.   
-0001c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c500: 2020 2020 2020 2020 2069 6620 276e 756d           if 'num
+0001c510: 6370 7573 2720 696e 2070 726f 6669 6c65  cpus' in profile
+0001c520: 2061 6e64 2063 7572 7265 6e74 6370 7573   and currentcpus
+0001c530: 2021 3d20 7072 6f66 696c 655b 276e 756d   != profile['num
+0001c540: 6370 7573 275d 3a0a 2020 2020 2020 2020  cpus']:.        
+0001c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c560: 2020 2020 2020 2020 7570 6461 7465 6420          updated 
+0001c570: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
 0001c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c590: 2020 2020 2073 697a 6520 3d20 696e 7428       size = int(
-0001c5a0: 6469 736b 290a 2020 2020 2020 2020 2020  disk).          
-0001c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5c0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-0001c5d0: 6f6c 203d 2073 656c 662e 706f 6f6c 0a20  ol = self.pool. 
+0001c590: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+0001c5a0: 5570 6461 7469 6e67 2063 7075 7320 6f66  Updating cpus of
+0001c5b0: 207b 6e61 6d65 7d20 746f 207b 7072 6f66   {name} to {prof
+0001c5c0: 696c 655b 276e 756d 6370 7573 275d 7d22  ile['numcpus']}"
+0001c5d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
 0001c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c600: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0001c610: 6365 2864 6973 6b2c 2064 6963 7429 3a0a  ce(disk, dict):.
+0001c5f0: 2020 7a2e 7570 6461 7465 5f63 7075 7328    z.update_cpus(
+0001c600: 6e61 6d65 2c20 7072 6f66 696c 655b 276e  name, profile['n
+0001c610: 756d 6370 7573 275d 290a 2020 2020 2020  umcpus']).      
 0001c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c640: 2020 2020 2020 2020 7369 7a65 203d 2064          size = d
-0001c650: 6973 6b2e 6765 7428 2773 697a 6527 2c20  isk.get('size', 
-0001c660: 7365 6c66 2e64 6973 6b73 697a 6529 0a20  self.disksize). 
-0001c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c690: 2020 2020 2020 2070 6f6f 6c20 3d20 6469         pool = di
-0001c6a0: 736b 2e67 6574 2827 706f 6f6c 272c 2073  sk.get('pool', s
-0001c6b0: 656c 662e 706f 6f6c 290a 2020 2020 2020  elf.pool).      
-0001c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001c6e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c700: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001c710: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0001c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c730: 2020 2020 2020 2020 207a 2e61 6464 5f64           z.add_d
-0001c740: 6973 6b28 6e61 6d65 3d6e 616d 652c 2073  isk(name=name, s
-0001c750: 697a 653d 7369 7a65 2c20 706f 6f6c 3d70  ize=size, pool=p
-0001c760: 6f6f 6c29 0a20 2020 2020 2020 2020 2020  ool).           
-0001c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c780: 2069 6620 6c65 6e28 6375 7272 656e 7464   if len(currentd
-0001c790: 6973 6b73 2920 3e20 6c65 6e28 7072 6f66  isks) > len(prof
-0001c7a0: 696c 655b 2764 6973 6b73 275d 293a 0a20  ile['disks']):. 
-0001c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7c0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-0001c7d0: 7064 6174 6564 203d 2054 7275 650a 2020  pdated = True.  
+0001c630: 2020 6966 2027 6469 736b 7327 2069 6e20    if 'disks' in 
+0001c640: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
+0001c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c660: 2020 2020 2069 6620 6c65 6e28 6375 7272       if len(curr
+0001c670: 656e 7464 6973 6b73 2920 3c20 6c65 6e28  entdisks) < len(
+0001c680: 7072 6f66 696c 655b 2764 6973 6b73 275d  profile['disks']
+0001c690: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6b0: 2020 2075 7064 6174 6564 203d 2054 7275     updated = Tru
+0001c6c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6e0: 2020 7070 7269 6e74 2866 2241 6464 696e    pprint(f"Addin
+0001c6f0: 6720 4469 736b 7320 746f 207b 6e61 6d65  g Disks to {name
+0001c700: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c720: 2020 2020 666f 7220 6469 736b 2069 6e20      for disk in 
+0001c730: 7072 6f66 696c 655b 2764 6973 6b73 275d  profile['disks']
+0001c740: 5b6c 656e 2863 7572 7265 6e74 6469 736b  [len(currentdisk
+0001c750: 7329 3a5d 3a0a 2020 2020 2020 2020 2020  s):]:.          
+0001c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c770: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0001c780: 6e73 7461 6e63 6528 6469 736b 2c20 696e  nstance(disk, in
+0001c790: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0001c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7b0: 2020 2020 2020 2020 2020 2020 7369 7a65              size
+0001c7c0: 203d 2064 6973 6b0a 2020 2020 2020 2020   = disk.        
+0001c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001c7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7f0: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-0001c800: 7269 6e74 2866 2252 656d 6f76 696e 6720  rint(f"Removing 
-0001c810: 4469 736b 7320 6f66 207b 6e61 6d65 7d22  Disks of {name}"
-0001c820: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c840: 2020 666f 7220 6469 736b 2069 6e20 6375    for disk in cu
-0001c850: 7272 656e 7464 6973 6b73 5b6c 656e 2863  rrentdisks[len(c
-0001c860: 7572 7265 6e74 6469 736b 7329 202d 206c  urrentdisks) - l
-0001c870: 656e 2870 726f 6669 6c65 5b27 6469 736b  en(profile['disk
-0001c880: 7327 5d29 3a5d 3a0a 2020 2020 2020 2020  s']):]:.        
+0001c7f0: 706f 6f6c 203d 2073 656c 662e 706f 6f6c  pool = self.pool
+0001c800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c820: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+0001c830: 616e 6365 2864 6973 6b2c 2073 7472 2920  ance(disk, str) 
+0001c840: 616e 6420 6469 736b 2e69 7364 6967 6974  and disk.isdigit
+0001c850: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0001c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c870: 2020 2020 2020 2020 2020 2020 7369 7a65              size
+0001c880: 203d 2069 6e74 2864 6973 6b29 0a20 2020   = int(disk).   
 0001c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8a0: 2020 2020 2020 2020 2020 2020 6469 736b              disk
-0001c8b0: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
-0001c8c0: 6173 656e 616d 6528 6469 736b 5b27 7061  asename(disk['pa
-0001c8d0: 7468 275d 290a 2020 2020 2020 2020 2020  th']).          
-0001c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8f0: 2020 2020 2020 2020 2020 6469 736b 706f            diskpo
-0001c900: 6f6c 203d 206f 732e 7061 7468 2e64 6972  ol = os.path.dir
-0001c910: 6e61 6d65 2864 6973 6b5b 2770 6174 6827  name(disk['path'
-0001c920: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0001c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c940: 2020 2020 2020 207a 2e64 656c 6574 655f         z.delete_
-0001c950: 6469 736b 286e 616d 653d 6e61 6d65 2c20  disk(name=name, 
-0001c960: 6469 736b 6e61 6d65 3d64 6973 6b6e 616d  diskname=disknam
-0001c970: 652c 2070 6f6f 6c3d 6469 736b 706f 6f6c  e, pool=diskpool
-0001c980: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c990: 2020 2020 2020 2020 2020 6966 2027 6e65            if 'ne
-0001c9a0: 7473 2720 696e 2070 726f 6669 6c65 3a0a  ts' in profile:.
+0001c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8b0: 2020 2020 2070 6f6f 6c20 3d20 7365 6c66       pool = self
+0001c8c0: 2e70 6f6f 6c0a 2020 2020 2020 2020 2020  .pool.          
+0001c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8e0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+0001c8f0: 7369 6e73 7461 6e63 6528 6469 736b 2c20  sinstance(disk, 
+0001c900: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
+0001c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c920: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001c930: 697a 6520 3d20 6469 736b 2e67 6574 2827  ize = disk.get('
+0001c940: 7369 7a65 272c 2073 656c 662e 6469 736b  size', self.disk
+0001c950: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
+0001c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c970: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0001c980: 6f6c 203d 2064 6973 6b2e 6765 7428 2770  ol = disk.get('p
+0001c990: 6f6f 6c27 2c20 7365 6c66 2e70 6f6f 6c29  ool', self.pool)
+0001c9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0001c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9c0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0001c9d0: 656e 2863 7572 7265 6e74 6e65 7473 2920  en(currentnets) 
-0001c9e0: 3c20 6c65 6e28 7072 6f66 696c 655b 276e  < len(profile['n
-0001c9f0: 6574 7327 5d29 3a0a 2020 2020 2020 2020  ets']):.        
+0001c9c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9f0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
 0001ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca10: 2020 2020 2020 2020 7570 6461 7465 6420          updated 
-0001ca20: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-0001ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca40: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-0001ca50: 4164 6469 6e67 204e 6963 7320 746f 207b  Adding Nics to {
-0001ca60: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
-0001ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca80: 2020 2020 2020 2020 666f 7220 6e65 7420          for net 
-0001ca90: 696e 2070 726f 6669 6c65 5b27 6e65 7473  in profile['nets
-0001caa0: 275d 5b6c 656e 2863 7572 7265 6e74 6e65  '][len(currentne
-0001cab0: 7473 293a 5d3a 0a20 2020 2020 2020 2020  ts):]:.         
-0001cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cad0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0001cae0: 696e 7374 616e 6365 286e 6574 2c20 7374  instance(net, st
-0001caf0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-0001cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb10: 2020 2020 2020 2020 2020 2020 6e65 7477              netw
-0001cb20: 6f72 6b20 3d20 6e65 740a 2020 2020 2020  ork = net.      
-0001cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb40: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001cb50: 6966 2069 7369 6e73 7461 6e63 6528 6e65  if isinstance(ne
-0001cb60: 742c 2064 6963 7429 2061 6e64 2027 6e61  t, dict) and 'na
-0001cb70: 6d65 2720 696e 206e 6574 3a0a 2020 2020  me' in net:.    
+0001ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca20: 7a2e 6164 645f 6469 736b 286e 616d 653d  z.add_disk(name=
+0001ca30: 6e61 6d65 2c20 7369 7a65 3d73 697a 652c  name, size=size,
+0001ca40: 2070 6f6f 6c3d 706f 6f6c 290a 2020 2020   pool=pool).    
+0001ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca60: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
+0001ca70: 7572 7265 6e74 6469 736b 7329 203e 206c  urrentdisks) > l
+0001ca80: 656e 2870 726f 6669 6c65 5b27 6469 736b  en(profile['disk
+0001ca90: 7327 5d29 3a0a 2020 2020 2020 2020 2020  s']):.          
+0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cab0: 2020 2020 2020 7570 6461 7465 6420 3d20        updated = 
+0001cac0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0001cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cae0: 2020 2020 2070 7072 696e 7428 6622 5265       pprint(f"Re
+0001caf0: 6d6f 7669 6e67 2044 6973 6b73 206f 6620  moving Disks of 
+0001cb00: 7b6e 616d 657d 2229 0a20 2020 2020 2020  {name}").       
+0001cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb20: 2020 2020 2020 2020 2066 6f72 2064 6973           for dis
+0001cb30: 6b20 696e 2063 7572 7265 6e74 6469 736b  k in currentdisk
+0001cb40: 735b 6c65 6e28 6375 7272 656e 7464 6973  s[len(currentdis
+0001cb50: 6b73 2920 2d20 6c65 6e28 7072 6f66 696c  ks) - len(profil
+0001cb60: 655b 2764 6973 6b73 275d 293a 5d3a 0a20  e['disks']):]:. 
+0001cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cba0: 2020 2020 6e65 7477 6f72 6b20 3d20 6e65      network = ne
-0001cbb0: 745b 276e 616d 6527 5d0a 2020 2020 2020  t['name'].      
+0001cb90: 2020 2064 6973 6b6e 616d 6520 3d20 6f73     diskname = os
+0001cba0: 2e70 6174 682e 6261 7365 6e61 6d65 2864  .path.basename(d
+0001cbb0: 6973 6b5b 2770 6174 6827 5d29 0a20 2020  isk['path']).   
 0001cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbd0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001cbe0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc00: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-0001cc10: 7228 6622 536b 7070 696e 6720 7772 6f6e  r(f"Skpping wron
-0001cc20: 6720 6e69 6320 7370 6563 2066 6f72 207b  g nic spec for {
-0001cc30: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
-0001cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc60: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbe0: 2064 6973 6b70 6f6f 6c20 3d20 6f73 2e70   diskpool = os.p
+0001cbf0: 6174 682e 6469 726e 616d 6528 6469 736b  ath.dirname(disk
+0001cc00: 5b27 7061 7468 275d 290a 2020 2020 2020  ['path']).      
+0001cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc20: 2020 2020 2020 2020 2020 2020 2020 7a2e                z.
+0001cc30: 6465 6c65 7465 5f64 6973 6b28 6e61 6d65  delete_disk(name
+0001cc40: 3d6e 616d 652c 2064 6973 6b6e 616d 653d  =name, diskname=
+0001cc50: 6469 736b 6e61 6d65 2c20 706f 6f6c 3d64  diskname, pool=d
+0001cc60: 6973 6b70 6f6f 6c29 0a20 2020 2020 2020  iskpool).       
 0001cc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc80: 2020 2020 2020 2020 2020 2020 207a 2e61               z.a
-0001cc90: 6464 5f6e 6963 286e 616d 652c 206e 6574  dd_nic(name, net
-0001cca0: 776f 726b 290a 2020 2020 2020 2020 2020  work).          
-0001ccb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ccc0: 2020 6966 206c 656e 2863 7572 7265 6e74    if len(current
-0001ccd0: 6e65 7473 2920 3e20 6c65 6e28 7072 6f66  nets) > len(prof
-0001cce0: 696c 655b 276e 6574 7327 5d29 3a0a 2020  ile['nets']):.  
-0001ccf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd00: 2020 2020 2020 2020 2020 2020 2020 7570                up
-0001cd10: 6461 7465 6420 3d20 5472 7565 0a20 2020  dated = True.   
-0001cd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd30: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001cd40: 696e 7428 6622 5265 6d6f 7669 6e67 204e  int(f"Removing N
-0001cd50: 6963 7320 6f66 207b 6e61 6d65 7d22 290a  ics of {name}").
-0001cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd80: 666f 7220 6e65 7420 696e 2072 616e 6765  for net in range
-0001cd90: 286c 656e 2863 7572 7265 6e74 6e65 7473  (len(currentnets
-0001cda0: 292c 206c 656e 2870 726f 6669 6c65 5b27  ), len(profile['
-0001cdb0: 6e65 7473 275d 292c 202d 3129 3a0a 2020  nets']), -1):.  
-0001cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cde0: 2020 696e 7465 7266 6163 6520 3d20 6622    interface = f"
-0001cdf0: 6574 687b 6e65 7420 2d31 7d22 0a20 2020  eth{net -1}".   
-0001ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce20: 207a 2e64 656c 6574 655f 6e69 6328 6e61   z.delete_nic(na
-0001ce30: 6d65 2c20 696e 7465 7266 6163 6529 0a20  me, interface). 
-0001ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce50: 2020 2020 2020 2069 6620 6f76 6572 7269         if overri
-0001ce60: 6465 732e 6765 7428 2773 6b69 705f 6669  des.get('skip_fi
-0001ce70: 6c65 735f 7265 6d65 6469 6174 696f 6e27  les_remediation'
-0001ce80: 2c20 4661 6c73 6529 3a0a 2020 2020 2020  , False):.      
-0001ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cea0: 2020 2020 2020 7070 7269 6e74 2866 2253        pprint(f"S
-0001ceb0: 6b69 7070 696e 6720 5265 6d65 6469 6174  kipping Remediat
-0001cec0: 696f 6e20 6669 6c65 7320 6f66 207b 6e61  ion files of {na
-0001ced0: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
-0001cee0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001cef0: 6966 2073 656c 662e 7265 6d65 6469 6174  if self.remediat
-0001cf00: 655f 6669 6c65 7328 6e61 6d65 2c20 7072  e_files(name, pr
-0001cf10: 6f66 696c 652e 6765 7428 2766 696c 6573  ofile.get('files
-0001cf20: 272c 205b 5d29 2c20 6f76 6572 7269 6465  ', []), override
-0001cf30: 732c 2069 6e70 7574 6469 723d 696e 7075  s, inputdir=inpu
-0001cf40: 7464 6972 293a 0a20 2020 2020 2020 2020  tdir):.         
+0001cc80: 2069 6620 276e 6574 7327 2069 6e20 7072   if 'nets' in pr
+0001cc90: 6f66 696c 653a 0a20 2020 2020 2020 2020  ofile:.         
+0001cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccb0: 2020 2069 6620 6c65 6e28 6375 7272 656e     if len(curren
+0001ccc0: 746e 6574 7329 203c 206c 656e 2870 726f  tnets) < len(pro
+0001ccd0: 6669 6c65 5b27 6e65 7473 275d 293a 0a20  file['nets']):. 
+0001cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccf0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0001cd00: 7064 6174 6564 203d 2054 7275 650a 2020  pdated = True.  
+0001cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd20: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+0001cd30: 7269 6e74 2866 2241 6464 696e 6720 4e69  rint(f"Adding Ni
+0001cd40: 6373 2074 6f20 7b6e 616d 657d 2229 0a20  cs to {name}"). 
+0001cd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd60: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001cd70: 6f72 206e 6574 2069 6e20 7072 6f66 696c  or net in profil
+0001cd80: 655b 276e 6574 7327 5d5b 6c65 6e28 6375  e['nets'][len(cu
+0001cd90: 7272 656e 746e 6574 7329 3a5d 3a0a 2020  rrentnets):]:.  
+0001cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdc0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001cdd0: 6e65 742c 2073 7472 293a 0a20 2020 2020  net, str):.     
+0001cde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce00: 2020 206e 6574 776f 726b 203d 206e 6574     network = net
+0001ce10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce30: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+0001ce40: 616e 6365 286e 6574 2c20 6469 6374 2920  ance(net, dict) 
+0001ce50: 616e 6420 276e 616d 6527 2069 6e20 6e65  and 'name' in ne
+0001ce60: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0001ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce80: 2020 2020 2020 2020 2020 206e 6574 776f             netwo
+0001ce90: 726b 203d 206e 6574 5b27 6e61 6d65 275d  rk = net['name']
+0001cea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cec0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cef0: 2020 2065 7272 6f72 2866 2253 6b70 7069     error(f"Skppi
+0001cf00: 6e67 2077 726f 6e67 206e 6963 2073 7065  ng wrong nic spe
+0001cf10: 6320 666f 7220 7b6e 616d 657d 2229 0a20  c for {name}"). 
+0001cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf40: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
 0001cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf60: 2020 2075 7064 6174 6564 203d 2054 7275     updated = Tru
-0001cf70: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001cf80: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0001cf90: 2075 7064 6174 6564 3a0a 2020 2020 2020   updated:.      
-0001cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfb0: 2020 2020 2020 7070 7269 6e74 2866 227b        pprint(f"{
-0001cfc0: 6e61 6d65 7d20 736b 6970 7065 6420 6f6e  name} skipped on
-0001cfd0: 207b 766d 636c 6965 6e74 7d21 2229 0a20   {vmclient}!"). 
+0001cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf70: 2020 2020 7a2e 6164 645f 6e69 6328 6e61      z.add_nic(na
+0001cf80: 6d65 2c20 6e65 7477 6f72 6b29 0a20 2020  me, network).   
+0001cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfa0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0001cfb0: 6375 7272 656e 746e 6574 7329 203e 206c  currentnets) > l
+0001cfc0: 656e 2870 726f 6669 6c65 5b27 6e65 7473  en(profile['nets
+0001cfd0: 275d 293a 0a20 2020 2020 2020 2020 2020  ']):.           
 0001cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cff0: 2020 2065 7869 7374 696e 6776 6d73 2e61     existingvms.a
-0001d000: 7070 656e 6428 6e61 6d65 290a 2020 2020  ppend(name).    
+0001cff0: 2020 2020 2075 7064 6174 6564 203d 2054       updated = T
+0001d000: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
 0001d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d020: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0001d030: 2020 2020 2020 2020 2073 6861 7265 646b           sharedk
-0001d040: 6579 203d 2070 726f 6669 6c65 2e67 6574  ey = profile.get
-0001d050: 2827 7368 6172 6564 6b65 7927 2c20 7365  ('sharedkey', se
-0001d060: 6c66 2e73 6861 7265 646b 6579 290a 2020  lf.sharedkey).  
-0001d070: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001d080: 2073 6861 7265 646b 6579 3a0a 2020 2020   sharedkey:.    
-0001d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0a0: 766d 636f 756e 7465 7220 2b3d 2031 0a20  vmcounter += 1. 
+0001d020: 2020 2020 7070 7269 6e74 2866 2252 656d      pprint(f"Rem
+0001d030: 6f76 696e 6720 4e69 6373 206f 6620 7b6e  oving Nics of {n
+0001d040: 616d 657d 2229 0a20 2020 2020 2020 2020  ame}").         
+0001d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d060: 2020 2020 2020 2066 6f72 206e 6574 2069         for net i
+0001d070: 6e20 7261 6e67 6528 6c65 6e28 6375 7272  n range(len(curr
+0001d080: 656e 746e 6574 7329 2c20 6c65 6e28 7072  entnets), len(pr
+0001d090: 6f66 696c 655b 276e 6574 7327 5d29 2c20  ofile['nets']), 
+0001d0a0: 2d31 293a 0a20 2020 2020 2020 2020 2020  -1):.           
 0001d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0c0: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
-0001d0d0: 682e 6578 6973 7473 2866 227b 706c 616e  h.exists(f"{plan
-0001d0e0: 7d2e 6b65 7922 2920 6f72 206e 6f74 206f  }.key") or not o
-0001d0f0: 732e 7061 7468 2e65 7869 7374 7328 6622  s.path.exists(f"
-0001d100: 7b70 6c61 6e7d 2e6b 6579 2e70 7562 2229  {plan}.key.pub")
-0001d110: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d120: 2020 2020 2020 2020 2020 6f73 2e73 7973            os.sys
-0001d130: 7465 6d28 6622 7373 682d 6b65 7967 656e  tem(f"ssh-keygen
-0001d140: 202d 7174 2072 7361 202d 4e20 2727 202d   -qt rsa -N '' -
-0001d150: 6620 7b70 6c61 6e7d 2e6b 6579 2229 0a20  f {plan}.key"). 
-0001d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d170: 2020 2070 7562 6c69 636b 6579 203d 206f     publickey = o
-0001d180: 7065 6e28 6622 7b70 6c61 6e7d 2e6b 6579  pen(f"{plan}.key
-0001d190: 2e70 7562 2229 2e72 6561 6428 292e 7374  .pub").read().st
-0001d1a0: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
-0001d1b0: 2020 2020 2020 2020 2020 7072 6976 6174            privat
-0001d1c0: 656b 6579 203d 206f 7065 6e28 6622 7b70  ekey = open(f"{p
-0001d1d0: 6c61 6e7d 2e6b 6579 2229 2e72 6561 6428  lan}.key").read(
-0001d1e0: 292e 7374 7269 7028 290a 2020 2020 2020  ).strip().      
-0001d1f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001d200: 2027 6b65 7973 2720 6e6f 7420 696e 2070   'keys' not in p
-0001d210: 726f 6669 6c65 3a0a 2020 2020 2020 2020  rofile:.        
-0001d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d230: 7072 6f66 696c 655b 276b 6579 7327 5d20  profile['keys'] 
-0001d240: 3d20 5b70 7562 6c69 636b 6579 5d0a 2020  = [publickey].  
-0001d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d260: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d280: 7072 6f66 696c 655b 276b 6579 7327 5d2e  profile['keys'].
-0001d290: 6170 7065 6e64 2870 7562 6c69 636b 6579  append(publickey
-0001d2a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d2b0: 2020 2020 2020 6966 2027 6669 6c65 7327        if 'files'
-0001d2c0: 2069 6e20 7072 6f66 696c 653a 0a20 2020   in profile:.   
-0001d2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2e0: 2020 2020 2070 726f 6669 6c65 5b27 6669       profile['fi
-0001d2f0: 6c65 7327 5d2e 6170 7065 6e64 287b 2770  les'].append({'p
-0001d300: 6174 6827 3a20 272f 726f 6f74 2f2e 7373  ath': '/root/.ss
-0001d310: 682f 6964 5f72 7361 272c 2027 636f 6e74  h/id_rsa', 'cont
-0001d320: 656e 7427 3a20 7072 6976 6174 656b 6579  ent': privatekey
-0001d330: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
-0001d340: 2020 2020 2020 2020 2020 2070 726f 6669             profi
-0001d350: 6c65 5b27 6669 6c65 7327 5d2e 6170 7065  le['files'].appe
-0001d360: 6e64 287b 2770 6174 6827 3a20 272f 726f  nd({'path': '/ro
-0001d370: 6f74 2f2e 7373 682f 6964 5f72 7361 2e70  ot/.ssh/id_rsa.p
-0001d380: 7562 272c 2027 636f 6e74 656e 7427 3a20  ub', 'content': 
-0001d390: 7075 626c 6963 6b65 797d 290a 2020 2020  publickey}).    
-0001d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001d3c0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001d3d0: 6f66 696c 655b 2766 696c 6573 275d 203d  ofile['files'] =
-0001d3e0: 205b 7b27 7061 7468 273a 2027 2f72 6f6f   [{'path': '/roo
-0001d3f0: 742f 2e73 7368 2f69 645f 7273 6127 2c20  t/.ssh/id_rsa', 
-0001d400: 2763 6f6e 7465 6e74 273a 2070 7269 7661  'content': priva
-0001d410: 7465 6b65 797d 2c0a 2020 2020 2020 2020  tekey},.        
-0001d420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d440: 2020 2020 7b27 7061 7468 273a 2027 2f72      {'path': '/r
-0001d450: 6f6f 742f 2e73 7368 2f69 645f 7273 612e  oot/.ssh/id_rsa.
-0001d460: 7075 6227 2c20 2763 6f6e 7465 6e74 273a  pub', 'content':
-0001d470: 2070 7562 6c69 636b 6579 7d5d 0a20 2020   publickey}].   
-0001d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d490: 2069 6620 766d 636f 756e 7465 7220 3e3d   if vmcounter >=
-0001d4a0: 206c 656e 2876 6d65 6e74 7269 6573 293a   len(vmentries):
-0001d4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d4c0: 2020 2020 2020 2020 206f 732e 7265 6d6f           os.remo
-0001d4d0: 7665 2866 227b 706c 616e 7d2e 6b65 792e  ve(f"{plan}.key.
-0001d4e0: 7075 6222 290a 2020 2020 2020 2020 2020  pub").          
-0001d4f0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-0001d500: 2e72 656d 6f76 6528 6622 7b70 6c61 6e7d  .remove(f"{plan}
-0001d510: 2e6b 6579 2229 0a20 2020 2020 2020 2020  .key").         
-0001d520: 2020 2020 2020 2063 7572 7265 6e74 6f76         currentov
-0001d530: 6572 7269 6465 7320 3d20 6f76 6572 7269  errides = overri
-0001d540: 6465 732e 636f 7079 2829 0a20 2020 2020  des.copy().     
-0001d550: 2020 2020 2020 2020 2020 2069 6620 2769             if 'i
-0001d560: 6d61 6765 2720 696e 2070 726f 6669 6c65  mage' in profile
-0001d570: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d580: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
-0001d590: 696e 2073 656c 662e 6c69 7374 5f70 726f  in self.list_pro
-0001d5a0: 6669 6c65 7328 293a 0a20 2020 2020 2020  files():.       
-0001d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5c0: 2063 7572 7265 6e74 696d 6167 6520 3d20   currentimage = 
-0001d5d0: 7072 6f66 696c 655b 2769 6d61 6765 275d  profile['image']
-0001d5e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d5f0: 2020 2020 2020 2020 2065 6e74 7279 7072           entrypr
-0001d600: 6f66 696c 6520 3d20 656e 7472 795b 305d  ofile = entry[0]
-0001d610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d620: 2020 2020 2020 2020 2069 6620 656e 7472           if entr
-0001d630: 7970 726f 6669 6c65 203d 3d20 6375 7272  yprofile == curr
-0001d640: 656e 7469 6d61 6765 3a0a 2020 2020 2020  entimage:.      
-0001d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d660: 2020 2020 2020 7072 6f66 696c 655b 2769        profile['i
-0001d670: 6d61 6765 275d 203d 2065 6e74 7279 5b34  mage'] = entry[4
-0001d680: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001d690: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0001d6a0: 7272 656e 746f 7665 7272 6964 6573 5b27  rrentoverrides['
-0001d6b0: 696d 6167 6527 5d20 3d20 7072 6f66 696c  image'] = profil
-0001d6c0: 655b 2769 6d61 6765 275d 0a20 2020 2020  e['image'].     
-0001d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6e0: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-0001d6f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001d700: 7468 7265 6164 6564 3a0a 2020 2020 2020  threaded:.      
-0001d710: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0001d720: 775f 6172 6773 203d 2028 6e61 6d65 2c20  w_args = (name, 
-0001d730: 7072 6f66 696c 656e 616d 652c 2063 7572  profilename, cur
-0001d740: 7265 6e74 6f76 6572 7269 6465 732c 2070  rentoverrides, p
-0001d750: 726f 6669 6c65 2c20 7a2c 2070 6c61 6e2c  rofile, z, plan,
-0001d760: 2063 7572 7265 6e74 706c 616e 6469 722c   currentplandir,
-0001d770: 2076 6d63 6c69 656e 742c 0a20 2020 2020   vmclient,.     
-0001d780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d790: 2020 2020 2020 2020 2020 206f 6e66 6c79             onfly
-0001d7a0: 2c20 6f6e 6c79 6173 7365 7473 2c20 6e65  , onlyassets, ne
-0001d7b0: 7776 6d73 2c20 6661 696c 6564 766d 732c  wvms, failedvms,
-0001d7c0: 2061 7379 6e63 7761 6974 766d 732c 206e   asyncwaitvms, n
-0001d7d0: 6577 6173 7365 7473 290a 2020 2020 2020  ewassets).      
-0001d7e0: 2020 2020 2020 2020 2020 2020 2020 7420                t 
-0001d7f0: 3d20 7468 7265 6164 696e 672e 5468 7265  = threading.Thre
-0001d800: 6164 2874 6172 6765 743d 7365 6c66 2e74  ad(target=self.t
-0001d810: 6872 6561 6465 645f 6372 6561 7465 5f76  hreaded_create_v
-0001d820: 6d2c 2061 7267 733d 6e65 775f 6172 6773  m, args=new_args
+0001d0c0: 2020 2020 2020 2020 2069 6e74 6572 6661           interfa
+0001d0d0: 6365 203d 2066 2265 7468 7b6e 6574 202d  ce = f"eth{net -
+0001d0e0: 317d 220a 2020 2020 2020 2020 2020 2020  1}".            
+0001d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d100: 2020 2020 2020 2020 7a2e 6465 6c65 7465          z.delete
+0001d110: 5f6e 6963 286e 616d 652c 2069 6e74 6572  _nic(name, inter
+0001d120: 6661 6365 290a 2020 2020 2020 2020 2020  face).          
+0001d130: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001d140: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+0001d150: 736b 6970 5f66 696c 6573 5f72 656d 6564  skip_files_remed
+0001d160: 6961 7469 6f6e 272c 2046 616c 7365 293a  iation', False):
+0001d170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d180: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0001d190: 696e 7428 6622 536b 6970 7069 6e67 2052  int(f"Skipping R
+0001d1a0: 656d 6564 6961 7469 6f6e 2066 696c 6573  emediation files
+0001d1b0: 206f 6620 7b6e 616d 657d 2229 0a20 2020   of {name}").   
+0001d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1d0: 2020 2020 2065 6c69 6620 7365 6c66 2e72       elif self.r
+0001d1e0: 656d 6564 6961 7465 5f66 696c 6573 286e  emediate_files(n
+0001d1f0: 616d 652c 2070 726f 6669 6c65 2e67 6574  ame, profile.get
+0001d200: 2827 6669 6c65 7327 2c20 5b5d 292c 206f  ('files', []), o
+0001d210: 7665 7272 6964 6573 2c20 696e 7075 7464  verrides, inputd
+0001d220: 6972 3d69 6e70 7574 6469 7229 3a0a 2020  ir=inputdir):.  
+0001d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d240: 2020 2020 2020 2020 2020 7570 6461 7465            update
+0001d250: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+0001d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d270: 2069 6620 6e6f 7420 7570 6461 7465 643a   if not updated:
+0001d280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d290: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0001d2a0: 696e 7428 6622 7b6e 616d 657d 2073 6b69  int(f"{name} ski
+0001d2b0: 7070 6564 206f 6e20 7b76 6d63 6c69 656e  pped on {vmclien
+0001d2c0: 747d 2122 290a 2020 2020 2020 2020 2020  t}!").          
+0001d2d0: 2020 2020 2020 2020 2020 6578 6973 7469            existi
+0001d2e0: 6e67 766d 732e 6170 7065 6e64 286e 616d  ngvms.append(nam
+0001d2f0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001d300: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0001d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d320: 7368 6172 6564 6b65 7920 3d20 7072 6f66  sharedkey = prof
+0001d330: 696c 652e 6765 7428 2773 6861 7265 646b  ile.get('sharedk
+0001d340: 6579 272c 2073 656c 662e 7368 6172 6564  ey', self.shared
+0001d350: 6b65 7929 0a20 2020 2020 2020 2020 2020  key).           
+0001d360: 2020 2020 2069 6620 7368 6172 6564 6b65       if sharedke
+0001d370: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0001d380: 2020 2020 2020 2076 6d63 6f75 6e74 6572         vmcounter
+0001d390: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0001d3a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0001d3b0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+0001d3c0: 6622 7b70 6c61 6e7d 2e6b 6579 2229 206f  f"{plan}.key") o
+0001d3d0: 7220 6e6f 7420 6f73 2e70 6174 682e 6578  r not os.path.ex
+0001d3e0: 6973 7473 2866 227b 706c 616e 7d2e 6b65  ists(f"{plan}.ke
+0001d3f0: 792e 7075 6222 293a 0a20 2020 2020 2020  y.pub"):.       
+0001d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d410: 206f 732e 7379 7374 656d 2866 2273 7368   os.system(f"ssh
+0001d420: 2d6b 6579 6765 6e20 2d71 7420 7273 6120  -keygen -qt rsa 
+0001d430: 2d4e 2027 2720 2d66 207b 706c 616e 7d2e  -N '' -f {plan}.
+0001d440: 6b65 7922 290a 2020 2020 2020 2020 2020  key").          
+0001d450: 2020 2020 2020 2020 2020 7075 626c 6963            public
+0001d460: 6b65 7920 3d20 6f70 656e 2866 227b 706c  key = open(f"{pl
+0001d470: 616e 7d2e 6b65 792e 7075 6222 292e 7265  an}.key.pub").re
+0001d480: 6164 2829 2e73 7472 6970 2829 0a20 2020  ad().strip().   
+0001d490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4a0: 2070 7269 7661 7465 6b65 7920 3d20 6f70   privatekey = op
+0001d4b0: 656e 2866 227b 706c 616e 7d2e 6b65 7922  en(f"{plan}.key"
+0001d4c0: 292e 7265 6164 2829 2e73 7472 6970 2829  ).read().strip()
+0001d4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d4e0: 2020 2020 2069 6620 276b 6579 7327 206e       if 'keys' n
+0001d4f0: 6f74 2069 6e20 7072 6f66 696c 653a 0a20  ot in profile:. 
+0001d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d510: 2020 2020 2020 2070 726f 6669 6c65 5b27         profile['
+0001d520: 6b65 7973 275d 203d 205b 7075 626c 6963  keys'] = [public
+0001d530: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
+0001d540: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d560: 2020 2020 2020 2070 726f 6669 6c65 5b27         profile['
+0001d570: 6b65 7973 275d 2e61 7070 656e 6428 7075  keys'].append(pu
+0001d580: 626c 6963 6b65 7929 0a20 2020 2020 2020  blickey).       
+0001d590: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001d5a0: 2766 696c 6573 2720 696e 2070 726f 6669  'files' in profi
+0001d5b0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+0001d5c0: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
+0001d5d0: 696c 655b 2766 696c 6573 275d 2e61 7070  ile['files'].app
+0001d5e0: 656e 6428 7b27 7061 7468 273a 2027 2f72  end({'path': '/r
+0001d5f0: 6f6f 742f 2e73 7368 2f69 645f 7273 6127  oot/.ssh/id_rsa'
+0001d600: 2c20 2763 6f6e 7465 6e74 273a 2070 7269  , 'content': pri
+0001d610: 7661 7465 6b65 797d 290a 2020 2020 2020  vatekey}).      
+0001d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d630: 2020 7072 6f66 696c 655b 2766 696c 6573    profile['files
+0001d640: 275d 2e61 7070 656e 6428 7b27 7061 7468  '].append({'path
+0001d650: 273a 2027 2f72 6f6f 742f 2e73 7368 2f69  ': '/root/.ssh/i
+0001d660: 645f 7273 612e 7075 6227 2c20 2763 6f6e  d_rsa.pub', 'con
+0001d670: 7465 6e74 273a 2070 7562 6c69 636b 6579  tent': publickey
+0001d680: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+0001d690: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6b0: 2020 2020 2070 726f 6669 6c65 5b27 6669       profile['fi
+0001d6c0: 6c65 7327 5d20 3d20 5b7b 2770 6174 6827  les'] = [{'path'
+0001d6d0: 3a20 272f 726f 6f74 2f2e 7373 682f 6964  : '/root/.ssh/id
+0001d6e0: 5f72 7361 272c 2027 636f 6e74 656e 7427  _rsa', 'content'
+0001d6f0: 3a20 7072 6976 6174 656b 6579 7d2c 0a20  : privatekey},. 
+0001d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d720: 2020 2020 2020 2020 2020 207b 2770 6174             {'pat
+0001d730: 6827 3a20 272f 726f 6f74 2f2e 7373 682f  h': '/root/.ssh/
+0001d740: 6964 5f72 7361 2e70 7562 272c 2027 636f  id_rsa.pub', 'co
+0001d750: 6e74 656e 7427 3a20 7075 626c 6963 6b65  ntent': publicke
+0001d760: 797d 5d0a 2020 2020 2020 2020 2020 2020  y}].            
+0001d770: 2020 2020 2020 2020 6966 2076 6d63 6f75          if vmcou
+0001d780: 6e74 6572 203e 3d20 6c65 6e28 766d 656e  nter >= len(vmen
+0001d790: 7472 6965 7329 3a0a 2020 2020 2020 2020  tries):.        
+0001d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7b0: 6f73 2e72 656d 6f76 6528 6622 7b70 6c61  os.remove(f"{pla
+0001d7c0: 6e7d 2e6b 6579 2e70 7562 2229 0a20 2020  n}.key.pub").   
+0001d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7e0: 2020 2020 206f 732e 7265 6d6f 7665 2866       os.remove(f
+0001d7f0: 227b 706c 616e 7d2e 6b65 7922 290a 2020  "{plan}.key").  
+0001d800: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001d810: 7272 656e 746f 7665 7272 6964 6573 203d  rrentoverrides =
+0001d820: 206f 7665 7272 6964 6573 2e63 6f70 7928   overrides.copy(
 0001d830: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d840: 2020 2020 2020 7468 7265 6164 732e 6170        threads.ap
-0001d850: 7065 6e64 2874 290a 2020 2020 2020 2020  pend(t).        
-0001d860: 2020 2020 2020 2020 2020 2020 742e 7374              t.st
-0001d870: 6172 7428 290a 2020 2020 2020 2020 2020  art().          
-0001d880: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001d840: 2020 6966 2027 696d 6167 6527 2069 6e20    if 'image' in 
+0001d850: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
+0001d860: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001d870: 2065 6e74 7279 2069 6e20 7365 6c66 2e6c   entry in self.l
+0001d880: 6973 745f 7072 6f66 696c 6573 2829 3a0a  ist_profiles():.
 0001d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8a0: 7265 7375 6c74 203d 2073 656c 662e 6372  result = self.cr
-0001d8b0: 6561 7465 5f76 6d28 6e61 6d65 2c20 7072  eate_vm(name, pr
-0001d8c0: 6f66 696c 656e 616d 652c 206f 7665 7272  ofilename, overr
-0001d8d0: 6964 6573 3d63 7572 7265 6e74 6f76 6572  ides=currentover
-0001d8e0: 7269 6465 732c 2063 7573 746f 6d70 726f  rides, custompro
-0001d8f0: 6669 6c65 3d70 726f 6669 6c65 2c20 6b3d  file=profile, k=
-0001d900: 7a2c 0a20 2020 2020 2020 2020 2020 2020  z,.             
-0001d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d920: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001d930: 6c61 6e3d 706c 616e 2c20 6261 7365 6469  lan=plan, basedi
-0001d940: 723d 6375 7272 656e 7470 6c61 6e64 6972  r=currentplandir
-0001d950: 2c20 636c 6965 6e74 3d76 6d63 6c69 656e  , client=vmclien
-0001d960: 742c 206f 6e66 6c79 3d6f 6e66 6c79 2c0a  t, onfly=onfly,.
+0001d8a0: 2020 2020 2020 2020 6375 7272 656e 7469          currenti
+0001d8b0: 6d61 6765 203d 2070 726f 6669 6c65 5b27  mage = profile['
+0001d8c0: 696d 6167 6527 5d0a 2020 2020 2020 2020  image'].        
+0001d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8e0: 656e 7472 7970 726f 6669 6c65 203d 2065  entryprofile = e
+0001d8f0: 6e74 7279 5b30 5d0a 2020 2020 2020 2020  ntry[0].        
+0001d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d910: 6966 2065 6e74 7279 7072 6f66 696c 6520  if entryprofile 
+0001d920: 3d3d 2063 7572 7265 6e74 696d 6167 653a  == currentimage:
+0001d930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d940: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+0001d950: 6669 6c65 5b27 696d 6167 6527 5d20 3d20  file['image'] = 
+0001d960: 656e 7472 795b 345d 0a20 2020 2020 2020  entry[4].       
 0001d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d990: 2020 2020 2020 2020 2020 2020 6f6e 6c79              only
-0001d9a0: 6173 7365 7473 3d6f 6e6c 7961 7373 6574  assets=onlyasset
-0001d9b0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-0001d9c0: 2020 2020 2020 2069 6620 6e6f 7420 6f6e         if not on
-0001d9d0: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
-0001d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9f0: 2020 636f 6d6d 6f6e 2e68 616e 646c 655f    common.handle_
-0001da00: 7265 7370 6f6e 7365 2872 6573 756c 742c  response(result,
-0001da10: 206e 616d 652c 2063 6c69 656e 743d 766d   name, client=vm
-0001da20: 636c 6965 6e74 290a 2020 2020 2020 2020  client).        
-0001da30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001da40: 2e68 616e 646c 655f 766d 5f72 6573 756c  .handle_vm_resul
-0001da50: 7428 6e61 6d65 2c20 7072 6f66 696c 652c  t(name, profile,
-0001da60: 2072 6573 756c 743d 7265 7375 6c74 2c20   result=result, 
-0001da70: 6e65 7776 6d73 3d6e 6577 766d 732c 2066  newvms=newvms, f
-0001da80: 6169 6c65 6476 6d73 3d66 6169 6c65 6476  ailedvms=failedv
-0001da90: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
-0001daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dab0: 2020 2020 2020 2020 2020 2020 2020 6173                as
-0001dac0: 796e 6377 6169 7476 6d73 3d61 7379 6e63  yncwaitvms=async
-0001dad0: 7761 6974 766d 732c 206f 6e6c 7961 7373  waitvms, onlyass
-0001dae0: 6574 733d 6f6e 6c79 6173 7365 7473 2c20  ets=onlyassets, 
-0001daf0: 6e65 7761 7373 6574 733d 6e65 7761 7373  newassets=newass
-0001db00: 6574 732c 0a20 2020 2020 2020 2020 2020  ets,.           
-0001db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db20: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001db30: 6d63 6c69 656e 743d 766d 636c 6965 6e74  mclient=vmclient
-0001db40: 290a 2020 2020 2020 2020 6966 2076 6d65  ).        if vme
-0001db50: 6e74 7269 6573 2061 6e64 2074 6872 6561  ntries and threa
-0001db60: 6465 643a 0a20 2020 2020 2020 2020 2020  ded:.           
-0001db70: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
-0001db80: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001db90: 2069 6e64 6578 2c20 7420 696e 2065 6e75   index, t in enu
-0001dba0: 6d65 7261 7465 2874 6872 6561 6473 293a  merate(threads):
-0001dbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dbc0: 2020 2020 2069 6620 6e6f 7420 742e 6973       if not t.is
-0001dbd0: 5f61 6c69 7665 2829 3a0a 2020 2020 2020  _alive():.      
-0001dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbf0: 2020 6465 6c20 7468 7265 6164 735b 696e    del threads[in
-0001dc00: 6465 785d 0a20 2020 2020 2020 2020 2020  dex].           
-0001dc10: 2020 2020 2069 6620 6e6f 7420 7468 7265       if not thre
-0001dc20: 6164 733a 0a20 2020 2020 2020 2020 2020  ads:.           
-0001dc30: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-0001dc40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001dc50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001dc60: 2020 2020 2020 2020 2073 6c65 6570 2831           sleep(1
-0001dc70: 290a 2020 2020 2020 2020 6966 2076 6d63  ).        if vmc
-0001dc80: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
-0001dc90: 2020 2020 7961 6d6c 2e73 6166 655f 6475      yaml.safe_du
-0001dca0: 6d70 2876 6d63 6c69 656e 7473 2c20 6f70  mp(vmclients, op
-0001dcb0: 656e 286f 732e 7061 7468 2e65 7870 616e  en(os.path.expan
-0001dcc0: 6475 7365 7228 6627 7e2f 2e6b 636c 692f  duser(f'~/.kcli/
-0001dcd0: 766d 636c 6965 6e74 735f 7b70 6c61 6e7d  vmclients_{plan}
-0001dce0: 2729 2c20 2777 2729 290a 2020 2020 2020  '), 'w')).      
-0001dcf0: 2020 6966 2064 6973 6b65 6e74 7269 6573    if diskentries
-0001dd00: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
-0001dd10: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
-0001dd20: 2070 7072 696e 7428 2244 6570 6c6f 7969   pprint("Deployi
-0001dd30: 6e67 2044 6973 6b73 2e2e 2e22 290a 2020  ng Disks...").  
-0001dd40: 2020 2020 2020 666f 7220 6469 736b 2069        for disk i
-0001dd50: 6e20 6469 736b 656e 7472 6965 733a 0a20  n diskentries:. 
-0001dd60: 2020 2020 2020 2020 2020 2070 726f 6669             profi
-0001dd70: 6c65 203d 2065 6e74 7269 6573 5b64 6973  le = entries[dis
-0001dd80: 6b5d 0a20 2020 2020 2020 2020 2020 2070  k].            p
-0001dd90: 6f6f 6c20 3d20 7072 6f66 696c 652e 6765  ool = profile.ge
-0001dda0: 7428 2770 6f6f 6c27 290a 2020 2020 2020  t('pool').      
-0001ddb0: 2020 2020 2020 766d 7320 3d20 7072 6f66        vms = prof
-0001ddc0: 696c 652e 6765 7428 2776 6d73 2729 0a20  ile.get('vms'). 
-0001ddd0: 2020 2020 2020 2020 2020 2074 656d 706c             templ
-0001dde0: 6174 6520 3d20 7072 6f66 696c 652e 6765  ate = profile.ge
-0001ddf0: 7428 2774 656d 706c 6174 6527 290a 2020  t('template').  
-0001de00: 2020 2020 2020 2020 2020 696d 6167 6520            image 
-0001de10: 3d20 7072 6f66 696c 652e 6765 7428 2769  = profile.get('i
-0001de20: 6d61 6765 272c 2074 656d 706c 6174 6529  mage', template)
-0001de30: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
-0001de40: 6520 3d20 696e 7428 7072 6f66 696c 652e  e = int(profile.
-0001de50: 6765 7428 2773 697a 6527 2c20 3130 2929  get('size', 10))
-0001de60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001de70: 706f 6f6c 2069 7320 4e6f 6e65 3a0a 2020  pool is None:.  
-0001de80: 2020 2020 2020 2020 2020 2020 2020 6572                er
-0001de90: 726f 7228 6622 4d69 7373 696e 6720 4b65  ror(f"Missing Ke
-0001dea0: 7920 506f 6f6c 2066 6f72 2064 6973 6b20  y Pool for disk 
-0001deb0: 7365 6374 696f 6e20 7b64 6973 6b7d 2e20  section {disk}. 
-0001dec0: 4e6f 7420 6372 6561 7469 6e67 2069 742e  Not creating it.
-0001ded0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-0001dee0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-0001def0: 2020 2020 2020 2020 2020 6966 2076 6d73            if vms
-0001df00: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001df10: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-0001df20: 6622 4d69 7373 696e 6720 6f72 2049 6e63  f"Missing or Inc
-0001df30: 6f72 7265 6374 204b 6579 2056 6d73 2066  orrect Key Vms f
-0001df40: 6f72 2064 6973 6b20 7365 6374 696f 6e20  or disk section 
-0001df50: 7b64 6973 6b7d 2e20 4e6f 7420 6372 6561  {disk}. Not crea
-0001df60: 7469 6e67 2069 742e 2e2e 2229 0a20 2020  ting it...").   
-0001df70: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001df80: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-0001df90: 2020 7368 6172 6561 626c 6520 3d20 5472    shareable = Tr
-0001dfa0: 7565 2069 6620 6c65 6e28 766d 7329 203e  ue if len(vms) >
-0001dfb0: 2031 2065 6c73 6520 4661 6c73 650a 2020   1 else False.  
-0001dfc0: 2020 2020 2020 2020 2020 6966 206b 2e64            if k.d
-0001dfd0: 6973 6b5f 6578 6973 7473 2870 6f6f 6c2c  isk_exists(pool,
-0001dfe0: 2064 6973 6b29 3a0a 2020 2020 2020 2020   disk):.        
-0001dff0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-0001e000: 2243 7265 6174 696f 6e20 666f 7220 4469  "Creation for Di
-0001e010: 736b 207b 6469 736b 7d20 736b 6970 7065  sk {disk} skippe
-0001e020: 6421 2229 0a20 2020 2020 2020 2020 2020  d!").           
-0001e030: 2020 2020 2070 6f6f 6c70 6174 6820 3d20       poolpath = 
-0001e040: 6b2e 6765 745f 706f 6f6c 5f70 6174 6828  k.get_pool_path(
-0001e050: 706f 6f6c 290a 2020 2020 2020 2020 2020  pool).          
-0001e060: 2020 2020 2020 6e65 7764 6973 6b20 3d20        newdisk = 
-0001e070: 6622 7b70 6f6f 6c70 6174 687d 2f7b 6469  f"{poolpath}/{di
-0001e080: 736b 7d22 0a20 2020 2020 2020 2020 2020  sk}".           
-0001e090: 2020 2020 2066 6f72 2076 6d20 696e 2076       for vm in v
-0001e0a0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-0001e0b0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-0001e0c0: 2241 6464 696e 6720 6469 736b 207b 6469  "Adding disk {di
-0001e0d0: 736b 7d20 746f 207b 766d 7d22 290a 2020  sk} to {vm}").  
-0001e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0f0: 2020 6b2e 6164 645f 6469 736b 286e 616d    k.add_disk(nam
-0001e100: 653d 766d 2c20 7369 7a65 3d73 697a 652c  e=vm, size=size,
-0001e110: 2070 6f6f 6c3d 706f 6f6c 2c20 696d 6167   pool=pool, imag
-0001e120: 653d 696d 6167 652c 2073 6861 7265 6162  e=image, shareab
-0001e130: 6c65 3d73 6861 7265 6162 6c65 2c20 6578  le=shareable, ex
-0001e140: 6973 7469 6e67 3d6e 6577 6469 736b 2c0a  isting=newdisk,.
-0001e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e160: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001e170: 6869 6e3d 4661 6c73 6529 0a20 2020 2020  hin=False).     
-0001e180: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001e190: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0001e1a0: 6469 736b 203d 206b 2e63 7265 6174 655f  disk = k.create_
-0001e1b0: 6469 736b 2864 6973 6b2c 2073 697a 653d  disk(disk, size=
-0001e1c0: 7369 7a65 2c20 706f 6f6c 3d70 6f6f 6c2c  size, pool=pool,
-0001e1d0: 2069 6d61 6765 3d69 6d61 6765 2c20 7468   image=image, th
-0001e1e0: 696e 3d46 616c 7365 290a 2020 2020 2020  in=False).      
-0001e1f0: 2020 2020 2020 2020 2020 6966 206e 6577            if new
-0001e200: 6469 736b 2069 7320 4e6f 6e65 3a0a 2020  disk is None:.  
-0001e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e220: 2020 6572 726f 7228 6622 4469 736b 207b    error(f"Disk {
-0001e230: 6469 736b 7d20 6e6f 7420 6465 706c 6f79  disk} not deploy
-0001e240: 6564 2e20 4974 2077 6f6e 2774 2062 6520  ed. It won't be 
-0001e250: 6164 6465 6420 746f 2061 6e79 2076 6d22  added to any vm"
-0001e260: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e270: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001e280: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
-0001e290: 6f6e 2e70 7072 696e 7428 6622 4469 736b  on.pprint(f"Disk
-0001e2a0: 207b 6469 736b 7d20 6465 706c 6f79 6564   {disk} deployed
-0001e2b0: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
-0001e2c0: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
-0001e2d0: 6e20 766d 733a 0a20 2020 2020 2020 2020  n vms:.         
-0001e2e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001e2f0: 7072 696e 7428 6622 4164 6469 6e67 2064  print(f"Adding d
-0001e300: 6973 6b20 7b64 6973 6b7d 2074 6f20 7b76  isk {disk} to {v
-0001e310: 6d7d 2229 0a20 2020 2020 2020 2020 2020  m}").           
-0001e320: 2020 2020 2020 2020 2020 2020 206b 2e61               k.a
-0001e330: 6464 5f64 6973 6b28 6e61 6d65 3d76 6d2c  dd_disk(name=vm,
-0001e340: 2073 697a 653d 7369 7a65 2c20 706f 6f6c   size=size, pool
-0001e350: 3d70 6f6f 6c2c 2069 6d61 6765 3d69 6d61  =pool, image=ima
-0001e360: 6765 2c20 7368 6172 6561 626c 653d 7368  ge, shareable=sh
-0001e370: 6172 6561 626c 652c 0a20 2020 2020 2020  areable,.       
-0001e380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e390: 2020 2020 2020 2020 2020 2020 6578 6973              exis
-0001e3a0: 7469 6e67 3d6e 6577 6469 736b 2c20 7468  ting=newdisk, th
-0001e3b0: 696e 3d46 616c 7365 290a 2020 2020 2020  in=False).      
-0001e3c0: 2020 6966 2063 6f6e 7461 696e 6572 656e    if containeren
-0001e3d0: 7472 6965 7320 616e 6420 6e6f 7420 6f6e  tries and not on
-0001e3e0: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
-0001e3f0: 2020 2020 2020 636f 6e74 203d 204b 636f        cont = Kco
-0001e400: 6e74 6169 6e65 7263 6f6e 6669 6728 7365  ntainerconfig(se
-0001e410: 6c66 2c20 636c 6965 6e74 3d73 656c 662e  lf, client=self.
-0001e420: 636f 6e74 6169 6e65 7263 6c69 656e 7429  containerclient)
-0001e430: 2e63 6f6e 740a 2020 2020 2020 2020 2020  .cont.          
-0001e440: 2020 7070 7269 6e74 2822 4465 706c 6f79    pprint("Deploy
-0001e450: 696e 6720 436f 6e74 6169 6e65 7273 2e2e  ing Containers..
-0001e460: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-0001e470: 6c61 6265 6c20 3d20 6622 706c 616e 3d7b  label = f"plan={
-0001e480: 706c 616e 7d22 0a20 2020 2020 2020 2020  plan}".         
-0001e490: 2020 2066 6f72 2063 6f6e 7461 696e 6572     for container
-0001e4a0: 2069 6e20 636f 6e74 6169 6e65 7265 6e74   in containerent
-0001e4b0: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
-0001e4c0: 2020 2020 2020 6966 2063 6f6e 742e 6578        if cont.ex
-0001e4d0: 6973 7473 5f63 6f6e 7461 696e 6572 2863  ists_container(c
-0001e4e0: 6f6e 7461 696e 6572 293a 0a20 2020 2020  ontainer):.     
-0001e4f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001e500: 7072 696e 7428 6622 436f 6e74 6169 6e65  print(f"Containe
-0001e510: 7220 7b63 6f6e 7461 696e 6572 7d20 736b  r {container} sk
-0001e520: 6970 7065 6421 2229 0a20 2020 2020 2020  ipped!").       
-0001e530: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001e540: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-0001e550: 2020 2020 2020 7072 6f66 696c 6520 3d20        profile = 
-0001e560: 656e 7472 6965 735b 636f 6e74 6169 6e65  entries[containe
-0001e570: 725d 0a20 2020 2020 2020 2020 2020 2020  r].             
-0001e580: 2020 2069 6620 2770 726f 6669 6c65 2720     if 'profile' 
-0001e590: 696e 2070 726f 6669 6c65 2061 6e64 2070  in profile and p
-0001e5a0: 726f 6669 6c65 5b27 7072 6f66 696c 6527  rofile['profile'
-0001e5b0: 5d20 696e 2063 6f6e 7461 696e 6572 7072  ] in containerpr
-0001e5c0: 6f66 696c 6573 3a0a 2020 2020 2020 2020  ofiles:.        
-0001e5d0: 2020 2020 2020 2020 2020 2020 6375 7374              cust
-0001e5e0: 6f6d 7072 6f66 696c 6520 3d20 636f 6e74  omprofile = cont
-0001e5f0: 6169 6e65 7270 726f 6669 6c65 735b 7072  ainerprofiles[pr
-0001e600: 6f66 696c 655b 2770 726f 6669 6c65 275d  ofile['profile']
-0001e610: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001e620: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001e630: 2020 2020 2020 2020 2020 2020 6375 7374              cust
-0001e640: 6f6d 7072 6f66 696c 6520 3d20 7b7d 0a20  omprofile = {}. 
-0001e650: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001e660: 6f6e 7461 696e 6572 696d 6167 6520 3d20  ontainerimage = 
-0001e670: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
-0001e680: 205b 7072 6f66 696c 652e 6765 7428 2769   [profile.get('i
-0001e690: 6d61 6765 2729 2c20 7072 6f66 696c 652e  mage'), profile.
-0001e6a0: 6765 7428 2769 6d61 6765 2729 2c0a 2020  get('image'),.  
-0001e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6e0: 2063 7573 746f 6d70 726f 6669 6c65 2e67   customprofile.g
-0001e6f0: 6574 2827 696d 6167 6527 292c 0a20 2020  et('image'),.   
-0001e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e730: 6375 7374 6f6d 7072 6f66 696c 652e 6765  customprofile.ge
-0001e740: 7428 2769 6d61 6765 2729 5d20 6966 2065  t('image')] if e
-0001e750: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
-0001e760: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-0001e770: 2020 2020 206e 6574 7320 3d20 6e65 7874       nets = next
-0001e780: 2828 6520 666f 7220 6520 696e 205b 7072  ((e for e in [pr
-0001e790: 6f66 696c 652e 6765 7428 276e 6574 7327  ofile.get('nets'
-0001e7a0: 292c 2063 7573 746f 6d70 726f 6669 6c65  ), customprofile
-0001e7b0: 2e67 6574 2827 6e65 7473 2729 5d20 6966  .get('nets')] if
-0001e7c0: 2065 2069 7320 6e6f 7420 4e6f 6e65 292c   e is not None),
-0001e7d0: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
-0001e7e0: 2020 2020 2020 2070 6f72 7473 203d 206e         ports = n
-0001e7f0: 6578 7428 2865 2066 6f72 2065 2069 6e20  ext((e for e in 
-0001e800: 5b70 726f 6669 6c65 2e67 6574 2827 706f  [profile.get('po
-0001e810: 7274 7327 292c 2063 7573 746f 6d70 726f  rts'), custompro
-0001e820: 6669 6c65 2e67 6574 2827 706f 7274 7327  file.get('ports'
-0001e830: 295d 2069 6620 6520 6973 206e 6f74 204e  )] if e is not N
-0001e840: 6f6e 6529 2c20 4e6f 6e65 290a 2020 2020  one), None).    
-0001e850: 2020 2020 2020 2020 2020 2020 766f 6c75              volu
-0001e860: 6d65 7320 3d20 6e65 7874 2828 6520 666f  mes = next((e fo
-0001e870: 7220 6520 696e 205b 7072 6f66 696c 652e  r e in [profile.
-0001e880: 6765 7428 2776 6f6c 756d 6573 2729 2c20  get('volumes'), 
-0001e890: 7072 6f66 696c 652e 6765 7428 2764 6973  profile.get('dis
-0001e8a0: 6b73 2729 2c0a 2020 2020 2020 2020 2020  ks'),.          
+0001d980: 2020 2020 2063 7572 7265 6e74 6f76 6572       currentover
+0001d990: 7269 6465 735b 2769 6d61 6765 275d 203d  rides['image'] =
+0001d9a0: 2070 726f 6669 6c65 5b27 696d 6167 6527   profile['image'
+0001d9b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001d9c0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0001d9d0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+0001d9e0: 2020 2020 6966 2074 6872 6561 6465 643a      if threaded:
+0001d9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001da00: 2020 2020 206e 6577 5f61 7267 7320 3d20       new_args = 
+0001da10: 286e 616d 652c 2070 726f 6669 6c65 6e61  (name, profilena
+0001da20: 6d65 2c20 6375 7272 656e 746f 7665 7272  me, currentoverr
+0001da30: 6964 6573 2c20 7072 6f66 696c 652c 207a  ides, profile, z
+0001da40: 2c20 706c 616e 2c20 6375 7272 656e 7470  , plan, currentp
+0001da50: 6c61 6e64 6972 2c20 766d 636c 6965 6e74  landir, vmclient
+0001da60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da80: 2020 6f6e 666c 792c 206f 6e6c 7961 7373    onfly, onlyass
+0001da90: 6574 732c 206e 6577 766d 732c 2066 6169  ets, newvms, fai
+0001daa0: 6c65 6476 6d73 2c20 6173 796e 6377 6169  ledvms, asyncwai
+0001dab0: 7476 6d73 2c20 6e65 7761 7373 6574 7329  tvms, newassets)
+0001dac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dad0: 2020 2020 2074 203d 2074 6872 6561 6469       t = threadi
+0001dae0: 6e67 2e54 6872 6561 6428 7461 7267 6574  ng.Thread(target
+0001daf0: 3d73 656c 662e 7468 7265 6164 6564 5f63  =self.threaded_c
+0001db00: 7265 6174 655f 766d 2c20 6172 6773 3d6e  reate_vm, args=n
+0001db10: 6577 5f61 7267 7329 0a20 2020 2020 2020  ew_args).       
+0001db20: 2020 2020 2020 2020 2020 2020 2074 6872               thr
+0001db30: 6561 6473 2e61 7070 656e 6428 7429 0a20  eads.append(t). 
+0001db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db50: 2020 2074 2e73 7461 7274 2829 0a20 2020     t.start().   
+0001db60: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0001db70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001db80: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+0001db90: 7365 6c66 2e63 7265 6174 655f 766d 286e  self.create_vm(n
+0001dba0: 616d 652c 2070 726f 6669 6c65 6e61 6d65  ame, profilename
+0001dbb0: 2c20 6f76 6572 7269 6465 733d 6375 7272  , overrides=curr
+0001dbc0: 656e 746f 7665 7272 6964 6573 2c20 6375  entoverrides, cu
+0001dbd0: 7374 6f6d 7072 6f66 696c 653d 7072 6f66  stomprofile=prof
+0001dbe0: 696c 652c 206b 3d7a 2c0a 2020 2020 2020  ile, k=z,.      
+0001dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc10: 2020 2020 2020 706c 616e 3d70 6c61 6e2c        plan=plan,
+0001dc20: 2062 6173 6564 6972 3d63 7572 7265 6e74   basedir=current
+0001dc30: 706c 616e 6469 722c 2063 6c69 656e 743d  plandir, client=
+0001dc40: 766d 636c 6965 6e74 2c20 6f6e 666c 793d  vmclient, onfly=
+0001dc50: 6f6e 666c 792c 0a20 2020 2020 2020 2020  onfly,.         
+0001dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc80: 2020 206f 6e6c 7961 7373 6574 733d 6f6e     onlyassets=on
+0001dc90: 6c79 6173 7365 7473 290a 2020 2020 2020  lyassets).      
+0001dca0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001dcb0: 206e 6f74 206f 6e6c 7961 7373 6574 733a   not onlyassets:
+0001dcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dcd0: 2020 2020 2020 2020 2063 6f6d 6d6f 6e2e           common.
+0001dce0: 6861 6e64 6c65 5f72 6573 706f 6e73 6528  handle_response(
+0001dcf0: 7265 7375 6c74 2c20 6e61 6d65 2c20 636c  result, name, cl
+0001dd00: 6965 6e74 3d76 6d63 6c69 656e 7429 0a20  ient=vmclient). 
+0001dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd20: 2020 2073 656c 662e 6861 6e64 6c65 5f76     self.handle_v
+0001dd30: 6d5f 7265 7375 6c74 286e 616d 652c 2070  m_result(name, p
+0001dd40: 726f 6669 6c65 2c20 7265 7375 6c74 3d72  rofile, result=r
+0001dd50: 6573 756c 742c 206e 6577 766d 733d 6e65  esult, newvms=ne
+0001dd60: 7776 6d73 2c20 6661 696c 6564 766d 733d  wvms, failedvms=
+0001dd70: 6661 696c 6564 766d 732c 0a20 2020 2020  failedvms,.     
+0001dd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dda0: 2020 2020 2061 7379 6e63 7761 6974 766d       asyncwaitvm
+0001ddb0: 733d 6173 796e 6377 6169 7476 6d73 2c20  s=asyncwaitvms, 
+0001ddc0: 6f6e 6c79 6173 7365 7473 3d6f 6e6c 7961  onlyassets=onlya
+0001ddd0: 7373 6574 732c 206e 6577 6173 7365 7473  ssets, newassets
+0001dde0: 3d6e 6577 6173 7365 7473 2c0a 2020 2020  =newassets,.    
+0001ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de10: 2020 2020 2020 766d 636c 6965 6e74 3d76        vmclient=v
+0001de20: 6d63 6c69 656e 7429 0a20 2020 2020 2020  mclient).       
+0001de30: 2069 6620 766d 656e 7472 6965 7320 616e   if vmentries an
+0001de40: 6420 7468 7265 6164 6564 3a0a 2020 2020  d threaded:.    
+0001de50: 2020 2020 2020 2020 7768 696c 6520 5472          while Tr
+0001de60: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+0001de70: 2020 2020 666f 7220 696e 6465 782c 2074      for index, t
+0001de80: 2069 6e20 656e 756d 6572 6174 6528 7468   in enumerate(th
+0001de90: 7265 6164 7329 3a0a 2020 2020 2020 2020  reads):.        
+0001dea0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001deb0: 6f74 2074 2e69 735f 616c 6976 6528 293a  ot t.is_alive():
+0001dec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ded0: 2020 2020 2020 2020 2064 656c 2074 6872           del thr
+0001dee0: 6561 6473 5b69 6e64 6578 5d0a 2020 2020  eads[index].    
+0001def0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001df00: 6f74 2074 6872 6561 6473 3a0a 2020 2020  ot threads:.    
+0001df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df20: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+0001df30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df50: 736c 6565 7028 3129 0a20 2020 2020 2020  sleep(1).       
+0001df60: 2069 6620 766d 636c 6965 6e74 733a 0a20   if vmclients:. 
+0001df70: 2020 2020 2020 2020 2020 2079 616d 6c2e             yaml.
+0001df80: 7361 6665 5f64 756d 7028 766d 636c 6965  safe_dump(vmclie
+0001df90: 6e74 732c 206f 7065 6e28 6f73 2e70 6174  nts, open(os.pat
+0001dfa0: 682e 6578 7061 6e64 7573 6572 2866 277e  h.expanduser(f'~
+0001dfb0: 2f2e 6b63 6c69 2f76 6d63 6c69 656e 7473  /.kcli/vmclients
+0001dfc0: 5f7b 706c 616e 7d27 292c 2027 7727 2929  _{plan}'), 'w'))
+0001dfd0: 0a20 2020 2020 2020 2069 6620 6469 736b  .        if disk
+0001dfe0: 656e 7472 6965 7320 616e 6420 6e6f 7420  entries and not 
+0001dff0: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
+0001e000: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
+0001e010: 4465 706c 6f79 696e 6720 4469 736b 732e  Deploying Disks.
+0001e020: 2e2e 2229 0a20 2020 2020 2020 2066 6f72  ..").        for
+0001e030: 2064 6973 6b20 696e 2064 6973 6b65 6e74   disk in diskent
+0001e040: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+0001e050: 2020 7072 6f66 696c 6520 3d20 656e 7472    profile = entr
+0001e060: 6965 735b 6469 736b 5d0a 2020 2020 2020  ies[disk].      
+0001e070: 2020 2020 2020 706f 6f6c 203d 2070 726f        pool = pro
+0001e080: 6669 6c65 2e67 6574 2827 706f 6f6c 2729  file.get('pool')
+0001e090: 0a20 2020 2020 2020 2020 2020 2076 6d73  .            vms
+0001e0a0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0001e0b0: 766d 7327 290a 2020 2020 2020 2020 2020  vms').          
+0001e0c0: 2020 7465 6d70 6c61 7465 203d 2070 726f    template = pro
+0001e0d0: 6669 6c65 2e67 6574 2827 7465 6d70 6c61  file.get('templa
+0001e0e0: 7465 2729 0a20 2020 2020 2020 2020 2020  te').           
+0001e0f0: 2069 6d61 6765 203d 2070 726f 6669 6c65   image = profile
+0001e100: 2e67 6574 2827 696d 6167 6527 2c20 7465  .get('image', te
+0001e110: 6d70 6c61 7465 290a 2020 2020 2020 2020  mplate).        
+0001e120: 2020 2020 7369 7a65 203d 2069 6e74 2870      size = int(p
+0001e130: 726f 6669 6c65 2e67 6574 2827 7369 7a65  rofile.get('size
+0001e140: 272c 2031 3029 290a 2020 2020 2020 2020  ', 10)).        
+0001e150: 2020 2020 6966 2070 6f6f 6c20 6973 204e      if pool is N
+0001e160: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001e170: 2020 2020 2065 7272 6f72 2866 224d 6973       error(f"Mis
+0001e180: 7369 6e67 204b 6579 2050 6f6f 6c20 666f  sing Key Pool fo
+0001e190: 7220 6469 736b 2073 6563 7469 6f6e 207b  r disk section {
+0001e1a0: 6469 736b 7d2e 204e 6f74 2063 7265 6174  disk}. Not creat
+0001e1b0: 696e 6720 6974 2e2e 2e22 290a 2020 2020  ing it...").    
+0001e1c0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001e1d0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0001e1e0: 2069 6620 766d 7320 6973 204e 6f6e 653a   if vms is None:
+0001e1f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e200: 2065 7272 6f72 2866 224d 6973 7369 6e67   error(f"Missing
+0001e210: 206f 7220 496e 636f 7272 6563 7420 4b65   or Incorrect Ke
+0001e220: 7920 566d 7320 666f 7220 6469 736b 2073  y Vms for disk s
+0001e230: 6563 7469 6f6e 207b 6469 736b 7d2e 204e  ection {disk}. N
+0001e240: 6f74 2063 7265 6174 696e 6720 6974 2e2e  ot creating it..
+0001e250: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0001e260: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0001e270: 2020 2020 2020 2020 2073 6861 7265 6162           shareab
+0001e280: 6c65 203d 2054 7275 6520 6966 206c 656e  le = True if len
+0001e290: 2876 6d73 2920 3e20 3120 656c 7365 2046  (vms) > 1 else F
+0001e2a0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0001e2b0: 2069 6620 6b2e 6469 736b 5f65 7869 7374   if k.disk_exist
+0001e2c0: 7328 706f 6f6c 2c20 6469 736b 293a 0a20  s(pool, disk):. 
+0001e2d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001e2e0: 7072 696e 7428 6622 4372 6561 7469 6f6e  print(f"Creation
+0001e2f0: 2066 6f72 2044 6973 6b20 7b64 6973 6b7d   for Disk {disk}
+0001e300: 2073 6b69 7070 6564 2122 290a 2020 2020   skipped!").    
+0001e310: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+0001e320: 7061 7468 203d 206b 2e67 6574 5f70 6f6f  path = k.get_poo
+0001e330: 6c5f 7061 7468 2870 6f6f 6c29 0a20 2020  l_path(pool).   
+0001e340: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0001e350: 6469 736b 203d 2066 227b 706f 6f6c 7061  disk = f"{poolpa
+0001e360: 7468 7d2f 7b64 6973 6b7d 220a 2020 2020  th}/{disk}".    
+0001e370: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001e380: 766d 2069 6e20 766d 733a 0a20 2020 2020  vm in vms:.     
+0001e390: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001e3a0: 7072 696e 7428 6622 4164 6469 6e67 2064  print(f"Adding d
+0001e3b0: 6973 6b20 7b64 6973 6b7d 2074 6f20 7b76  isk {disk} to {v
+0001e3c0: 6d7d 2229 0a20 2020 2020 2020 2020 2020  m}").           
+0001e3d0: 2020 2020 2020 2020 206b 2e61 6464 5f64           k.add_d
+0001e3e0: 6973 6b28 6e61 6d65 3d76 6d2c 2073 697a  isk(name=vm, siz
+0001e3f0: 653d 7369 7a65 2c20 706f 6f6c 3d70 6f6f  e=size, pool=poo
+0001e400: 6c2c 2069 6d61 6765 3d69 6d61 6765 2c20  l, image=image, 
+0001e410: 7368 6172 6561 626c 653d 7368 6172 6561  shareable=sharea
+0001e420: 626c 652c 2065 7869 7374 696e 673d 6e65  ble, existing=ne
+0001e430: 7764 6973 6b2c 0a20 2020 2020 2020 2020  wdisk,.         
+0001e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e450: 2020 2020 2020 7468 696e 3d46 616c 7365        thin=False
+0001e460: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0001e470: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001e480: 2020 2020 6e65 7764 6973 6b20 3d20 6b2e      newdisk = k.
+0001e490: 6372 6561 7465 5f64 6973 6b28 6469 736b  create_disk(disk
+0001e4a0: 2c20 7369 7a65 3d73 697a 652c 2070 6f6f  , size=size, poo
+0001e4b0: 6c3d 706f 6f6c 2c20 696d 6167 653d 696d  l=pool, image=im
+0001e4c0: 6167 652c 2074 6869 6e3d 4661 6c73 6529  age, thin=False)
+0001e4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e4e0: 2069 6620 6e65 7764 6973 6b20 6973 204e   if newdisk is N
+0001e4f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001e500: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
+0001e510: 2244 6973 6b20 7b64 6973 6b7d 206e 6f74  "Disk {disk} not
+0001e520: 2064 6570 6c6f 7965 642e 2049 7420 776f   deployed. It wo
+0001e530: 6e27 7420 6265 2061 6464 6564 2074 6f20  n't be added to 
+0001e540: 616e 7920 766d 2229 0a20 2020 2020 2020  any vm").       
+0001e550: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001e560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e570: 2020 2063 6f6d 6d6f 6e2e 7070 7269 6e74     common.pprint
+0001e580: 2866 2244 6973 6b20 7b64 6973 6b7d 2064  (f"Disk {disk} d
+0001e590: 6570 6c6f 7965 6421 2229 0a20 2020 2020  eployed!").     
+0001e5a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001e5b0: 6f72 2076 6d20 696e 2076 6d73 3a0a 2020  or vm in vms:.  
+0001e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5d0: 2020 2020 2020 7070 7269 6e74 2866 2241        pprint(f"A
+0001e5e0: 6464 696e 6720 6469 736b 207b 6469 736b  dding disk {disk
+0001e5f0: 7d20 746f 207b 766d 7d22 290a 2020 2020  } to {vm}").    
+0001e600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e610: 2020 2020 6b2e 6164 645f 6469 736b 286e      k.add_disk(n
+0001e620: 616d 653d 766d 2c20 7369 7a65 3d73 697a  ame=vm, size=siz
+0001e630: 652c 2070 6f6f 6c3d 706f 6f6c 2c20 696d  e, pool=pool, im
+0001e640: 6167 653d 696d 6167 652c 2073 6861 7265  age=image, share
+0001e650: 6162 6c65 3d73 6861 7265 6162 6c65 2c0a  able=shareable,.
+0001e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e680: 2020 2065 7869 7374 696e 673d 6e65 7764     existing=newd
+0001e690: 6973 6b2c 2074 6869 6e3d 4661 6c73 6529  isk, thin=False)
+0001e6a0: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
+0001e6b0: 6169 6e65 7265 6e74 7269 6573 2061 6e64  ainerentries and
+0001e6c0: 206e 6f74 206f 6e6c 7961 7373 6574 733a   not onlyassets:
+0001e6d0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+0001e6e0: 7420 3d20 4b63 6f6e 7461 696e 6572 636f  t = Kcontainerco
+0001e6f0: 6e66 6967 2873 656c 662c 2063 6c69 656e  nfig(self, clien
+0001e700: 743d 7365 6c66 2e63 6f6e 7461 696e 6572  t=self.container
+0001e710: 636c 6965 6e74 292e 636f 6e74 0a20 2020  client).cont.   
+0001e720: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0001e730: 2244 6570 6c6f 7969 6e67 2043 6f6e 7461  "Deploying Conta
+0001e740: 696e 6572 732e 2e2e 2229 0a20 2020 2020  iners...").     
+0001e750: 2020 2020 2020 206c 6162 656c 203d 2066         label = f
+0001e760: 2270 6c61 6e3d 7b70 6c61 6e7d 220a 2020  "plan={plan}".  
+0001e770: 2020 2020 2020 2020 2020 666f 7220 636f            for co
+0001e780: 6e74 6169 6e65 7220 696e 2063 6f6e 7461  ntainer in conta
+0001e790: 696e 6572 656e 7472 6965 733a 0a20 2020  inerentries:.   
+0001e7a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001e7b0: 636f 6e74 2e65 7869 7374 735f 636f 6e74  cont.exists_cont
+0001e7c0: 6169 6e65 7228 636f 6e74 6169 6e65 7229  ainer(container)
+0001e7d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001e7e0: 2020 2020 2020 7070 7269 6e74 2866 2243        pprint(f"C
+0001e7f0: 6f6e 7461 696e 6572 207b 636f 6e74 6169  ontainer {contai
+0001e800: 6e65 727d 2073 6b69 7070 6564 2122 290a  ner} skipped!").
+0001e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e820: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0001e830: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+0001e840: 6669 6c65 203d 2065 6e74 7269 6573 5b63  file = entries[c
+0001e850: 6f6e 7461 696e 6572 5d0a 2020 2020 2020  ontainer].      
+0001e860: 2020 2020 2020 2020 2020 6966 2027 7072            if 'pr
+0001e870: 6f66 696c 6527 2069 6e20 7072 6f66 696c  ofile' in profil
+0001e880: 6520 616e 6420 7072 6f66 696c 655b 2770  e and profile['p
+0001e890: 726f 6669 6c65 275d 2069 6e20 636f 6e74  rofile'] in cont
+0001e8a0: 6169 6e65 7270 726f 6669 6c65 733a 0a20  ainerprofiles:. 
 0001e8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8d0: 2020 6375 7374 6f6d 7072 6f66 696c 652e    customprofile.
-0001e8e0: 6765 7428 2776 6f6c 756d 6573 2729 2c20  get('volumes'), 
-0001e8f0: 6375 7374 6f6d 7072 6f66 696c 652e 6765  customprofile.ge
-0001e900: 7428 2764 6973 6b73 2729 5d0a 2020 2020  t('disks')].    
+0001e8c0: 2020 2063 7573 746f 6d70 726f 6669 6c65     customprofile
+0001e8d0: 203d 2063 6f6e 7461 696e 6572 7072 6f66   = containerprof
+0001e8e0: 696c 6573 5b70 726f 6669 6c65 5b27 7072  iles[profile['pr
+0001e8f0: 6f66 696c 6527 5d5d 0a20 2020 2020 2020  ofile']].       
+0001e900: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
 0001e910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e920: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-0001e930: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
-0001e940: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-0001e950: 2020 2020 2065 6e76 6972 6f6e 6d65 6e74       environment
-0001e960: 203d 206e 6578 7428 2865 2066 6f72 2065   = next((e for e
-0001e970: 2069 6e20 5b70 726f 6669 6c65 2e67 6574   in [profile.get
-0001e980: 2827 656e 7669 726f 6e6d 656e 7427 292c  ('environment'),
-0001e990: 2063 7573 746f 6d70 726f 6669 6c65 2e67   customprofile.g
-0001e9a0: 6574 2827 656e 7669 726f 6e6d 656e 7427  et('environment'
-0001e9b0: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
-0001e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e9d0: 2020 2020 2020 2069 6620 6520 6973 206e         if e is n
-0001e9e0: 6f74 204e 6f6e 6529 2c20 4e6f 6e65 290a  ot None), None).
+0001e920: 2020 2063 7573 746f 6d70 726f 6669 6c65     customprofile
+0001e930: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
+0001e940: 2020 2020 2020 636f 6e74 6169 6e65 7269        containeri
+0001e950: 6d61 6765 203d 206e 6578 7428 2865 2066  mage = next((e f
+0001e960: 6f72 2065 2069 6e20 5b70 726f 6669 6c65  or e in [profile
+0001e970: 2e67 6574 2827 696d 6167 6527 292c 2070  .get('image'), p
+0001e980: 726f 6669 6c65 2e67 6574 2827 696d 6167  rofile.get('imag
+0001e990: 6527 292c 0a20 2020 2020 2020 2020 2020  e'),.           
+0001e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9c0: 2020 2020 2020 2020 6375 7374 6f6d 7072          custompr
+0001e9d0: 6f66 696c 652e 6765 7428 2769 6d61 6765  ofile.get('image
+0001e9e0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
 0001e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea00: 636d 6473 203d 206e 6578 7428 2865 2066  cmds = next((e f
-0001ea10: 6f72 2065 2069 6e20 5b70 726f 6669 6c65  or e in [profile
-0001ea20: 2e67 6574 2827 636d 6473 2729 2c20 6375  .get('cmds'), cu
-0001ea30: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
-0001ea40: 2763 6d64 7327 295d 2069 6620 6520 6973  'cmds')] if e is
-0001ea50: 206e 6f74 204e 6f6e 6529 2c20 5b5d 290a   not None), []).
-0001ea60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea70: 7375 6363 6573 7328 6622 436f 6e74 6169  success(f"Contai
-0001ea80: 6e65 7220 7b63 6f6e 7461 696e 6572 7dc2  ner {container}.
-0001ea90: a064 6570 6c6f 7965 6421 2229 0a20 2020  .deployed!").   
-0001eaa0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001eab0: 742e 6372 6561 7465 5f63 6f6e 7461 696e  t.create_contain
-0001eac0: 6572 286e 616d 653d 636f 6e74 6169 6e65  er(name=containe
-0001ead0: 722c 2069 6d61 6765 3d63 6f6e 7461 696e  r, image=contain
-0001eae0: 6572 696d 6167 652c 206e 6574 733d 6e65  erimage, nets=ne
-0001eaf0: 7473 2c20 636d 6473 3d63 6d64 732c 2070  ts, cmds=cmds, p
-0001eb00: 6f72 7473 3d70 6f72 7473 2c0a 2020 2020  orts=ports,.    
-0001eb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb30: 2020 766f 6c75 6d65 733d 766f 6c75 6d65    volumes=volume
-0001eb40: 732c 2065 6e76 6972 6f6e 6d65 6e74 3d65  s, environment=e
-0001eb50: 6e76 6972 6f6e 6d65 6e74 2c20 6c61 6265  nvironment, labe
-0001eb60: 6c3d 6c61 6265 6c29 0a20 2020 2020 2020  l=label).       
-0001eb70: 2069 6620 646e 7365 6e74 7269 6573 2061   if dnsentries a
-0001eb80: 6e64 206e 6f74 206f 6e6c 7961 7373 6574  nd not onlyasset
-0001eb90: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-0001eba0: 7072 696e 7428 2244 6570 6c6f 7969 6e67  print("Deploying
-0001ebb0: 2044 6e73 2045 6e74 7269 6573 2e2e 2e22   Dns Entries..."
-0001ebc0: 290a 2020 2020 2020 2020 2020 2020 646e  ).            dn
-0001ebd0: 7363 6c69 656e 7473 203d 207b 7d0a 2020  sclients = {}.  
-0001ebe0: 2020 2020 2020 2020 2020 666f 7220 646e            for dn
-0001ebf0: 7365 6e74 7279 2069 6e20 646e 7365 6e74  sentry in dnsent
-0001ec00: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
-0001ec10: 2020 2020 2020 646e 7370 726f 6669 6c65        dnsprofile
-0001ec20: 203d 2065 6e74 7269 6573 5b64 6e73 656e   = entries[dnsen
-0001ec30: 7472 795d 0a20 2020 2020 2020 2020 2020  try].           
-0001ec40: 2020 2020 2064 6e73 646f 6d61 696e 203d       dnsdomain =
-0001ec50: 2064 6e73 7072 6f66 696c 652e 6765 7428   dnsprofile.get(
-0001ec60: 2764 6f6d 6169 6e27 290a 2020 2020 2020  'domain').      
-0001ec70: 2020 2020 2020 2020 2020 646e 736e 6574            dnsnet
-0001ec80: 203d 2064 6e73 7072 6f66 696c 652e 6765   = dnsprofile.ge
-0001ec90: 7428 276e 6574 272c 2027 6465 6661 756c  t('net', 'defaul
-0001eca0: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
-0001ecb0: 2020 2020 646e 7369 7020 3d20 646e 7370      dnsip = dnsp
-0001ecc0: 726f 6669 6c65 2e67 6574 2827 6970 2729  rofile.get('ip')
-0001ecd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ece0: 2064 6e73 616c 6961 7320 3d20 646e 7370   dnsalias = dnsp
-0001ecf0: 726f 6669 6c65 2e67 6574 2827 616c 6961  rofile.get('alia
-0001ed00: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
-0001ed10: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
-0001ed20: 7420 3d20 646e 7370 726f 6669 6c65 2e67  t = dnsprofile.g
-0001ed30: 6574 2827 636c 6965 6e74 2729 0a20 2020  et('client').   
-0001ed40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001ed50: 646e 7363 6c69 656e 7420 6973 204e 6f6e  dnsclient is Non
-0001ed60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001ed70: 2020 2020 2020 207a 203d 206b 0a20 2020         z = k.   
-0001ed80: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0001ed90: 6620 646e 7363 6c69 656e 7420 696e 2064  f dnsclient in d
-0001eda0: 6e73 636c 6965 6e74 733a 0a20 2020 2020  nsclients:.     
-0001edb0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-0001edc0: 203d 2064 6e73 636c 6965 6e74 735b 646e   = dnsclients[dn
-0001edd0: 7363 6c69 656e 745d 0a20 2020 2020 2020  sclient].       
-0001ede0: 2020 2020 2020 2020 2065 6c69 6620 646e           elif dn
-0001edf0: 7363 6c69 656e 7420 696e 2073 656c 662e  sclient in self.
-0001ee00: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
-0001ee10: 2020 2020 2020 2020 2020 2020 207a 203d               z =
-0001ee20: 204b 636f 6e66 6967 2863 6c69 656e 743d   Kconfig(client=
-0001ee30: 646e 7363 6c69 656e 7429 2e6b 0a20 2020  dnsclient).k.   
-0001ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee50: 2064 6e73 636c 6965 6e74 735b 646e 7363   dnsclients[dnsc
-0001ee60: 6c69 656e 745d 203d 207a 0a20 2020 2020  lient] = z.     
-0001ee70: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001ee80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ee90: 2020 2020 2077 6172 6e69 6e67 2866 2243       warning(f"C
-0001eea0: 6c69 656e 7420 7b64 6e73 636c 6965 6e74  lient {dnsclient
-0001eeb0: 7d20 6e6f 7420 666f 756e 642e 2053 6b69  } not found. Ski
-0001eec0: 7070 696e 6722 290a 2020 2020 2020 2020  pping").        
-0001eed0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001eee0: 726e 0a20 2020 2020 2020 2020 2020 2020  rn.             
-0001eef0: 2020 2069 6620 646e 7369 7020 6973 204e     if dnsip is N
-0001ef00: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0001ef10: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0001ef20: 2822 4d69 7373 696e 6720 6970 2e20 536b  ("Missing ip. Sk
-0001ef30: 6970 7069 6e67 2122 290a 2020 2020 2020  ipping!").      
-0001ef40: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001ef50: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
-0001ef60: 2020 2020 2069 6620 646e 736e 6574 2069       if dnsnet i
-0001ef70: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0001ef80: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-0001ef90: 696e 6728 224d 6973 7369 6e67 206e 6574  ing("Missing net
-0001efa0: 2e20 536b 6970 7069 6e67 2122 290a 2020  . Skipping!").  
-0001efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001efc0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-0001efd0: 2020 2020 2020 2020 207a 2e72 6573 6572           z.reser
-0001efe0: 7665 5f64 6e73 286e 616d 653d 646e 7365  ve_dns(name=dnse
-0001eff0: 6e74 7279 2c20 6e65 7473 3d5b 646e 736e  ntry, nets=[dnsn
-0001f000: 6574 5d2c 2064 6f6d 6169 6e3d 646e 7364  et], domain=dnsd
-0001f010: 6f6d 6169 6e2c 2069 703d 646e 7369 702c  omain, ip=dnsip,
-0001f020: 2061 6c69 6173 3d64 6e73 616c 6961 732c   alias=dnsalias,
-0001f030: 2066 6f72 6365 3d54 7275 652c 0a20 2020   force=True,.   
-0001f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f050: 2020 2020 2020 2020 2020 2070 7269 6d61             prima
-0001f060: 7279 3d54 7275 6529 0a20 2020 2020 2020  ry=True).       
-0001f070: 2069 6620 616e 7369 626c 6565 6e74 7269   if ansibleentri
-0001f080: 6573 2061 6e64 206e 6f74 206f 6e6c 7961  es and not onlya
-0001f090: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
-0001f0a0: 2020 2069 6620 6e6f 7420 6e65 7776 6d73     if not newvms
-0001f0b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001f0c0: 2020 7761 726e 696e 6728 2241 6e73 6962    warning("Ansib
-0001f0d0: 6c65 2073 6b69 7070 6564 2061 7320 6e6f  le skipped as no
-0001f0e0: 206e 6577 2076 6d20 7769 7468 696e 2070   new vm within p
-0001f0f0: 6c61 7962 6f6f 6b20 7072 6f76 6973 696f  laybook provisio
-0001f100: 6e65 6422 290a 2020 2020 2020 2020 2020  ned").          
-0001f110: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-0001f120: 2020 2020 2020 2020 2066 6f72 2065 6e74           for ent
-0001f130: 7279 2069 6e20 736f 7274 6564 2861 6e73  ry in sorted(ans
-0001f140: 6962 6c65 656e 7472 6965 7329 3a0a 2020  ibleentries):.  
-0001f150: 2020 2020 2020 2020 2020 2020 2020 5f61                _a
-0001f160: 6e73 6962 6c65 203d 2065 6e74 7269 6573  nsible = entries
-0001f170: 5b65 6e74 7279 5d0a 2020 2020 2020 2020  [entry].        
-0001f180: 2020 2020 2020 2020 6966 2027 706c 6179          if 'play
-0001f190: 626f 6f6b 2720 6e6f 7420 696e 205f 616e  book' not in _an
-0001f1a0: 7369 626c 653a 0a20 2020 2020 2020 2020  sible:.         
-0001f1b0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-0001f1c0: 2822 4d69 7373 696e 6720 506c 6179 626f  ("Missing Playbo
-0001f1d0: 6f6b 2066 6f72 2061 6e73 6962 6c65 2e49  ok for ansible.I
-0001f1e0: 676e 6f72 696e 672e 2e2e 2229 0a20 2020  gnoring...").   
+0001ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea10: 2020 2020 2020 2063 7573 746f 6d70 726f         custompro
+0001ea20: 6669 6c65 2e67 6574 2827 696d 6167 6527  file.get('image'
+0001ea30: 295d 2069 6620 6520 6973 206e 6f74 204e  )] if e is not N
+0001ea40: 6f6e 6529 2c20 4e6f 6e65 290a 2020 2020  one), None).    
+0001ea50: 2020 2020 2020 2020 2020 2020 6e65 7473              nets
+0001ea60: 203d 206e 6578 7428 2865 2066 6f72 2065   = next((e for e
+0001ea70: 2069 6e20 5b70 726f 6669 6c65 2e67 6574   in [profile.get
+0001ea80: 2827 6e65 7473 2729 2c20 6375 7374 6f6d  ('nets'), custom
+0001ea90: 7072 6f66 696c 652e 6765 7428 276e 6574  profile.get('net
+0001eaa0: 7327 295d 2069 6620 6520 6973 206e 6f74  s')] if e is not
+0001eab0: 204e 6f6e 6529 2c20 4e6f 6e65 290a 2020   None), None).  
+0001eac0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0001ead0: 7274 7320 3d20 6e65 7874 2828 6520 666f  rts = next((e fo
+0001eae0: 7220 6520 696e 205b 7072 6f66 696c 652e  r e in [profile.
+0001eaf0: 6765 7428 2770 6f72 7473 2729 2c20 6375  get('ports'), cu
+0001eb00: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
+0001eb10: 2770 6f72 7473 2729 5d20 6966 2065 2069  'ports')] if e i
+0001eb20: 7320 6e6f 7420 4e6f 6e65 292c 204e 6f6e  s not None), Non
+0001eb30: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001eb40: 2020 2076 6f6c 756d 6573 203d 206e 6578     volumes = nex
+0001eb50: 7428 2865 2066 6f72 2065 2069 6e20 5b70  t((e for e in [p
+0001eb60: 726f 6669 6c65 2e67 6574 2827 766f 6c75  rofile.get('volu
+0001eb70: 6d65 7327 292c 2070 726f 6669 6c65 2e67  mes'), profile.g
+0001eb80: 6574 2827 6469 736b 7327 292c 0a20 2020  et('disks'),.   
+0001eb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebb0: 2020 2020 2020 2020 2063 7573 746f 6d70           customp
+0001ebc0: 726f 6669 6c65 2e67 6574 2827 766f 6c75  rofile.get('volu
+0001ebd0: 6d65 7327 292c 2063 7573 746f 6d70 726f  mes'), custompro
+0001ebe0: 6669 6c65 2e67 6574 2827 6469 736b 7327  file.get('disks'
+0001ebf0: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
+0001ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec10: 2020 2069 6620 6520 6973 206e 6f74 204e     if e is not N
+0001ec20: 6f6e 6529 2c20 4e6f 6e65 290a 2020 2020  one), None).    
+0001ec30: 2020 2020 2020 2020 2020 2020 656e 7669              envi
+0001ec40: 726f 6e6d 656e 7420 3d20 6e65 7874 2828  ronment = next((
+0001ec50: 6520 666f 7220 6520 696e 205b 7072 6f66  e for e in [prof
+0001ec60: 696c 652e 6765 7428 2765 6e76 6972 6f6e  ile.get('environ
+0001ec70: 6d65 6e74 2729 2c20 6375 7374 6f6d 7072  ment'), custompr
+0001ec80: 6f66 696c 652e 6765 7428 2765 6e76 6972  ofile.get('envir
+0001ec90: 6f6e 6d65 6e74 2729 5d0a 2020 2020 2020  onment')].      
+0001eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ecb0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001ecc0: 2065 2069 7320 6e6f 7420 4e6f 6e65 292c   e is not None),
+0001ecd0: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
+0001ece0: 2020 2020 2020 2063 6d64 7320 3d20 6e65         cmds = ne
+0001ecf0: 7874 2828 6520 666f 7220 6520 696e 205b  xt((e for e in [
+0001ed00: 7072 6f66 696c 652e 6765 7428 2763 6d64  profile.get('cmd
+0001ed10: 7327 292c 2063 7573 746f 6d70 726f 6669  s'), customprofi
+0001ed20: 6c65 2e67 6574 2827 636d 6473 2729 5d20  le.get('cmds')] 
+0001ed30: 6966 2065 2069 7320 6e6f 7420 4e6f 6e65  if e is not None
+0001ed40: 292c 205b 5d29 0a20 2020 2020 2020 2020  ), []).         
+0001ed50: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
+0001ed60: 2243 6f6e 7461 696e 6572 207b 636f 6e74  "Container {cont
+0001ed70: 6169 6e65 727d c2a0 6465 706c 6f79 6564  ainer}..deployed
+0001ed80: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
+0001ed90: 2020 2020 636f 6e74 2e63 7265 6174 655f      cont.create_
+0001eda0: 636f 6e74 6169 6e65 7228 6e61 6d65 3d63  container(name=c
+0001edb0: 6f6e 7461 696e 6572 2c20 696d 6167 653d  ontainer, image=
+0001edc0: 636f 6e74 6169 6e65 7269 6d61 6765 2c20  containerimage, 
+0001edd0: 6e65 7473 3d6e 6574 732c 2063 6d64 733d  nets=nets, cmds=
+0001ede0: 636d 6473 2c20 706f 7274 733d 706f 7274  cmds, ports=port
+0001edf0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0001ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee10: 2020 2020 2020 2020 2076 6f6c 756d 6573           volumes
+0001ee20: 3d76 6f6c 756d 6573 2c20 656e 7669 726f  =volumes, enviro
+0001ee30: 6e6d 656e 743d 656e 7669 726f 6e6d 656e  nment=environmen
+0001ee40: 742c 206c 6162 656c 3d6c 6162 656c 290a  t, label=label).
+0001ee50: 2020 2020 2020 2020 6966 2064 6e73 656e          if dnsen
+0001ee60: 7472 6965 7320 616e 6420 6e6f 7420 6f6e  tries and not on
+0001ee70: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
+0001ee80: 2020 2020 2020 7070 7269 6e74 2822 4465        pprint("De
+0001ee90: 706c 6f79 696e 6720 446e 7320 456e 7472  ploying Dns Entr
+0001eea0: 6965 732e 2e2e 2229 0a20 2020 2020 2020  ies...").       
+0001eeb0: 2020 2020 2064 6e73 636c 6965 6e74 7320       dnsclients 
+0001eec0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0001eed0: 2066 6f72 2064 6e73 656e 7472 7920 696e   for dnsentry in
+0001eee0: 2064 6e73 656e 7472 6965 733a 0a20 2020   dnsentries:.   
+0001eef0: 2020 2020 2020 2020 2020 2020 2064 6e73               dns
+0001ef00: 7072 6f66 696c 6520 3d20 656e 7472 6965  profile = entrie
+0001ef10: 735b 646e 7365 6e74 7279 5d0a 2020 2020  s[dnsentry].    
+0001ef20: 2020 2020 2020 2020 2020 2020 646e 7364              dnsd
+0001ef30: 6f6d 6169 6e20 3d20 646e 7370 726f 6669  omain = dnsprofi
+0001ef40: 6c65 2e67 6574 2827 646f 6d61 696e 2729  le.get('domain')
+0001ef50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ef60: 2064 6e73 6e65 7420 3d20 646e 7370 726f   dnsnet = dnspro
+0001ef70: 6669 6c65 2e67 6574 2827 6e65 7427 2c20  file.get('net', 
+0001ef80: 2764 6566 6175 6c74 2729 0a20 2020 2020  'default').     
+0001ef90: 2020 2020 2020 2020 2020 2064 6e73 6970             dnsip
+0001efa0: 203d 2064 6e73 7072 6f66 696c 652e 6765   = dnsprofile.ge
+0001efb0: 7428 2769 7027 290a 2020 2020 2020 2020  t('ip').        
+0001efc0: 2020 2020 2020 2020 646e 7361 6c69 6173          dnsalias
+0001efd0: 203d 2064 6e73 7072 6f66 696c 652e 6765   = dnsprofile.ge
+0001efe0: 7428 2761 6c69 6173 272c 205b 5d29 0a20  t('alias', []). 
+0001eff0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0001f000: 6e73 636c 6965 6e74 203d 2064 6e73 7072  nsclient = dnspr
+0001f010: 6f66 696c 652e 6765 7428 2763 6c69 656e  ofile.get('clien
+0001f020: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+0001f030: 2020 2020 6966 2064 6e73 636c 6965 6e74      if dnsclient
+0001f040: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0001f050: 2020 2020 2020 2020 2020 2020 2020 7a20                z 
+0001f060: 3d20 6b0a 2020 2020 2020 2020 2020 2020  = k.            
+0001f070: 2020 2020 656c 6966 2064 6e73 636c 6965      elif dnsclie
+0001f080: 6e74 2069 6e20 646e 7363 6c69 656e 7473  nt in dnsclients
+0001f090: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001f0a0: 2020 2020 2020 7a20 3d20 646e 7363 6c69        z = dnscli
+0001f0b0: 656e 7473 5b64 6e73 636c 6965 6e74 5d0a  ents[dnsclient].
+0001f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f0d0: 656c 6966 2064 6e73 636c 6965 6e74 2069  elif dnsclient i
+0001f0e0: 6e20 7365 6c66 2e63 6c69 656e 7473 3a0a  n self.clients:.
+0001f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f100: 2020 2020 7a20 3d20 4b63 6f6e 6669 6728      z = Kconfig(
+0001f110: 636c 6965 6e74 3d64 6e73 636c 6965 6e74  client=dnsclient
+0001f120: 292e 6b0a 2020 2020 2020 2020 2020 2020  ).k.            
+0001f130: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
+0001f140: 7473 5b64 6e73 636c 6965 6e74 5d20 3d20  ts[dnsclient] = 
+0001f150: 7a0a 2020 2020 2020 2020 2020 2020 2020  z.              
+0001f160: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001f170: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+0001f180: 696e 6728 6622 436c 6965 6e74 207b 646e  ing(f"Client {dn
+0001f190: 7363 6c69 656e 747d 206e 6f74 2066 6f75  sclient} not fou
+0001f1a0: 6e64 2e20 536b 6970 7069 6e67 2229 0a20  nd. Skipping"). 
+0001f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f1c0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+0001f1d0: 2020 2020 2020 2020 2020 6966 2064 6e73            if dns
+0001f1e0: 6970 2069 7320 4e6f 6e65 3a0a 2020 2020  ip is None:.    
 0001f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f200: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
-0001f210: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
-0001f220: 7962 6f6f 6b20 3d20 5f61 6e73 6962 6c65  ybook = _ansible
-0001f230: 5b27 706c 6179 626f 6f6b 275d 0a20 2020  ['playbook'].   
-0001f240: 2020 2020 2020 2020 2020 2020 2076 6572               ver
-0001f250: 626f 7365 203d 205f 616e 7369 626c 655b  bose = _ansible[
-0001f260: 2776 6572 626f 7365 275d 2069 6620 2776  'verbose'] if 'v
-0001f270: 6572 626f 7365 2720 696e 205f 616e 7369  erbose' in _ansi
-0001f280: 626c 6520 656c 7365 2046 616c 7365 0a20  ble else False. 
-0001f290: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0001f2a0: 726f 7570 7320 3d20 5f61 6e73 6962 6c65  roups = _ansible
-0001f2b0: 2e67 6574 2827 6772 6f75 7073 272c 207b  .get('groups', {
-0001f2c0: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
-0001f2d0: 2020 2075 7365 7220 3d20 5f61 6e73 6962     user = _ansib
-0001f2e0: 6c65 2e67 6574 2827 7573 6572 2729 0a20  le.get('user'). 
-0001f2f0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001f300: 6172 6961 626c 6573 203d 205f 616e 7369  ariables = _ansi
-0001f310: 626c 652e 6765 7428 2776 6172 6961 626c  ble.get('variabl
-0001f320: 6573 272c 207b 7d29 0a20 2020 2020 2020  es', {}).       
-0001f330: 2020 2020 2020 2020 2074 6172 6765 7476           targetv
-0001f340: 6d73 203d 205b 766d 2066 6f72 2076 6d20  ms = [vm for vm 
-0001f350: 696e 205f 616e 7369 626c 655b 2776 6d73  in _ansible['vms
-0001f360: 275d 2069 6620 766d 2069 6e20 6e65 7776  '] if vm in newv
-0001f370: 6d73 5d20 6966 2027 766d 7327 2069 6e20  ms] if 'vms' in 
-0001f380: 5f61 6e73 6962 6c65 2065 6c73 6520 6e65  _ansible else ne
-0001f390: 7776 6d73 0a20 2020 2020 2020 2020 2020  wvms.           
-0001f3a0: 2020 2020 2069 6620 6e6f 7420 7461 7267       if not targ
-0001f3b0: 6574 766d 733a 0a20 2020 2020 2020 2020  etvms:.         
-0001f3c0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0001f3d0: 6e67 2822 416e 7369 626c 6520 736b 6970  ng("Ansible skip
-0001f3e0: 7065 6420 6173 206e 6f20 6e65 7720 766d  ped as no new vm
-0001f3f0: 2077 6974 6869 6e20 706c 6179 626f 6f6b   within playbook
-0001f400: 2070 726f 7669 7369 6f6e 6564 2229 0a20   provisioned"). 
-0001f410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f420: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-0001f430: 2020 2020 2020 2020 2020 616e 7369 626c            ansibl
-0001f440: 6563 6f6d 6d61 6e64 203d 2022 616e 7369  ecommand = "ansi
-0001f450: 626c 652d 706c 6179 626f 6f6b 220a 2020  ble-playbook".  
-0001f460: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001f470: 2076 6572 626f 7365 3a0a 2020 2020 2020   verbose:.      
-0001f480: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0001f490: 7369 626c 6563 6f6d 6d61 6e64 202b 3d20  siblecommand += 
-0001f4a0: 2220 2d76 7676 220a 2020 2020 2020 2020  " -vvv".        
-0001f4b0: 2020 2020 2020 2020 696e 7665 6e74 6f72          inventor
-0001f4c0: 7966 696c 6520 3d20 6622 2f74 6d70 2f7b  yfile = f"/tmp/{
-0001f4d0: 706c 616e 7d2e 696e 762e 7961 6d6c 2220  plan}.inv.yaml" 
-0001f4e0: 6966 2073 656c 662e 7961 6d6c 696e 7665  if self.yamlinve
-0001f4f0: 6e74 6f72 7920 656c 7365 2066 222f 746d  ntory else f"/tm
-0001f500: 702f 7b70 6c61 6e7d 2e69 6e76 220a 2020  p/{plan}.inv".  
-0001f510: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0001f520: 7369 626c 6575 7469 6c73 2e6d 616b 655f  sibleutils.make_
-0001f530: 706c 616e 5f69 6e76 656e 746f 7279 2876  plan_inventory(v
-0001f540: 6d73 5f74 6f5f 686f 7374 2c20 706c 616e  ms_to_host, plan
-0001f550: 2c20 7461 7267 6574 766d 732c 2067 726f  , targetvms, gro
-0001f560: 7570 733d 6772 6f75 7073 2c20 7573 6572  ups=groups, user
-0001f570: 3d75 7365 722c 0a20 2020 2020 2020 2020  =user,.         
-0001f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5a0: 2020 2020 2020 2020 7961 6d6c 696e 7665          yamlinve
-0001f5b0: 6e74 6f72 793d 7365 6c66 2e79 616d 6c69  ntory=self.yamli
-0001f5c0: 6e76 656e 746f 7279 2c20 7475 6e6e 656c  nventory, tunnel
-0001f5d0: 3d73 656c 662e 7475 6e6e 656c 2c0a 2020  =self.tunnel,.  
-0001f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f600: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001f610: 756e 6e65 6c68 6f73 743d 7365 6c66 2e74  unnelhost=self.t
-0001f620: 756e 6e65 6c68 6f73 742c 2074 756e 6e65  unnelhost, tunne
-0001f630: 6c75 7365 723d 7365 6c66 2e74 756e 6e65  luser=self.tunne
-0001f640: 6c75 7365 722c 0a20 2020 2020 2020 2020  luser,.         
-0001f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f670: 2020 2020 2020 2020 7475 6e6e 656c 706f          tunnelpo
-0001f680: 7274 3d73 656c 662e 7475 6e6e 656c 706f  rt=self.tunnelpo
-0001f690: 7274 2c20 696e 7365 6375 7265 3d73 656c  rt, insecure=sel
-0001f6a0: 662e 696e 7365 6375 7265 290a 2020 2020  f.insecure).    
-0001f6b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001f6c0: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-0001f6d0: 7328 277e 2f2e 616e 7369 626c 652e 6366  s('~/.ansible.cf
-0001f6e0: 6727 293a 0a20 2020 2020 2020 2020 2020  g'):.           
-0001f6f0: 2020 2020 2020 2020 2061 6e73 6962 6c65           ansible
-0001f700: 636f 6e66 6967 203d 206f 732e 7061 7468  config = os.path
-0001f710: 2e65 7870 616e 6475 7365 7228 277e 2f2e  .expanduser('~/.
-0001f720: 616e 7369 626c 652e 6366 6727 290a 2020  ansible.cfg').  
-0001f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f740: 2020 7769 7468 206f 7065 6e28 616e 7369    with open(ansi
-0001f750: 626c 6563 6f6e 6669 672c 2022 7722 2920  bleconfig, "w") 
-0001f760: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-0001f770: 2020 2020 2020 2020 2020 2020 2020 662e                f.
-0001f780: 7772 6974 6528 225b 7373 685f 636f 6e6e  write("[ssh_conn
-0001f790: 6563 7469 6f6e 5d5c 6e72 6574 7269 6573  ection]\nretries
-0001f7a0: 3d31 305c 6e22 290a 2020 2020 2020 2020  =10\n").        
-0001f7b0: 2020 2020 2020 2020 6966 2076 6172 6961          if varia
-0001f7c0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
-0001f7d0: 2020 2020 2020 2020 2020 7661 7273 6669            varsfi
-0001f7e0: 6c65 203d 2066 222f 746d 702f 7b70 6c61  le = f"/tmp/{pla
-0001f7f0: 6e7d 2e76 6172 732e 796d 6c22 0a20 2020  n}.vars.yml".   
-0001f800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f810: 2077 6974 6820 6f70 656e 2876 6172 7366   with open(varsf
-0001f820: 696c 652c 2027 7727 2920 6173 2066 3a0a  ile, 'w') as f:.
-0001f830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f840: 2020 2020 2020 2020 7961 6d6c 2e64 756d          yaml.dum
-0001f850: 7028 7661 7269 6162 6c65 732c 2066 2c20  p(variables, f, 
-0001f860: 6465 6661 756c 745f 666c 6f77 5f73 7479  default_flow_sty
-0001f870: 6c65 3d46 616c 7365 290a 2020 2020 2020  le=False).      
-0001f880: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0001f890: 7369 626c 6563 6f6d 6d61 6e64 202b 3d20  siblecommand += 
-0001f8a0: 6622 202d 2d65 7874 7261 2d76 6172 7320  f" --extra-vars 
-0001f8b0: 407b 7661 7273 6669 6c65 7d22 0a20 2020  @{varsfile}".   
-0001f8c0: 2020 2020 2020 2020 2020 2020 2061 6e73               ans
-0001f8d0: 6962 6c65 636f 6d6d 616e 6420 2b3d 2066  iblecommand += f
-0001f8e0: 2220 2d69 207b 696e 7665 6e74 6f72 7966  " -i {inventoryf
-0001f8f0: 696c 657d 207b 706c 6179 626f 6f6b 7d22  ile} {playbook}"
-0001f900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f910: 2070 7072 696e 7428 6622 5275 6e6e 696e   pprint(f"Runnin
-0001f920: 673a 207b 616e 7369 626c 6563 6f6d 6d61  g: {ansiblecomma
-0001f930: 6e64 7d22 290a 2020 2020 2020 2020 2020  nd}").          
-0001f940: 2020 2020 2020 6f73 2e73 7973 7465 6d28        os.system(
-0001f950: 616e 7369 626c 6563 6f6d 6d61 6e64 290a  ansiblecommand).
-0001f960: 2020 2020 2020 2020 6966 2061 6e73 6962          if ansib
-0001f970: 6c65 2061 6e64 206e 6f74 206f 6e6c 7961  le and not onlya
-0001f980: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
-0001f990: 2020 2070 7072 696e 7428 2244 6570 6c6f     pprint("Deplo
-0001f9a0: 7969 6e67 2041 6e73 6962 6c65 2049 6e76  ying Ansible Inv
-0001f9b0: 656e 746f 7279 2e2e 2e22 290a 2020 2020  entory...").    
-0001f9c0: 2020 2020 2020 2020 696e 7665 6e74 6f72          inventor
-0001f9d0: 7966 696c 6520 3d20 6622 2f74 6d70 2f7b  yfile = f"/tmp/{
-0001f9e0: 706c 616e 7d2e 696e 762e 7961 6d6c 2220  plan}.inv.yaml" 
-0001f9f0: 6966 2073 656c 662e 7961 6d6c 696e 7665  if self.yamlinve
-0001fa00: 6e74 6f72 7920 656c 7365 2066 222f 746d  ntory else f"/tm
-0001fa10: 702f 7b70 6c61 6e7d 2e69 6e76 220a 2020  p/{plan}.inv".  
-0001fa20: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
-0001fa30: 7061 7468 2e65 7869 7374 7328 696e 7665  path.exists(inve
-0001fa40: 6e74 6f72 7966 696c 6529 3a0a 2020 2020  ntoryfile):.    
-0001fa50: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-0001fa60: 6e74 2866 2249 6e76 656e 746f 7279 2069  nt(f"Inventory i
-0001fa70: 6e20 7b69 6e76 656e 746f 7279 6669 6c65  n {inventoryfile
-0001fa80: 7d20 736b 6970 7065 6421 2229 0a20 2020  } skipped!").   
-0001fa90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001faa0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001fab0: 7072 696e 7428 6622 4372 6561 7469 6e67  print(f"Creating
-0001fac0: 2061 6e73 6962 6c65 2069 6e76 656e 746f   ansible invento
-0001fad0: 7279 2066 6f72 2070 6c61 6e20 7b70 6c61  ry for plan {pla
-0001fae0: 6e7d 2069 6e20 7b69 6e76 656e 746f 7279  n} in {inventory
-0001faf0: 6669 6c65 7d22 290a 2020 2020 2020 2020  file}").        
-0001fb00: 2020 2020 2020 2020 766d 7320 3d20 5b5d          vms = []
-0001fb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fb20: 2066 6f72 2076 6d20 696e 2073 6f72 7465   for vm in sorte
-0001fb30: 6428 6b2e 6c69 7374 2829 2c20 6b65 793d  d(k.list(), key=
-0001fb40: 6c61 6d62 6461 2078 3a20 785b 276e 616d  lambda x: x['nam
-0001fb50: 6527 5d29 3a0a 2020 2020 2020 2020 2020  e']):.          
-0001fb60: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
-0001fb70: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
-0001fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb90: 6465 7363 7269 7074 696f 6e20 3d20 766d  description = vm
-0001fba0: 5b27 706c 616e 275d 0a20 2020 2020 2020  ['plan'].       
-0001fbb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001fbc0: 6465 7363 7269 7074 696f 6e20 3d3d 2070  description == p
-0001fbd0: 6c61 6e3a 0a20 2020 2020 2020 2020 2020  lan:.           
-0001fbe0: 2020 2020 2020 2020 2020 2020 2076 6d73               vms
-0001fbf0: 2e61 7070 656e 6428 6e61 6d65 290a 2020  .append(name).  
-0001fc00: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0001fc10: 7369 626c 6575 7469 6c73 2e6d 616b 655f  sibleutils.make_
-0001fc20: 706c 616e 5f69 6e76 656e 746f 7279 2876  plan_inventory(v
-0001fc30: 6d73 5f74 6f5f 686f 7374 2c20 706c 616e  ms_to_host, plan
-0001fc40: 2c20 766d 732c 2079 616d 6c69 6e76 656e  , vms, yamlinven
-0001fc50: 746f 7279 3d73 656c 662e 7961 6d6c 696e  tory=self.yamlin
-0001fc60: 7665 6e74 6f72 792c 0a20 2020 2020 2020  ventory,.       
-0001fc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc90: 2020 2020 2020 2020 2020 696e 7365 6375            insecu
-0001fca0: 7265 3d73 656c 662e 696e 7365 6375 7265  re=self.insecure
-0001fcb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001fcc0: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
-0001fcd0: 7427 3a20 2773 7563 6365 7373 272c 2027  t': 'success', '
-0001fce0: 706c 616e 273a 2070 6c61 6e7d 0a20 2020  plan': plan}.   
-0001fcf0: 2020 2020 2069 6620 6c62 7320 616e 6420       if lbs and 
-0001fd00: 6e6f 7420 6f6e 6c79 6173 7365 7473 3a0a  not onlyassets:.
-0001fd10: 2020 2020 2020 2020 2020 2020 646e 7363              dnsc
-0001fd20: 6c69 656e 7473 203d 207b 7d0a 2020 2020  lients = {}.    
-0001fd30: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
-0001fd40: 4465 706c 6f79 696e 6720 4c6f 6164 6261  Deploying Loadba
-0001fd50: 6c61 6e63 6572 732e 2e2e 2229 0a20 2020  lancers...").   
-0001fd60: 2020 2020 2020 2020 2066 6f72 2069 6e64           for ind
-0001fd70: 6578 2c20 6c62 656e 7472 7920 696e 2065  ex, lbentry in e
-0001fd80: 6e75 6d65 7261 7465 286c 6273 293a 0a20  numerate(lbs):. 
-0001fd90: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001fda0: 6574 6169 6c73 203d 2065 6e74 7269 6573  etails = entries
-0001fdb0: 5b6c 6265 6e74 7279 5d0a 2020 2020 2020  [lbentry].      
-0001fdc0: 2020 2020 2020 2020 2020 706f 7274 7320            ports 
-0001fdd0: 3d20 6465 7461 696c 732e 6765 7428 2770  = details.get('p
-0001fde0: 6f72 7473 272c 205b 5d29 0a20 2020 2020  orts', []).     
-0001fdf0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001fe00: 7420 706f 7274 733a 0a20 2020 2020 2020  t ports:.       
-0001fe10: 2020 2020 2020 2020 2020 2020 2065 7272               err
-0001fe20: 6f72 2822 4d69 7373 696e 6720 506f 7274  or("Missing Port
-0001fe30: 7320 666f 7220 6c6f 6164 6261 6c61 6e63  s for loadbalanc
-0001fe40: 6572 2e20 4e6f 7420 6372 6561 7469 6e67  er. Not creating
-0001fe50: 2069 742e 2e2e 2229 0a20 2020 2020 2020   it...").       
-0001fe60: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001fe70: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
-0001fe80: 2020 2020 6368 6563 6b70 6174 6820 3d20      checkpath = 
-0001fe90: 6465 7461 696c 732e 6765 7428 2763 6865  details.get('che
-0001fea0: 636b 7061 7468 272c 2027 2f27 290a 2020  ckpath', '/').  
-0001feb0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-0001fec0: 6563 6b70 6f72 7420 3d20 6465 7461 696c  eckport = detail
-0001fed0: 732e 6765 7428 2763 6865 636b 706f 7274  s.get('checkport
-0001fee0: 272c 2038 3029 0a20 2020 2020 2020 2020  ', 80).         
-0001fef0: 2020 2020 2020 2061 6c69 6173 203d 2064         alias = d
-0001ff00: 6574 6169 6c73 2e67 6574 2827 616c 6961  etails.get('alia
-0001ff10: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
-0001ff20: 2020 2020 2020 2020 646f 6d61 696e 203d          domain =
-0001ff30: 2064 6574 6169 6c73 2e67 6574 2827 646f   details.get('do
-0001ff40: 6d61 696e 2729 0a20 2020 2020 2020 2020  main').         
-0001ff50: 2020 2020 2020 2064 6e73 636c 6965 6e74         dnsclient
-0001ff60: 203d 2064 6574 6169 6c73 2e67 6574 2827   = details.get('
-0001ff70: 646e 7363 6c69 656e 7427 2c20 6f76 6572  dnsclient', over
-0001ff80: 7269 6465 732e 6765 7428 2764 6e73 636c  rides.get('dnscl
-0001ff90: 6965 6e74 2729 290a 2020 2020 2020 2020  ient')).        
-0001ffa0: 2020 2020 2020 2020 6c62 766d 7320 3d20          lbvms = 
-0001ffb0: 6465 7461 696c 732e 6765 7428 2776 6d73  details.get('vms
-0001ffc0: 272c 205b 5d29 0a20 2020 2020 2020 2020  ', []).         
-0001ffd0: 2020 2020 2020 206c 626e 6574 7320 3d20         lbnets = 
-0001ffe0: 6465 7461 696c 732e 6765 7428 276e 6574  details.get('net
-0001fff0: 7327 2c20 5b27 6465 6661 756c 7427 5d29  s', ['default'])
-00020000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020010: 2069 6e74 6572 6e61 6c20 3d20 6465 7461   internal = deta
-00020020: 696c 732e 6765 7428 2769 6e74 6572 6e61  ils.get('interna
-00020030: 6c27 290a 2020 2020 2020 2020 2020 2020  l').            
-00020040: 2020 2020 7375 626e 6574 6964 203d 2064      subnetid = d
-00020050: 6574 6169 6c73 2e67 6574 2827 7375 626e  etails.get('subn
-00020060: 6574 6964 2729 0a20 2020 2020 2020 2020  etid').         
-00020070: 2020 2020 2020 2069 7020 3d20 6465 7461         ip = deta
-00020080: 696c 732e 6765 7428 2769 7027 290a 2020  ils.get('ip').  
-00020090: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000200a0: 6c66 2e63 7265 6174 655f 6c6f 6164 6261  lf.create_loadba
-000200b0: 6c61 6e63 6572 286c 6265 6e74 7279 2c20  lancer(lbentry, 
-000200c0: 6e65 7473 3d6c 626e 6574 732c 2070 6f72  nets=lbnets, por
-000200d0: 7473 3d70 6f72 7473 2c20 6368 6563 6b70  ts=ports, checkp
-000200e0: 6174 683d 6368 6563 6b70 6174 682c 2076  ath=checkpath, v
-000200f0: 6d73 3d6c 6276 6d73 2c0a 2020 2020 2020  ms=lbvms,.      
-00020100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020120: 2020 2064 6f6d 6169 6e3d 646f 6d61 696e     domain=domain
-00020130: 2c20 706c 616e 3d70 6c61 6e2c 2063 6865  , plan=plan, che
-00020140: 636b 706f 7274 3d63 6865 636b 706f 7274  ckport=checkport
-00020150: 2c20 616c 6961 733d 616c 6961 732c 0a20  , alias=alias,. 
-00020160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020180: 2020 2020 2020 2020 696e 7465 726e 616c          internal
-00020190: 3d69 6e74 6572 6e61 6c2c 2064 6e73 636c  =internal, dnscl
-000201a0: 6965 6e74 3d64 6e73 636c 6965 6e74 2c20  ient=dnsclient, 
-000201b0: 7375 626e 6574 6964 3d73 7562 6e65 7469  subnetid=subneti
-000201c0: 642c 2069 703d 6970 290a 2020 2020 2020  d, ip=ip).      
-000201d0: 2020 6966 2073 6773 2061 6e64 206e 6f74    if sgs and not
-000201e0: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
-000201f0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00020200: 2244 6570 6c6f 7969 6e67 2053 6563 7572  "Deploying Secur
-00020210: 6974 7947 726f 7570 732e 2e2e 2229 0a20  ityGroups..."). 
-00020220: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-00020230: 6720 696e 2073 6773 3a0a 2020 2020 2020  g in sgs:.      
-00020240: 2020 2020 2020 2020 2020 6465 7461 696c            detail
-00020250: 7320 3d20 656e 7472 6965 735b 7367 5d0a  s = entries[sg].
-00020260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020270: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
-00020280: 2020 2020 2070 6f72 7473 203d 2064 6574       ports = det
-00020290: 6169 6c73 2e67 6574 2827 706f 7274 7327  ails.get('ports'
-000202a0: 2c20 5b5d 290a 2020 2020 2020 2020 2020  , []).          
-000202b0: 2020 2020 2020 6966 206e 6f74 2070 6f72        if not por
-000202c0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-000202d0: 2020 2020 2020 2020 6572 726f 7228 224d          error("M
-000202e0: 6973 7369 6e67 2050 6f72 7473 2066 6f72  issing Ports for
-000202f0: 2073 6773 2e20 4e6f 7420 6372 6561 7469   sgs. Not creati
-00020300: 6e67 2069 742e 2e2e 2229 0a20 2020 2020  ng it...").     
-00020310: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00020320: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
-00020330: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
-00020340: 655f 7365 6375 7269 7479 5f67 726f 7570  e_security_group
-00020350: 2873 672c 207b 2770 6f72 7473 273a 2070  (sg, {'ports': p
-00020360: 6f72 7473 7d29 0a20 2020 2020 2020 2069  orts}).        i
-00020370: 6620 776f 726b 666c 6f77 656e 7472 6965  f workflowentrie
-00020380: 7320 616e 6420 6e6f 7420 6f6e 6c79 6173  s and not onlyas
-00020390: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
-000203a0: 2020 7070 7269 6e74 2822 4465 706c 6f79    pprint("Deploy
-000203b0: 696e 6720 576f 726b 666c 6f77 2045 6e74  ing Workflow Ent
-000203c0: 7269 6573 2e2e 2e22 290a 2020 2020 2020  ries...").      
-000203d0: 2020 2020 2020 666f 7220 776f 726b 666c        for workfl
-000203e0: 6f77 2069 6e20 776f 726b 666c 6f77 656e  ow in workflowen
-000203f0: 7472 6965 733a 0a20 2020 2020 2020 2020  tries:.         
-00020400: 2020 2020 2020 2077 6f72 6b66 6c6f 775f         workflow_
-00020410: 6f76 6572 7269 6465 7320 3d20 6f76 6572  overrides = over
-00020420: 7269 6465 732e 636f 7079 2829 0a20 2020  rides.copy().   
-00020430: 2020 2020 2020 2020 2020 2020 2077 6f72               wor
-00020440: 6b66 6c6f 775f 6f76 6572 7269 6465 732e  kflow_overrides.
-00020450: 7570 6461 7465 2865 6e74 7269 6573 5b77  update(entries[w
-00020460: 6f72 6b66 6c6f 775d 290a 2020 2020 2020  orkflow]).      
-00020470: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00020480: 7265 6174 655f 776f 726b 666c 6f77 2877  reate_workflow(w
-00020490: 6f72 6b66 6c6f 772c 206f 7665 7272 6964  orkflow, overrid
-000204a0: 6573 3d77 6f72 6b66 6c6f 775f 6f76 6572  es=workflow_over
-000204b0: 7269 6465 7329 0a20 2020 2020 2020 2072  rides).        r
-000204c0: 6574 7572 6e64 6174 6120 3d20 7b27 7265  eturndata = {'re
-000204d0: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
-000204e0: 2c20 2770 6c61 6e27 3a20 706c 616e 7d0a  , 'plan': plan}.
-000204f0: 2020 2020 2020 2020 7265 7475 726e 6461          returnda
-00020500: 7461 5b27 6e65 7776 6d73 275d 203d 206e  ta['newvms'] = n
-00020510: 6577 766d 7320 6966 206e 6577 766d 7320  ewvms if newvms 
-00020520: 656c 7365 205b 5d0a 2020 2020 2020 2020  else [].        
-00020530: 7265 7475 726e 6461 7461 5b27 6578 6973  returndata['exis
-00020540: 7469 6e67 766d 7327 5d20 3d20 6578 6973  tingvms'] = exis
-00020550: 7469 6e67 766d 7320 6966 2065 7869 7374  tingvms if exist
-00020560: 696e 6776 6d73 2065 6c73 6520 5b5d 0a20  ingvms else []. 
-00020570: 2020 2020 2020 2072 6574 7572 6e64 6174         returndat
-00020580: 615b 2766 6169 6c65 6476 6d73 275d 203d  a['failedvms'] =
-00020590: 2066 6169 6c65 6476 6d73 2069 6620 6661   failedvms if fa
-000205a0: 696c 6564 766d 7320 656c 7365 205b 5d0a  iledvms else [].
-000205b0: 2020 2020 2020 2020 7265 7475 726e 6461          returnda
-000205c0: 7461 5b27 6173 7365 7473 275d 203d 206e  ta['assets'] = n
-000205d0: 6577 6173 7365 7473 2069 6620 6e65 7761  ewassets if newa
-000205e0: 7373 6574 7320 656c 7365 205b 5d0a 2020  ssets else [].  
-000205f0: 2020 2020 2020 6966 2066 6169 6c65 6476        if failedv
-00020600: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-00020610: 7265 7475 726e 6461 7461 5b27 7265 7375  returndata['resu
-00020620: 6c74 275d 203d 2027 6661 696c 7572 6527  lt'] = 'failure'
-00020630: 0a20 2020 2020 2020 2020 2020 2066 6169  .            fai
-00020640: 6c65 646e 616d 6573 203d 2027 2c27 2e6a  lednames = ','.j
-00020650: 6f69 6e28 5b76 5b27 6e61 6d65 275d 2066  oin([v['name'] f
-00020660: 6f72 2076 2069 6e20 6661 696c 6564 766d  or v in failedvm
-00020670: 735d 290a 2020 2020 2020 2020 2020 2020  s]).            
-00020680: 7265 7475 726e 6461 7461 5b27 7265 6173  returndata['reas
-00020690: 6f6e 275d 203d 2066 2754 6865 2066 6f6c  on'] = f'The fol
-000206a0: 6c6f 7769 6e67 2076 6d73 2066 6169 6c65  lowing vms faile
-000206b0: 643a 207b 6661 696c 6564 6e61 6d65 737d  d: {failednames}
-000206c0: 270a 2020 2020 2020 2020 6966 2067 6574  '.        if get
-000206d0: 6261 636b 206f 7220 746f 636c 6561 6e3a  back or toclean:
-000206e0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-000206f0: 6368 6469 7228 272e 2e27 290a 2020 2020  chdir('..').    
-00020700: 2020 2020 6966 2074 6f63 6c65 616e 3a0a      if toclean:.
-00020710: 2020 2020 2020 2020 2020 2020 726d 7472              rmtr
-00020720: 6565 2870 6174 6829 0a20 2020 2020 2020  ee(path).       
-00020730: 2069 6620 696e 7075 7473 7472 696e 6720   if inputstring 
-00020740: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00020750: 6f73 2e70 6174 682e 6578 6973 7473 2866  os.path.exists(f
-00020760: 2274 656d 705f 706c 616e 5f7b 706c 616e  "temp_plan_{plan
-00020770: 7d2e 796d 6c22 293a 0a20 2020 2020 2020  }.yml"):.       
-00020780: 2020 2020 206f 732e 7265 6d6f 7665 2866       os.remove(f
-00020790: 2274 656d 705f 706c 616e 5f7b 706c 616e  "temp_plan_{plan
-000207a0: 7d2e 796d 6c22 290a 2020 2020 2020 2020  }.yml").        
-000207b0: 666f 7220 656e 7472 7920 696e 2061 7379  for entry in asy
-000207c0: 6e63 7761 6974 766d 733a 0a20 2020 2020  ncwaitvms:.     
-000207d0: 2020 2020 2020 206e 616d 652c 2066 696e         name, fin
-000207e0: 6973 6866 696c 6573 203d 2065 6e74 7279  ishfiles = entry
-000207f0: 5b27 6e61 6d65 275d 2c20 656e 7472 795b  ['name'], entry[
-00020800: 2766 696e 6973 6866 696c 6573 275d 0a20  'finishfiles']. 
-00020810: 2020 2020 2020 2020 2020 2077 6169 7463             waitc
-00020820: 6f6d 6d61 6e64 2c20 7761 6974 7469 6d65  ommand, waittime
-00020830: 6f75 7420 3d20 656e 7472 795b 2777 6169  out = entry['wai
-00020840: 7463 6f6d 6d61 6e64 275d 2c20 656e 7472  tcommand'], entr
-00020850: 795b 2777 6169 7474 696d 656f 7574 275d  y['waittimeout']
-00020860: 0a20 2020 2020 2020 2020 2020 2076 6d63  .            vmc
-00020870: 6c69 656e 7420 3d20 656e 7472 795b 2776  lient = entry['v
-00020880: 6d63 6c69 656e 7427 5d0a 2020 2020 2020  mclient'].      
-00020890: 2020 2020 2020 7365 6c66 2e77 6169 745f        self.wait_
-000208a0: 6669 6e69 7368 286e 616d 652c 2077 6169  finish(name, wai
-000208b0: 7463 6f6d 6d61 6e64 3d77 6169 7463 6f6d  tcommand=waitcom
-000208c0: 6d61 6e64 2c20 7761 6974 7469 6d65 6f75  mand, waittimeou
-000208d0: 743d 7761 6974 7469 6d65 6f75 742c 2076  t=waittimeout, v
-000208e0: 6d63 6c69 656e 743d 766d 636c 6965 6e74  mclient=vmclient
-000208f0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00020900: 2066 696e 6973 6866 696c 6573 3a0a 2020   finishfiles:.  
-00020910: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00020920: 6c66 2e68 616e 646c 655f 6669 6e69 7368  lf.handle_finish
-00020930: 6669 6c65 7328 6e61 6d65 2c20 6669 6e69  files(name, fini
-00020940: 7368 6669 6c65 732c 2076 6d63 6c69 656e  shfiles, vmclien
-00020950: 743d 766d 636c 6965 6e74 290a 2020 2020  t=vmclient).    
-00020960: 2020 2020 706f 7374 5f73 6372 6970 7420      post_script 
-00020970: 3d20 6627 7b69 6e70 7574 6469 727d 2f6b  = f'{inputdir}/k
-00020980: 636c 695f 706f 7374 2e73 6827 0a20 2020  cli_post.sh'.   
-00020990: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-000209a0: 6578 6973 7473 2870 6f73 745f 7363 7269  exists(post_scri
-000209b0: 7074 293a 0a20 2020 2020 2020 2020 2020  pt):.           
-000209c0: 2069 6620 706f 7374 3a0a 2020 2020 2020   if post:.      
-000209d0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-000209e0: 2822 5275 6e6e 696e 6720 6b63 6c69 5f70  ("Running kcli_p
-000209f0: 6f73 742e 7368 2229 0a20 2020 2020 2020  ost.sh").       
-00020a00: 2020 2020 2020 2020 2077 6974 6820 5465           with Te
-00020a10: 6d70 6f72 6172 7944 6972 6563 746f 7279  mporaryDirectory
-00020a20: 2829 2061 7320 746d 7064 6972 3a0a 2020  () as tmpdir:.  
-00020a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a40: 2020 706f 7374 5f73 6372 6970 7420 3d20    post_script = 
-00020a50: 7365 6c66 2e70 726f 6365 7373 5f69 6e70  self.process_inp
-00020a60: 7574 6669 6c65 2827 7878 7827 2c20 706f  utfile('xxx', po
-00020a70: 7374 5f73 6372 6970 742c 206f 7665 7272  st_script, overr
-00020a80: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
-00020a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020aa0: 2020 2020 7769 7468 206f 7065 6e28 6622      with open(f"
-00020ab0: 7b74 6d70 6469 727d 2f70 6f73 742e 7368  {tmpdir}/post.sh
-00020ac0: 222c 2027 7727 2920 6173 2066 3a0a 2020  ", 'w') as f:.  
-00020ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ae0: 2020 2020 2020 662e 7772 6974 6528 706f        f.write(po
-00020af0: 7374 5f73 6372 6970 7429 0a20 2020 2020  st_script).     
-00020b00: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00020b10: 6f73 745f 7275 6e20 3d20 7275 6e28 6627  ost_run = run(f'
-00020b20: 6261 7368 207b 746d 7064 6972 7d2f 706f  bash {tmpdir}/po
-00020b30: 7374 2e73 6827 2c20 7368 656c 6c3d 5472  st.sh', shell=Tr
-00020b40: 7565 2c20 7374 646f 7574 3d50 4950 452c  ue, stdout=PIPE,
-00020b50: 2073 7464 6572 723d 5354 444f 5554 2c0a   stderr=STDOUT,.
-00020b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b80: 2020 2075 6e69 7665 7273 616c 5f6e 6577     universal_new
-00020b90: 6c69 6e65 733d 5472 7565 290a 2020 2020  lines=True).    
-00020ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020bb0: 6966 2070 6f73 745f 7275 6e2e 7265 7475  if post_run.retu
-00020bc0: 726e 636f 6465 2021 3d20 303a 0a20 2020  rncode != 0:.   
-00020bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020be0: 2020 2020 206d 7367 203d 2066 2249 7373       msg = f"Iss
-00020bf0: 7565 2077 6865 6e20 7275 6e6e 696e 6720  ue when running 
-00020c00: 6b63 6c69 5f70 6f73 742e 7368 203a 5c6e  kcli_post.sh :\n
-00020c10: 7b70 6f73 745f 7275 6e2e 7374 646f 7574  {post_run.stdout
-00020c20: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-00020c30: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00020c40: 286d 7367 290a 2020 2020 2020 2020 2020  (msg).          
-00020c50: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00020c60: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-00020c70: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
-00020c80: 6f6e 273a 206d 7367 7d0a 2020 2020 2020  on': msg}.      
-00020c90: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00020ca0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-00020cb0: 696e 6728 2253 6b69 7070 696e 6720 6b63  ing("Skipping kc
-00020cc0: 6c69 5f70 6f73 742e 7368 2061 7320 7265  li_post.sh as re
-00020cd0: 7175 6573 7465 6422 290a 2020 2020 2020  quested").      
-00020ce0: 2020 6966 206f 7665 7272 6964 6573 2e67    if overrides.g
-00020cf0: 6574 2827 7465 6d70 6b65 7964 6972 2729  et('tempkeydir')
-00020d00: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00020d10: 2020 2020 2020 2020 2020 6f76 6572 7269            overri
-00020d20: 6465 732e 6765 7428 2774 656d 706b 6579  des.get('tempkey
-00020d30: 6469 7227 292e 636c 6561 6e75 7028 290a  dir').cleanup().
-00020d40: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00020d50: 6574 7572 6e64 6174 610a 0a20 2020 2064  eturndata..    d
-00020d60: 6566 2068 616e 646c 655f 686f 7374 2873  ef handle_host(s
-00020d70: 656c 662c 2070 6f6f 6c3d 4e6f 6e65 2c20  elf, pool=None, 
-00020d80: 696d 6167 653d 4e6f 6e65 2c20 7377 6974  image=None, swit
-00020d90: 6368 3d4e 6f6e 652c 2064 6f77 6e6c 6f61  ch=None, downloa
-00020da0: 643d 4661 6c73 652c 0a20 2020 2020 2020  d=False,.       
-00020db0: 2020 2020 2020 2020 2020 2020 2075 726c               url
-00020dc0: 3d4e 6f6e 652c 2063 6d64 3d4e 6f6e 652c  =None, cmd=None,
-00020dd0: 2073 796e 633d 4661 6c73 652c 2073 697a   sync=False, siz
-00020de0: 653d 4e6f 6e65 2c20 6172 6368 3d27 7838  e=None, arch='x8
-00020df0: 365f 3634 272c 0a20 2020 2020 2020 2020  6_64',.         
-00020e00: 2020 2020 2020 2020 2020 206b 766d 5f6f             kvm_o
-00020e10: 7065 6e73 7461 636b 3d54 7275 652c 2072  penstack=True, r
-00020e20: 6863 6f73 5f63 6f6d 6d69 743d 4e6f 6e65  hcos_commit=None
-00020e30: 2c20 7268 636f 735f 696e 7374 616c 6c65  , rhcos_installe
-00020e40: 723d 4661 6c73 6529 3a0a 2020 2020 2020  r=False):.      
-00020e50: 2020 6966 2064 6f77 6e6c 6f61 643a 0a20    if download:. 
-00020e60: 2020 2020 2020 2020 2020 206b 203d 2073             k = s
-00020e70: 656c 662e 6b0a 2020 2020 2020 2020 2020  elf.k.          
-00020e80: 2020 6966 2070 6f6f 6c20 6973 204e 6f6e    if pool is Non
-00020e90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00020ea0: 2020 2070 6f6f 6c20 3d20 7365 6c66 2e70     pool = self.p
-00020eb0: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
-00020ec0: 2020 2020 7070 7269 6e74 2866 2255 7369      pprint(f"Usi
-00020ed0: 6e67 2070 6f6f 6c20 7b70 6f6f 6c7d 2229  ng pool {pool}")
-00020ee0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00020ef0: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
-00020f00: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00020f10: 2020 2069 6620 7572 6c20 6973 204e 6f6e     if url is Non
-00020f20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00020f30: 2020 2020 2020 2069 6620 6172 6368 2021         if arch !
-00020f40: 3d20 2778 3836 5f36 3427 3a0a 2020 2020  = 'x86_64':.    
-00020f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f60: 2020 2020 494d 4147 4553 2e75 7064 6174      IMAGES.updat
-00020f70: 6528 7b69 3a20 494d 4147 4553 5b69 5d2e  e({i: IMAGES[i].
-00020f80: 7265 706c 6163 6528 2778 3836 5f36 3427  replace('x86_64'
-00020f90: 2c20 6172 6368 292e 7265 706c 6163 6528  , arch).replace(
-00020fa0: 2761 6d64 3634 272c 2061 7263 6829 0a20  'amd64', arch). 
-00020fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fd0: 2020 2020 2020 666f 7220 6920 696e 2049        for i in I
-00020fe0: 4d41 4745 537d 290a 2020 2020 2020 2020  MAGES}).        
-00020ff0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00021000: 6d61 6765 206e 6f74 2069 6e20 494d 4147  mage not in IMAG
-00021010: 4553 3a0a 2020 2020 2020 2020 2020 2020  ES:.            
-00021020: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00021030: 7228 6622 496d 6167 6520 7b69 6d61 6765  r(f"Image {image
-00021040: 7d20 6861 7320 6e6f 2061 7373 6f63 6961  } has no associa
-00021050: 7465 6420 7572 6c22 290a 2020 2020 2020  ted url").      
-00021060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021070: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
-00021080: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
-00021090: 7265 6173 6f6e 273a 2022 496e 636f 7272  reason': "Incorr
-000210a0: 6563 7420 696d 6167 6522 7d0a 2020 2020  ect image"}.    
-000210b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210c0: 7572 6c20 3d20 494d 4147 4553 5b69 6d61  url = IMAGES[ima
-000210d0: 6765 5d0a 2020 2020 2020 2020 2020 2020  ge].            
-000210e0: 2020 2020 2020 2020 696d 6167 655f 7479          image_ty
-000210f0: 7065 203d 2027 6f70 656e 7374 6163 6b27  pe = 'openstack'
-00021100: 2069 6620 6b76 6d5f 6f70 656e 7374 6163   if kvm_openstac
-00021110: 6b20 616e 6420 7365 6c66 2e74 7970 6520  k and self.type 
-00021120: 3d3d 2027 6b76 6d27 2065 6c73 6520 7365  == 'kvm' else se
-00021130: 6c66 2e74 7970 650a 2020 2020 2020 2020  lf.type.        
-00021140: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00021150: 6f74 206b 766d 5f6f 7065 6e73 7461 636b  ot kvm_openstack
-00021160: 2061 6e64 2073 656c 662e 7479 7065 203d   and self.type =
-00021170: 3d20 276b 766d 273a 0a20 2020 2020 2020  = 'kvm':.       
-00021180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021190: 2069 6d61 6765 202b 3d20 222d 7165 6d75   image += "-qemu
-000211a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000211b0: 2020 2020 2020 6966 2027 7268 636f 7327        if 'rhcos'
-000211c0: 2069 6e20 696d 6167 6520 616e 6420 6e6f   in image and no
-000211d0: 7420 696d 6167 652e 656e 6473 7769 7468  t image.endswith
-000211e0: 2827 7163 6f77 322e 677a 2729 3a0a 2020  ('qcow2.gz'):.  
-000211f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021200: 2020 2020 2020 6966 2072 6863 6f73 5f63        if rhcos_c
-00021210: 6f6d 6d69 7420 6973 206e 6f74 204e 6f6e  ommit is not Non
-00021220: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00021230: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00021240: 726c 203d 2063 6f6d 6d6f 6e2e 6765 745f  rl = common.get_
-00021250: 636f 6d6d 6974 5f72 6863 6f73 2872 6863  commit_rhcos(rhc
-00021260: 6f73 5f63 6f6d 6d69 742c 205f 7479 7065  os_commit, _type
-00021270: 3d69 6d61 6765 5f74 7970 6529 0a20 2020  =image_type).   
-00021280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021290: 2020 2020 2065 6c69 6620 7268 636f 735f       elif rhcos_
-000212a0: 696e 7374 616c 6c65 723a 0a20 2020 2020  installer:.     
-000212b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000212c0: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
-000212d0: 6e5b 2750 4154 4827 5d20 2b3d 2066 273a  n['PATH'] += f':
-000212e0: 7b6f 732e 6765 7463 7764 2829 7d27 0a20  {os.getcwd()}'. 
-000212f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021300: 2020 2020 2020 2020 2020 2075 726c 203d             url =
-00021310: 2063 6f6d 6d6f 6e2e 6765 745f 696e 7374   common.get_inst
-00021320: 616c 6c65 725f 7268 636f 7328 5f74 7970  aller_rhcos(_typ
-00021330: 653d 696d 6167 655f 7479 7065 2c20 6172  e=image_type, ar
-00021340: 6368 3d61 7263 6829 0a20 2020 2020 2020  ch=arch).       
-00021350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021360: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00021370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021380: 2020 2069 6620 6172 6368 2021 3d20 2778     if arch != 'x
-00021390: 3836 5f36 3427 3a0a 2020 2020 2020 2020  86_64':.        
-000213a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000213b0: 2020 2020 2020 2020 7572 6c20 2b3d 2066          url += f
-000213c0: 272d 7b61 7263 687d 270a 2020 2020 2020  '-{arch}'.      
-000213d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000213e0: 2020 2020 2020 7572 6c20 3d20 636f 6d6d        url = comm
-000213f0: 6f6e 2e67 6574 5f6c 6174 6573 745f 7268  on.get_latest_rh
-00021400: 636f 7328 7572 6c2c 205f 7479 7065 3d69  cos(url, _type=i
-00021410: 6d61 6765 5f74 7970 652c 2061 7263 683d  mage_type, arch=
-00021420: 6172 6368 290a 2020 2020 2020 2020 2020  arch).          
-00021430: 2020 2020 2020 2020 2020 6966 2027 6663            if 'fc
-00021440: 6f73 2720 696e 2069 6d61 6765 3a0a 2020  os' in image:.  
-00021450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021460: 2020 2020 2020 7572 6c20 3d20 636f 6d6d        url = comm
-00021470: 6f6e 2e67 6574 5f6c 6174 6573 745f 6663  on.get_latest_fc
-00021480: 6f73 2875 726c 2c20 5f74 7970 653d 696d  os(url, _type=im
-00021490: 6167 655f 7479 7065 290a 2020 2020 2020  age_type).      
-000214a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000214b0: 2069 6d61 6765 203d 3d20 2766 6564 6f72   image == 'fedor
-000214c0: 616c 6174 6573 7427 3a0a 2020 2020 2020  alatest':.      
-000214d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000214e0: 2020 7572 6c20 3d20 636f 6d6d 6f6e 2e67    url = common.g
-000214f0: 6574 5f6c 6174 6573 745f 6665 646f 7261  et_latest_fedora
-00021500: 2875 726c 290a 2020 2020 2020 2020 2020  (url).          
-00021510: 2020 2020 2020 2020 2020 696d 6167 6520            image 
-00021520: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-00021530: 6d65 2869 6d61 6765 290a 2020 2020 2020  me(image).      
-00021540: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00021550: 2069 6d61 6765 2e73 7461 7274 7377 6974   image.startswit
-00021560: 6828 2772 6865 6c27 293a 0a20 2020 2020  h('rhel'):.     
-00021570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021580: 2020 2069 6620 2777 6562 2720 696e 2073     if 'web' in s
-00021590: 7973 2e61 7267 765b 305d 3a0a 2020 2020  ys.argv[0]:.    
-000215a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000215b0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-000215c0: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
-000215d0: 7265 272c 2027 7265 6173 6f6e 273a 2022  re', 'reason': "
-000215e0: 4d69 7373 696e 6720 7572 6c22 7d0a 2020  Missing url"}.  
-000215f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021600: 2020 2020 2020 7070 7269 6e74 2866 224f        pprint(f"O
-00021610: 7065 6e69 6e67 2075 726c 207b 7572 6c7d  pening url {url}
-00021620: 2066 6f72 2079 6f75 2074 6f20 6772 6162   for you to grab
-00021630: 2063 6f6d 706c 6574 6520 7572 6c20 666f   complete url fo
-00021640: 7220 7b69 6d61 6765 7d20 6b76 6d20 6775  r {image} kvm gu
-00021650: 6573 7420 696d 6167 6522 290a 2020 2020  est image").    
-00021660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021670: 2020 2020 7765 6262 726f 7773 6572 2e6f      webbrowser.o
-00021680: 7065 6e28 7572 6c2c 206e 6577 3d32 2c20  pen(url, new=2, 
-00021690: 6175 746f 7261 6973 653d 5472 7565 290a  autoraise=True).
-000216a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216b0: 2020 2020 2020 2020 7572 6c20 3d20 696e          url = in
-000216c0: 7075 7428 2243 6f70 7920 5572 6c3a 5c6e  put("Copy Url:\n
-000216d0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000216e0: 2020 2020 2020 2020 2020 2069 6620 7572             if ur
-000216f0: 6c2e 7374 7269 7028 2920 3d3d 2027 273a  l.strip() == '':
-00021700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021710: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00021720: 6f72 2822 4d69 7373 696e 6720 7072 6f70  or("Missing prop
-00021730: 6572 2075 726c 2e4c 6561 7669 6e67 2e2e  er url.Leaving..
-00021740: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00021750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021760: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-00021770: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
-00021780: 6173 6f6e 273a 2022 4d69 7373 696e 6720  ason': "Missing 
-00021790: 696d 6167 6522 7d0a 2020 2020 2020 2020  image"}.        
-000217a0: 2020 2020 2020 2020 6966 2063 6d64 2069          if cmd i
-000217b0: 7320 4e6f 6e65 2061 6e64 2069 6d61 6765  s None and image
-000217c0: 2021 3d20 2727 2061 6e64 2069 6d61 6765   != '' and image
-000217d0: 2069 6e20 494d 4147 4553 434f 4d4d 414e   in IMAGESCOMMAN
-000217e0: 4453 3a0a 2020 2020 2020 2020 2020 2020  DS:.            
-000217f0: 2020 2020 2020 2020 636d 6420 3d20 494d          cmd = IM
-00021800: 4147 4553 434f 4d4d 414e 4453 5b69 6d61  AGESCOMMANDS[ima
-00021810: 6765 5d0a 2020 2020 2020 2020 2020 2020  ge].            
-00021820: 2020 2020 7070 7269 6e74 2866 2247 7261      pprint(f"Gra
-00021830: 6262 696e 6720 696d 6167 6520 7b69 6d61  bbing image {ima
-00021840: 6765 7d20 6672 6f6d 2075 726c 207b 7572  ge} from url {ur
-00021850: 6c7d 2229 0a20 2020 2020 2020 2020 2020  l}").           
-00021860: 2020 2020 206e 6565 645f 6973 6f20 3d20       need_iso = 
-00021870: 2761 7069 2f61 7373 6973 7465 642d 696d  'api/assisted-im
-00021880: 6167 6573 2f69 6d61 6765 7327 2069 6e20  ages/images' in 
-00021890: 7572 6c0a 2020 2020 2020 2020 2020 2020  url.            
-000218a0: 2020 2020 7368 6f72 746e 616d 6520 3d20      shortname = 
-000218b0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-000218c0: 2875 726c 292e 7370 6c69 7428 273f 2729  (url).split('?')
-000218d0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-000218e0: 2020 2020 6966 206e 6565 645f 6973 6f3a      if need_iso:
-000218f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021900: 2020 2020 2069 6d61 6765 203d 2066 2762       image = f'b
-00021910: 6f6f 742d 7b73 686f 7274 6e61 6d65 7d2e  oot-{shortname}.
-00021920: 6973 6f27 0a20 2020 2020 2020 2020 2020  iso'.           
-00021930: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00021940: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00021950: 6e76 6572 7420 3d20 272e 7261 772e 2720  nvert = '.raw.' 
-00021960: 696e 2075 726c 0a20 2020 2020 2020 2020  in url.         
-00021970: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00021980: 7420 3d20 6b2e 6164 645f 696d 6167 6528  t = k.add_image(
-00021990: 7572 6c2c 2070 6f6f 6c2c 2063 6d64 3d63  url, pool, cmd=c
-000219a0: 6d64 2c20 6e61 6d65 3d69 6d61 6765 2c20  md, name=image, 
-000219b0: 7369 7a65 3d73 697a 652c 2063 6f6e 7665  size=size, conve
-000219c0: 7274 3d63 6f6e 7665 7274 290a 2020 2020  rt=convert).    
-000219d0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-000219e0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-000219f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00021a00: 2020 2020 2020 2065 7272 6f72 2866 2247         error(f"G
-00021a10: 6f74 207b 657d 2229 0a20 2020 2020 2020  ot {e}").       
-00021a20: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00021a30: 6f72 2866 2250 6c65 6173 6520 7275 6e20  or(f"Please run 
-00021a40: 6b63 6c69 2064 656c 6574 6520 696d 6167  kcli delete imag
-00021a50: 6520 2d2d 7965 7320 7b73 686f 7274 6e61  e --yes {shortna
-00021a60: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
-00021a70: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00021a80: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-00021a90: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-00021aa0: 2022 5573 6572 2069 6e74 6572 7275 7074   "User interrupt
-00021ab0: 696f 6e22 7d0a 2020 2020 2020 2020 2020  ion"}.          
-00021ac0: 2020 2020 2020 666f 756e 6420 3d20 2766        found = 'f
-00021ad0: 6f75 6e64 2720 696e 2072 6573 756c 740a  ound' in result.
-00021ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021af0: 6966 2066 6f75 6e64 3a0a 2020 2020 2020  if found:.      
-00021b00: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00021b10: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-00021b20: 2773 7563 6365 7373 277d 0a20 2020 2020  'success'}.     
-00021b30: 2020 2020 2020 2020 2020 2063 6f6d 6d6f             commo
-00021b40: 6e2e 6861 6e64 6c65 5f72 6573 706f 6e73  n.handle_respons
-00021b50: 6528 7265 7375 6c74 2c20 696d 6167 652c  e(result, image,
-00021b60: 2065 6c65 6d65 6e74 3d27 496d 6167 6527   element='Image'
-00021b70: 2c20 6163 7469 6f6e 3d27 4164 6465 6427  , action='Added'
-00021b80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00021b90: 2020 6966 2072 6573 756c 745b 2772 6573    if result['res
-00021ba0: 756c 7427 5d20 213d 2027 7375 6363 6573  ult'] != 'succes
-00021bb0: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
-00021bc0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-00021bd0: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
-00021be0: 7265 272c 2027 7265 6173 6f6e 273a 2072  re', 'reason': r
-00021bf0: 6573 756c 745b 2772 6561 736f 6e27 5d7d  esult['reason']}
-00021c00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00021c10: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-00021c20: 7375 6363 6573 7327 7d0a 2020 2020 2020  success'}.      
-00021c30: 2020 656c 6966 2073 7769 7463 683a 0a20    elif switch:. 
-00021c40: 2020 2020 2020 2020 2020 2069 6620 7377             if sw
-00021c50: 6974 6368 206e 6f74 2069 6e20 7365 6c66  itch not in self
-00021c60: 2e63 6c69 656e 7473 3a0a 2020 2020 2020  .clients:.      
-00021c70: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00021c80: 6622 436c 6965 6e74 207b 7377 6974 6368  f"Client {switch
-00021c90: 7d20 6e6f 7420 666f 756e 6420 696e 2063  } not found in c
-00021ca0: 6f6e 6669 672e 4c65 6176 696e 672e 2e2e  onfig.Leaving...
-00021cb0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00021cc0: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00021cd0: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
-00021ce0: 2027 7265 6173 6f6e 273a 2066 2243 6c69   'reason': f"Cli
-00021cf0: 656e 7420 7b73 7769 7463 687d 206e 6f74  ent {switch} not
-00021d00: 2066 6f75 6e64 2069 6e20 636f 6e66 6967   found in config
-00021d10: 227d 0a20 2020 2020 2020 2020 2020 2065  "}.            e
-00021d20: 6e61 626c 6564 203d 2073 656c 662e 696e  nabled = self.in
-00021d30: 695b 7377 6974 6368 5d2e 6765 7428 2765  i[switch].get('e
-00021d40: 6e61 626c 6564 272c 2054 7275 6529 0a20  nabled', True). 
-00021d50: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00021d60: 7420 656e 6162 6c65 643a 0a20 2020 2020  t enabled:.     
-00021d70: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00021d80: 2866 2243 6c69 656e 7420 7b73 7769 7463  (f"Client {switc
-00021d90: 687d 2069 7320 6469 7361 626c 6564 2e4c  h} is disabled.L
-00021da0: 6561 7669 6e67 2e2e 2e2e 2229 0a20 2020  eaving....").   
-00021db0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00021dc0: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-00021dd0: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
-00021de0: 6e27 3a20 6622 436c 6965 6e74 207b 7377  n': f"Client {sw
-00021df0: 6974 6368 7d20 6973 2064 6973 6162 6c65  itch} is disable
-00021e00: 6422 7d0a 2020 2020 2020 2020 2020 2020  d"}.            
-00021e10: 7070 7269 6e74 2866 2253 7769 7463 6869  pprint(f"Switchi
-00021e20: 6e67 2074 6f20 636c 6965 6e74 207b 7377  ng to client {sw
-00021e30: 6974 6368 7d2e 2e2e 2229 0a20 2020 2020  itch}...").     
-00021e40: 2020 2020 2020 2069 6e69 6669 6c65 203d         inifile =
-00021e50: 2022 2573 2f2e 6b63 6c69 2f63 6f6e 6669   "%s/.kcli/confi
-00021e60: 672e 796d 6c22 2025 206f 732e 656e 7669  g.yml" % os.envi
-00021e70: 726f 6e2e 6765 7428 2748 4f4d 4527 290a  ron.get('HOME').
-00021e80: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00021e90: 732e 7061 7468 2e65 7869 7374 7328 696e  s.path.exists(in
-00021ea0: 6966 696c 6529 3a0a 2020 2020 2020 2020  ifile):.        
-00021eb0: 2020 2020 2020 2020 6e65 7769 6e69 203d          newini =
-00021ec0: 2027 270a 2020 2020 2020 2020 2020 2020   ''.            
-00021ed0: 2020 2020 666f 7220 6c69 6e65 2069 6e20      for line in 
-00021ee0: 6f70 656e 2869 6e69 6669 6c65 292e 7265  open(inifile).re
-00021ef0: 6164 6c69 6e65 7328 293a 0a20 2020 2020  adlines():.     
-00021f00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021f10: 6620 2763 6c69 656e 7427 2069 6e20 6c69  f 'client' in li
-00021f20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00021f30: 2020 2020 2020 2020 2020 2020 6e65 7769              newi
-00021f40: 6e69 202b 3d20 6622 2063 6c69 656e 743a  ni += f" client:
-00021f50: 207b 7377 6974 6368 7d5c 6e22 0a20 2020   {switch}\n".   
-00021f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021f70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00021f80: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00021f90: 6577 696e 6920 2b3d 206c 696e 650a 2020  ewini += line.  
-00021fa0: 2020 2020 2020 2020 2020 2020 2020 6f70                op
-00021fb0: 656e 2869 6e69 6669 6c65 2c20 2777 2729  en(inifile, 'w')
-00021fc0: 2e77 7269 7465 286e 6577 696e 6929 0a20  .write(newini). 
-00021fd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00021fe0: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
-00021ff0: 6363 6573 7327 7d0a 2020 2020 2020 2020  ccess'}.        
-00022000: 656c 6966 2073 796e 633a 0a20 2020 2020  elif sync:.     
-00022010: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
-00022020: 6b0a 2020 2020 2020 2020 2020 2020 6966  k.            if
-00022030: 206e 6f74 2073 656c 662e 6578 7472 6163   not self.extrac
-00022040: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
-00022050: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-00022060: 224e 6f74 6869 6e67 2074 6f20 646f 2e20  "Nothing to do. 
-00022070: 4c65 6176 696e 672e 2e2e 2229 0a20 2020  Leaving...").   
-00022080: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00022090: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
-000220a0: 7375 6363 6573 7327 7d0a 2020 2020 2020  success'}.      
-000220b0: 2020 2020 2020 666f 7220 636c 6920 696e        for cli in
-000220c0: 2073 656c 662e 6578 7472 6163 6c69 656e   self.extraclien
-000220d0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-000220e0: 2020 2020 6465 7374 203d 2073 656c 662e      dest = self.
-000220f0: 6578 7472 6163 6c69 656e 7473 5b63 6c69  extraclients[cli
-00022100: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00022110: 2020 7070 7269 6e74 2866 2273 796e 6369    pprint(f"synci
-00022120: 6e67 2063 6c69 656e 7420 696d 6167 6573  ng client images
-00022130: 2066 726f 6d20 7b73 656c 662e 636c 6965   from {self.clie
-00022140: 6e74 7d20 746f 207b 636c 697d 2229 0a20  nt} to {cli}"). 
-00022150: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00022160: 6172 6e69 6e67 2822 4e6f 7465 2072 6865  arning("Note rhe
-00022170: 6c20 696d 6167 6573 2061 7265 2063 7572  l images are cur
-00022180: 7265 6e74 6c79 206e 6f74 2073 796e 6365  rently not synce
-00022190: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
-000221a0: 666f 7220 766f 6c20 696e 206b 2e76 6f6c  for vol in k.vol
-000221b0: 756d 6573 2829 3a0a 2020 2020 2020 2020  umes():.        
-000221c0: 2020 2020 2020 2020 696d 6167 6520 3d20          image = 
-000221d0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-000221e0: 2876 6f6c 290a 2020 2020 2020 2020 2020  (vol).          
-000221f0: 2020 2020 2020 6966 2069 6d61 6765 2069        if image i
-00022200: 6e20 5b6f 732e 7061 7468 2e62 6173 656e  n [os.path.basen
-00022210: 616d 6528 7629 2066 6f72 2076 2069 6e20  ame(v) for v in 
-00022220: 6465 7374 2e76 6f6c 756d 6573 2829 5d3a  dest.volumes()]:
-00022230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022240: 2020 2020 2077 6172 6e69 6e67 2866 2249       warning(f"I
-00022250: 676e 6f72 696e 6720 7b69 6d61 6765 7d20  gnoring {image} 
-00022260: 6173 2069 7427 7320 616c 7265 6164 7920  as it's already 
-00022270: 7468 6572 6522 290a 2020 2020 2020 2020  there").        
-00022280: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00022290: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-000222a0: 2020 2020 2075 726c 203d 204e 6f6e 650a       url = None.
-000222b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000222c0: 666f 7220 6e20 696e 206c 6973 7428 494d  for n in list(IM
-000222d0: 4147 4553 2e76 616c 7565 7328 2929 3a0a  AGES.values()):.
-000222e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000222f0: 2020 2020 6966 206e 2069 7320 4e6f 6e65      if n is None
-00022300: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00022310: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00022320: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00022330: 2020 2020 2020 2065 6c69 6620 6e2e 7370         elif n.sp
-00022340: 6c69 7428 272f 2729 5b2d 315d 203d 3d20  lit('/')[-1] == 
-00022350: 696d 6167 653a 0a20 2020 2020 2020 2020  image:.         
-00022360: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00022370: 726c 203d 206e 0a20 2020 2020 2020 2020  rl = n.         
-00022380: 2020 2020 2020 2069 6620 7572 6c20 6973         if url is
-00022390: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000223a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000223b0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
-000223c0: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
-000223d0: 3a20 2269 6d61 6765 206e 6f74 2069 6e20  : "image not in 
-000223e0: 6465 6661 756c 7420 6c69 7374 227d 0a20  default list"}. 
-000223f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00022400: 6620 696d 6167 652e 7374 6172 7473 7769  f image.startswi
-00022410: 7468 2827 7268 656c 2729 3a0a 2020 2020  th('rhel'):.    
-00022420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022430: 6966 2027 7765 6227 2069 6e20 7379 732e  if 'web' in sys.
-00022440: 6172 6776 5b30 5d3a 0a20 2020 2020 2020  argv[0]:.       
-00022450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022460: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00022470: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
-00022480: 6561 736f 6e27 3a20 224d 6973 7369 6e67  eason': "Missing
-00022490: 2075 726c 227d 0a20 2020 2020 2020 2020   url"}.         
-000224a0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-000224b0: 7428 6622 4f70 656e 696e 6720 7572 6c20  t(f"Opening url 
-000224c0: 7b75 726c 7d20 666f 7220 796f 7520 746f  {url} for you to
-000224d0: 2067 7261 6220 636f 6d70 6c65 7465 2075   grab complete u
-000224e0: 726c 2066 6f72 207b 766f 6c7d 206b 766d  rl for {vol} kvm
-000224f0: 2067 7565 7374 2069 6d61 6765 2229 0a20   guest image"). 
-00022500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022510: 2020 2077 6562 6272 6f77 7365 722e 6f70     webbrowser.op
-00022520: 656e 2875 726c 2c20 6e65 773d 322c 2061  en(url, new=2, a
-00022530: 7574 6f72 6169 7365 3d54 7275 6529 0a20  utoraise=True). 
-00022540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022550: 2020 2075 726c 203d 2069 6e70 7574 2822     url = input("
-00022560: 436f 7079 2055 726c 3a5c 6e22 290a 2020  Copy Url:\n").  
-00022570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022580: 2020 6966 2075 726c 2e73 7472 6970 2829    if url.strip()
-00022590: 203d 3d20 2727 3a0a 2020 2020 2020 2020   == '':.        
-000225a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000225b0: 6572 726f 7228 224d 6973 7369 6e67 2070  error("Missing p
-000225c0: 726f 7065 7220 7572 6c2e 4c65 6176 696e  roper url.Leavin
-000225d0: 672e 2e2e 2229 0a20 2020 2020 2020 2020  g...").         
-000225e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000225f0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-00022600: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
-00022610: 736f 6e27 3a20 224d 6973 7369 6e67 2069  son': "Missing i
-00022620: 6d61 6765 227d 0a20 2020 2020 2020 2020  mage"}.         
-00022630: 2020 2020 2020 2063 6d64 203d 204e 6f6e         cmd = Non
-00022640: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00022650: 2020 6966 2076 6f6c 2069 6e20 494d 4147    if vol in IMAG
-00022660: 4553 434f 4d4d 414e 4453 3a0a 2020 2020  ESCOMMANDS:.    
-00022670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022680: 636d 6420 3d20 494d 4147 4553 434f 4d4d  cmd = IMAGESCOMM
-00022690: 414e 4453 5b69 6d61 6765 5d0a 2020 2020  ANDS[image].    
-000226a0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-000226b0: 6e74 2866 2247 7261 6262 696e 6720 696d  nt(f"Grabbing im
-000226c0: 6167 6520 7b69 6d61 6765 7d2e 2e2e 2229  age {image}...")
-000226d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000226e0: 2064 6573 742e 6164 645f 696d 6167 6528   dest.add_image(
-000226f0: 7572 6c2c 2070 6f6f 6c2c 2063 6d64 3d63  url, pool, cmd=c
-00022700: 6d64 290a 2020 2020 2020 2020 7265 7475  md).        retu
-00022710: 726e 207b 2772 6573 756c 7427 3a20 2773  rn {'result': 's
-00022720: 7563 6365 7373 277d 0a0a 2020 2020 6465  uccess'}..    de
-00022730: 6620 6465 6c65 7465 5f6c 6f61 6462 616c  f delete_loadbal
-00022740: 616e 6365 7228 7365 6c66 2c20 6e61 6d65  ancer(self, name
-00022750: 2c20 646f 6d61 696e 3d4e 6f6e 6529 3a0a  , domain=None):.
-00022760: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
-00022770: 2e6b 0a20 2020 2020 2020 2070 7072 696e  .k.        pprin
-00022780: 7428 6622 4465 6c65 7469 6e67 206c 6f61  t(f"Deleting loa
-00022790: 6462 616c 616e 6365 7220 7b6e 616d 657d  dbalancer {name}
-000227a0: 2229 0a20 2020 2020 2020 2069 6620 7365  ").        if se
-000227b0: 6c66 2e74 7970 6520 696e 205b 2761 7773  lf.type in ['aws
-000227c0: 272c 2027 6763 7027 2c20 2769 626d 275d  ', 'gcp', 'ibm']
-000227d0: 3a0a 2020 2020 2020 2020 2020 2020 646e  :.            dn
-000227e0: 7363 6c69 656e 7420 3d20 6b2e 6465 6c65  sclient = k.dele
-000227f0: 7465 5f6c 6f61 6462 616c 616e 6365 7228  te_loadbalancer(
-00022800: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-00022810: 2020 6966 2064 6f6d 6169 6e20 6973 206e    if domain is n
-00022820: 6f74 204e 6f6e 6520 616e 6420 646e 7363  ot None and dnsc
-00022830: 6c69 656e 7420 6973 206e 6f74 204e 6f6e  lient is not Non
-00022840: 6520 616e 6420 6973 696e 7374 616e 6365  e and isinstance
-00022850: 2864 6e73 636c 6965 6e74 2c20 7374 7229  (dnsclient, str)
-00022860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00022870: 2020 6966 2064 6e73 636c 6965 6e74 2069    if dnsclient i
-00022880: 6e20 7365 6c66 2e63 6c69 656e 7473 3a0a  n self.clients:.
-00022890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000228a0: 2020 2020 7a20 3d20 4b63 6f6e 6669 6728      z = Kconfig(
-000228b0: 636c 6965 6e74 3d64 6e73 636c 6965 6e74  client=dnsclient
-000228c0: 292e 6b0a 2020 2020 2020 2020 2020 2020  ).k.            
-000228d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000228e0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-000228f0: 726e 696e 6728 6622 436c 6965 6e74 207b  rning(f"Client {
-00022900: 646e 7363 6c69 656e 747d 206e 6f74 2066  dnsclient} not f
-00022910: 6f75 6e64 2e20 536b 6970 7069 6e67 2229  ound. Skipping")
-00022920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022930: 207a 2e64 656c 6574 655f 646e 7328 6e61   z.delete_dns(na
-00022940: 6d65 2e72 6570 6c61 6365 2827 5f27 2c20  me.replace('_', 
-00022950: 272d 2729 2c20 646f 6d61 696e 290a 2020  '-'), domain).  
-00022960: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-00022970: 7479 7065 203d 3d20 276b 766d 273a 0a20  type == 'kvm':. 
-00022980: 2020 2020 2020 2020 2020 206b 2e64 656c             k.del
-00022990: 6574 6528 6e61 6d65 290a 0a20 2020 2064  ete(name)..    d
-000229a0: 6566 2063 7265 6174 655f 6c6f 6164 6261  ef create_loadba
-000229b0: 6c61 6e63 6572 2873 656c 662c 206e 616d  lancer(self, nam
-000229c0: 652c 206e 6574 733d 5b27 6465 6661 756c  e, nets=['defaul
-000229d0: 7427 5d2c 2070 6f72 7473 3d5b 5d2c 2063  t'], ports=[], c
-000229e0: 6865 636b 7061 7468 3d27 2f27 2c20 766d  heckpath='/', vm
-000229f0: 733d 5b5d 2c20 646f 6d61 696e 3d4e 6f6e  s=[], domain=Non
-00022a00: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00022a10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00022a20: 6c61 6e3d 4e6f 6e65 2c20 6368 6563 6b70  lan=None, checkp
-00022a30: 6f72 743d 3830 2c20 616c 6961 733d 5b5d  ort=80, alias=[]
-00022a40: 2c20 696e 7465 726e 616c 3d46 616c 7365  , internal=False
-00022a50: 2c20 646e 7363 6c69 656e 743d 4e6f 6e65  , dnsclient=None
-00022a60: 2c20 7375 626e 6574 6964 3d4e 6f6e 652c  , subnetid=None,
-00022a70: 2069 703d 4e6f 6e65 293a 0a20 2020 2020   ip=None):.     
-00022a80: 2020 206e 616d 6520 3d20 6e61 6d65 7574     name = nameut
-00022a90: 696c 732e 6765 745f 7261 6e64 6f6d 5f6e  ils.get_random_n
-00022aa0: 616d 6528 292e 7265 706c 6163 6528 275f  ame().replace('_
-00022ab0: 272c 2027 2d27 2920 6966 206e 616d 6520  ', '-') if name 
-00022ac0: 6973 204e 6f6e 6520 656c 7365 206e 616d  is None else nam
-00022ad0: 650a 2020 2020 2020 2020 7070 7269 6e74  e.        pprint
-00022ae0: 2866 2244 6570 6c6f 7969 6e67 206c 6f61  (f"Deploying loa
-00022af0: 6462 616c 616e 6365 7220 7b6e 616d 657d  dbalancer {name}
-00022b00: 2229 0a20 2020 2020 2020 206b 203d 2073  ").        k = s
-00022b10: 656c 662e 6b0a 2020 2020 2020 2020 6966  elf.k.        if
-00022b20: 2073 656c 662e 7479 7065 2069 6e20 5b27   self.type in ['
-00022b30: 6177 7327 2c20 2767 6370 272c 2027 6962  aws', 'gcp', 'ib
-00022b40: 6d27 5d3a 0a20 2020 2020 2020 2020 2020  m']:.           
-00022b50: 206c 625f 6970 203d 206b 2e63 7265 6174   lb_ip = k.creat
-00022b60: 655f 6c6f 6164 6261 6c61 6e63 6572 286e  e_loadbalancer(n
-00022b70: 616d 652c 2070 6f72 7473 3d70 6f72 7473  ame, ports=ports
-00022b80: 2c20 6368 6563 6b70 6174 683d 6368 6563  , checkpath=chec
-00022b90: 6b70 6174 682c 2076 6d73 3d76 6d73 2c20  kpath, vms=vms, 
-00022ba0: 646f 6d61 696e 3d64 6f6d 6169 6e2c 0a20  domain=domain,. 
-00022bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022bd0: 2020 2020 2020 2020 2063 6865 636b 706f           checkpo
-00022be0: 7274 3d63 6865 636b 706f 7274 2c20 616c  rt=checkport, al
-00022bf0: 6961 733d 616c 6961 732c 2069 6e74 6572  ias=alias, inter
-00022c00: 6e61 6c3d 696e 7465 726e 616c 2c0a 2020  nal=internal,.  
-00022c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022c30: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
-00022c40: 743d 646e 7363 6c69 656e 742c 2073 7562  t=dnsclient, sub
-00022c50: 6e65 7469 643d 7375 626e 6574 6964 2c20  netid=subnetid, 
-00022c60: 6970 3d69 7029 0a20 2020 2020 2020 2020  ip=ip).         
-00022c70: 2020 2069 6620 646e 7363 6c69 656e 7420     if dnsclient 
-00022c80: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00022c90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00022ca0: 646e 7363 6c69 656e 7420 696e 2073 656c  dnsclient in sel
-00022cb0: 662e 636c 6965 6e74 733a 0a20 2020 2020  f.clients:.     
-00022cc0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-00022cd0: 203d 204b 636f 6e66 6967 2863 6c69 656e   = Kconfig(clien
-00022ce0: 743d 646e 7363 6c69 656e 7429 2e6b 0a20  t=dnsclient).k. 
-00022cf0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00022d00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00022d10: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00022d20: 2866 2243 6c69 656e 7420 7b64 6e73 636c  (f"Client {dnscl
-00022d30: 6965 6e74 7d20 6e6f 7420 666f 756e 642e  ient} not found.
-00022d40: 2053 6b69 7070 696e 6722 290a 2020 2020   Skipping").    
-00022d50: 2020 2020 2020 2020 2020 2020 7a2e 7265              z.re
-00022d60: 7365 7276 655f 646e 7328 6e61 6d65 2e72  serve_dns(name.r
-00022d70: 6570 6c61 6365 2827 5f27 2c20 272d 2729  eplace('_', '-')
-00022d80: 2c20 6970 3d6c 625f 6970 2c20 646f 6d61  , ip=lb_ip, doma
-00022d90: 696e 3d64 6f6d 6169 6e2c 2061 6c69 6173  in=domain, alias
-00022da0: 3d61 6c69 6173 290a 2020 2020 2020 2020  =alias).        
-00022db0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00022dc0: 2020 766d 696e 666f 203d 205b 5d0a 2020    vminfo = [].  
-00022dd0: 2020 2020 2020 2020 2020 666f 7220 766d            for vm
-00022de0: 2069 6e20 766d 733a 0a20 2020 2020 2020   in vms:.       
-00022df0: 2020 2020 2020 2020 2069 6620 7661 6c69           if vali
-00022e00: 645f 6970 2876 6d29 3a0a 2020 2020 2020  d_ip(vm):.      
-00022e10: 2020 2020 2020 2020 2020 2020 2020 766d                vm
-00022e20: 6e61 6d65 203d 2076 6d2e 7265 706c 6163  name = vm.replac
-00022e30: 6528 273a 272c 2027 2d27 292e 7265 706c  e(':', '-').repl
-00022e40: 6163 6528 272e 272c 2027 2d27 290a 2020  ace('.', '-').  
-00022e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022e60: 2020 766d 696e 666f 2e61 7070 656e 6428    vminfo.append(
-00022e70: 7b27 6e61 6d65 273a 2076 6d6e 616d 652c  {'name': vmname,
-00022e80: 2027 6970 273a 2076 6d7d 290a 2020 2020   'ip': vm}).    
-00022e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ea0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-00022eb0: 2020 2020 2020 2020 2063 6f75 6e74 6572           counter
-00022ec0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00022ed0: 2020 2020 2077 6869 6c65 2063 6f75 6e74       while count
-00022ee0: 6572 2021 3d20 3130 303a 0a20 2020 2020  er != 100:.     
-00022ef0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00022f00: 7020 3d20 6b2e 6970 2876 6d29 0a20 2020  p = k.ip(vm).   
-00022f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f20: 2069 6620 6970 2069 7320 4e6f 6e65 3a0a   if ip is None:.
-00022f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f40: 2020 2020 2020 2020 736c 6565 7028 3529          sleep(5)
-00022f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022f60: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00022f70: 2257 6169 7469 6e67 2035 2073 6563 6f6e  "Waiting 5 secon
-00022f80: 6473 2074 6f20 6772 6162 2069 7020 666f  ds to grab ip fo
-00022f90: 7220 766d 207b 766d 7d2e 2e2e 2229 0a20  r vm {vm}..."). 
-00022fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022fb0: 2020 2020 2020 2063 6f75 6e74 6572 202b         counter +
-00022fc0: 3d20 350a 2020 2020 2020 2020 2020 2020  = 5.            
-00022fd0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00022fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ff0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-00023000: 2020 2020 2020 2020 2020 2020 766d 696e              vmin
-00023010: 666f 2e61 7070 656e 6428 7b27 6e61 6d65  fo.append({'name
-00023020: 273a 2076 6d2c 2027 6970 273a 2069 707d  ': vm, 'ip': ip}
-00023030: 290a 2020 2020 2020 2020 2020 2020 6f76  ).            ov
-00023040: 6572 7269 6465 7320 3d20 7b0a 2020 2020  errides = {.    
-00023050: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
-00023060: 6522 3a20 6e61 6d65 2c0a 2020 2020 2020  e": name,.      
-00023070: 2020 2020 2020 2020 2020 2276 6d73 223a            "vms":
-00023080: 2076 6d69 6e66 6f2c 0a20 2020 2020 2020   vminfo,.       
-00023090: 2020 2020 2020 2020 2022 6e65 7473 223a           "nets":
-000230a0: 206e 6574 732c 0a20 2020 2020 2020 2020   nets,.         
-000230b0: 2020 2020 2020 2022 706f 7274 7322 3a20         "ports": 
-000230c0: 706f 7274 732c 0a20 2020 2020 2020 2020  ports,.         
-000230d0: 2020 2020 2020 2022 6368 6563 6b70 6174         "checkpat
-000230e0: 6822 3a20 6368 6563 6b70 6174 682c 0a20  h": checkpath,. 
-000230f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00023100: 646f 6d61 696e 223a 2064 6f6d 6169 6e2c  domain": domain,
-00023110: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-00023120: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00023130: 706c 616e 2870 6c61 6e2c 2069 6e70 7574  plan(plan, input
-00023140: 7374 7269 6e67 3d68 6170 726f 7879 706c  string=haproxypl
-00023150: 616e 2c20 6f76 6572 7269 6465 733d 6f76  an, overrides=ov
-00023160: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
-00023170: 6620 6c69 7374 5f6c 6f61 6462 616c 616e  f list_loadbalan
-00023180: 6365 7273 2873 656c 6629 3a0a 2020 2020  cers(self):.    
-00023190: 2020 2020 6b20 3d20 7365 6c66 2e6b 0a20      k = self.k. 
-000231a0: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-000231b0: 7970 6520 6e6f 7420 696e 205b 2761 7773  ype not in ['aws
-000231c0: 272c 2027 6763 7027 2c20 2769 626d 275d  ', 'gcp', 'ibm']
-000231d0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000231e0: 7375 6c74 7320 3d20 5b5d 0a20 2020 2020  sults = [].     
-000231f0: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
-00023200: 206b 2e6c 6973 7428 293a 0a20 2020 2020   k.list():.     
-00023210: 2020 2020 2020 2020 2020 2069 6620 766d             if vm
-00023220: 5b27 7072 6f66 696c 6527 5d2e 7374 6172  ['profile'].star
-00023230: 7473 7769 7468 2827 6c6f 6164 6261 6c61  tswith('loadbala
-00023240: 6e63 6572 2729 2061 6e64 206c 656e 2876  ncer') and len(v
-00023250: 6d5b 2770 726f 6669 6c65 275d 2e73 706c  m['profile'].spl
-00023260: 6974 2827 2d27 2929 203d 3d20 323a 0a20  it('-')) == 2:. 
-00023270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023280: 2020 2070 6f72 7473 203d 2076 6d5b 2770     ports = vm['p
-00023290: 726f 6669 6c65 275d 2e73 706c 6974 2827  rofile'].split('
-000232a0: 2d27 295b 315d 0a20 2020 2020 2020 2020  -')[1].         
-000232b0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-000232c0: 7473 2e61 7070 656e 6428 5b76 6d5b 276e  ts.append([vm['n
-000232d0: 616d 6527 5d2c 2076 6d5b 2769 7027 5d2c  ame'], vm['ip'],
-000232e0: 2027 7463 7027 2c20 706f 7274 732c 2027   'tcp', ports, '
-000232f0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-00023300: 7265 7475 726e 2072 6573 756c 7473 0a20  return results. 
-00023310: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00023320: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00023330: 6b2e 6c69 7374 5f6c 6f61 6462 616c 616e  k.list_loadbalan
-00023340: 6365 7273 2829 0a0a 2020 2020 6465 6620  cers()..    def 
-00023350: 7761 6974 5f66 696e 6973 6828 7365 6c66  wait_finish(self
-00023360: 2c20 6e61 6d65 2c20 696d 6167 653d 4e6f  , name, image=No
-00023370: 6e65 2c20 7175 6965 743d 4661 6c73 652c  ne, quiet=False,
-00023380: 2077 6169 7463 6f6d 6d61 6e64 3d4e 6f6e   waitcommand=Non
-00023390: 652c 2077 6169 7474 696d 656f 7574 3d30  e, waittimeout=0
-000233a0: 2c20 6964 656e 7469 7479 6669 6c65 3d4e  , identityfile=N
-000233b0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-000233c0: 2020 2020 2020 2020 2076 6d63 6c69 656e           vmclien
-000233d0: 743d 4e6f 6e65 293a 0a20 2020 2020 2020  t=None):.       
-000233e0: 2063 6f6e 6669 6720 3d20 4b63 6f6e 6669   config = Kconfi
-000233f0: 6728 636c 6965 6e74 3d76 6d63 6c69 656e  g(client=vmclien
-00023400: 7429 2069 6620 766d 636c 6965 6e74 2069  t) if vmclient i
-00023410: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-00023420: 7365 6c66 0a20 2020 2020 2020 206b 203d  self.        k =
-00023430: 2063 6f6e 6669 672e 6b0a 2020 2020 2020   config.k.      
-00023440: 2020 6966 2069 6d61 6765 2069 7320 4e6f    if image is No
-00023450: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00023460: 696d 6167 6520 3d20 6b2e 696e 666f 286e  image = k.info(n
-00023470: 616d 6529 5b27 696d 6167 6527 5d0a 2020  ame)['image'].  
-00023480: 2020 2020 2020 7070 7269 6e74 2866 2257        pprint(f"W
-00023490: 6169 7469 6e67 2066 6f72 2076 6d20 7b6e  aiting for vm {n
-000234a0: 616d 657d 2074 6f20 6669 6e69 7368 2063  ame} to finish c
-000234b0: 7573 746f 6d69 7361 7469 6f6e 2229 0a20  ustomisation"). 
-000234c0: 2020 2020 2020 2069 6620 7761 6974 636f         if waitco
-000234d0: 6d6d 616e 6420 6973 206e 6f74 204e 6f6e  mmand is not Non
-000234e0: 6520 616e 6420 2732 3e27 206e 6f74 2069  e and '2>' not i
-000234f0: 6e20 7761 6974 636f 6d6d 616e 643a 0a20  n waitcommand:. 
-00023500: 2020 2020 2020 2020 2020 2077 6169 7463             waitc
-00023510: 6f6d 6d61 6e64 202b 3d20 2220 323e 2f64  ommand += " 2>/d
-00023520: 6576 2f6e 756c 6c22 0a20 2020 2020 2020  ev/null".       
-00023530: 2069 6620 636f 6d6d 6f6e 2e6e 6565 6473   if common.needs
-00023540: 5f69 676e 6974 696f 6e28 696d 6167 6529  _ignition(image)
-00023550: 3a0a 2020 2020 2020 2020 2020 2020 636d  :.            cm
-00023560: 6420 3d20 7761 6974 636f 6d6d 616e 6420  d = waitcommand 
-00023570: 6f72 2027 7375 646f 206a 6f75 726e 616c  or 'sudo journal
-00023580: 6374 6c20 2d2d 616c 6c20 2d2d 6e6f 2d70  ctl --all --no-p
-00023590: 6167 6572 270a 2020 2020 2020 2020 656c  ager'.        el
-000235a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000235b0: 636d 6420 3d20 7761 6974 636f 6d6d 616e  cmd = waitcomman
-000235c0: 6420 6f72 2066 2273 7564 6f20 7461 696c  d or f"sudo tail
-000235d0: 202d 6e20 3530 207b 636f 6d6d 6f6e 2e67   -n 50 {common.g
-000235e0: 6574 5f63 6c6f 7564 696e 6974 6669 6c65  et_cloudinitfile
-000235f0: 2869 6d61 6765 297d 220a 2020 2020 2020  (image)}".      
-00023600: 2020 7573 6572 2c20 6970 2c20 766d 706f    user, ip, vmpo
-00023610: 7274 203d 204e 6f6e 652c 204e 6f6e 652c  rt = None, None,
-00023620: 204e 6f6e 650a 2020 2020 2020 2020 686f   None.        ho
-00023630: 7374 6970 203d 204e 6f6e 650a 2020 2020  stip = None.    
-00023640: 2020 2020 7469 6d65 6f75 7420 3d20 300a      timeout = 0.
-00023650: 2020 2020 2020 2020 7768 696c 6520 6970          while ip
-00023660: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00023670: 2020 2020 2020 696e 666f 203d 206b 2e69        info = k.i
-00023680: 6e66 6f28 6e61 6d65 290a 2020 2020 2020  nfo(name).      
-00023690: 2020 2020 2020 6966 2063 6f6e 6669 672e        if config.
-000236a0: 7479 7065 203d 3d20 2770 6163 6b65 7427  type == 'packet'
-000236b0: 2061 6e64 2069 6e66 6f2e 6765 7428 2773   and info.get('s
-000236c0: 7461 7475 7327 2920 213d 2027 6163 7469  tatus') != 'acti
-000236d0: 7665 273a 0a20 2020 2020 2020 2020 2020  ve':.           
-000236e0: 2020 2020 2077 6172 6e69 6e67 2822 5761       warning("Wa
-000236f0: 6974 696e 6720 666f 7220 6e6f 6465 2074  iting for node t
-00023700: 6f20 6265 2061 6374 6976 6522 290a 2020  o be active").  
-00023710: 2020 2020 2020 2020 2020 2020 2020 6970                ip
-00023720: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00023730: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00023740: 2020 2020 2020 2020 2020 7573 6572 2c20            user, 
-00023750: 6970 203d 2063 6f6e 6669 672e 766d 7573  ip = config.vmus
-00023760: 6572 206f 7220 696e 666f 2e67 6574 2827  er or info.get('
-00023770: 7573 6572 2729 2c20 696e 666f 2e67 6574  user'), info.get
-00023780: 2827 6970 2729 0a20 2020 2020 2020 2020  ('ip').         
-00023790: 2020 2020 2020 2069 6620 636f 6e66 6967         if config
-000237a0: 2e74 7970 6520 3d3d 2027 6b75 6265 7669  .type == 'kubevi
-000237b0: 7274 273a 0a20 2020 2020 2020 2020 2020  rt':.           
-000237c0: 2020 2020 2020 2020 2069 6620 6b2e 6163           if k.ac
-000237d0: 6365 7373 5f6d 6f64 6520 3d3d 2027 4e6f  cess_mode == 'No
-000237e0: 6465 506f 7274 273a 0a20 2020 2020 2020  dePort':.       
-000237f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023800: 2076 6d70 6f72 7420 3d20 696e 666f 2e67   vmport = info.g
-00023810: 6574 2827 6e6f 6465 706f 7274 2729 0a20  et('nodeport'). 
-00023820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023830: 2020 2020 2020 2069 6620 686f 7374 6970         if hostip
-00023840: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00023850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023860: 2020 2020 2020 686f 7374 6970 203d 206b        hostip = k
-00023870: 2e6e 6f64 655f 686f 7374 286e 616d 653d  .node_host(name=
-00023880: 696e 666f 2e67 6574 2827 686f 7374 2729  info.get('host')
-00023890: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000238a0: 2020 2020 2020 2020 2020 6970 203d 2068            ip = h
-000238b0: 6f73 7469 700a 2020 2020 2020 2020 2020  ostip.          
-000238c0: 2020 2020 2020 2020 2020 656c 6966 206b            elif k
-000238d0: 2e61 6363 6573 735f 6d6f 6465 203d 3d20  .access_mode == 
-000238e0: 274c 6f61 6442 616c 616e 6365 7227 3a0a  'LoadBalancer':.
-000238f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023900: 2020 2020 2020 2020 6970 203d 2069 6e66          ip = inf
-00023910: 6f2e 6765 7428 276c 6f61 6462 616c 616e  o.get('loadbalan
-00023920: 6365 7269 7027 290a 2020 2020 2020 2020  cerip').        
-00023930: 2020 2020 2020 2020 6966 2075 7365 7220          if user 
-00023940: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00023950: 6970 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ip is not None:.
-00023960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023970: 2020 2020 6966 2063 6f6e 6669 672e 7479      if config.ty
-00023980: 7065 203d 3d20 276f 7065 6e73 7461 636b  pe == 'openstack
-00023990: 2720 616e 6420 696e 666f 2e67 6574 2827  ' and info.get('
-000239a0: 7072 6976 6174 6569 7027 2920 3d3d 2069  privateip') == i
-000239b0: 7020 616e 6420 6b2e 6578 7465 726e 616c  p and k.external
-000239c0: 5f6e 6574 776f 726b 2069 7320 6e6f 7420  _network is not 
-000239d0: 4e6f 6e65 5c0a 2020 2020 2020 2020 2020  None\.          
-000239e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000239f0: 2020 616e 6420 696e 666f 2e67 6574 2827    and info.get('
-00023a00: 6e65 7473 2729 5b30 5d5b 276e 6574 275d  nets')[0]['net']
-00023a10: 2021 3d20 6b2e 6578 7465 726e 616c 5f6e   != k.external_n
-00023a20: 6574 776f 726b 3a0a 2020 2020 2020 2020  etwork:.        
-00023a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a40: 7761 726e 696e 6728 2257 6169 7469 6e67  warning("Waiting
-00023a50: 2066 6f72 2066 6c6f 6174 696e 6720 6970   for floating ip
-00023a60: 2069 6e73 7465 6164 206f 6620 6120 7072   instead of a pr
-00023a70: 6976 6174 6520 6970 2e2e 2e22 290a 2020  ivate ip...").  
-00023a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a90: 2020 2020 2020 6970 203d 204e 6f6e 650a        ip = None.
+0001f200: 7761 726e 696e 6728 224d 6973 7369 6e67  warning("Missing
+0001f210: 2069 702e 2053 6b69 7070 696e 6721 2229   ip. Skipping!")
+0001f220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f230: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+0001f240: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+0001f250: 6e73 6e65 7420 6973 204e 6f6e 653a 0a20  nsnet is None:. 
+0001f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f270: 2020 2077 6172 6e69 6e67 2822 4d69 7373     warning("Miss
+0001f280: 696e 6720 6e65 742e 2053 6b69 7070 696e  ing net. Skippin
+0001f290: 6721 2229 0a20 2020 2020 2020 2020 2020  g!").           
+0001f2a0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0001f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2c0: 7a2e 7265 7365 7276 655f 646e 7328 6e61  z.reserve_dns(na
+0001f2d0: 6d65 3d64 6e73 656e 7472 792c 206e 6574  me=dnsentry, net
+0001f2e0: 733d 5b64 6e73 6e65 745d 2c20 646f 6d61  s=[dnsnet], doma
+0001f2f0: 696e 3d64 6e73 646f 6d61 696e 2c20 6970  in=dnsdomain, ip
+0001f300: 3d64 6e73 6970 2c20 616c 6961 733d 646e  =dnsip, alias=dn
+0001f310: 7361 6c69 6173 2c20 666f 7263 653d 5472  salias, force=Tr
+0001f320: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0001f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f340: 2020 7072 696d 6172 793d 5472 7565 290a    primary=True).
+0001f350: 2020 2020 2020 2020 6966 2061 6e73 6962          if ansib
+0001f360: 6c65 656e 7472 6965 7320 616e 6420 6e6f  leentries and no
+0001f370: 7420 6f6e 6c79 6173 7365 7473 3a0a 2020  t onlyassets:.  
+0001f380: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0001f390: 206e 6577 766d 733a 0a20 2020 2020 2020   newvms:.       
+0001f3a0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0001f3b0: 2822 416e 7369 626c 6520 736b 6970 7065  ("Ansible skippe
+0001f3c0: 6420 6173 206e 6f20 6e65 7720 766d 2077  d as no new vm w
+0001f3d0: 6974 6869 6e20 706c 6179 626f 6f6b 2070  ithin playbook p
+0001f3e0: 726f 7669 7369 6f6e 6564 2229 0a20 2020  rovisioned").   
+0001f3f0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001f400: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
+0001f410: 666f 7220 656e 7472 7920 696e 2073 6f72  for entry in sor
+0001f420: 7465 6428 616e 7369 626c 6565 6e74 7269  ted(ansibleentri
+0001f430: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
+0001f440: 2020 2020 205f 616e 7369 626c 6520 3d20       _ansible = 
+0001f450: 656e 7472 6965 735b 656e 7472 795d 0a20  entries[entry]. 
+0001f460: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001f470: 6620 2770 6c61 7962 6f6f 6b27 206e 6f74  f 'playbook' not
+0001f480: 2069 6e20 5f61 6e73 6962 6c65 3a0a 2020   in _ansible:.  
+0001f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4a0: 2020 6572 726f 7228 224d 6973 7369 6e67    error("Missing
+0001f4b0: 2050 6c61 7962 6f6f 6b20 666f 7220 616e   Playbook for an
+0001f4c0: 7369 626c 652e 4967 6e6f 7269 6e67 2e2e  sible.Ignoring..
+0001f4d0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0001f4e0: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+0001f4f0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+0001f500: 2020 2020 706c 6179 626f 6f6b 203d 205f      playbook = _
+0001f510: 616e 7369 626c 655b 2770 6c61 7962 6f6f  ansible['playboo
+0001f520: 6b27 5d0a 2020 2020 2020 2020 2020 2020  k'].            
+0001f530: 2020 2020 7665 7262 6f73 6520 3d20 5f61      verbose = _a
+0001f540: 6e73 6962 6c65 5b27 7665 7262 6f73 6527  nsible['verbose'
+0001f550: 5d20 6966 2027 7665 7262 6f73 6527 2069  ] if 'verbose' i
+0001f560: 6e20 5f61 6e73 6962 6c65 2065 6c73 6520  n _ansible else 
+0001f570: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0001f580: 2020 2020 2020 6772 6f75 7073 203d 205f        groups = _
+0001f590: 616e 7369 626c 652e 6765 7428 2767 726f  ansible.get('gro
+0001f5a0: 7570 7327 2c20 7b7d 290a 2020 2020 2020  ups', {}).      
+0001f5b0: 2020 2020 2020 2020 2020 7573 6572 203d            user =
+0001f5c0: 205f 616e 7369 626c 652e 6765 7428 2775   _ansible.get('u
+0001f5d0: 7365 7227 290a 2020 2020 2020 2020 2020  ser').          
+0001f5e0: 2020 2020 2020 7661 7269 6162 6c65 7320        variables 
+0001f5f0: 3d20 5f61 6e73 6962 6c65 2e67 6574 2827  = _ansible.get('
+0001f600: 7661 7269 6162 6c65 7327 2c20 7b7d 290a  variables', {}).
+0001f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f620: 7461 7267 6574 766d 7320 3d20 5b76 6d20  targetvms = [vm 
+0001f630: 666f 7220 766d 2069 6e20 5f61 6e73 6962  for vm in _ansib
+0001f640: 6c65 5b27 766d 7327 5d20 6966 2076 6d20  le['vms'] if vm 
+0001f650: 696e 206e 6577 766d 735d 2069 6620 2776  in newvms] if 'v
+0001f660: 6d73 2720 696e 205f 616e 7369 626c 6520  ms' in _ansible 
+0001f670: 656c 7365 206e 6577 766d 730a 2020 2020  else newvms.    
+0001f680: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001f690: 6f74 2074 6172 6765 7476 6d73 3a0a 2020  ot targetvms:.  
+0001f6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f6b0: 2020 7761 726e 696e 6728 2241 6e73 6962    warning("Ansib
+0001f6c0: 6c65 2073 6b69 7070 6564 2061 7320 6e6f  le skipped as no
+0001f6d0: 206e 6577 2076 6d20 7769 7468 696e 2070   new vm within p
+0001f6e0: 6c61 7962 6f6f 6b20 7072 6f76 6973 696f  laybook provisio
+0001f6f0: 6e65 6422 290a 2020 2020 2020 2020 2020  ned").          
+0001f700: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001f710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f720: 2061 6e73 6962 6c65 636f 6d6d 616e 6420   ansiblecommand 
+0001f730: 3d20 2261 6e73 6962 6c65 2d70 6c61 7962  = "ansible-playb
+0001f740: 6f6f 6b22 0a20 2020 2020 2020 2020 2020  ook".           
+0001f750: 2020 2020 2069 6620 7665 7262 6f73 653a       if verbose:
+0001f760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f770: 2020 2020 2061 6e73 6962 6c65 636f 6d6d       ansiblecomm
+0001f780: 616e 6420 2b3d 2022 202d 7676 7622 0a20  and += " -vvv". 
+0001f790: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001f7a0: 6e76 656e 746f 7279 6669 6c65 203d 2066  nventoryfile = f
+0001f7b0: 222f 746d 702f 7b70 6c61 6e7d 2e69 6e76  "/tmp/{plan}.inv
+0001f7c0: 2e79 616d 6c22 2069 6620 7365 6c66 2e79  .yaml" if self.y
+0001f7d0: 616d 6c69 6e76 656e 746f 7279 2065 6c73  amlinventory els
+0001f7e0: 6520 6622 2f74 6d70 2f7b 706c 616e 7d2e  e f"/tmp/{plan}.
+0001f7f0: 696e 7622 0a20 2020 2020 2020 2020 2020  inv".           
+0001f800: 2020 2020 2061 6e73 6962 6c65 7574 696c       ansibleutil
+0001f810: 732e 6d61 6b65 5f70 6c61 6e5f 696e 7665  s.make_plan_inve
+0001f820: 6e74 6f72 7928 766d 735f 746f 5f68 6f73  ntory(vms_to_hos
+0001f830: 742c 2070 6c61 6e2c 2074 6172 6765 7476  t, plan, targetv
+0001f840: 6d73 2c20 6772 6f75 7073 3d67 726f 7570  ms, groups=group
+0001f850: 732c 2075 7365 723d 7573 6572 2c0a 2020  s, user=user,.  
+0001f860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f880: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+0001f890: 616d 6c69 6e76 656e 746f 7279 3d73 656c  amlinventory=sel
+0001f8a0: 662e 7961 6d6c 696e 7665 6e74 6f72 792c  f.yamlinventory,
+0001f8b0: 2074 756e 6e65 6c3d 7365 6c66 2e74 756e   tunnel=self.tun
+0001f8c0: 6e65 6c2c 0a20 2020 2020 2020 2020 2020  nel,.           
+0001f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8f0: 2020 2020 2020 7475 6e6e 656c 686f 7374        tunnelhost
+0001f900: 3d73 656c 662e 7475 6e6e 656c 686f 7374  =self.tunnelhost
+0001f910: 2c20 7475 6e6e 656c 7573 6572 3d73 656c  , tunneluser=sel
+0001f920: 662e 7475 6e6e 656c 7573 6572 2c0a 2020  f.tunneluser,.  
+0001f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f950: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001f960: 756e 6e65 6c70 6f72 743d 7365 6c66 2e74  unnelport=self.t
+0001f970: 756e 6e65 6c70 6f72 742c 2069 6e73 6563  unnelport, insec
+0001f980: 7572 653d 7365 6c66 2e69 6e73 6563 7572  ure=self.insecur
+0001f990: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001f9a0: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+0001f9b0: 682e 6578 6973 7473 2827 7e2f 2e61 6e73  h.exists('~/.ans
+0001f9c0: 6962 6c65 2e63 6667 2729 3a0a 2020 2020  ible.cfg'):.    
+0001f9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f9e0: 616e 7369 626c 6563 6f6e 6669 6720 3d20  ansibleconfig = 
+0001f9f0: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
+0001fa00: 6572 2827 7e2f 2e61 6e73 6962 6c65 2e63  er('~/.ansible.c
+0001fa10: 6667 2729 0a20 2020 2020 2020 2020 2020  fg').           
+0001fa20: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+0001fa30: 656e 2861 6e73 6962 6c65 636f 6e66 6967  en(ansibleconfig
+0001fa40: 2c20 2277 2229 2061 7320 663a 0a20 2020  , "w") as f:.   
+0001fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa60: 2020 2020 2066 2e77 7269 7465 2822 5b73       f.write("[s
+0001fa70: 7368 5f63 6f6e 6e65 6374 696f 6e5d 5c6e  sh_connection]\n
+0001fa80: 7265 7472 6965 733d 3130 5c6e 2229 0a20  retries=10\n"). 
+0001fa90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001faa0: 6620 7661 7269 6162 6c65 733a 0a20 2020  f variables:.   
+0001fab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fac0: 2076 6172 7366 696c 6520 3d20 6622 2f74   varsfile = f"/t
+0001fad0: 6d70 2f7b 706c 616e 7d2e 7661 7273 2e79  mp/{plan}.vars.y
+0001fae0: 6d6c 220a 2020 2020 2020 2020 2020 2020  ml".            
+0001faf0: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
+0001fb00: 6e28 7661 7273 6669 6c65 2c20 2777 2729  n(varsfile, 'w')
+0001fb10: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
+0001fb20: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+0001fb30: 616d 6c2e 6475 6d70 2876 6172 6961 626c  aml.dump(variabl
+0001fb40: 6573 2c20 662c 2064 6566 6175 6c74 5f66  es, f, default_f
+0001fb50: 6c6f 775f 7374 796c 653d 4661 6c73 6529  low_style=False)
+0001fb60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fb70: 2020 2020 2061 6e73 6962 6c65 636f 6d6d       ansiblecomm
+0001fb80: 616e 6420 2b3d 2066 2220 2d2d 6578 7472  and += f" --extr
+0001fb90: 612d 7661 7273 2040 7b76 6172 7366 696c  a-vars @{varsfil
+0001fba0: 657d 220a 2020 2020 2020 2020 2020 2020  e}".            
+0001fbb0: 2020 2020 616e 7369 626c 6563 6f6d 6d61      ansiblecomma
+0001fbc0: 6e64 202b 3d20 6622 202d 6920 7b69 6e76  nd += f" -i {inv
+0001fbd0: 656e 746f 7279 6669 6c65 7d20 7b70 6c61  entoryfile} {pla
+0001fbe0: 7962 6f6f 6b7d 220a 2020 2020 2020 2020  ybook}".        
+0001fbf0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0001fc00: 2252 756e 6e69 6e67 3a20 7b61 6e73 6962  "Running: {ansib
+0001fc10: 6c65 636f 6d6d 616e 647d 2229 0a20 2020  lecommand}").   
+0001fc20: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+0001fc30: 7379 7374 656d 2861 6e73 6962 6c65 636f  system(ansibleco
+0001fc40: 6d6d 616e 6429 0a20 2020 2020 2020 2069  mmand).        i
+0001fc50: 6620 616e 7369 626c 6520 616e 6420 6e6f  f ansible and no
+0001fc60: 7420 6f6e 6c79 6173 7365 7473 3a0a 2020  t onlyassets:.  
+0001fc70: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+0001fc80: 2822 4465 706c 6f79 696e 6720 416e 7369  ("Deploying Ansi
+0001fc90: 626c 6520 496e 7665 6e74 6f72 792e 2e2e  ble Inventory...
+0001fca0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+0001fcb0: 6e76 656e 746f 7279 6669 6c65 203d 2066  nventoryfile = f
+0001fcc0: 222f 746d 702f 7b70 6c61 6e7d 2e69 6e76  "/tmp/{plan}.inv
+0001fcd0: 2e79 616d 6c22 2069 6620 7365 6c66 2e79  .yaml" if self.y
+0001fce0: 616d 6c69 6e76 656e 746f 7279 2065 6c73  amlinventory els
+0001fcf0: 6520 6622 2f74 6d70 2f7b 706c 616e 7d2e  e f"/tmp/{plan}.
+0001fd00: 696e 7622 0a20 2020 2020 2020 2020 2020  inv".           
+0001fd10: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+0001fd20: 7473 2869 6e76 656e 746f 7279 6669 6c65  ts(inventoryfile
+0001fd30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001fd40: 2020 2070 7072 696e 7428 6622 496e 7665     pprint(f"Inve
+0001fd50: 6e74 6f72 7920 696e 207b 696e 7665 6e74  ntory in {invent
+0001fd60: 6f72 7966 696c 657d 2073 6b69 7070 6564  oryfile} skipped
+0001fd70: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
+0001fd80: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001fd90: 2020 2020 2020 7070 7269 6e74 2866 2243        pprint(f"C
+0001fda0: 7265 6174 696e 6720 616e 7369 626c 6520  reating ansible 
+0001fdb0: 696e 7665 6e74 6f72 7920 666f 7220 706c  inventory for pl
+0001fdc0: 616e 207b 706c 616e 7d20 696e 207b 696e  an {plan} in {in
+0001fdd0: 7665 6e74 6f72 7966 696c 657d 2229 0a20  ventoryfile}"). 
+0001fde0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0001fdf0: 6d73 203d 205b 5d0a 2020 2020 2020 2020  ms = [].        
+0001fe00: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
+0001fe10: 6e20 736f 7274 6564 286b 2e6c 6973 7428  n sorted(k.list(
+0001fe20: 292c 206b 6579 3d6c 616d 6264 6120 783a  ), key=lambda x:
+0001fe30: 2078 5b27 6e61 6d65 275d 293a 0a20 2020   x['name']):.   
+0001fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe50: 206e 616d 6520 3d20 766d 5b27 6e61 6d65   name = vm['name
+0001fe60: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+0001fe70: 2020 2020 2020 2064 6573 6372 6970 7469         descripti
+0001fe80: 6f6e 203d 2076 6d5b 2770 6c61 6e27 5d0a  on = vm['plan'].
+0001fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fea0: 2020 2020 6966 2064 6573 6372 6970 7469      if descripti
+0001feb0: 6f6e 203d 3d20 706c 616e 3a0a 2020 2020  on == plan:.    
+0001fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fed0: 2020 2020 766d 732e 6170 7065 6e64 286e      vms.append(n
+0001fee0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+0001fef0: 2020 2020 2061 6e73 6962 6c65 7574 696c       ansibleutil
+0001ff00: 732e 6d61 6b65 5f70 6c61 6e5f 696e 7665  s.make_plan_inve
+0001ff10: 6e74 6f72 7928 766d 735f 746f 5f68 6f73  ntory(vms_to_hos
+0001ff20: 742c 2070 6c61 6e2c 2076 6d73 2c20 7961  t, plan, vms, ya
+0001ff30: 6d6c 696e 7665 6e74 6f72 793d 7365 6c66  mlinventory=self
+0001ff40: 2e79 616d 6c69 6e76 656e 746f 7279 2c0a  .yamlinventory,.
+0001ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff80: 2069 6e73 6563 7572 653d 7365 6c66 2e69   insecure=self.i
+0001ff90: 6e73 6563 7572 6529 0a20 2020 2020 2020  nsecure).       
+0001ffa0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001ffb0: 7b27 7265 7375 6c74 273a 2027 7375 6363  {'result': 'succ
+0001ffc0: 6573 7327 2c20 2770 6c61 6e27 3a20 706c  ess', 'plan': pl
+0001ffd0: 616e 7d0a 2020 2020 2020 2020 6966 206c  an}.        if l
+0001ffe0: 6273 2061 6e64 206e 6f74 206f 6e6c 7961  bs and not onlya
+0001fff0: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
+00020000: 2020 2064 6e73 636c 6965 6e74 7320 3d20     dnsclients = 
+00020010: 7b7d 0a20 2020 2020 2020 2020 2020 2070  {}.            p
+00020020: 7072 696e 7428 2244 6570 6c6f 7969 6e67  print("Deploying
+00020030: 204c 6f61 6462 616c 616e 6365 7273 2e2e   Loadbalancers..
+00020040: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00020050: 666f 7220 696e 6465 782c 206c 6265 6e74  for index, lbent
+00020060: 7279 2069 6e20 656e 756d 6572 6174 6528  ry in enumerate(
+00020070: 6c62 7329 3a0a 2020 2020 2020 2020 2020  lbs):.          
+00020080: 2020 2020 2020 6465 7461 696c 7320 3d20        details = 
+00020090: 656e 7472 6965 735b 6c62 656e 7472 795d  entries[lbentry]
+000200a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000200b0: 2070 6f72 7473 203d 2064 6574 6169 6c73   ports = details
+000200c0: 2e67 6574 2827 706f 7274 7327 2c20 5b5d  .get('ports', []
+000200d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000200e0: 2020 6966 206e 6f74 2070 6f72 7473 3a0a    if not ports:.
+000200f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020100: 2020 2020 6572 726f 7228 224d 6973 7369      error("Missi
+00020110: 6e67 2050 6f72 7473 2066 6f72 206c 6f61  ng Ports for loa
+00020120: 6462 616c 616e 6365 722e 204e 6f74 2063  dbalancer. Not c
+00020130: 7265 6174 696e 6720 6974 2e2e 2e22 290a  reating it...").
+00020140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020150: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+00020160: 2020 2020 2020 2020 2020 2063 6865 636b             check
+00020170: 7061 7468 203d 2064 6574 6169 6c73 2e67  path = details.g
+00020180: 6574 2827 6368 6563 6b70 6174 6827 2c20  et('checkpath', 
+00020190: 272f 2729 0a20 2020 2020 2020 2020 2020  '/').           
+000201a0: 2020 2020 2063 6865 636b 706f 7274 203d       checkport =
+000201b0: 2064 6574 6169 6c73 2e67 6574 2827 6368   details.get('ch
+000201c0: 6563 6b70 6f72 7427 2c20 3830 290a 2020  eckport', 80).  
+000201d0: 2020 2020 2020 2020 2020 2020 2020 616c                al
+000201e0: 6961 7320 3d20 6465 7461 696c 732e 6765  ias = details.ge
+000201f0: 7428 2761 6c69 6173 272c 205b 5d29 0a20  t('alias', []). 
+00020200: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00020210: 6f6d 6169 6e20 3d20 6465 7461 696c 732e  omain = details.
+00020220: 6765 7428 2764 6f6d 6169 6e27 290a 2020  get('domain').  
+00020230: 2020 2020 2020 2020 2020 2020 2020 646e                dn
+00020240: 7363 6c69 656e 7420 3d20 6465 7461 696c  sclient = detail
+00020250: 732e 6765 7428 2764 6e73 636c 6965 6e74  s.get('dnsclient
+00020260: 272c 206f 7665 7272 6964 6573 2e67 6574  ', overrides.get
+00020270: 2827 646e 7363 6c69 656e 7427 2929 0a20  ('dnsclient')). 
+00020280: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00020290: 6276 6d73 203d 2064 6574 6169 6c73 2e67  bvms = details.g
+000202a0: 6574 2827 766d 7327 2c20 5b5d 290a 2020  et('vms', []).  
+000202b0: 2020 2020 2020 2020 2020 2020 2020 6c62                lb
+000202c0: 6e65 7473 203d 2064 6574 6169 6c73 2e67  nets = details.g
+000202d0: 6574 2827 6e65 7473 272c 205b 2764 6566  et('nets', ['def
+000202e0: 6175 6c74 275d 290a 2020 2020 2020 2020  ault']).        
+000202f0: 2020 2020 2020 2020 696e 7465 726e 616c          internal
+00020300: 203d 2064 6574 6169 6c73 2e67 6574 2827   = details.get('
+00020310: 696e 7465 726e 616c 2729 0a20 2020 2020  internal').     
+00020320: 2020 2020 2020 2020 2020 2073 7562 6e65             subne
+00020330: 7469 6420 3d20 6465 7461 696c 732e 6765  tid = details.ge
+00020340: 7428 2773 7562 6e65 7469 6427 290a 2020  t('subnetid').  
+00020350: 2020 2020 2020 2020 2020 2020 2020 6970                ip
+00020360: 203d 2064 6574 6169 6c73 2e67 6574 2827   = details.get('
+00020370: 6970 2729 0a20 2020 2020 2020 2020 2020  ip').           
+00020380: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
+00020390: 5f6c 6f61 6462 616c 616e 6365 7228 6c62  _loadbalancer(lb
+000203a0: 656e 7472 792c 206e 6574 733d 6c62 6e65  entry, nets=lbne
+000203b0: 7473 2c20 706f 7274 733d 706f 7274 732c  ts, ports=ports,
+000203c0: 2063 6865 636b 7061 7468 3d63 6865 636b   checkpath=check
+000203d0: 7061 7468 2c20 766d 733d 6c62 766d 732c  path, vms=lbvms,
+000203e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000203f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020400: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
+00020410: 3d64 6f6d 6169 6e2c 2070 6c61 6e3d 706c  =domain, plan=pl
+00020420: 616e 2c20 6368 6563 6b70 6f72 743d 6368  an, checkport=ch
+00020430: 6563 6b70 6f72 742c 2061 6c69 6173 3d61  eckport, alias=a
+00020440: 6c69 6173 2c0a 2020 2020 2020 2020 2020  lias,.          
+00020450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020460: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00020470: 6e74 6572 6e61 6c3d 696e 7465 726e 616c  nternal=internal
+00020480: 2c20 646e 7363 6c69 656e 743d 646e 7363  , dnsclient=dnsc
+00020490: 6c69 656e 742c 2073 7562 6e65 7469 643d  lient, subnetid=
+000204a0: 7375 626e 6574 6964 2c20 6970 3d69 7029  subnetid, ip=ip)
+000204b0: 0a20 2020 2020 2020 2069 6620 7367 7320  .        if sgs 
+000204c0: 616e 6420 6e6f 7420 6f6e 6c79 6173 7365  and not onlyasse
+000204d0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+000204e0: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
+000204f0: 6720 5365 6375 7269 7479 4772 6f75 7073  g SecurityGroups
+00020500: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00020510: 2020 666f 7220 7367 2069 6e20 7367 733a    for sg in sgs:
+00020520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020530: 2064 6574 6169 6c73 203d 2065 6e74 7269   details = entri
+00020540: 6573 5b73 675d 0a20 2020 2020 2020 2020  es[sg].         
+00020550: 2020 2020 2020 206e 616d 650a 2020 2020         name.    
+00020560: 2020 2020 2020 2020 2020 2020 706f 7274              port
+00020570: 7320 3d20 6465 7461 696c 732e 6765 7428  s = details.get(
+00020580: 2770 6f72 7473 272c 205b 5d29 0a20 2020  'ports', []).   
+00020590: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000205a0: 6e6f 7420 706f 7274 733a 0a20 2020 2020  not ports:.     
+000205b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000205c0: 7272 6f72 2822 4d69 7373 696e 6720 506f  rror("Missing Po
+000205d0: 7274 7320 666f 7220 7367 732e 204e 6f74  rts for sgs. Not
+000205e0: 2063 7265 6174 696e 6720 6974 2e2e 2e22   creating it..."
+000205f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020600: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+00020610: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00020620: 662e 6372 6561 7465 5f73 6563 7572 6974  f.create_securit
+00020630: 795f 6772 6f75 7028 7367 2c20 7b27 706f  y_group(sg, {'po
+00020640: 7274 7327 3a20 706f 7274 737d 290a 2020  rts': ports}).  
+00020650: 2020 2020 2020 6966 2077 6f72 6b66 6c6f        if workflo
+00020660: 7765 6e74 7269 6573 2061 6e64 206e 6f74  wentries and not
+00020670: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
+00020680: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00020690: 2244 6570 6c6f 7969 6e67 2057 6f72 6b66  "Deploying Workf
+000206a0: 6c6f 7720 456e 7472 6965 732e 2e2e 2229  low Entries...")
+000206b0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000206c0: 2077 6f72 6b66 6c6f 7720 696e 2077 6f72   workflow in wor
+000206d0: 6b66 6c6f 7765 6e74 7269 6573 3a0a 2020  kflowentries:.  
+000206e0: 2020 2020 2020 2020 2020 2020 2020 776f                wo
+000206f0: 726b 666c 6f77 5f6f 7665 7272 6964 6573  rkflow_overrides
+00020700: 203d 206f 7665 7272 6964 6573 2e63 6f70   = overrides.cop
+00020710: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+00020720: 2020 2020 776f 726b 666c 6f77 5f6f 7665      workflow_ove
+00020730: 7272 6964 6573 2e75 7064 6174 6528 656e  rrides.update(en
+00020740: 7472 6965 735b 776f 726b 666c 6f77 5d29  tries[workflow])
+00020750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020760: 2073 656c 662e 6372 6561 7465 5f77 6f72   self.create_wor
+00020770: 6b66 6c6f 7728 776f 726b 666c 6f77 2c20  kflow(workflow, 
+00020780: 6f76 6572 7269 6465 733d 776f 726b 666c  overrides=workfl
+00020790: 6f77 5f6f 7665 7272 6964 6573 290a 2020  ow_overrides).  
+000207a0: 2020 2020 2020 7265 7475 726e 6461 7461        returndata
+000207b0: 203d 207b 2772 6573 756c 7427 3a20 2773   = {'result': 's
+000207c0: 7563 6365 7373 272c 2027 706c 616e 273a  uccess', 'plan':
+000207d0: 2070 6c61 6e7d 0a20 2020 2020 2020 2072   plan}.        r
+000207e0: 6574 7572 6e64 6174 615b 276e 6577 766d  eturndata['newvm
+000207f0: 7327 5d20 3d20 6e65 7776 6d73 2069 6620  s'] = newvms if 
+00020800: 6e65 7776 6d73 2065 6c73 6520 5b5d 0a20  newvms else []. 
+00020810: 2020 2020 2020 2072 6574 7572 6e64 6174         returndat
+00020820: 615b 2765 7869 7374 696e 6776 6d73 275d  a['existingvms']
+00020830: 203d 2065 7869 7374 696e 6776 6d73 2069   = existingvms i
+00020840: 6620 6578 6973 7469 6e67 766d 7320 656c  f existingvms el
+00020850: 7365 205b 5d0a 2020 2020 2020 2020 7265  se [].        re
+00020860: 7475 726e 6461 7461 5b27 6661 696c 6564  turndata['failed
+00020870: 766d 7327 5d20 3d20 6661 696c 6564 766d  vms'] = failedvm
+00020880: 7320 6966 2066 6169 6c65 6476 6d73 2065  s if failedvms e
+00020890: 6c73 6520 5b5d 0a20 2020 2020 2020 2072  lse [].        r
+000208a0: 6574 7572 6e64 6174 615b 2761 7373 6574  eturndata['asset
+000208b0: 7327 5d20 3d20 6e65 7761 7373 6574 7320  s'] = newassets 
+000208c0: 6966 206e 6577 6173 7365 7473 2065 6c73  if newassets els
+000208d0: 6520 5b5d 0a20 2020 2020 2020 2069 6620  e [].        if 
+000208e0: 6661 696c 6564 766d 733a 0a20 2020 2020  failedvms:.     
+000208f0: 2020 2020 2020 2072 6574 7572 6e64 6174         returndat
+00020900: 615b 2772 6573 756c 7427 5d20 3d20 2766  a['result'] = 'f
+00020910: 6169 6c75 7265 270a 2020 2020 2020 2020  ailure'.        
+00020920: 2020 2020 6661 696c 6564 6e61 6d65 7320      failednames 
+00020930: 3d20 272c 272e 6a6f 696e 285b 765b 276e  = ','.join([v['n
+00020940: 616d 6527 5d20 666f 7220 7620 696e 2066  ame'] for v in f
+00020950: 6169 6c65 6476 6d73 5d29 0a20 2020 2020  ailedvms]).     
+00020960: 2020 2020 2020 2072 6574 7572 6e64 6174         returndat
+00020970: 615b 2772 6561 736f 6e27 5d20 3d20 6627  a['reason'] = f'
+00020980: 5468 6520 666f 6c6c 6f77 696e 6720 766d  The following vm
+00020990: 7320 6661 696c 6564 3a20 7b66 6169 6c65  s failed: {faile
+000209a0: 646e 616d 6573 7d27 0a20 2020 2020 2020  dnames}'.       
+000209b0: 2069 6620 6765 7462 6163 6b20 6f72 2074   if getback or t
+000209c0: 6f63 6c65 616e 3a0a 2020 2020 2020 2020  oclean:.        
+000209d0: 2020 2020 6f73 2e63 6864 6972 2827 2e2e      os.chdir('..
+000209e0: 2729 0a20 2020 2020 2020 2069 6620 746f  ').        if to
+000209f0: 636c 6561 6e3a 0a20 2020 2020 2020 2020  clean:.         
+00020a00: 2020 2072 6d74 7265 6528 7061 7468 290a     rmtree(path).
+00020a10: 2020 2020 2020 2020 6966 2069 6e70 7574          if input
+00020a20: 7374 7269 6e67 2069 7320 6e6f 7420 4e6f  string is not No
+00020a30: 6e65 2061 6e64 206f 732e 7061 7468 2e65  ne and os.path.e
+00020a40: 7869 7374 7328 6622 7465 6d70 5f70 6c61  xists(f"temp_pla
+00020a50: 6e5f 7b70 6c61 6e7d 2e79 6d6c 2229 3a0a  n_{plan}.yml"):.
+00020a60: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
+00020a70: 656d 6f76 6528 6622 7465 6d70 5f70 6c61  emove(f"temp_pla
+00020a80: 6e5f 7b70 6c61 6e7d 2e79 6d6c 2229 0a20  n_{plan}.yml"). 
+00020a90: 2020 2020 2020 2066 6f72 2065 6e74 7279         for entry
+00020aa0: 2069 6e20 6173 796e 6377 6169 7476 6d73   in asyncwaitvms
+00020ab0: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
+00020ac0: 6d65 2c20 6669 6e69 7368 6669 6c65 7320  me, finishfiles 
+00020ad0: 3d20 656e 7472 795b 276e 616d 6527 5d2c  = entry['name'],
+00020ae0: 2065 6e74 7279 5b27 6669 6e69 7368 6669   entry['finishfi
+00020af0: 6c65 7327 5d0a 2020 2020 2020 2020 2020  les'].          
+00020b00: 2020 7761 6974 636f 6d6d 616e 642c 2077    waitcommand, w
+00020b10: 6169 7474 696d 656f 7574 203d 2065 6e74  aittimeout = ent
+00020b20: 7279 5b27 7761 6974 636f 6d6d 616e 6427  ry['waitcommand'
+00020b30: 5d2c 2065 6e74 7279 5b27 7761 6974 7469  ], entry['waitti
+00020b40: 6d65 6f75 7427 5d0a 2020 2020 2020 2020  meout'].        
+00020b50: 2020 2020 766d 636c 6965 6e74 203d 2065      vmclient = e
+00020b60: 6e74 7279 5b27 766d 636c 6965 6e74 275d  ntry['vmclient']
+00020b70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00020b80: 662e 7761 6974 5f66 696e 6973 6828 6e61  f.wait_finish(na
+00020b90: 6d65 2c20 7761 6974 636f 6d6d 616e 643d  me, waitcommand=
+00020ba0: 7761 6974 636f 6d6d 616e 642c 2077 6169  waitcommand, wai
+00020bb0: 7474 696d 656f 7574 3d77 6169 7474 696d  ttimeout=waittim
+00020bc0: 656f 7574 2c20 766d 636c 6965 6e74 3d76  eout, vmclient=v
+00020bd0: 6d63 6c69 656e 7429 0a20 2020 2020 2020  mclient).       
+00020be0: 2020 2020 2069 6620 6669 6e69 7368 6669       if finishfi
+00020bf0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00020c00: 2020 2020 2073 656c 662e 6861 6e64 6c65       self.handle
+00020c10: 5f66 696e 6973 6866 696c 6573 286e 616d  _finishfiles(nam
+00020c20: 652c 2066 696e 6973 6866 696c 6573 2c20  e, finishfiles, 
+00020c30: 766d 636c 6965 6e74 3d76 6d63 6c69 656e  vmclient=vmclien
+00020c40: 7429 0a20 2020 2020 2020 2070 6f73 745f  t).        post_
+00020c50: 7363 7269 7074 203d 2066 277b 696e 7075  script = f'{inpu
+00020c60: 7464 6972 7d2f 6b63 6c69 5f70 6f73 742e  tdir}/kcli_post.
+00020c70: 7368 270a 2020 2020 2020 2020 6966 206f  sh'.        if o
+00020c80: 732e 7061 7468 2e65 7869 7374 7328 706f  s.path.exists(po
+00020c90: 7374 5f73 6372 6970 7429 3a0a 2020 2020  st_script):.    
+00020ca0: 2020 2020 2020 2020 6966 2070 6f73 743a          if post:
+00020cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020cc0: 2070 7072 696e 7428 2252 756e 6e69 6e67   pprint("Running
+00020cd0: 206b 636c 695f 706f 7374 2e73 6822 290a   kcli_post.sh").
+00020ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020cf0: 7769 7468 2054 656d 706f 7261 7279 4469  with TemporaryDi
+00020d00: 7265 6374 6f72 7928 2920 6173 2074 6d70  rectory() as tmp
+00020d10: 6469 723a 0a20 2020 2020 2020 2020 2020  dir:.           
+00020d20: 2020 2020 2020 2020 2070 6f73 745f 7363           post_sc
+00020d30: 7269 7074 203d 2073 656c 662e 7072 6f63  ript = self.proc
+00020d40: 6573 735f 696e 7075 7466 696c 6528 2778  ess_inputfile('x
+00020d50: 7878 272c 2070 6f73 745f 7363 7269 7074  xx', post_script
+00020d60: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
+00020d70: 7269 6465 7329 0a20 2020 2020 2020 2020  rides).         
+00020d80: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00020d90: 6f70 656e 2866 227b 746d 7064 6972 7d2f  open(f"{tmpdir}/
+00020da0: 706f 7374 2e73 6822 2c20 2777 2729 2061  post.sh", 'w') a
+00020db0: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
+00020dc0: 2020 2020 2020 2020 2020 2020 2066 2e77               f.w
+00020dd0: 7269 7465 2870 6f73 745f 7363 7269 7074  rite(post_script
+00020de0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020df0: 2020 2020 2020 706f 7374 5f72 756e 203d        post_run =
+00020e00: 2072 756e 2866 2762 6173 6820 7b74 6d70   run(f'bash {tmp
+00020e10: 6469 727d 2f70 6f73 742e 7368 272c 2073  dir}/post.sh', s
+00020e20: 6865 6c6c 3d54 7275 652c 2073 7464 6f75  hell=True, stdou
+00020e30: 743d 5049 5045 2c20 7374 6465 7272 3d53  t=PIPE, stderr=S
+00020e40: 5444 4f55 542c 0a20 2020 2020 2020 2020  TDOUT,.         
+00020e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e60: 2020 2020 2020 2020 2020 756e 6976 6572            univer
+00020e70: 7361 6c5f 6e65 776c 696e 6573 3d54 7275  sal_newlines=Tru
+00020e80: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00020e90: 2020 2020 2020 2069 6620 706f 7374 5f72         if post_r
+00020ea0: 756e 2e72 6574 7572 6e63 6f64 6520 213d  un.returncode !=
+00020eb0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00020ec0: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
+00020ed0: 3d20 6622 4973 7375 6520 7768 656e 2072  = f"Issue when r
+00020ee0: 756e 6e69 6e67 206b 636c 695f 706f 7374  unning kcli_post
+00020ef0: 2e73 6820 3a5c 6e7b 706f 7374 5f72 756e  .sh :\n{post_run
+00020f00: 2e73 7464 6f75 747d 220a 2020 2020 2020  .stdout}".      
+00020f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f20: 2020 6572 726f 7228 6d73 6729 0a20 2020    error(msg).   
+00020f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f40: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00020f50: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
+00020f60: 2c20 2772 6561 736f 6e27 3a20 6d73 677d  , 'reason': msg}
+00020f70: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00020f80: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00020f90: 2020 2077 6172 6e69 6e67 2822 536b 6970     warning("Skip
+00020fa0: 7069 6e67 206b 636c 695f 706f 7374 2e73  ping kcli_post.s
+00020fb0: 6820 6173 2072 6571 7565 7374 6564 2229  h as requested")
+00020fc0: 0a20 2020 2020 2020 2069 6620 6f76 6572  .        if over
+00020fd0: 7269 6465 732e 6765 7428 2774 656d 706b  rides.get('tempk
+00020fe0: 6579 6469 7227 2920 6973 206e 6f74 204e  eydir') is not N
+00020ff0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00021000: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+00021010: 7465 6d70 6b65 7964 6972 2729 2e63 6c65  tempkeydir').cle
+00021020: 616e 7570 2829 0a20 2020 2020 2020 2072  anup().        r
+00021030: 6574 7572 6e20 7265 7475 726e 6461 7461  eturn returndata
+00021040: 0a0a 2020 2020 6465 6620 6861 6e64 6c65  ..    def handle
+00021050: 5f68 6f73 7428 7365 6c66 2c20 706f 6f6c  _host(self, pool
+00021060: 3d4e 6f6e 652c 2069 6d61 6765 3d4e 6f6e  =None, image=Non
+00021070: 652c 2073 7769 7463 683d 4e6f 6e65 2c20  e, switch=None, 
+00021080: 646f 776e 6c6f 6164 3d46 616c 7365 2c0a  download=False,.
+00021090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000210a0: 2020 2020 7572 6c3d 4e6f 6e65 2c20 636d      url=None, cm
+000210b0: 643d 4e6f 6e65 2c20 7379 6e63 3d46 616c  d=None, sync=Fal
+000210c0: 7365 2c20 7369 7a65 3d4e 6f6e 652c 2061  se, size=None, a
+000210d0: 7263 683d 2778 3836 5f36 3427 2c0a 2020  rch='x86_64',.  
+000210e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000210f0: 2020 6b76 6d5f 6f70 656e 7374 6163 6b3d    kvm_openstack=
+00021100: 5472 7565 2c20 7268 636f 735f 636f 6d6d  True, rhcos_comm
+00021110: 6974 3d4e 6f6e 652c 2072 6863 6f73 5f69  it=None, rhcos_i
+00021120: 6e73 7461 6c6c 6572 3d46 616c 7365 293a  nstaller=False):
+00021130: 0a20 2020 2020 2020 2069 6620 646f 776e  .        if down
+00021140: 6c6f 6164 3a0a 2020 2020 2020 2020 2020  load:.          
+00021150: 2020 6b20 3d20 7365 6c66 2e6b 0a20 2020    k = self.k.   
+00021160: 2020 2020 2020 2020 2069 6620 706f 6f6c           if pool
+00021170: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00021180: 2020 2020 2020 2020 2020 706f 6f6c 203d            pool =
+00021190: 2073 656c 662e 706f 6f6c 0a20 2020 2020   self.pool.     
+000211a0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+000211b0: 7428 6622 5573 696e 6720 706f 6f6c 207b  t(f"Using pool {
+000211c0: 706f 6f6c 7d22 290a 2020 2020 2020 2020  pool}").        
+000211d0: 2020 2020 6966 2069 6d61 6765 2069 7320      if image is 
+000211e0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000211f0: 2020 2020 2020 2020 2020 6966 2075 726c            if url
+00021200: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00021210: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00021220: 2061 7263 6820 213d 2027 7838 365f 3634   arch != 'x86_64
+00021230: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00021240: 2020 2020 2020 2020 2020 2049 4d41 4745             IMAGE
+00021250: 532e 7570 6461 7465 287b 693a 2049 4d41  S.update({i: IMA
+00021260: 4745 535b 695d 2e72 6570 6c61 6365 2827  GES[i].replace('
+00021270: 7838 365f 3634 272c 2061 7263 6829 2e72  x86_64', arch).r
+00021280: 6570 6c61 6365 2827 616d 6436 3427 2c20  eplace('amd64', 
+00021290: 6172 6368 290a 2020 2020 2020 2020 2020  arch).          
+000212a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212b0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000212c0: 2069 2069 6e20 494d 4147 4553 7d29 0a20   i in IMAGES}). 
+000212d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212e0: 2020 2069 6620 696d 6167 6520 6e6f 7420     if image not 
+000212f0: 696e 2049 4d41 4745 533a 0a20 2020 2020  in IMAGES:.     
+00021300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021310: 2020 2065 7272 6f72 2866 2249 6d61 6765     error(f"Image
+00021320: 207b 696d 6167 657d 2068 6173 206e 6f20   {image} has no 
+00021330: 6173 736f 6369 6174 6564 2075 726c 2229  associated url")
+00021340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021350: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00021360: 7b27 7265 7375 6c74 273a 2027 6661 696c  {'result': 'fail
+00021370: 7572 6527 2c20 2772 6561 736f 6e27 3a20  ure', 'reason': 
+00021380: 2249 6e63 6f72 7265 6374 2069 6d61 6765  "Incorrect image
+00021390: 227d 0a20 2020 2020 2020 2020 2020 2020  "}.             
+000213a0: 2020 2020 2020 2075 726c 203d 2049 4d41         url = IMA
+000213b0: 4745 535b 696d 6167 655d 0a20 2020 2020  GES[image].     
+000213c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000213d0: 6d61 6765 5f74 7970 6520 3d20 276f 7065  mage_type = 'ope
+000213e0: 6e73 7461 636b 2720 6966 206b 766d 5f6f  nstack' if kvm_o
+000213f0: 7065 6e73 7461 636b 2061 6e64 2073 656c  penstack and sel
+00021400: 662e 7479 7065 203d 3d20 276b 766d 2720  f.type == 'kvm' 
+00021410: 656c 7365 2073 656c 662e 7479 7065 0a20  else self.type. 
+00021420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021430: 2020 2069 6620 6e6f 7420 6b76 6d5f 6f70     if not kvm_op
+00021440: 656e 7374 6163 6b20 616e 6420 7365 6c66  enstack and self
+00021450: 2e74 7970 6520 3d3d 2027 6b76 6d27 3a0a  .type == 'kvm':.
+00021460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021470: 2020 2020 2020 2020 696d 6167 6520 2b3d          image +=
+00021480: 2022 2d71 656d 7522 0a20 2020 2020 2020   "-qemu".       
+00021490: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000214a0: 2772 6863 6f73 2720 696e 2069 6d61 6765  'rhcos' in image
+000214b0: 2061 6e64 206e 6f74 2069 6d61 6765 2e65   and not image.e
+000214c0: 6e64 7377 6974 6828 2771 636f 7732 2e67  ndswith('qcow2.g
+000214d0: 7a27 293a 0a20 2020 2020 2020 2020 2020  z'):.           
+000214e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000214f0: 7268 636f 735f 636f 6d6d 6974 2069 7320  rhcos_commit is 
+00021500: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00021510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021520: 2020 2020 2020 7572 6c20 3d20 636f 6d6d        url = comm
+00021530: 6f6e 2e67 6574 5f63 6f6d 6d69 745f 7268  on.get_commit_rh
+00021540: 636f 7328 7268 636f 735f 636f 6d6d 6974  cos(rhcos_commit
+00021550: 2c20 5f74 7970 653d 696d 6167 655f 7479  , _type=image_ty
+00021560: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
+00021570: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00021580: 2072 6863 6f73 5f69 6e73 7461 6c6c 6572   rhcos_installer
+00021590: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000215a0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+000215b0: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
+000215c0: 202b 3d20 6627 3a7b 6f73 2e67 6574 6377   += f':{os.getcw
+000215d0: 6428 297d 270a 2020 2020 2020 2020 2020  d()}'.          
+000215e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000215f0: 2020 7572 6c20 3d20 636f 6d6d 6f6e 2e67    url = common.g
+00021600: 6574 5f69 6e73 7461 6c6c 6572 5f72 6863  et_installer_rhc
+00021610: 6f73 285f 7479 7065 3d69 6d61 6765 5f74  os(_type=image_t
+00021620: 7970 652c 2061 7263 683d 6172 6368 290a  ype, arch=arch).
+00021630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021640: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00021650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021660: 2020 2020 2020 2020 2020 6966 2061 7263            if arc
+00021670: 6820 213d 2027 7838 365f 3634 273a 0a20  h != 'x86_64':. 
+00021680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021690: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+000216a0: 726c 202b 3d20 6627 2d7b 6172 6368 7d27  rl += f'-{arch}'
+000216b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000216c0: 2020 2020 2020 2020 2020 2020 2075 726c               url
+000216d0: 203d 2063 6f6d 6d6f 6e2e 6765 745f 6c61   = common.get_la
+000216e0: 7465 7374 5f72 6863 6f73 2875 726c 2c20  test_rhcos(url, 
+000216f0: 5f74 7970 653d 696d 6167 655f 7479 7065  _type=image_type
+00021700: 2c20 6172 6368 3d61 7263 6829 0a20 2020  , arch=arch).   
+00021710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021720: 2069 6620 2766 636f 7327 2069 6e20 696d   if 'fcos' in im
+00021730: 6167 653a 0a20 2020 2020 2020 2020 2020  age:.           
+00021740: 2020 2020 2020 2020 2020 2020 2075 726c               url
+00021750: 203d 2063 6f6d 6d6f 6e2e 6765 745f 6c61   = common.get_la
+00021760: 7465 7374 5f66 636f 7328 7572 6c2c 205f  test_fcos(url, _
+00021770: 7479 7065 3d69 6d61 6765 5f74 7970 6529  type=image_type)
+00021780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021790: 2020 2020 2069 6620 696d 6167 6520 3d3d       if image ==
+000217a0: 2027 6665 646f 7261 6c61 7465 7374 273a   'fedoralatest':
+000217b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000217c0: 2020 2020 2020 2020 2075 726c 203d 2063           url = c
+000217d0: 6f6d 6d6f 6e2e 6765 745f 6c61 7465 7374  ommon.get_latest
+000217e0: 5f66 6564 6f72 6128 7572 6c29 0a20 2020  _fedora(url).   
+000217f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021800: 2069 6d61 6765 203d 206f 732e 7061 7468   image = os.path
+00021810: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
+00021820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021830: 2020 2020 2069 6620 696d 6167 652e 7374       if image.st
+00021840: 6172 7473 7769 7468 2827 7268 656c 2729  artswith('rhel')
+00021850: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00021860: 2020 2020 2020 2020 2020 6966 2027 7765            if 'we
+00021870: 6227 2069 6e20 7379 732e 6172 6776 5b30  b' in sys.argv[0
+00021880: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00021890: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000218a0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+000218b0: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
+000218c0: 736f 6e27 3a20 224d 6973 7369 6e67 2075  son': "Missing u
+000218d0: 726c 227d 0a20 2020 2020 2020 2020 2020  rl"}.           
+000218e0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+000218f0: 696e 7428 6622 4f70 656e 696e 6720 7572  int(f"Opening ur
+00021900: 6c20 7b75 726c 7d20 666f 7220 796f 7520  l {url} for you 
+00021910: 746f 2067 7261 6220 636f 6d70 6c65 7465  to grab complete
+00021920: 2075 726c 2066 6f72 207b 696d 6167 657d   url for {image}
+00021930: 206b 766d 2067 7565 7374 2069 6d61 6765   kvm guest image
+00021940: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00021950: 2020 2020 2020 2020 2020 2077 6562 6272             webbr
+00021960: 6f77 7365 722e 6f70 656e 2875 726c 2c20  owser.open(url, 
+00021970: 6e65 773d 322c 2061 7574 6f72 6169 7365  new=2, autoraise
+00021980: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00021990: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+000219a0: 726c 203d 2069 6e70 7574 2822 436f 7079  rl = input("Copy
+000219b0: 2055 726c 3a5c 6e22 290a 2020 2020 2020   Url:\n").      
+000219c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000219d0: 2020 6966 2075 726c 2e73 7472 6970 2829    if url.strip()
+000219e0: 203d 3d20 2727 3a0a 2020 2020 2020 2020   == '':.        
+000219f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021a00: 2020 2020 6572 726f 7228 224d 6973 7369      error("Missi
+00021a10: 6e67 2070 726f 7065 7220 7572 6c2e 4c65  ng proper url.Le
+00021a20: 6176 696e 672e 2e2e 2229 0a20 2020 2020  aving...").     
+00021a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021a40: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00021a50: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
+00021a60: 6527 2c20 2772 6561 736f 6e27 3a20 224d  e', 'reason': "M
+00021a70: 6973 7369 6e67 2069 6d61 6765 227d 0a20  issing image"}. 
+00021a80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00021a90: 6620 636d 6420 6973 204e 6f6e 6520 616e  f cmd is None an
+00021aa0: 6420 696d 6167 6520 213d 2027 2720 616e  d image != '' an
+00021ab0: 6420 696d 6167 6520 696e 2049 4d41 4745  d image in IMAGE
+00021ac0: 5343 4f4d 4d41 4e44 533a 0a20 2020 2020  SCOMMANDS:.     
+00021ad0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00021ae0: 6d64 203d 2049 4d41 4745 5343 4f4d 4d41  md = IMAGESCOMMA
+00021af0: 4e44 535b 696d 6167 655d 0a20 2020 2020  NDS[image].     
+00021b00: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00021b10: 7428 6622 4772 6162 6269 6e67 2069 6d61  t(f"Grabbing ima
+00021b20: 6765 207b 696d 6167 657d 2066 726f 6d20  ge {image} from 
+00021b30: 7572 6c20 7b75 726c 7d22 290a 2020 2020  url {url}").    
+00021b40: 2020 2020 2020 2020 2020 2020 6e65 6564              need
+00021b50: 5f69 736f 203d 2027 6170 692f 6173 7369  _iso = 'api/assi
+00021b60: 7374 6564 2d69 6d61 6765 732f 696d 6167  sted-images/imag
+00021b70: 6573 2720 696e 2075 726c 0a20 2020 2020  es' in url.     
+00021b80: 2020 2020 2020 2020 2020 2073 686f 7274             short
+00021b90: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
+00021ba0: 6173 656e 616d 6528 7572 6c29 2e73 706c  asename(url).spl
+00021bb0: 6974 2827 3f27 295b 305d 0a20 2020 2020  it('?')[0].     
+00021bc0: 2020 2020 2020 2020 2020 2069 6620 6e65             if ne
+00021bd0: 6564 5f69 736f 3a0a 2020 2020 2020 2020  ed_iso:.        
+00021be0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+00021bf0: 6520 3d20 6627 626f 6f74 2d7b 7368 6f72  e = f'boot-{shor
+00021c00: 746e 616d 657d 2e69 736f 270a 2020 2020  tname}.iso'.    
+00021c10: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00021c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021c30: 2020 2020 2063 6f6e 7665 7274 203d 2027       convert = '
+00021c40: 2e72 6177 2e27 2069 6e20 7572 6c0a 2020  .raw.' in url.  
+00021c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021c60: 2020 7265 7375 6c74 203d 206b 2e61 6464    result = k.add
+00021c70: 5f69 6d61 6765 2875 726c 2c20 706f 6f6c  _image(url, pool
+00021c80: 2c20 636d 643d 636d 642c 206e 616d 653d  , cmd=cmd, name=
+00021c90: 696d 6167 652c 2073 697a 653d 7369 7a65  image, size=size
+00021ca0: 2c20 636f 6e76 6572 743d 636f 6e76 6572  , convert=conver
+00021cb0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00021cc0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00021cd0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00021ce0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00021cf0: 726f 7228 6622 476f 7420 7b65 7d22 290a  ror(f"Got {e}").
+00021d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021d10: 2020 2020 6572 726f 7228 6622 506c 6561      error(f"Plea
+00021d20: 7365 2072 756e 206b 636c 6920 6465 6c65  se run kcli dele
+00021d30: 7465 2069 6d61 6765 202d 2d79 6573 207b  te image --yes {
+00021d40: 7368 6f72 746e 616d 657d 2229 0a20 2020  shortname}").   
+00021d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021d60: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
+00021d70: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
+00021d80: 6561 736f 6e27 3a20 2255 7365 7220 696e  eason': "User in
+00021d90: 7465 7272 7570 7469 6f6e 227d 0a20 2020  terruption"}.   
+00021da0: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
+00021db0: 6e64 203d 2027 666f 756e 6427 2069 6e20  nd = 'found' in 
+00021dc0: 7265 7375 6c74 0a20 2020 2020 2020 2020  result.         
+00021dd0: 2020 2020 2020 2069 6620 666f 756e 643a         if found:
+00021de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021df0: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00021e00: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
+00021e10: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00021e20: 2020 636f 6d6d 6f6e 2e68 616e 646c 655f    common.handle_
+00021e30: 7265 7370 6f6e 7365 2872 6573 756c 742c  response(result,
+00021e40: 2069 6d61 6765 2c20 656c 656d 656e 743d   image, element=
+00021e50: 2749 6d61 6765 272c 2061 6374 696f 6e3d  'Image', action=
+00021e60: 2741 6464 6564 2729 0a20 2020 2020 2020  'Added').       
+00021e70: 2020 2020 2020 2020 2069 6620 7265 7375           if resu
+00021e80: 6c74 5b27 7265 7375 6c74 275d 2021 3d20  lt['result'] != 
+00021e90: 2773 7563 6365 7373 273a 0a20 2020 2020  'success':.     
+00021ea0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00021eb0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00021ec0: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
+00021ed0: 736f 6e27 3a20 7265 7375 6c74 5b27 7265  son': result['re
+00021ee0: 6173 6f6e 275d 7d0a 2020 2020 2020 2020  ason']}.        
+00021ef0: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+00021f00: 756c 7427 3a20 2773 7563 6365 7373 277d  ult': 'success'}
+00021f10: 0a20 2020 2020 2020 2065 6c69 6620 7377  .        elif sw
+00021f20: 6974 6368 3a0a 2020 2020 2020 2020 2020  itch:.          
+00021f30: 2020 6966 2073 7769 7463 6820 6e6f 7420    if switch not 
+00021f40: 696e 2073 656c 662e 636c 6965 6e74 733a  in self.clients:
+00021f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021f60: 2065 7272 6f72 2866 2243 6c69 656e 7420   error(f"Client 
+00021f70: 7b73 7769 7463 687d 206e 6f74 2066 6f75  {switch} not fou
+00021f80: 6e64 2069 6e20 636f 6e66 6967 2e4c 6561  nd in config.Lea
+00021f90: 7669 6e67 2e2e 2e2e 2229 0a20 2020 2020  ving....").     
+00021fa0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00021fb0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
+00021fc0: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
+00021fd0: 3a20 6622 436c 6965 6e74 207b 7377 6974  : f"Client {swit
+00021fe0: 6368 7d20 6e6f 7420 666f 756e 6420 696e  ch} not found in
+00021ff0: 2063 6f6e 6669 6722 7d0a 2020 2020 2020   config"}.      
+00022000: 2020 2020 2020 656e 6162 6c65 6420 3d20        enabled = 
+00022010: 7365 6c66 2e69 6e69 5b73 7769 7463 685d  self.ini[switch]
+00022020: 2e67 6574 2827 656e 6162 6c65 6427 2c20  .get('enabled', 
+00022030: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00022040: 2020 6966 206e 6f74 2065 6e61 626c 6564    if not enabled
+00022050: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00022060: 2020 6572 726f 7228 6622 436c 6965 6e74    error(f"Client
+00022070: 207b 7377 6974 6368 7d20 6973 2064 6973   {switch} is dis
+00022080: 6162 6c65 642e 4c65 6176 696e 672e 2e2e  abled.Leaving...
+00022090: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+000220a0: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+000220b0: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
+000220c0: 2027 7265 6173 6f6e 273a 2066 2243 6c69   'reason': f"Cli
+000220d0: 656e 7420 7b73 7769 7463 687d 2069 7320  ent {switch} is 
+000220e0: 6469 7361 626c 6564 227d 0a20 2020 2020  disabled"}.     
+000220f0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00022100: 5377 6974 6368 696e 6720 746f 2063 6c69  Switching to cli
+00022110: 656e 7420 7b73 7769 7463 687d 2e2e 2e22  ent {switch}..."
+00022120: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
+00022130: 6966 696c 6520 3d20 2225 732f 2e6b 636c  ifile = "%s/.kcl
+00022140: 692f 636f 6e66 6967 2e79 6d6c 2220 2520  i/config.yml" % 
+00022150: 6f73 2e65 6e76 6972 6f6e 2e67 6574 2827  os.environ.get('
+00022160: 484f 4d45 2729 0a20 2020 2020 2020 2020  HOME').         
+00022170: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
+00022180: 6973 7473 2869 6e69 6669 6c65 293a 0a20  ists(inifile):. 
+00022190: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000221a0: 6577 696e 6920 3d20 2727 0a20 2020 2020  ewini = ''.     
+000221b0: 2020 2020 2020 2020 2020 2066 6f72 206c             for l
+000221c0: 696e 6520 696e 206f 7065 6e28 696e 6966  ine in open(inif
+000221d0: 696c 6529 2e72 6561 646c 696e 6573 2829  ile).readlines()
+000221e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000221f0: 2020 2020 2020 6966 2027 636c 6965 6e74        if 'client
+00022200: 2720 696e 206c 696e 653a 0a20 2020 2020  ' in line:.     
+00022210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022220: 2020 206e 6577 696e 6920 2b3d 2066 2220     newini += f" 
+00022230: 636c 6965 6e74 3a20 7b73 7769 7463 687d  client: {switch}
+00022240: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
+00022250: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00022260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022270: 2020 2020 2020 6e65 7769 6e69 202b 3d20        newini += 
+00022280: 6c69 6e65 0a20 2020 2020 2020 2020 2020  line.           
+00022290: 2020 2020 206f 7065 6e28 696e 6966 696c       open(inifil
+000222a0: 652c 2027 7727 292e 7772 6974 6528 6e65  e, 'w').write(ne
+000222b0: 7769 6e69 290a 2020 2020 2020 2020 2020  wini).          
+000222c0: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+000222d0: 7427 3a20 2773 7563 6365 7373 277d 0a20  t': 'success'}. 
+000222e0: 2020 2020 2020 2065 6c69 6620 7379 6e63         elif sync
+000222f0: 3a0a 2020 2020 2020 2020 2020 2020 6b20  :.            k 
+00022300: 3d20 7365 6c66 2e6b 0a20 2020 2020 2020  = self.k.       
+00022310: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+00022320: 2e65 7874 7261 636c 6965 6e74 733a 0a20  .extraclients:. 
+00022330: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00022340: 6172 6e69 6e67 2822 4e6f 7468 696e 6720  arning("Nothing 
+00022350: 746f 2064 6f2e 204c 6561 7669 6e67 2e2e  to do. Leaving..
+00022360: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00022370: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+00022380: 756c 7427 3a20 2773 7563 6365 7373 277d  ult': 'success'}
+00022390: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000223a0: 2063 6c69 2069 6e20 7365 6c66 2e65 7874   cli in self.ext
+000223b0: 7261 636c 6965 6e74 733a 0a20 2020 2020  raclients:.     
+000223c0: 2020 2020 2020 2020 2020 2064 6573 7420             dest 
+000223d0: 3d20 7365 6c66 2e65 7874 7261 636c 6965  = self.extraclie
+000223e0: 6e74 735b 636c 695d 0a20 2020 2020 2020  nts[cli].       
+000223f0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00022400: 6622 7379 6e63 696e 6720 636c 6965 6e74  f"syncing client
+00022410: 2069 6d61 6765 7320 6672 6f6d 207b 7365   images from {se
+00022420: 6c66 2e63 6c69 656e 747d 2074 6f20 7b63  lf.client} to {c
+00022430: 6c69 7d22 290a 2020 2020 2020 2020 2020  li}").          
+00022440: 2020 2020 2020 7761 726e 696e 6728 224e        warning("N
+00022450: 6f74 6520 7268 656c 2069 6d61 6765 7320  ote rhel images 
+00022460: 6172 6520 6375 7272 656e 746c 7920 6e6f  are currently no
+00022470: 7420 7379 6e63 6564 2229 0a20 2020 2020  t synced").     
+00022480: 2020 2020 2020 2066 6f72 2076 6f6c 2069         for vol i
+00022490: 6e20 6b2e 766f 6c75 6d65 7328 293a 0a20  n k.volumes():. 
+000224a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000224b0: 6d61 6765 203d 206f 732e 7061 7468 2e62  mage = os.path.b
+000224c0: 6173 656e 616d 6528 766f 6c29 0a20 2020  asename(vol).   
+000224d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000224e0: 696d 6167 6520 696e 205b 6f73 2e70 6174  image in [os.pat
+000224f0: 682e 6261 7365 6e61 6d65 2876 2920 666f  h.basename(v) fo
+00022500: 7220 7620 696e 2064 6573 742e 766f 6c75  r v in dest.volu
+00022510: 6d65 7328 295d 3a0a 2020 2020 2020 2020  mes()]:.        
+00022520: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00022530: 696e 6728 6622 4967 6e6f 7269 6e67 207b  ing(f"Ignoring {
+00022540: 696d 6167 657d 2061 7320 6974 2773 2061  image} as it's a
+00022550: 6c72 6561 6479 2074 6865 7265 2229 0a20  lready there"). 
+00022560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022570: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00022580: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
+00022590: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+000225a0: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
+000225b0: 6c69 7374 2849 4d41 4745 532e 7661 6c75  list(IMAGES.valu
+000225c0: 6573 2829 293a 0a20 2020 2020 2020 2020  es()):.         
+000225d0: 2020 2020 2020 2020 2020 2069 6620 6e20             if n 
+000225e0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000225f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022600: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00022610: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00022620: 6966 206e 2e73 706c 6974 2827 2f27 295b  if n.split('/')[
+00022630: 2d31 5d20 3d3d 2069 6d61 6765 3a0a 2020  -1] == image:.  
+00022640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022650: 2020 2020 2020 7572 6c20 3d20 6e0a 2020        url = n.  
+00022660: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00022670: 2075 726c 2069 7320 4e6f 6e65 3a0a 2020   url is None:.  
+00022680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022690: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+000226a0: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
+000226b0: 7265 6173 6f6e 273a 2022 696d 6167 6520  reason': "image 
+000226c0: 6e6f 7420 696e 2064 6566 6175 6c74 206c  not in default l
+000226d0: 6973 7422 7d0a 2020 2020 2020 2020 2020  ist"}.          
+000226e0: 2020 2020 2020 6966 2069 6d61 6765 2e73        if image.s
+000226f0: 7461 7274 7377 6974 6828 2772 6865 6c27  tartswith('rhel'
+00022700: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00022710: 2020 2020 2020 2069 6620 2777 6562 2720         if 'web' 
+00022720: 696e 2073 7973 2e61 7267 765b 305d 3a0a  in sys.argv[0]:.
+00022730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022740: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+00022750: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
+00022760: 7265 272c 2027 7265 6173 6f6e 273a 2022  re', 'reason': "
+00022770: 4d69 7373 696e 6720 7572 6c22 7d0a 2020  Missing url"}.  
+00022780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022790: 2020 7070 7269 6e74 2866 224f 7065 6e69    pprint(f"Openi
+000227a0: 6e67 2075 726c 207b 7572 6c7d 2066 6f72  ng url {url} for
+000227b0: 2079 6f75 2074 6f20 6772 6162 2063 6f6d   you to grab com
+000227c0: 706c 6574 6520 7572 6c20 666f 7220 7b76  plete url for {v
+000227d0: 6f6c 7d20 6b76 6d20 6775 6573 7420 696d  ol} kvm guest im
+000227e0: 6167 6522 290a 2020 2020 2020 2020 2020  age").          
+000227f0: 2020 2020 2020 2020 2020 7765 6262 726f            webbro
+00022800: 7773 6572 2e6f 7065 6e28 7572 6c2c 206e  wser.open(url, n
+00022810: 6577 3d32 2c20 6175 746f 7261 6973 653d  ew=2, autoraise=
+00022820: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00022830: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
+00022840: 696e 7075 7428 2243 6f70 7920 5572 6c3a  input("Copy Url:
+00022850: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+00022860: 2020 2020 2020 2020 2069 6620 7572 6c2e           if url.
+00022870: 7374 7269 7028 2920 3d3d 2027 273a 0a20  strip() == '':. 
+00022880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022890: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
+000228a0: 7373 696e 6720 7072 6f70 6572 2075 726c  ssing proper url
+000228b0: 2e4c 6561 7669 6e67 2e2e 2e22 290a 2020  .Leaving...").  
+000228c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000228d0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+000228e0: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
+000228f0: 272c 2027 7265 6173 6f6e 273a 2022 4d69  ', 'reason': "Mi
+00022900: 7373 696e 6720 696d 6167 6522 7d0a 2020  ssing image"}.  
+00022910: 2020 2020 2020 2020 2020 2020 2020 636d                cm
+00022920: 6420 3d20 4e6f 6e65 0a20 2020 2020 2020  d = None.       
+00022930: 2020 2020 2020 2020 2069 6620 766f 6c20           if vol 
+00022940: 696e 2049 4d41 4745 5343 4f4d 4d41 4e44  in IMAGESCOMMAND
+00022950: 533a 0a20 2020 2020 2020 2020 2020 2020  S:.             
+00022960: 2020 2020 2020 2063 6d64 203d 2049 4d41         cmd = IMA
+00022970: 4745 5343 4f4d 4d41 4e44 535b 696d 6167  GESCOMMANDS[imag
+00022980: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+00022990: 2020 2070 7072 696e 7428 6622 4772 6162     pprint(f"Grab
+000229a0: 6269 6e67 2069 6d61 6765 207b 696d 6167  bing image {imag
+000229b0: 657d 2e2e 2e22 290a 2020 2020 2020 2020  e}...").        
+000229c0: 2020 2020 2020 2020 6465 7374 2e61 6464          dest.add
+000229d0: 5f69 6d61 6765 2875 726c 2c20 706f 6f6c  _image(url, pool
+000229e0: 2c20 636d 643d 636d 6429 0a20 2020 2020  , cmd=cmd).     
+000229f0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+00022a00: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
+00022a10: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
+00022a20: 6c6f 6164 6261 6c61 6e63 6572 2873 656c  loadbalancer(sel
+00022a30: 662c 206e 616d 652c 2064 6f6d 6169 6e3d  f, name, domain=
+00022a40: 4e6f 6e65 293a 0a20 2020 2020 2020 206b  None):.        k
+00022a50: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
+00022a60: 2020 7070 7269 6e74 2866 2244 656c 6574    pprint(f"Delet
+00022a70: 696e 6720 6c6f 6164 6261 6c61 6e63 6572  ing loadbalancer
+00022a80: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
+00022a90: 2020 6966 2073 656c 662e 7479 7065 2069    if self.type i
+00022aa0: 6e20 5b27 6177 7327 2c20 2767 6370 272c  n ['aws', 'gcp',
+00022ab0: 2027 6962 6d27 5d3a 0a20 2020 2020 2020   'ibm']:.       
+00022ac0: 2020 2020 2064 6e73 636c 6965 6e74 203d       dnsclient =
+00022ad0: 206b 2e64 656c 6574 655f 6c6f 6164 6261   k.delete_loadba
+00022ae0: 6c61 6e63 6572 286e 616d 6529 0a20 2020  lancer(name).   
+00022af0: 2020 2020 2020 2020 2069 6620 646f 6d61           if doma
+00022b00: 696e 2069 7320 6e6f 7420 4e6f 6e65 2061  in is not None a
+00022b10: 6e64 2064 6e73 636c 6965 6e74 2069 7320  nd dnsclient is 
+00022b20: 6e6f 7420 4e6f 6e65 2061 6e64 2069 7369  not None and isi
+00022b30: 6e73 7461 6e63 6528 646e 7363 6c69 656e  nstance(dnsclien
+00022b40: 742c 2073 7472 293a 0a20 2020 2020 2020  t, str):.       
+00022b50: 2020 2020 2020 2020 2069 6620 646e 7363           if dnsc
+00022b60: 6c69 656e 7420 696e 2073 656c 662e 636c  lient in self.cl
+00022b70: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
+00022b80: 2020 2020 2020 2020 2020 207a 203d 204b             z = K
+00022b90: 636f 6e66 6967 2863 6c69 656e 743d 646e  config(client=dn
+00022ba0: 7363 6c69 656e 7429 2e6b 0a20 2020 2020  sclient).k.     
+00022bb0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00022bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022bd0: 2020 2020 2077 6172 6e69 6e67 2866 2243       warning(f"C
+00022be0: 6c69 656e 7420 7b64 6e73 636c 6965 6e74  lient {dnsclient
+00022bf0: 7d20 6e6f 7420 666f 756e 642e 2053 6b69  } not found. Ski
+00022c00: 7070 696e 6722 290a 2020 2020 2020 2020  pping").        
+00022c10: 2020 2020 2020 2020 7a2e 6465 6c65 7465          z.delete
+00022c20: 5f64 6e73 286e 616d 652e 7265 706c 6163  _dns(name.replac
+00022c30: 6528 275f 272c 2027 2d27 292c 2064 6f6d  e('_', '-'), dom
+00022c40: 6169 6e29 0a20 2020 2020 2020 2065 6c69  ain).        eli
+00022c50: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
+00022c60: 6b76 6d27 3a0a 2020 2020 2020 2020 2020  kvm':.          
+00022c70: 2020 6b2e 6465 6c65 7465 286e 616d 6529    k.delete(name)
+00022c80: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+00022c90: 5f6c 6f61 6462 616c 616e 6365 7228 7365  _loadbalancer(se
+00022ca0: 6c66 2c20 6e61 6d65 2c20 6e65 7473 3d5b  lf, name, nets=[
+00022cb0: 2764 6566 6175 6c74 275d 2c20 706f 7274  'default'], port
+00022cc0: 733d 5b5d 2c20 6368 6563 6b70 6174 683d  s=[], checkpath=
+00022cd0: 272f 272c 2076 6d73 3d5b 5d2c 2064 6f6d  '/', vms=[], dom
+00022ce0: 6169 6e3d 4e6f 6e65 2c0a 2020 2020 2020  ain=None,.      
+00022cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d00: 2020 2020 2020 706c 616e 3d4e 6f6e 652c        plan=None,
+00022d10: 2063 6865 636b 706f 7274 3d38 302c 2061   checkport=80, a
+00022d20: 6c69 6173 3d5b 5d2c 2069 6e74 6572 6e61  lias=[], interna
+00022d30: 6c3d 4661 6c73 652c 2064 6e73 636c 6965  l=False, dnsclie
+00022d40: 6e74 3d4e 6f6e 652c 2073 7562 6e65 7469  nt=None, subneti
+00022d50: 643d 4e6f 6e65 2c20 6970 3d4e 6f6e 6529  d=None, ip=None)
+00022d60: 3a0a 2020 2020 2020 2020 6e61 6d65 203d  :.        name =
+00022d70: 206e 616d 6575 7469 6c73 2e67 6574 5f72   nameutils.get_r
+00022d80: 616e 646f 6d5f 6e61 6d65 2829 2e72 6570  andom_name().rep
+00022d90: 6c61 6365 2827 5f27 2c20 272d 2729 2069  lace('_', '-') i
+00022da0: 6620 6e61 6d65 2069 7320 4e6f 6e65 2065  f name is None e
+00022db0: 6c73 6520 6e61 6d65 0a20 2020 2020 2020  lse name.       
+00022dc0: 2070 7072 696e 7428 6622 4465 706c 6f79   pprint(f"Deploy
+00022dd0: 696e 6720 6c6f 6164 6261 6c61 6e63 6572  ing loadbalancer
+00022de0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
+00022df0: 2020 6b20 3d20 7365 6c66 2e6b 0a20 2020    k = self.k.   
+00022e00: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
+00022e10: 6520 696e 205b 2761 7773 272c 2027 6763  e in ['aws', 'gc
+00022e20: 7027 2c20 2769 626d 275d 3a0a 2020 2020  p', 'ibm']:.    
+00022e30: 2020 2020 2020 2020 6c62 5f69 7020 3d20          lb_ip = 
+00022e40: 6b2e 6372 6561 7465 5f6c 6f61 6462 616c  k.create_loadbal
+00022e50: 616e 6365 7228 6e61 6d65 2c20 706f 7274  ancer(name, port
+00022e60: 733d 706f 7274 732c 2063 6865 636b 7061  s=ports, checkpa
+00022e70: 7468 3d63 6865 636b 7061 7468 2c20 766d  th=checkpath, vm
+00022e80: 733d 766d 732c 2064 6f6d 6169 6e3d 646f  s=vms, domain=do
+00022e90: 6d61 696e 2c0a 2020 2020 2020 2020 2020  main,.          
+00022ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ec0: 6368 6563 6b70 6f72 743d 6368 6563 6b70  checkport=checkp
+00022ed0: 6f72 742c 2061 6c69 6173 3d61 6c69 6173  ort, alias=alias
+00022ee0: 2c20 696e 7465 726e 616c 3d69 6e74 6572  , internal=inter
+00022ef0: 6e61 6c2c 0a20 2020 2020 2020 2020 2020  nal,.           
+00022f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022f10: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00022f20: 6e73 636c 6965 6e74 3d64 6e73 636c 6965  nsclient=dnsclie
+00022f30: 6e74 2c20 7375 626e 6574 6964 3d73 7562  nt, subnetid=sub
+00022f40: 6e65 7469 642c 2069 703d 6970 290a 2020  netid, ip=ip).  
+00022f50: 2020 2020 2020 2020 2020 6966 2064 6e73            if dns
+00022f60: 636c 6965 6e74 2069 7320 6e6f 7420 4e6f  client is not No
+00022f70: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00022f80: 2020 2020 6966 2064 6e73 636c 6965 6e74      if dnsclient
+00022f90: 2069 6e20 7365 6c66 2e63 6c69 656e 7473   in self.clients
+00022fa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00022fb0: 2020 2020 2020 7a20 3d20 4b63 6f6e 6669        z = Kconfi
+00022fc0: 6728 636c 6965 6e74 3d64 6e73 636c 6965  g(client=dnsclie
+00022fd0: 6e74 292e 6b0a 2020 2020 2020 2020 2020  nt).k.          
+00022fe0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00022ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023000: 7761 726e 696e 6728 6622 436c 6965 6e74  warning(f"Client
+00023010: 207b 646e 7363 6c69 656e 747d 206e 6f74   {dnsclient} not
+00023020: 2066 6f75 6e64 2e20 536b 6970 7069 6e67   found. Skipping
+00023030: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00023040: 2020 207a 2e72 6573 6572 7665 5f64 6e73     z.reserve_dns
+00023050: 286e 616d 652e 7265 706c 6163 6528 275f  (name.replace('_
+00023060: 272c 2027 2d27 292c 2069 703d 6c62 5f69  ', '-'), ip=lb_i
+00023070: 702c 2064 6f6d 6169 6e3d 646f 6d61 696e  p, domain=domain
+00023080: 2c20 616c 6961 733d 616c 6961 7329 0a20  , alias=alias). 
+00023090: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000230a0: 2020 2020 2020 2020 2076 6d69 6e66 6f20           vminfo 
+000230b0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+000230c0: 2066 6f72 2076 6d20 696e 2076 6d73 3a0a   for vm in vms:.
+000230d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230e0: 6966 2076 616c 6964 5f69 7028 766d 293a  if valid_ip(vm):
+000230f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023100: 2020 2020 2076 6d6e 616d 6520 3d20 766d       vmname = vm
+00023110: 2e72 6570 6c61 6365 2827 3a27 2c20 272d  .replace(':', '-
+00023120: 2729 2e72 6570 6c61 6365 2827 2e27 2c20  ').replace('.', 
+00023130: 272d 2729 0a20 2020 2020 2020 2020 2020  '-').           
+00023140: 2020 2020 2020 2020 2076 6d69 6e66 6f2e           vminfo.
+00023150: 6170 7065 6e64 287b 276e 616d 6527 3a20  append({'name': 
+00023160: 766d 6e61 6d65 2c20 2769 7027 3a20 766d  vmname, 'ip': vm
+00023170: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+00023180: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00023190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000231a0: 636f 756e 7465 7220 3d20 300a 2020 2020  counter = 0.    
+000231b0: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+000231c0: 6520 636f 756e 7465 7220 213d 2031 3030  e counter != 100
+000231d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000231e0: 2020 2020 2020 6970 203d 206b 2e69 7028        ip = k.ip(
+000231f0: 766d 290a 2020 2020 2020 2020 2020 2020  vm).            
+00023200: 2020 2020 2020 2020 6966 2069 7020 6973          if ip is
+00023210: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00023220: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00023230: 6c65 6570 2835 290a 2020 2020 2020 2020  leep(5).        
+00023240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023250: 7072 696e 7428 6622 5761 6974 696e 6720  print(f"Waiting 
+00023260: 3520 7365 636f 6e64 7320 746f 2067 7261  5 seconds to gra
+00023270: 6220 6970 2066 6f72 2076 6d20 7b76 6d7d  b ip for vm {vm}
+00023280: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00023290: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000232a0: 756e 7465 7220 2b3d 2035 0a20 2020 2020  unter += 5.     
+000232b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000232c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000232d0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+000232e0: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+000232f0: 2020 2076 6d69 6e66 6f2e 6170 7065 6e64     vminfo.append
+00023300: 287b 276e 616d 6527 3a20 766d 2c20 2769  ({'name': vm, 'i
+00023310: 7027 3a20 6970 7d29 0a20 2020 2020 2020  p': ip}).       
+00023320: 2020 2020 206f 7665 7272 6964 6573 203d       overrides =
+00023330: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00023340: 2020 2022 6e61 6d65 223a 206e 616d 652c     "name": name,
+00023350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023360: 2022 766d 7322 3a20 766d 696e 666f 2c0a   "vms": vminfo,.
+00023370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023380: 226e 6574 7322 3a20 6e65 7473 2c0a 2020  "nets": nets,.  
+00023390: 2020 2020 2020 2020 2020 2020 2020 2270                "p
+000233a0: 6f72 7473 223a 2070 6f72 7473 2c0a 2020  orts": ports,.  
+000233b0: 2020 2020 2020 2020 2020 2020 2020 2263                "c
+000233c0: 6865 636b 7061 7468 223a 2063 6865 636b  heckpath": check
+000233d0: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
+000233e0: 2020 2020 2020 2264 6f6d 6169 6e22 3a20        "domain": 
+000233f0: 646f 6d61 696e 2c0a 2020 2020 2020 2020  domain,.        
+00023400: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+00023410: 2020 7365 6c66 2e70 6c61 6e28 706c 616e    self.plan(plan
+00023420: 2c20 696e 7075 7473 7472 696e 673d 6861  , inputstring=ha
+00023430: 7072 6f78 7970 6c61 6e2c 206f 7665 7272  proxyplan, overr
+00023440: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
+00023450: 0a20 2020 2064 6566 206c 6973 745f 6c6f  .    def list_lo
+00023460: 6164 6261 6c61 6e63 6572 7328 7365 6c66  adbalancers(self
+00023470: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
+00023480: 656c 662e 6b0a 2020 2020 2020 2020 6966  elf.k.        if
+00023490: 2073 656c 662e 7479 7065 206e 6f74 2069   self.type not i
+000234a0: 6e20 5b27 6177 7327 2c20 2767 6370 272c  n ['aws', 'gcp',
+000234b0: 2027 6962 6d27 5d3a 0a20 2020 2020 2020   'ibm']:.       
+000234c0: 2020 2020 2072 6573 756c 7473 203d 205b       results = [
+000234d0: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
+000234e0: 7220 766d 2069 6e20 6b2e 6c69 7374 2829  r vm in k.list()
+000234f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00023500: 2020 6966 2076 6d5b 2770 726f 6669 6c65    if vm['profile
+00023510: 275d 2e73 7461 7274 7377 6974 6828 276c  '].startswith('l
+00023520: 6f61 6462 616c 616e 6365 7227 2920 616e  oadbalancer') an
+00023530: 6420 6c65 6e28 766d 5b27 7072 6f66 696c  d len(vm['profil
+00023540: 6527 5d2e 7370 6c69 7428 272d 2729 2920  e'].split('-')) 
+00023550: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+00023560: 2020 2020 2020 2020 2020 706f 7274 7320            ports 
+00023570: 3d20 766d 5b27 7072 6f66 696c 6527 5d2e  = vm['profile'].
+00023580: 7370 6c69 7428 272d 2729 5b31 5d0a 2020  split('-')[1].  
+00023590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000235a0: 2020 7265 7375 6c74 732e 6170 7065 6e64    results.append
+000235b0: 285b 766d 5b27 6e61 6d65 275d 2c20 766d  ([vm['name'], vm
+000235c0: 5b27 6970 275d 2c20 2774 6370 272c 2070  ['ip'], 'tcp', p
+000235d0: 6f72 7473 2c20 2727 5d29 0a20 2020 2020  orts, '']).     
+000235e0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+000235f0: 7375 6c74 730a 2020 2020 2020 2020 656c  sults.        el
+00023600: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00023610: 7265 7475 726e 206b 2e6c 6973 745f 6c6f  return k.list_lo
+00023620: 6164 6261 6c61 6e63 6572 7328 290a 0a20  adbalancers().. 
+00023630: 2020 2064 6566 2077 6169 745f 6669 6e69     def wait_fini
+00023640: 7368 2873 656c 662c 206e 616d 652c 2069  sh(self, name, i
+00023650: 6d61 6765 3d4e 6f6e 652c 2071 7569 6574  mage=None, quiet
+00023660: 3d46 616c 7365 2c20 7761 6974 636f 6d6d  =False, waitcomm
+00023670: 616e 643d 4e6f 6e65 2c20 7761 6974 7469  and=None, waitti
+00023680: 6d65 6f75 743d 302c 2069 6465 6e74 6974  meout=0, identit
+00023690: 7966 696c 653d 4e6f 6e65 2c0a 2020 2020  yfile=None,.    
+000236a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000236b0: 766d 636c 6965 6e74 3d4e 6f6e 6529 3a0a  vmclient=None):.
+000236c0: 2020 2020 2020 2020 636f 6e66 6967 203d          config =
+000236d0: 204b 636f 6e66 6967 2863 6c69 656e 743d   Kconfig(client=
+000236e0: 766d 636c 6965 6e74 2920 6966 2076 6d63  vmclient) if vmc
+000236f0: 6c69 656e 7420 6973 206e 6f74 204e 6f6e  lient is not Non
+00023700: 6520 656c 7365 2073 656c 660a 2020 2020  e else self.    
+00023710: 2020 2020 6b20 3d20 636f 6e66 6967 2e6b      k = config.k
+00023720: 0a20 2020 2020 2020 2069 6620 696d 6167  .        if imag
+00023730: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+00023740: 2020 2020 2020 2069 6d61 6765 203d 206b         image = k
+00023750: 2e69 6e66 6f28 6e61 6d65 295b 2769 6d61  .info(name)['ima
+00023760: 6765 275d 0a20 2020 2020 2020 2070 7072  ge'].        ppr
+00023770: 696e 7428 6622 5761 6974 696e 6720 666f  int(f"Waiting fo
+00023780: 7220 766d 207b 6e61 6d65 7d20 746f 2066  r vm {name} to f
+00023790: 696e 6973 6820 6375 7374 6f6d 6973 6174  inish customisat
+000237a0: 696f 6e22 290a 2020 2020 2020 2020 6966  ion").        if
+000237b0: 2077 6169 7463 6f6d 6d61 6e64 2069 7320   waitcommand is 
+000237c0: 6e6f 7420 4e6f 6e65 2061 6e64 2027 323e  not None and '2>
+000237d0: 2720 6e6f 7420 696e 2077 6169 7463 6f6d  ' not in waitcom
+000237e0: 6d61 6e64 3a0a 2020 2020 2020 2020 2020  mand:.          
+000237f0: 2020 7761 6974 636f 6d6d 616e 6420 2b3d    waitcommand +=
+00023800: 2022 2032 3e2f 6465 762f 6e75 6c6c 220a   " 2>/dev/null".
+00023810: 2020 2020 2020 2020 6966 2063 6f6d 6d6f          if commo
+00023820: 6e2e 6e65 6564 735f 6967 6e69 7469 6f6e  n.needs_ignition
+00023830: 2869 6d61 6765 293a 0a20 2020 2020 2020  (image):.       
+00023840: 2020 2020 2063 6d64 203d 2077 6169 7463       cmd = waitc
+00023850: 6f6d 6d61 6e64 206f 7220 2773 7564 6f20  ommand or 'sudo 
+00023860: 6a6f 7572 6e61 6c63 746c 202d 2d61 6c6c  journalctl --all
+00023870: 202d 2d6e 6f2d 7061 6765 7227 0a20 2020   --no-pager'.   
+00023880: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00023890: 2020 2020 2020 2063 6d64 203d 2077 6169         cmd = wai
+000238a0: 7463 6f6d 6d61 6e64 206f 7220 6622 7375  tcommand or f"su
+000238b0: 646f 2074 6169 6c20 2d6e 2035 3020 7b63  do tail -n 50 {c
+000238c0: 6f6d 6d6f 6e2e 6765 745f 636c 6f75 6469  ommon.get_cloudi
+000238d0: 6e69 7466 696c 6528 696d 6167 6529 7d22  nitfile(image)}"
+000238e0: 0a20 2020 2020 2020 2075 7365 722c 2069  .        user, i
+000238f0: 702c 2076 6d70 6f72 7420 3d20 4e6f 6e65  p, vmport = None
+00023900: 2c20 4e6f 6e65 2c20 4e6f 6e65 0a20 2020  , None, None.   
+00023910: 2020 2020 2068 6f73 7469 7020 3d20 4e6f       hostip = No
+00023920: 6e65 0a20 2020 2020 2020 2074 696d 656f  ne.        timeo
+00023930: 7574 203d 2030 0a20 2020 2020 2020 2077  ut = 0.        w
+00023940: 6869 6c65 2069 7020 6973 204e 6f6e 653a  hile ip is None:
+00023950: 0a20 2020 2020 2020 2020 2020 2069 6e66  .            inf
+00023960: 6f20 3d20 6b2e 696e 666f 286e 616d 6529  o = k.info(name)
+00023970: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00023980: 636f 6e66 6967 2e74 7970 6520 3d3d 2027  config.type == '
+00023990: 7061 636b 6574 2720 616e 6420 696e 666f  packet' and info
+000239a0: 2e67 6574 2827 7374 6174 7573 2729 2021  .get('status') !
+000239b0: 3d20 2761 6374 6976 6527 3a0a 2020 2020  = 'active':.    
+000239c0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+000239d0: 696e 6728 2257 6169 7469 6e67 2066 6f72  ing("Waiting for
+000239e0: 206e 6f64 6520 746f 2062 6520 6163 7469   node to be acti
+000239f0: 7665 2229 0a20 2020 2020 2020 2020 2020  ve").           
+00023a00: 2020 2020 2069 7020 3d20 4e6f 6e65 0a20       ip = None. 
+00023a10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00023a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023a30: 2075 7365 722c 2069 7020 3d20 636f 6e66   user, ip = conf
+00023a40: 6967 2e76 6d75 7365 7220 6f72 2069 6e66  ig.vmuser or inf
+00023a50: 6f2e 6765 7428 2775 7365 7227 292c 2069  o.get('user'), i
+00023a60: 6e66 6f2e 6765 7428 2769 7027 290a 2020  nfo.get('ip').  
+00023a70: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00023a80: 2063 6f6e 6669 672e 7479 7065 203d 3d20   config.type == 
+00023a90: 276b 7562 6576 6972 7427 3a0a 2020 2020  'kubevirt':.    
 00023aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ab0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00023ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ad0: 2020 7465 7374 636d 6420 3d20 636f 6d6d    testcmd = comm
-00023ae0: 6f6e 2e73 7368 286e 616d 652c 2075 7365  on.ssh(name, use
-00023af0: 723d 7573 6572 2c20 6970 3d69 702c 2074  r=user, ip=ip, t
-00023b00: 756e 6e65 6c3d 636f 6e66 6967 2e74 756e  unnel=config.tun
-00023b10: 6e65 6c2c 2074 756e 6e65 6c68 6f73 743d  nel, tunnelhost=
-00023b20: 636f 6e66 6967 2e74 756e 6e65 6c68 6f73  config.tunnelhos
-00023b30: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00023b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b60: 7475 6e6e 656c 706f 7274 3d63 6f6e 6669  tunnelport=confi
-00023b70: 672e 7475 6e6e 656c 706f 7274 2c20 7475  g.tunnelport, tu
-00023b80: 6e6e 656c 7573 6572 3d63 6f6e 6669 672e  nneluser=config.
-00023b90: 7475 6e6e 656c 7573 6572 2c0a 2020 2020  tunneluser,.    
+00023ab0: 6966 206b 2e61 6363 6573 735f 6d6f 6465  if k.access_mode
+00023ac0: 203d 3d20 274e 6f64 6550 6f72 7427 3a0a   == 'NodePort':.
+00023ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ae0: 2020 2020 2020 2020 766d 706f 7274 203d          vmport =
+00023af0: 2069 6e66 6f2e 6765 7428 276e 6f64 6570   info.get('nodep
+00023b00: 6f72 7427 290a 2020 2020 2020 2020 2020  ort').          
+00023b10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00023b20: 2068 6f73 7469 7020 6973 204e 6f6e 653a   hostip is None:
+00023b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023b40: 2020 2020 2020 2020 2020 2020 2068 6f73               hos
+00023b50: 7469 7020 3d20 6b2e 6e6f 6465 5f68 6f73  tip = k.node_hos
+00023b60: 7428 6e61 6d65 3d69 6e66 6f2e 6765 7428  t(name=info.get(
+00023b70: 2768 6f73 7427 2929 0a20 2020 2020 2020  'host')).       
+00023b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b90: 2069 7020 3d20 686f 7374 6970 0a20 2020   ip = hostip.   
 00023ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023bc0: 2020 2020 2020 2020 2069 6e73 6563 7572           insecur
-00023bd0: 653d 636f 6e66 6967 2e69 6e73 6563 7572  e=config.insecur
-00023be0: 652c 2063 6d64 3d27 6964 202d 756e 272c  e, cmd='id -un',
-00023bf0: 2076 6d70 6f72 743d 766d 706f 7274 2c0a   vmport=vmport,.
-00023c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c20: 2020 2020 2020 2020 2020 2020 2069 6465               ide
-00023c30: 6e74 6974 7966 696c 653d 6964 656e 7469  ntityfile=identi
-00023c40: 7479 6669 6c65 2c20 7061 7373 776f 7264  tyfile, password
-00023c50: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-00023c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c70: 6966 206f 732e 706f 7065 6e28 7465 7374  if os.popen(test
-00023c80: 636d 6429 2e72 6561 6428 292e 7374 7269  cmd).read().stri
-00023c90: 7028 2920 213d 2075 7365 723a 0a20 2020  p() != user:.   
-00023ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023cb0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00023cc0: 2822 4761 7468 6572 6564 2069 7020 6e6f  ("Gathered ip no
-00023cd0: 7420 6675 6e63 7469 6f6e 616c 2079 6574  t functional yet
-00023ce0: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00023cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d00: 2020 6970 203d 204e 6f6e 650a 2020 2020    ip = None.    
-00023d10: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
-00023d20: 5761 6974 696e 6720 666f 7220 766d 2074  Waiting for vm t
-00023d30: 6f20 6265 2061 6363 6573 7369 626c 652e  o be accessible.
-00023d40: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-00023d50: 2073 6c65 6570 2835 290a 2020 2020 2020   sleep(5).      
-00023d60: 2020 2020 2020 7469 6d65 6f75 7420 2b3d        timeout +=
-00023d70: 2035 0a20 2020 2020 2020 2020 2020 2069   5.            i
-00023d80: 6620 7761 6974 7469 6d65 6f75 7420 3e20  f waittimeout > 
-00023d90: 3020 616e 6420 7469 6d65 6f75 7420 3e20  0 and timeout > 
-00023da0: 7761 6974 7469 6d65 6f75 743a 0a20 2020  waittimeout:.   
-00023db0: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00023dc0: 6f72 2822 5469 6d65 6f75 7420 7761 6974  or("Timeout wait
-00023dd0: 696e 6720 666f 7220 766d 2074 6f20 6265  ing for vm to be
-00023de0: 2061 6363 6573 7369 626c 652e 2e2e 2229   accessible...")
-00023df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023e00: 2062 7265 616b 0a20 2020 2020 2020 2073   break.        s
-00023e10: 6c65 6570 2835 290a 2020 2020 2020 2020  leep(5).        
-00023e20: 6f6c 646f 7574 7075 7420 3d20 2727 0a20  oldoutput = ''. 
-00023e30: 2020 2020 2020 2074 696d 656f 7574 203d         timeout =
-00023e40: 2030 0a20 2020 2020 2020 2077 6869 6c65   0.        while
-00023e50: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
-00023e60: 2020 2073 7368 636d 6420 3d20 636f 6d6d     sshcmd = comm
-00023e70: 6f6e 2e73 7368 286e 616d 652c 2075 7365  on.ssh(name, use
-00023e80: 723d 2772 6f6f 7427 2c20 6970 3d69 702c  r='root', ip=ip,
-00023e90: 2074 756e 6e65 6c3d 636f 6e66 6967 2e74   tunnel=config.t
-00023ea0: 756e 6e65 6c2c 2074 756e 6e65 6c68 6f73  unnel, tunnelhos
-00023eb0: 743d 636f 6e66 6967 2e74 756e 6e65 6c68  t=config.tunnelh
-00023ec0: 6f73 742c 0a20 2020 2020 2020 2020 2020  ost,.           
-00023ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ee0: 2020 2020 2076 6d70 6f72 743d 766d 706f       vmport=vmpo
-00023ef0: 7274 2c20 7475 6e6e 656c 706f 7274 3d63  rt, tunnelport=c
-00023f00: 6f6e 6669 672e 7475 6e6e 656c 706f 7274  onfig.tunnelport
-00023f10: 2c20 7475 6e6e 656c 7573 6572 3d63 6f6e  , tunneluser=con
-00023f20: 6669 672e 7475 6e6e 656c 7573 6572 2c0a  fig.tunneluser,.
-00023f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023bb0: 2065 6c69 6620 6b2e 6163 6365 7373 5f6d   elif k.access_m
+00023bc0: 6f64 6520 3d3d 2027 4c6f 6164 4261 6c61  ode == 'LoadBala
+00023bd0: 6e63 6572 273a 0a20 2020 2020 2020 2020  ncer':.         
+00023be0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00023bf0: 7020 3d20 696e 666f 2e67 6574 2827 6c6f  p = info.get('lo
+00023c00: 6164 6261 6c61 6e63 6572 6970 2729 0a20  adbalancerip'). 
+00023c10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00023c20: 6620 7573 6572 2069 7320 6e6f 7420 4e6f  f user is not No
+00023c30: 6e65 2061 6e64 2069 7020 6973 206e 6f74  ne and ip is not
+00023c40: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00023c50: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+00023c60: 6e66 6967 2e74 7970 6520 3d3d 2027 6f70  nfig.type == 'op
+00023c70: 656e 7374 6163 6b27 2061 6e64 2069 6e66  enstack' and inf
+00023c80: 6f2e 6765 7428 2770 7269 7661 7465 6970  o.get('privateip
+00023c90: 2729 203d 3d20 6970 2061 6e64 206b 2e65  ') == ip and k.e
+00023ca0: 7874 6572 6e61 6c5f 6e65 7477 6f72 6b20  xternal_network 
+00023cb0: 6973 206e 6f74 204e 6f6e 655c 0a20 2020  is not None\.   
+00023cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cd0: 2020 2020 2020 2020 2061 6e64 2069 6e66           and inf
+00023ce0: 6f2e 6765 7428 276e 6574 7327 295b 305d  o.get('nets')[0]
+00023cf0: 5b27 6e65 7427 5d20 213d 206b 2e65 7874  ['net'] != k.ext
+00023d00: 6572 6e61 6c5f 6e65 7477 6f72 6b3a 0a20  ernal_network:. 
+00023d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d20: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
+00023d30: 5761 6974 696e 6720 666f 7220 666c 6f61  Waiting for floa
+00023d40: 7469 6e67 2069 7020 696e 7374 6561 6420  ting ip instead 
+00023d50: 6f66 2061 2070 7269 7661 7465 2069 702e  of a private ip.
+00023d60: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+00023d70: 2020 2020 2020 2020 2020 2020 2069 7020               ip 
+00023d80: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+00023d90: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00023da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023db0: 2020 2020 2020 2020 2074 6573 7463 6d64           testcmd
+00023dc0: 203d 2063 6f6d 6d6f 6e2e 7373 6828 6e61   = common.ssh(na
+00023dd0: 6d65 2c20 7573 6572 3d75 7365 722c 2069  me, user=user, i
+00023de0: 703d 6970 2c20 7475 6e6e 656c 3d63 6f6e  p=ip, tunnel=con
+00023df0: 6669 672e 7475 6e6e 656c 2c20 7475 6e6e  fig.tunnel, tunn
+00023e00: 656c 686f 7374 3d63 6f6e 6669 672e 7475  elhost=config.tu
+00023e10: 6e6e 656c 686f 7374 2c0a 2020 2020 2020  nnelhost,.      
+00023e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e40: 2020 2020 2020 2074 756e 6e65 6c70 6f72         tunnelpor
+00023e50: 743d 636f 6e66 6967 2e74 756e 6e65 6c70  t=config.tunnelp
+00023e60: 6f72 742c 2074 756e 6e65 6c75 7365 723d  ort, tunneluser=
+00023e70: 636f 6e66 6967 2e74 756e 6e65 6c75 7365  config.tunneluse
+00023e80: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00023e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023eb0: 696e 7365 6375 7265 3d63 6f6e 6669 672e  insecure=config.
+00023ec0: 696e 7365 6375 7265 2c20 636d 643d 2769  insecure, cmd='i
+00023ed0: 6420 2d75 6e27 2c20 766d 706f 7274 3d76  d -un', vmport=v
+00023ee0: 6d70 6f72 742c 0a20 2020 2020 2020 2020  mport,.         
+00023ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f10: 2020 2020 6964 656e 7469 7479 6669 6c65      identityfile
+00023f20: 3d69 6465 6e74 6974 7966 696c 652c 2070  =identityfile, p
+00023f30: 6173 7377 6f72 643d 4661 6c73 6529 0a20  assword=False). 
 00023f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f50: 696e 7365 6375 7265 3d63 6f6e 6669 672e  insecure=config.
-00023f60: 696e 7365 6375 7265 2c20 636d 643d 636d  insecure, cmd=cm
-00023f70: 642c 2069 6465 6e74 6974 7966 696c 653d  d, identityfile=
-00023f80: 6964 656e 7469 7479 6669 6c65 2c20 7061  identityfile, pa
-00023f90: 7373 776f 7264 3d46 616c 7365 290a 2020  ssword=False).  
-00023fa0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-00023fb0: 203d 206f 732e 706f 7065 6e28 7373 6863   = os.popen(sshc
-00023fc0: 6d64 292e 7265 6164 2829 0a20 2020 2020  md).read().     
-00023fd0: 2020 2020 2020 2069 6620 7761 6974 636f         if waitco
-00023fe0: 6d6d 616e 6420 6973 206e 6f74 204e 6f6e  mmand is not Non
-00023ff0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00024000: 2020 2069 6620 6f75 7470 7574 2021 3d20     if output != 
-00024010: 2727 3a0a 2020 2020 2020 2020 2020 2020  '':.            
-00024020: 2020 2020 2020 2020 7072 696e 7428 6f75          print(ou
-00024030: 7470 7574 290a 2020 2020 2020 2020 2020  tput).          
-00024040: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00024050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024060: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00024070: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00024080: 2822 5761 6974 696e 6720 666f 7220 7761  ("Waiting for wa
-00024090: 6974 636f 6d6d 616e 6420 746f 2073 7563  itcommand to suc
-000240a0: 6365 6564 2e2e 2e22 290a 2020 2020 2020  ceed...").      
-000240b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000240c0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-000240d0: 6b63 6c69 2062 6f6f 7420 6669 6e69 7368  kcli boot finish
-000240e0: 6564 2720 696e 206f 7574 7075 7420 6f72  ed' in output or
-000240f0: 2027 4967 6e69 7469 6f6e 2066 696e 6973   'Ignition finis
-00024100: 6865 6420 7375 6363 6573 7366 756c 6c79  hed successfully
-00024110: 2720 696e 206f 7574 7075 7420 6f72 5c0a  ' in output or\.
-00024120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024130: 2020 2027 4669 6e69 7368 6564 2043 6f6d     'Finished Com
-00024140: 6275 7374 696f 6e27 2069 6e20 6f75 7470  bustion' in outp
-00024150: 7574 3a0a 2020 2020 2020 2020 2020 2020  ut:.            
-00024160: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00024170: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00024180: 7470 7574 203d 206f 7574 7075 742e 7265  tput = output.re
-00024190: 706c 6163 6528 6f6c 646f 7574 7075 742c  place(oldoutput,
-000241a0: 2027 2729 0a20 2020 2020 2020 2020 2020   '').           
-000241b0: 2020 2020 2069 6620 6e6f 7420 7175 6965       if not quie
-000241c0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-000241d0: 2020 2020 2020 2070 7269 6e74 286f 7574         print(out
-000241e0: 7075 7429 0a20 2020 2020 2020 2020 2020  put).           
-000241f0: 2020 2020 206f 6c64 6f75 7470 7574 203d       oldoutput =
-00024200: 206f 7574 7075 740a 2020 2020 2020 2020   output.        
-00024210: 2020 2020 736c 6565 7028 3229 0a20 2020      sleep(2).   
-00024220: 2020 2020 2020 2020 2074 696d 656f 7574           timeout
-00024230: 202b 3d20 320a 2020 2020 2020 2020 2020   += 2.          
-00024240: 2020 6966 2077 6169 7474 696d 656f 7574    if waittimeout
-00024250: 203e 2030 2061 6e64 2074 696d 656f 7574   > 0 and timeout
-00024260: 203e 2077 6169 7474 696d 656f 7574 3a0a   > waittimeout:.
-00024270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024280: 6572 726f 7228 2254 696d 656f 7574 2077  error("Timeout w
-00024290: 6169 7469 6e67 2066 6f72 2077 6169 7463  aiting for waitc
-000242a0: 6f6d 6d61 6e64 2074 6f20 6578 6563 7574  ommand to execut
-000242b0: 652e 2e2e 2229 0a20 2020 2020 2020 2020  e...").         
-000242c0: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-000242d0: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-000242e0: 0a0a 2020 2020 6465 6620 636c 6561 6e5f  ..    def clean_
-000242f0: 7465 6d70 6b65 7928 7365 6c66 2c20 6e61  tempkey(self, na
-00024300: 6d65 2c20 6964 656e 7469 7479 6669 6c65  me, identityfile
-00024310: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00024320: 636d 6420 3d20 2273 6564 202d 6920 272f  cmd = "sed -i '/
-00024330: 7465 6d70 2d6b 636c 692d 6b65 792f 6427  temp-kcli-key/d'
-00024340: 202f 686f 6d65 2f2a 2f2e 7373 682f 6175   /home/*/.ssh/au
-00024350: 7468 6f72 697a 6564 5f6b 6579 7320 2f72  thorized_keys /r
-00024360: 6f6f 742f 2e73 7368 2f61 7574 686f 7269  oot/.ssh/authori
-00024370: 7a65 645f 6b65 7973 220a 2020 2020 2020  zed_keys".      
-00024380: 2020 6b20 3d20 7365 6c66 2e6b 0a20 2020    k = self.k.   
-00024390: 2020 2020 2069 6e66 6f20 3d20 6b2e 696e       info = k.in
-000243a0: 666f 286e 616d 6529 0a20 2020 2020 2020  fo(name).       
-000243b0: 2076 6d70 6f72 7420 3d20 4e6f 6e65 0a20   vmport = None. 
-000243c0: 2020 2020 2020 2069 7020 3d20 696e 666f         ip = info
-000243d0: 2e67 6574 2827 6970 2729 0a20 2020 2020  .get('ip').     
-000243e0: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
-000243f0: 3d3d 2027 6b75 6265 7669 7274 273a 0a20  == 'kubevirt':. 
-00024400: 2020 2020 2020 2020 2020 2069 6620 6b2e             if k.
-00024410: 6163 6365 7373 5f6d 6f64 6520 3d3d 2027  access_mode == '
-00024420: 4e6f 6465 506f 7274 273a 0a20 2020 2020  NodePort':.     
-00024430: 2020 2020 2020 2020 2020 2076 6d70 6f72             vmpor
-00024440: 7420 3d20 696e 666f 2e67 6574 2827 6e6f  t = info.get('no
-00024450: 6465 706f 7274 2729 0a20 2020 2020 2020  deport').       
-00024460: 2020 2020 2020 2020 2069 7020 3d20 6b2e           ip = k.
-00024470: 6e6f 6465 5f68 6f73 7428 6e61 6d65 3d69  node_host(name=i
-00024480: 6e66 6f2e 6765 7428 2768 6f73 7427 2929  nfo.get('host'))
-00024490: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-000244a0: 6620 6b2e 6163 6365 7373 5f6d 6f64 6520  f k.access_mode 
-000244b0: 3d3d 2027 4c6f 6164 4261 6c61 6e63 6572  == 'LoadBalancer
-000244c0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-000244d0: 2020 2069 7020 3d20 696e 666f 2e67 6574     ip = info.get
-000244e0: 2827 6c6f 6164 6261 6c61 6e63 6572 6970  ('loadbalancerip
-000244f0: 2729 0a20 2020 2020 2020 2073 7368 636d  ').        sshcm
-00024500: 6420 3d20 636f 6d6d 6f6e 2e73 7368 286e  d = common.ssh(n
-00024510: 616d 652c 2075 7365 723d 2772 6f6f 7427  ame, user='root'
-00024520: 2c20 6970 3d69 702c 2074 756e 6e65 6c3d  , ip=ip, tunnel=
-00024530: 7365 6c66 2e74 756e 6e65 6c2c 2074 756e  self.tunnel, tun
-00024540: 6e65 6c68 6f73 743d 7365 6c66 2e74 756e  nelhost=self.tun
-00024550: 6e65 6c68 6f73 742c 2076 6d70 6f72 743d  nelhost, vmport=
-00024560: 766d 706f 7274 2c0a 2020 2020 2020 2020  vmport,.        
-00024570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024580: 2020 2020 7475 6e6e 656c 706f 7274 3d73      tunnelport=s
-00024590: 656c 662e 7475 6e6e 656c 706f 7274 2c20  elf.tunnelport, 
-000245a0: 7475 6e6e 656c 7573 6572 3d73 656c 662e  tunneluser=self.
-000245b0: 7475 6e6e 656c 7573 6572 2c20 696e 7365  tunneluser, inse
-000245c0: 6375 7265 3d73 656c 662e 696e 7365 6375  cure=self.insecu
-000245d0: 7265 2c20 636d 643d 636d 642c 0a20 2020  re, cmd=cmd,.   
-000245e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000245f0: 2020 2020 2020 2020 2069 6465 6e74 6974           identit
-00024600: 7966 696c 653d 6964 656e 7469 7479 6669  yfile=identityfi
-00024610: 6c65 2c20 7061 7373 776f 7264 3d46 616c  le, password=Fal
-00024620: 7365 290a 2020 2020 2020 2020 6f73 2e70  se).        os.p
-00024630: 6f70 656e 2873 7368 636d 6429 2e72 6561  open(sshcmd).rea
-00024640: 6428 290a 0a20 2020 2064 6566 2074 6872  d()..    def thr
-00024650: 6561 6465 645f 6372 6561 7465 5f6b 7562  eaded_create_kub
-00024660: 6528 7365 6c66 2c20 636c 7573 7465 722c  e(self, cluster,
-00024670: 206b 7562 6574 7970 652c 206b 7562 655f   kubetype, kube_
-00024680: 6f76 6572 7269 6465 7329 3a0a 2020 2020  overrides):.    
-00024690: 2020 2020 6970 706f 6f6c 203d 206b 7562      ippool = kub
-000246a0: 655f 6f76 6572 7269 6465 732e 6765 7428  e_overrides.get(
-000246b0: 2769 7070 6f6f 6c27 2920 6f72 206b 7562  'ippool') or kub
-000246c0: 655f 6f76 6572 7269 6465 732e 6765 7428  e_overrides.get(
-000246d0: 2763 6f6e 6670 6f6f 6c27 290a 2020 2020  'confpool').    
-000246e0: 2020 2020 6261 7265 6d65 7461 6c70 6f6f      baremetalpoo
-000246f0: 6c20 3d20 6b75 6265 5f6f 7665 7272 6964  l = kube_overrid
-00024700: 6573 2e67 6574 2827 6970 706f 6f6c 2729  es.get('ippool')
-00024710: 206f 7220 6b75 6265 5f6f 7665 7272 6964   or kube_overrid
-00024720: 6573 2e67 6574 2827 636f 6e66 706f 6f6c  es.get('confpool
-00024730: 2729 0a20 2020 2020 2020 2069 6620 6970  ').        if ip
-00024740: 706f 6f6c 2069 7320 6e6f 7420 4e6f 6e65  pool is not None
-00024750: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00024760: 6c66 2e67 6574 5f76 6970 5f66 726f 6d5f  lf.get_vip_from_
-00024770: 636f 6e66 706f 6f6c 2863 6c75 7374 6572  confpool(cluster
-00024780: 2c20 6970 706f 6f6c 2c20 6f76 6572 7269  , ippool, overri
-00024790: 6465 733d 6b75 6265 5f6f 7665 7272 6964  des=kube_overrid
-000247a0: 6573 290a 2020 2020 2020 2020 6966 2062  es).        if b
-000247b0: 6172 656d 6574 616c 706f 6f6c 2069 7320  aremetalpool is 
-000247c0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000247d0: 2020 2020 2020 7365 6c66 2e67 6574 5f62        self.get_b
-000247e0: 6172 656d 6574 616c 5f68 6f73 7473 5f66  aremetal_hosts_f
-000247f0: 726f 6d5f 636f 6e66 706f 6f6c 2863 6c75  rom_confpool(clu
-00024800: 7374 6572 2c20 6261 7265 6d65 7461 6c70  ster, baremetalp
-00024810: 6f6f 6c2c 206f 7665 7272 6964 6573 3d6b  ool, overrides=k
-00024820: 7562 655f 6f76 6572 7269 6465 7329 0a20  ube_overrides). 
-00024830: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
-00024840: 7465 5f6b 7562 6528 636c 7573 7465 722c  te_kube(cluster,
-00024850: 206b 7562 6574 7970 652c 206b 7562 655f   kubetype, kube_
-00024860: 6f76 6572 7269 6465 7329 0a0a 2020 2020  overrides)..    
-00024870: 6465 6620 6372 6561 7465 5f6b 7562 6528  def create_kube(
-00024880: 7365 6c66 2c20 636c 7573 7465 722c 206b  self, cluster, k
-00024890: 7562 6574 7970 652c 206f 7665 7272 6964  ubetype, overrid
-000248a0: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
-000248b0: 6966 2073 656c 662e 7479 7065 203d 3d20  if self.type == 
-000248c0: 2777 6562 2720 616e 6420 7365 6c66 2e6b  'web' and self.k
-000248d0: 2e6c 6f63 616c 6b75 6265 3a0a 2020 2020  .localkube:.    
-000248e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000248f0: 656c 662e 6b2e 6372 6561 7465 5f6b 7562  elf.k.create_kub
-00024900: 6528 636c 7573 7465 722c 206b 7562 6574  e(cluster, kubet
-00024910: 7970 652c 206f 7665 7272 6964 6573 3d6f  ype, overrides=o
-00024920: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
-00024930: 2020 6970 706f 6f6c 203d 206f 7665 7272    ippool = overr
-00024940: 6964 6573 2e67 6574 2827 6970 706f 6f6c  ides.get('ippool
-00024950: 2729 206f 7220 6f76 6572 7269 6465 732e  ') or overrides.
-00024960: 6765 7428 2763 6f6e 6670 6f6f 6c27 290a  get('confpool').
-00024970: 2020 2020 2020 2020 6261 7265 6d65 7461          baremeta
-00024980: 6c70 6f6f 6c20 3d20 6f76 6572 7269 6465  lpool = override
-00024990: 732e 6765 7428 2769 7070 6f6f 6c27 2920  s.get('ippool') 
-000249a0: 6f72 206f 7665 7272 6964 6573 2e67 6574  or overrides.get
-000249b0: 2827 636f 6e66 706f 6f6c 2729 0a20 2020  ('confpool').   
-000249c0: 2020 2020 2069 6620 6970 706f 6f6c 2069       if ippool i
-000249d0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-000249e0: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
-000249f0: 5f76 6970 5f66 726f 6d5f 636f 6e66 706f  _vip_from_confpo
-00024a00: 6f6c 2863 6c75 7374 6572 2c20 6970 706f  ol(cluster, ippo
-00024a10: 6f6c 2c20 6f76 6572 7269 6465 733d 6f76  ol, overrides=ov
-00024a20: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
-00024a30: 2069 6620 6261 7265 6d65 7461 6c70 6f6f   if baremetalpoo
-00024a40: 6c20 6973 206e 6f74 204e 6f6e 653a 0a20  l is not None:. 
-00024a50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00024a60: 6765 745f 6261 7265 6d65 7461 6c5f 686f  get_baremetal_ho
-00024a70: 7374 735f 6672 6f6d 5f63 6f6e 6670 6f6f  sts_from_confpoo
-00024a80: 6c28 636c 7573 7465 722c 2062 6172 656d  l(cluster, barem
-00024a90: 6574 616c 706f 6f6c 2c20 6f76 6572 7269  etalpool, overri
-00024aa0: 6465 733d 6f76 6572 7269 6465 7329 0a20  des=overrides). 
-00024ab0: 2020 2020 2020 2069 6620 6b75 6265 7479         if kubety
-00024ac0: 7065 203d 3d20 276f 7065 6e73 6869 6674  pe == 'openshift
-00024ad0: 273a 0a20 2020 2020 2020 2020 2020 2072  ':.            r
-00024ae0: 6573 756c 7420 3d20 7365 6c66 2e63 7265  esult = self.cre
-00024af0: 6174 655f 6b75 6265 5f6f 7065 6e73 6869  ate_kube_openshi
-00024b00: 6674 2863 6c75 7374 6572 2c20 6f76 6572  ft(cluster, over
-00024b10: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
-00024b20: 0a20 2020 2020 2020 2065 6c69 6620 6b75  .        elif ku
-00024b30: 6265 7479 7065 203d 3d20 2768 7970 6572  betype == 'hyper
-00024b40: 7368 6966 7427 3a0a 2020 2020 2020 2020  shift':.        
-00024b50: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-00024b60: 662e 6372 6561 7465 5f6b 7562 655f 6879  f.create_kube_hy
-00024b70: 7065 7273 6869 6674 2863 6c75 7374 6572  pershift(cluster
-00024b80: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-00024b90: 7269 6465 7329 0a20 2020 2020 2020 2065  rides).        e
-00024ba0: 6c69 6620 6b75 6265 7479 7065 203d 3d20  lif kubetype == 
-00024bb0: 276d 6963 726f 7368 6966 7427 3a0a 2020  'microshift':.  
-00024bc0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00024bd0: 203d 2073 656c 662e 6372 6561 7465 5f6b   = self.create_k
-00024be0: 7562 655f 6d69 6372 6f73 6869 6674 2863  ube_microshift(c
-00024bf0: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
-00024c00: 733d 6f76 6572 7269 6465 7329 0a20 2020  s=overrides).   
-00024c10: 2020 2020 2065 6c69 6620 6b75 6265 7479       elif kubety
-00024c20: 7065 203d 3d20 276b 3373 273a 0a20 2020  pe == 'k3s':.   
-00024c30: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00024c40: 3d20 7365 6c66 2e63 7265 6174 655f 6b75  = self.create_ku
-00024c50: 6265 5f6b 3373 2863 6c75 7374 6572 2c20  be_k3s(cluster, 
-00024c60: 6f76 6572 7269 6465 733d 6f76 6572 7269  overrides=overri
-00024c70: 6465 7329 0a20 2020 2020 2020 2065 6c69  des).        eli
-00024c80: 6620 6b75 6265 7479 7065 203d 3d20 2767  f kubetype == 'g
-00024c90: 6b65 273a 0a20 2020 2020 2020 2020 2020  ke':.           
-00024ca0: 2072 6573 756c 7420 3d20 7365 6c66 2e63   result = self.c
-00024cb0: 7265 6174 655f 6b75 6265 5f67 6b65 2863  reate_kube_gke(c
-00024cc0: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
-00024cd0: 733d 6f76 6572 7269 6465 7329 0a20 2020  s=overrides).   
-00024ce0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00024cf0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00024d00: 7365 6c66 2e63 7265 6174 655f 6b75 6265  self.create_kube
-00024d10: 5f67 656e 6572 6963 2863 6c75 7374 6572  _generic(cluster
-00024d20: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-00024d30: 7269 6465 7329 0a20 2020 2020 2020 2072  rides).        r
-00024d40: 6574 7572 6e20 7265 7375 6c74 0a0a 2020  eturn result..  
-00024d50: 2020 6465 6620 6372 6561 7465 5f6b 7562    def create_kub
-00024d60: 655f 6765 6e65 7269 6328 7365 6c66 2c20  e_generic(self, 
-00024d70: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00024d80: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
-00024d90: 6966 2063 6f6e 7461 696e 6572 5f6d 6f64  if container_mod
-00024da0: 6528 293a 0a20 2020 2020 2020 2020 2020  e():.           
-00024db0: 206f 732e 656e 7669 726f 6e5b 2750 4154   os.environ['PAT
-00024dc0: 4827 5d20 2b3d 2027 3a2f 776f 726b 6469  H'] += ':/workdi
-00024dd0: 7227 0a20 2020 2020 2020 2065 6c73 653a  r'.        else:
-00024de0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-00024df0: 656e 7669 726f 6e5b 2750 4154 4827 5d20  environ['PATH'] 
-00024e00: 2b3d 2027 3a25 7327 2025 206f 732e 6765  += ':%s' % os.ge
-00024e10: 7463 7764 2829 0a20 2020 2020 2020 2070  tcwd().        p
-00024e20: 6c61 6e64 6972 203d 206f 732e 7061 7468  landir = os.path
-00024e30: 2e64 6972 6e61 6d65 286b 7562 6561 646d  .dirname(kubeadm
-00024e40: 2e63 7265 6174 652e 5f5f 636f 6465 5f5f  .create.__code__
-00024e50: 2e63 6f5f 6669 6c65 6e61 6d65 290a 2020  .co_filename).  
-00024e60: 2020 2020 2020 7265 7475 726e 206b 7562        return kub
-00024e70: 6561 646d 2e63 7265 6174 6528 7365 6c66  eadm.create(self
-00024e80: 2c20 706c 616e 6469 722c 2063 6c75 7374  , plandir, clust
-00024e90: 6572 2c20 6f76 6572 7269 6465 7329 0a0a  er, overrides)..
-00024ea0: 2020 2020 6465 6620 6372 6561 7465 5f6b      def create_k
-00024eb0: 7562 655f 676b 6528 7365 6c66 2c20 636c  ube_gke(self, cl
-00024ec0: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00024ed0: 3d7b 7d29 3a0a 2020 2020 2020 2020 6672  ={}):.        fr
-00024ee0: 6f6d 206b 7669 7274 2e63 6c75 7374 6572  om kvirt.cluster
-00024ef0: 2069 6d70 6f72 7420 676b 650a 2020 2020   import gke.    
-00024f00: 2020 2020 6966 2063 6f6e 7461 696e 6572      if container
-00024f10: 5f6d 6f64 6528 293a 0a20 2020 2020 2020  _mode():.       
-00024f20: 2020 2020 206f 732e 656e 7669 726f 6e5b       os.environ[
-00024f30: 2750 4154 4827 5d20 2b3d 2027 3a2f 776f  'PATH'] += ':/wo
-00024f40: 726b 6469 7227 0a20 2020 2020 2020 2065  rkdir'.        e
-00024f50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00024f60: 206f 732e 656e 7669 726f 6e5b 2750 4154   os.environ['PAT
-00024f70: 4827 5d20 2b3d 2027 3a25 7327 2025 206f  H'] += ':%s' % o
-00024f80: 732e 6765 7463 7764 2829 0a20 2020 2020  s.getcwd().     
-00024f90: 2020 2072 6574 7572 6e20 676b 652e 6372     return gke.cr
-00024fa0: 6561 7465 2873 656c 662c 2063 6c75 7374  eate(self, clust
-00024fb0: 6572 2c20 6f76 6572 7269 6465 7329 0a0a  er, overrides)..
-00024fc0: 2020 2020 6465 6620 6372 6561 7465 5f6b      def create_k
-00024fd0: 7562 655f 6d69 6372 6f73 6869 6674 2873  ube_microshift(s
-00024fe0: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
-00024ff0: 6572 7269 6465 733d 7b7d 293a 0a20 2020  errides={}):.   
-00025000: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
-00025010: 725f 6d6f 6465 2829 3a0a 2020 2020 2020  r_mode():.      
-00025020: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-00025030: 5b27 5041 5448 275d 202b 3d20 273a 2f77  ['PATH'] += ':/w
-00025040: 6f72 6b64 6972 270a 2020 2020 2020 2020  orkdir'.        
-00025050: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00025060: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
-00025070: 5448 275d 202b 3d20 273a 2573 2720 2520  TH'] += ':%s' % 
-00025080: 6f73 2e67 6574 6377 6428 290a 2020 2020  os.getcwd().    
-00025090: 2020 2020 706c 616e 6469 7220 3d20 6f73      plandir = os
-000250a0: 2e70 6174 682e 6469 726e 616d 6528 6d69  .path.dirname(mi
-000250b0: 6372 6f73 6869 6674 2e63 7265 6174 652e  croshift.create.
-000250c0: 5f5f 636f 6465 5f5f 2e63 6f5f 6669 6c65  __code__.co_file
-000250d0: 6e61 6d65 290a 2020 2020 2020 2020 7265  name).        re
-000250e0: 7475 726e 206d 6963 726f 7368 6966 742e  turn microshift.
-000250f0: 6372 6561 7465 2873 656c 662c 2070 6c61  create(self, pla
-00025100: 6e64 6972 2c20 636c 7573 7465 722c 206f  ndir, cluster, o
-00025110: 7665 7272 6964 6573 290a 0a20 2020 2064  verrides)..    d
-00025120: 6566 2063 7265 6174 655f 6b75 6265 5f6b  ef create_kube_k
-00025130: 3373 2873 656c 662c 2063 6c75 7374 6572  3s(self, cluster
-00025140: 2c20 6f76 6572 7269 6465 733d 7b7d 293a  , overrides={}):
-00025150: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
-00025160: 6169 6e65 725f 6d6f 6465 2829 3a0a 2020  ainer_mode():.  
-00025170: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
-00025180: 6972 6f6e 5b27 5041 5448 275d 202b 3d20  iron['PATH'] += 
-00025190: 273a 2f77 6f72 6b64 6972 270a 2020 2020  ':/workdir'.    
-000251a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000251b0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-000251c0: 5b27 5041 5448 275d 202b 3d20 273a 2573  ['PATH'] += ':%s
-000251d0: 2720 2520 6f73 2e67 6574 6377 6428 290a  ' % os.getcwd().
-000251e0: 2020 2020 2020 2020 706c 616e 6469 7220          plandir 
-000251f0: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-00025200: 6528 6b33 732e 6372 6561 7465 2e5f 5f63  e(k3s.create.__c
-00025210: 6f64 655f 5f2e 636f 5f66 696c 656e 616d  ode__.co_filenam
-00025220: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-00025230: 6e20 6b33 732e 6372 6561 7465 2873 656c  n k3s.create(sel
-00025240: 662c 2070 6c61 6e64 6972 2c20 636c 7573  f, plandir, clus
-00025250: 7465 722c 206f 7665 7272 6964 6573 290a  ter, overrides).
-00025260: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-00025270: 6b75 6265 5f68 7970 6572 7368 6966 7428  kube_hypershift(
-00025280: 7365 6c66 2c20 636c 7573 7465 722c 206f  self, cluster, o
-00025290: 7665 7272 6964 6573 3d7b 7d29 3a0a 2020  verrides={}):.  
-000252a0: 2020 2020 2020 6966 2063 6f6e 7461 696e        if contain
-000252b0: 6572 5f6d 6f64 6528 293a 0a20 2020 2020  er_mode():.     
-000252c0: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
-000252d0: 6e5b 2750 4154 4827 5d20 2b3d 2027 3a2f  n['PATH'] += ':/
-000252e0: 776f 726b 6469 7227 0a20 2020 2020 2020  workdir'.       
-000252f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00025300: 2020 206f 732e 656e 7669 726f 6e5b 2750     os.environ['P
-00025310: 4154 4827 5d20 2b3d 2027 3a25 7327 2025  ATH'] += ':%s' %
-00025320: 206f 732e 6765 7463 7764 2829 0a20 2020   os.getcwd().   
-00025330: 2020 2020 2070 6c61 6e64 6972 203d 206f       plandir = o
-00025340: 732e 7061 7468 2e64 6972 6e61 6d65 2868  s.path.dirname(h
-00025350: 7970 6572 7368 6966 742e 6372 6561 7465  ypershift.create
-00025360: 2e5f 5f63 6f64 655f 5f2e 636f 5f66 696c  .__code__.co_fil
-00025370: 656e 616d 6529 0a20 2020 2020 2020 2023  ename).        #
-00025380: 2064 6e73 636c 6965 6e74 203d 206f 7665   dnsclient = ove
-00025390: 7272 6964 6573 2e67 6574 2827 646e 7363  rrides.get('dnsc
-000253a0: 6c69 656e 7427 290a 2020 2020 2020 2020  lient').        
-000253b0: 2320 646e 7363 6f6e 6669 6720 3d20 4b63  # dnsconfig = Kc
-000253c0: 6f6e 6669 6728 636c 6965 6e74 3d64 6e73  onfig(client=dns
-000253d0: 636c 6965 6e74 2920 6966 2064 6e73 636c  client) if dnscl
-000253e0: 6965 6e74 2069 7320 6e6f 7420 4e6f 6e65  ient is not None
-000253f0: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
-00025400: 2020 2072 6574 7572 6e20 6879 7065 7273     return hypers
-00025410: 6869 6674 2e63 7265 6174 6528 7365 6c66  hift.create(self
-00025420: 2c20 706c 616e 6469 722c 2063 6c75 7374  , plandir, clust
-00025430: 6572 2c20 6f76 6572 7269 6465 7329 0a0a  er, overrides)..
-00025440: 2020 2020 6465 6620 6372 6561 7465 5f6b      def create_k
-00025450: 7562 655f 6f70 656e 7368 6966 7428 7365  ube_openshift(se
-00025460: 6c66 2c20 636c 7573 7465 722c 206f 7665  lf, cluster, ove
-00025470: 7272 6964 6573 3d7b 7d29 3a0a 2020 2020  rrides={}):.    
-00025480: 2020 2020 6966 2063 6f6e 7461 696e 6572      if container
-00025490: 5f6d 6f64 6528 293a 0a20 2020 2020 2020  _mode():.       
-000254a0: 2020 2020 206f 732e 656e 7669 726f 6e5b       os.environ[
-000254b0: 2750 4154 4827 5d20 2b3d 2027 3a2f 776f  'PATH'] += ':/wo
-000254c0: 726b 6469 7227 0a20 2020 2020 2020 2065  rkdir'.        e
-000254d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000254e0: 206f 732e 656e 7669 726f 6e5b 2750 4154   os.environ['PAT
-000254f0: 4827 5d20 2b3d 2027 3a25 7327 2025 206f  H'] += ':%s' % o
-00025500: 732e 6765 7463 7764 2829 0a20 2020 2020  s.getcwd().     
-00025510: 2020 2070 6c61 6e64 6972 203d 206f 732e     plandir = os.
-00025520: 7061 7468 2e64 6972 6e61 6d65 286f 7065  path.dirname(ope
-00025530: 6e73 6869 6674 2e63 7265 6174 652e 5f5f  nshift.create.__
-00025540: 636f 6465 5f5f 2e63 6f5f 6669 6c65 6e61  code__.co_filena
-00025550: 6d65 290a 2020 2020 2020 2020 646e 7363  me).        dnsc
-00025560: 6c69 656e 7420 3d20 6f76 6572 7269 6465  lient = override
-00025570: 732e 6765 7428 2764 6e73 636c 6965 6e74  s.get('dnsclient
-00025580: 2729 0a20 2020 2020 2020 2064 6e73 636f  ').        dnsco
-00025590: 6e66 6967 203d 204b 636f 6e66 6967 2863  nfig = Kconfig(c
-000255a0: 6c69 656e 743d 646e 7363 6c69 656e 7429  lient=dnsclient)
-000255b0: 2069 6620 646e 7363 6c69 656e 7420 6973   if dnsclient is
-000255c0: 206e 6f74 204e 6f6e 6520 656c 7365 204e   not None else N
-000255d0: 6f6e 650a 2020 2020 2020 2020 7265 7475  one.        retu
-000255e0: 726e 206f 7065 6e73 6869 6674 2e63 7265  rn openshift.cre
-000255f0: 6174 6528 7365 6c66 2c20 706c 616e 6469  ate(self, plandi
-00025600: 722c 2063 6c75 7374 6572 2c20 6f76 6572  r, cluster, over
-00025610: 7269 6465 732c 2064 6e73 636f 6e66 6967  rides, dnsconfig
-00025620: 3d64 6e73 636f 6e66 6967 290a 0a20 2020  =dnsconfig)..   
-00025630: 2064 6566 2064 656c 6574 655f 6b75 6265   def delete_kube
-00025640: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
-00025650: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
-00025660: 2020 2020 2020 2068 7970 6572 7368 6966         hypershif
-00025670: 7420 3d20 4661 6c73 650a 2020 2020 2020  t = False.      
-00025680: 2020 6173 7369 7374 6564 203d 2046 616c    assisted = Fal
-00025690: 7365 0a20 2020 2020 2020 2067 6b65 203d  se.        gke =
-000256a0: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-000256b0: 6f6d 6169 6e20 3d20 6f76 6572 7269 6465  omain = override
-000256c0: 732e 6765 7428 2764 6f6d 6169 6e27 2c20  s.get('domain', 
-000256d0: 276b 6172 6d61 6c61 6273 2e63 6f72 7027  'karmalabs.corp'
-000256e0: 290a 2020 2020 2020 2020 6b75 6265 7479  ).        kubety
-000256f0: 7065 203d 206f 7665 7272 6964 6573 2e67  pe = overrides.g
-00025700: 6574 2827 6b75 6265 7479 7065 272c 2027  et('kubetype', '
-00025710: 6765 6e65 7269 6327 290a 2020 2020 2020  generic').      
-00025720: 2020 646e 7363 6c69 656e 7420 3d20 4e6f    dnsclient = No
-00025730: 6e65 0a20 2020 2020 2020 206b 203d 2073  ne.        k = s
-00025740: 656c 662e 6b0a 2020 2020 2020 2020 6966  elf.k.        if
-00025750: 2073 656c 662e 7479 7065 203d 3d20 2777   self.type == 'w
-00025760: 6562 2720 616e 6420 7365 6c66 2e6b 2e6c  eb' and self.k.l
-00025770: 6f63 616c 6b75 6265 3a0a 2020 2020 2020  ocalkube:.      
-00025780: 2020 2020 2020 7265 7475 726e 206b 2e64        return k.d
-00025790: 656c 6574 655f 6b75 6265 2863 6c75 7374  elete_kube(clust
-000257a0: 6572 2c20 6b75 6265 7479 7065 2c20 6f76  er, kubetype, ov
-000257b0: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-000257c0: 7329 0a20 2020 2020 2020 2063 6c75 7374  s).        clust
-000257d0: 6572 203d 206f 7665 7272 6964 6573 2e67  er = overrides.g
-000257e0: 6574 2827 636c 7573 7465 7227 2c20 636c  et('cluster', cl
-000257f0: 7573 7465 7229 0a20 2020 2020 2020 2069  uster).        i
-00025800: 6620 636c 7573 7465 7220 6973 204e 6f6e  f cluster is Non
-00025810: 6520 6f72 2063 6c75 7374 6572 203d 3d20  e or cluster == 
-00025820: 2727 3a0a 2020 2020 2020 2020 2020 2020  '':.            
-00025830: 6465 6661 756c 745f 636c 7573 7465 7273  default_clusters
-00025840: 203d 207b 2767 656e 6572 6963 273a 2027   = {'generic': '
-00025850: 6d79 6b75 6265 272c 2027 6879 7065 7273  mykube', 'hypers
-00025860: 6869 6674 273a 2027 6d79 6879 7065 7273  hift': 'myhypers
-00025870: 6869 6674 272c 2027 6f70 656e 7368 6966  hift', 'openshif
-00025880: 7427 3a20 276d 796f 7065 6e73 6869 6674  t': 'myopenshift
-00025890: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-000258a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000258b0: 2020 2027 6b33 7327 3a20 276d 796b 3373     'k3s': 'myk3s
-000258c0: 272c 2027 6d69 6372 6f73 6869 6674 273a  ', 'microshift':
-000258d0: 2027 6d79 6d69 6372 6f73 6869 6674 272c   'mymicroshift',
-000258e0: 2027 676b 6527 3a20 276d 7967 6b65 277d   'gke': 'mygke'}
-000258f0: 0a20 2020 2020 2020 2020 2020 2063 6c75  .            clu
-00025900: 7374 6572 203d 2064 6566 6175 6c74 5f63  ster = default_c
-00025910: 6c75 7374 6572 735b 6b75 6265 7479 7065  lusters[kubetype
-00025920: 5d0a 2020 2020 2020 2020 636c 7573 7465  ].        cluste
-00025930: 7264 6174 6120 3d20 7b7d 0a20 2020 2020  rdata = {}.     
-00025940: 2020 2063 6c75 7374 6572 6469 7220 3d20     clusterdir = 
-00025950: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
-00025960: 6572 2866 227e 2f2e 6b63 6c69 2f63 6c75  er(f"~/.kcli/clu
-00025970: 7374 6572 732f 7b63 6c75 7374 6572 7d22  sters/{cluster}"
-00025980: 290a 2020 2020 2020 2020 6966 206f 732e  ).        if os.
-00025990: 7061 7468 2e65 7869 7374 7328 636c 7573  path.exists(clus
-000259a0: 7465 7264 6972 293a 0a20 2020 2020 2020  terdir):.       
-000259b0: 2020 2020 2070 6172 616d 6574 6572 7366       parametersf
-000259c0: 696c 6520 3d20 6622 7b63 6c75 7374 6572  ile = f"{cluster
-000259d0: 6469 727d 2f6b 636c 695f 7061 7261 6d65  dir}/kcli_parame
-000259e0: 7465 7273 2e79 6d6c 220a 2020 2020 2020  ters.yml".      
-000259f0: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00025a00: 2e65 7869 7374 7328 7061 7261 6d65 7465  .exists(paramete
-00025a10: 7273 6669 6c65 293a 0a20 2020 2020 2020  rsfile):.       
-00025a20: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-00025a30: 656e 2870 6172 616d 6574 6572 7366 696c  en(parametersfil
-00025a40: 6529 2061 7320 663a 0a20 2020 2020 2020  e) as f:.       
-00025a50: 2020 2020 2020 2020 2020 2020 2063 6c75               clu
-00025a60: 7374 6572 6461 7461 203d 2079 616d 6c2e  sterdata = yaml.
-00025a70: 7361 6665 5f6c 6f61 6428 6629 0a20 2020  safe_load(f).   
-00025a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025a90: 206b 7562 6574 7970 6520 3d20 636c 7573   kubetype = clus
-00025aa0: 7465 7264 6174 612e 6765 7428 276b 7562  terdata.get('kub
-00025ab0: 6574 7970 6527 2c20 2767 656e 6572 6963  etype', 'generic
-00025ac0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00025ad0: 2020 2020 2020 2069 6620 6b75 6265 7479         if kubety
-00025ae0: 7065 203d 3d20 2768 7970 6572 7368 6966  pe == 'hypershif
-00025af0: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
-00025b00: 2020 2020 2020 2020 2020 2020 6879 7065              hype
-00025b10: 7273 6869 6674 203d 2054 7275 650a 2020  rshift = True.  
-00025b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b30: 2020 2020 2020 6173 7369 7374 6564 203d        assisted =
-00025b40: 2063 6c75 7374 6572 6461 7461 2e67 6574   clusterdata.get
-00025b50: 2827 6173 7369 7374 6564 272c 2046 616c  ('assisted', Fal
-00025b60: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-00025b70: 2020 2020 2020 2020 646f 6d61 696e 203d          domain =
-00025b80: 2063 6c75 7374 6572 6461 7461 2e67 6574   clusterdata.get
-00025b90: 2827 646f 6d61 696e 272c 2064 6f6d 6169  ('domain', domai
-00025ba0: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
-00025bb0: 2020 2020 2020 2064 6e73 636c 6965 6e74         dnsclient
-00025bc0: 203d 2063 6c75 7374 6572 6461 7461 2e67   = clusterdata.g
-00025bd0: 6574 2827 646e 7363 6c69 656e 7427 290a  et('dnsclient').
-00025be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025bf0: 2020 2020 676b 6520 3d20 6b75 6265 7479      gke = kubety
-00025c00: 7065 203d 3d20 2767 6b65 270a 2020 2020  pe == 'gke'.    
-00025c10: 2020 2020 6465 6c65 7465 636c 6965 6e74      deleteclient
-00025c20: 7320 3d20 7b73 656c 662e 636c 6965 6e74  s = {self.client
-00025c30: 3a20 6b7d 0a20 2020 2020 2020 2076 6d63  : k}.        vmc
-00025c40: 6c69 656e 7473 203d 205b 5d0a 2020 2020  lients = [].    
-00025c50: 2020 2020 766d 636c 6965 6e74 735f 6669      vmclients_fi
-00025c60: 6c65 203d 206f 732e 7061 7468 2e65 7870  le = os.path.exp
-00025c70: 616e 6475 7365 7228 6627 7e2f 2e6b 636c  anduser(f'~/.kcl
-00025c80: 692f 766d 636c 6965 6e74 735f 7b63 6c75  i/vmclients_{clu
-00025c90: 7374 6572 7d27 290a 2020 2020 2020 2020  ster}').        
-00025ca0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-00025cb0: 7328 766d 636c 6965 6e74 735f 6669 6c65  s(vmclients_file
-00025cc0: 293a 0a20 2020 2020 2020 2020 2020 2076  ):.            v
-00025cd0: 6d63 6c69 656e 7473 203d 2079 616d 6c2e  mclients = yaml.
-00025ce0: 7361 6665 5f6c 6f61 6428 6f70 656e 2876  safe_load(open(v
-00025cf0: 6d63 6c69 656e 7473 5f66 696c 6529 290a  mclients_file)).
-00025d00: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
-00025d10: 656d 6f76 6528 766d 636c 6965 6e74 735f  emove(vmclients_
-00025d20: 6669 6c65 290a 2020 2020 2020 2020 6966  file).        if
-00025d30: 2073 656c 662e 6578 7472 6163 6c69 656e   self.extraclien
-00025d40: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00025d50: 6465 6c65 7465 636c 6965 6e74 732e 7570  deleteclients.up
-00025d60: 6461 7465 2873 656c 662e 6578 7472 6163  date(self.extrac
-00025d70: 6c69 656e 7473 290a 2020 2020 2020 2020  lients).        
-00025d80: 656c 6966 2076 6d63 6c69 656e 7473 3a0a  elif vmclients:.
-00025d90: 2020 2020 2020 2020 2020 2020 6465 6c65              dele
-00025da0: 7465 636c 6965 6e74 732e 7570 6461 7465  teclients.update
-00025db0: 287b 636c 693a 204b 636f 6e66 6967 2863  ({cli: Kconfig(c
-00025dc0: 6c69 656e 743d 636c 6929 2e6b 2066 6f72  lient=cli).k for
-00025dd0: 2063 6c69 2069 6e20 766d 636c 6965 6e74   cli in vmclient
-00025de0: 7320 6966 2063 6c69 2021 3d20 7365 6c66  s if cli != self
-00025df0: 2e63 6c69 656e 747d 290a 2020 2020 2020  .client}).      
-00025e00: 2020 666f 7220 6879 7065 7276 6973 6f72    for hypervisor
-00025e10: 2069 6e20 6465 6c65 7465 636c 6965 6e74   in deleteclient
-00025e20: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-00025e30: 203d 2064 656c 6574 6563 6c69 656e 7473   = deleteclients
-00025e40: 5b68 7970 6572 7669 736f 725d 0a20 2020  [hypervisor].   
-00025e50: 2020 2020 2020 2020 2066 6f72 2076 6d20           for vm 
-00025e60: 696e 2073 6f72 7465 6428 632e 6c69 7374  in sorted(c.list
-00025e70: 2829 2c20 6b65 793d 6c61 6d62 6461 2078  (), key=lambda x
-00025e80: 3a20 785b 276e 616d 6527 5d29 3a0a 2020  : x['name']):.  
-00025e90: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-00025ea0: 6d65 203d 2076 6d5b 276e 616d 6527 5d0a  me = vm['name'].
-00025eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ec0: 646e 7363 6c69 656e 7420 3d20 766d 2e67  dnsclient = vm.g
-00025ed0: 6574 2827 646e 7363 6c69 656e 7427 2920  et('dnsclient') 
-00025ee0: 6f72 2064 6e73 636c 6965 6e74 0a20 2020  or dnsclient.   
-00025ef0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00025f00: 7265 6e74 636c 7573 7465 7220 3d20 766d  rentcluster = vm
-00025f10: 2e67 6574 2827 6b75 6265 2729 0a20 2020  .get('kube').   
-00025f20: 2020 2020 2020 2020 2020 2020 206b 7562               kub
-00025f30: 6574 7970 6520 3d20 766d 2e67 6574 2827  etype = vm.get('
+00023f50: 2020 2020 2020 2069 6620 6f73 2e70 6f70         if os.pop
+00023f60: 656e 2874 6573 7463 6d64 292e 7265 6164  en(testcmd).read
+00023f70: 2829 2e73 7472 6970 2829 2021 3d20 7573  ().strip() != us
+00023f80: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00023f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023fa0: 7761 726e 696e 6728 2247 6174 6865 7265  warning("Gathere
+00023fb0: 6420 6970 206e 6f74 2066 756e 6374 696f  d ip not functio
+00023fc0: 6e61 6c20 7965 742e 2e2e 2229 0a20 2020  nal yet...").   
+00023fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023fe0: 2020 2020 2020 2020 2069 7020 3d20 4e6f           ip = No
+00023ff0: 6e65 0a20 2020 2020 2020 2020 2020 2070  ne.            p
+00024000: 7072 696e 7428 2257 6169 7469 6e67 2066  print("Waiting f
+00024010: 6f72 2076 6d20 746f 2062 6520 6163 6365  or vm to be acce
+00024020: 7373 6962 6c65 2e2e 2e22 290a 2020 2020  ssible...").    
+00024030: 2020 2020 2020 2020 736c 6565 7028 3529          sleep(5)
+00024040: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
+00024050: 656f 7574 202b 3d20 350a 2020 2020 2020  eout += 5.      
+00024060: 2020 2020 2020 6966 2077 6169 7474 696d        if waittim
+00024070: 656f 7574 203e 2030 2061 6e64 2074 696d  eout > 0 and tim
+00024080: 656f 7574 203e 2077 6169 7474 696d 656f  eout > waittimeo
+00024090: 7574 3a0a 2020 2020 2020 2020 2020 2020  ut:.            
+000240a0: 2020 2020 6572 726f 7228 2254 696d 656f      error("Timeo
+000240b0: 7574 2077 6169 7469 6e67 2066 6f72 2076  ut waiting for v
+000240c0: 6d20 746f 2062 6520 6163 6365 7373 6962  m to be accessib
+000240d0: 6c65 2e2e 2e22 290a 2020 2020 2020 2020  le...").        
+000240e0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+000240f0: 2020 2020 2020 736c 6565 7028 3529 0a20        sleep(5). 
+00024100: 2020 2020 2020 206f 6c64 6f75 7470 7574         oldoutput
+00024110: 203d 2027 270a 2020 2020 2020 2020 7469   = ''.        ti
+00024120: 6d65 6f75 7420 3d20 300a 2020 2020 2020  meout = 0.      
+00024130: 2020 7768 696c 6520 5472 7565 3a0a 2020    while True:.  
+00024140: 2020 2020 2020 2020 2020 7373 6863 6d64            sshcmd
+00024150: 203d 2063 6f6d 6d6f 6e2e 7373 6828 6e61   = common.ssh(na
+00024160: 6d65 2c20 7573 6572 3d27 726f 6f74 272c  me, user='root',
+00024170: 2069 703d 6970 2c20 7475 6e6e 656c 3d63   ip=ip, tunnel=c
+00024180: 6f6e 6669 672e 7475 6e6e 656c 2c20 7475  onfig.tunnel, tu
+00024190: 6e6e 656c 686f 7374 3d63 6f6e 6669 672e  nnelhost=config.
+000241a0: 7475 6e6e 656c 686f 7374 2c0a 2020 2020  tunnelhost,.    
+000241b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000241c0: 2020 2020 2020 2020 2020 2020 766d 706f              vmpo
+000241d0: 7274 3d76 6d70 6f72 742c 2074 756e 6e65  rt=vmport, tunne
+000241e0: 6c70 6f72 743d 636f 6e66 6967 2e74 756e  lport=config.tun
+000241f0: 6e65 6c70 6f72 742c 2074 756e 6e65 6c75  nelport, tunnelu
+00024200: 7365 723d 636f 6e66 6967 2e74 756e 6e65  ser=config.tunne
+00024210: 6c75 7365 722c 0a20 2020 2020 2020 2020  luser,.         
+00024220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024230: 2020 2020 2020 2069 6e73 6563 7572 653d         insecure=
+00024240: 636f 6e66 6967 2e69 6e73 6563 7572 652c  config.insecure,
+00024250: 2063 6d64 3d63 6d64 2c20 6964 656e 7469   cmd=cmd, identi
+00024260: 7479 6669 6c65 3d69 6465 6e74 6974 7966  tyfile=identityf
+00024270: 696c 652c 2070 6173 7377 6f72 643d 4661  ile, password=Fa
+00024280: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
+00024290: 206f 7574 7075 7420 3d20 6f73 2e70 6f70   output = os.pop
+000242a0: 656e 2873 7368 636d 6429 2e72 6561 6428  en(sshcmd).read(
+000242b0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000242c0: 2077 6169 7463 6f6d 6d61 6e64 2069 7320   waitcommand is 
+000242d0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000242e0: 2020 2020 2020 2020 2020 6966 206f 7574            if out
+000242f0: 7075 7420 213d 2027 273a 0a20 2020 2020  put != '':.     
+00024300: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00024310: 7269 6e74 286f 7574 7075 7429 0a20 2020  rint(output).   
+00024320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024330: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00024340: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00024350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024360: 2070 7072 696e 7428 2257 6169 7469 6e67   pprint("Waiting
+00024370: 2066 6f72 2077 6169 7463 6f6d 6d61 6e64   for waitcommand
+00024380: 2074 6f20 7375 6363 6565 642e 2e2e 2229   to succeed...")
+00024390: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000243a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000243b0: 2020 2069 6620 276b 636c 6920 626f 6f74     if 'kcli boot
+000243c0: 2066 696e 6973 6865 6427 2069 6e20 6f75   finished' in ou
+000243d0: 7470 7574 206f 7220 2749 676e 6974 696f  tput or 'Ignitio
+000243e0: 6e20 6669 6e69 7368 6564 2073 7563 6365  n finished succe
+000243f0: 7373 6675 6c6c 7927 2069 6e20 6f75 7470  ssfully' in outp
+00024400: 7574 206f 725c 0a20 2020 2020 2020 2020  ut or\.         
+00024410: 2020 2020 2020 2020 2020 2746 696e 6973            'Finis
+00024420: 6865 6420 436f 6d62 7573 7469 6f6e 2720  hed Combustion' 
+00024430: 696e 206f 7574 7075 743a 0a20 2020 2020  in output:.     
+00024440: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00024450: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+00024460: 2020 2020 206f 7574 7075 7420 3d20 6f75       output = ou
+00024470: 7470 7574 2e72 6570 6c61 6365 286f 6c64  tput.replace(old
+00024480: 6f75 7470 7574 2c20 2727 290a 2020 2020  output, '').    
+00024490: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000244a0: 6f74 2071 7569 6574 3a0a 2020 2020 2020  ot quiet:.      
+000244b0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000244c0: 696e 7428 6f75 7470 7574 290a 2020 2020  int(output).    
+000244d0: 2020 2020 2020 2020 2020 2020 6f6c 646f              oldo
+000244e0: 7574 7075 7420 3d20 6f75 7470 7574 0a20  utput = output. 
+000244f0: 2020 2020 2020 2020 2020 2073 6c65 6570             sleep
+00024500: 2832 290a 2020 2020 2020 2020 2020 2020  (2).            
+00024510: 7469 6d65 6f75 7420 2b3d 2032 0a20 2020  timeout += 2.   
+00024520: 2020 2020 2020 2020 2069 6620 7761 6974           if wait
+00024530: 7469 6d65 6f75 7420 3e20 3020 616e 6420  timeout > 0 and 
+00024540: 7469 6d65 6f75 7420 3e20 7761 6974 7469  timeout > waitti
+00024550: 6d65 6f75 743a 0a20 2020 2020 2020 2020  meout:.         
+00024560: 2020 2020 2020 2065 7272 6f72 2822 5469         error("Ti
+00024570: 6d65 6f75 7420 7761 6974 696e 6720 666f  meout waiting fo
+00024580: 7220 7761 6974 636f 6d6d 616e 6420 746f  r waitcommand to
+00024590: 2065 7865 6375 7465 2e2e 2e22 290a 2020   execute...").  
+000245a0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+000245b0: 6561 6b0a 2020 2020 2020 2020 7265 7475  eak.        retu
+000245c0: 726e 2054 7275 650a 0a20 2020 2064 6566  rn True..    def
+000245d0: 2063 6c65 616e 5f74 656d 706b 6579 2873   clean_tempkey(s
+000245e0: 656c 662c 206e 616d 652c 2069 6465 6e74  elf, name, ident
+000245f0: 6974 7966 696c 653d 4e6f 6e65 293a 0a20  ityfile=None):. 
+00024600: 2020 2020 2020 2063 6d64 203d 2022 7365         cmd = "se
+00024610: 6420 2d69 2027 2f74 656d 702d 6b63 6c69  d -i '/temp-kcli
+00024620: 2d6b 6579 2f64 2720 2f68 6f6d 652f 2a2f  -key/d' /home/*/
+00024630: 2e73 7368 2f61 7574 686f 7269 7a65 645f  .ssh/authorized_
+00024640: 6b65 7973 202f 726f 6f74 2f2e 7373 682f  keys /root/.ssh/
+00024650: 6175 7468 6f72 697a 6564 5f6b 6579 7322  authorized_keys"
+00024660: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
+00024670: 662e 6b0a 2020 2020 2020 2020 696e 666f  f.k.        info
+00024680: 203d 206b 2e69 6e66 6f28 6e61 6d65 290a   = k.info(name).
+00024690: 2020 2020 2020 2020 766d 706f 7274 203d          vmport =
+000246a0: 204e 6f6e 650a 2020 2020 2020 2020 6970   None.        ip
+000246b0: 203d 2069 6e66 6f2e 6765 7428 2769 7027   = info.get('ip'
+000246c0: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
+000246d0: 662e 7479 7065 203d 3d20 276b 7562 6576  f.type == 'kubev
+000246e0: 6972 7427 3a0a 2020 2020 2020 2020 2020  irt':.          
+000246f0: 2020 6966 206b 2e61 6363 6573 735f 6d6f    if k.access_mo
+00024700: 6465 203d 3d20 274e 6f64 6550 6f72 7427  de == 'NodePort'
+00024710: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00024720: 2020 766d 706f 7274 203d 2069 6e66 6f2e    vmport = info.
+00024730: 6765 7428 276e 6f64 6570 6f72 7427 290a  get('nodeport').
+00024740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024750: 6970 203d 206b 2e6e 6f64 655f 686f 7374  ip = k.node_host
+00024760: 286e 616d 653d 696e 666f 2e67 6574 2827  (name=info.get('
+00024770: 686f 7374 2729 290a 2020 2020 2020 2020  host')).        
+00024780: 2020 2020 656c 6966 206b 2e61 6363 6573      elif k.acces
+00024790: 735f 6d6f 6465 203d 3d20 274c 6f61 6442  s_mode == 'LoadB
+000247a0: 616c 616e 6365 7227 3a0a 2020 2020 2020  alancer':.      
+000247b0: 2020 2020 2020 2020 2020 6970 203d 2069            ip = i
+000247c0: 6e66 6f2e 6765 7428 276c 6f61 6462 616c  nfo.get('loadbal
+000247d0: 616e 6365 7269 7027 290a 2020 2020 2020  ancerip').      
+000247e0: 2020 7373 6863 6d64 203d 2063 6f6d 6d6f    sshcmd = commo
+000247f0: 6e2e 7373 6828 6e61 6d65 2c20 7573 6572  n.ssh(name, user
+00024800: 3d27 726f 6f74 272c 2069 703d 6970 2c20  ='root', ip=ip, 
+00024810: 7475 6e6e 656c 3d73 656c 662e 7475 6e6e  tunnel=self.tunn
+00024820: 656c 2c20 7475 6e6e 656c 686f 7374 3d73  el, tunnelhost=s
+00024830: 656c 662e 7475 6e6e 656c 686f 7374 2c20  elf.tunnelhost, 
+00024840: 766d 706f 7274 3d76 6d70 6f72 742c 0a20  vmport=vmport,. 
+00024850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024860: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
+00024870: 6c70 6f72 743d 7365 6c66 2e74 756e 6e65  lport=self.tunne
+00024880: 6c70 6f72 742c 2074 756e 6e65 6c75 7365  lport, tunneluse
+00024890: 723d 7365 6c66 2e74 756e 6e65 6c75 7365  r=self.tunneluse
+000248a0: 722c 2069 6e73 6563 7572 653d 7365 6c66  r, insecure=self
+000248b0: 2e69 6e73 6563 7572 652c 2063 6d64 3d63  .insecure, cmd=c
+000248c0: 6d64 2c0a 2020 2020 2020 2020 2020 2020  md,.            
+000248d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000248e0: 6964 656e 7469 7479 6669 6c65 3d69 6465  identityfile=ide
+000248f0: 6e74 6974 7966 696c 652c 2070 6173 7377  ntityfile, passw
+00024900: 6f72 643d 4661 6c73 6529 0a20 2020 2020  ord=False).     
+00024910: 2020 206f 732e 706f 7065 6e28 7373 6863     os.popen(sshc
+00024920: 6d64 292e 7265 6164 2829 0a0a 2020 2020  md).read()..    
+00024930: 6465 6620 7468 7265 6164 6564 5f63 7265  def threaded_cre
+00024940: 6174 655f 6b75 6265 2873 656c 662c 2063  ate_kube(self, c
+00024950: 6c75 7374 6572 2c20 6b75 6265 7479 7065  luster, kubetype
+00024960: 2c20 6b75 6265 5f6f 7665 7272 6964 6573  , kube_overrides
+00024970: 293a 0a20 2020 2020 2020 2069 7070 6f6f  ):.        ippoo
+00024980: 6c20 3d20 6b75 6265 5f6f 7665 7272 6964  l = kube_overrid
+00024990: 6573 2e67 6574 2827 6970 706f 6f6c 2729  es.get('ippool')
+000249a0: 206f 7220 6b75 6265 5f6f 7665 7272 6964   or kube_overrid
+000249b0: 6573 2e67 6574 2827 636f 6e66 706f 6f6c  es.get('confpool
+000249c0: 2729 0a20 2020 2020 2020 2062 6172 656d  ').        barem
+000249d0: 6574 616c 706f 6f6c 203d 206b 7562 655f  etalpool = kube_
+000249e0: 6f76 6572 7269 6465 732e 6765 7428 2769  overrides.get('i
+000249f0: 7070 6f6f 6c27 2920 6f72 206b 7562 655f  ppool') or kube_
+00024a00: 6f76 6572 7269 6465 732e 6765 7428 2763  overrides.get('c
+00024a10: 6f6e 6670 6f6f 6c27 290a 2020 2020 2020  onfpool').      
+00024a20: 2020 6966 2069 7070 6f6f 6c20 6973 206e    if ippool is n
+00024a30: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00024a40: 2020 2020 2073 656c 662e 6765 745f 7669       self.get_vi
+00024a50: 705f 6672 6f6d 5f63 6f6e 6670 6f6f 6c28  p_from_confpool(
+00024a60: 636c 7573 7465 722c 2069 7070 6f6f 6c2c  cluster, ippool,
+00024a70: 206f 7665 7272 6964 6573 3d6b 7562 655f   overrides=kube_
+00024a80: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
+00024a90: 2020 2069 6620 6261 7265 6d65 7461 6c70     if baremetalp
+00024aa0: 6f6f 6c20 6973 206e 6f74 204e 6f6e 653a  ool is not None:
+00024ab0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00024ac0: 662e 6765 745f 6261 7265 6d65 7461 6c5f  f.get_baremetal_
+00024ad0: 686f 7374 735f 6672 6f6d 5f63 6f6e 6670  hosts_from_confp
+00024ae0: 6f6f 6c28 636c 7573 7465 722c 2062 6172  ool(cluster, bar
+00024af0: 656d 6574 616c 706f 6f6c 2c20 6f76 6572  emetalpool, over
+00024b00: 7269 6465 733d 6b75 6265 5f6f 7665 7272  rides=kube_overr
+00024b10: 6964 6573 290a 2020 2020 2020 2020 7365  ides).        se
+00024b20: 6c66 2e63 7265 6174 655f 6b75 6265 2863  lf.create_kube(c
+00024b30: 6c75 7374 6572 2c20 6b75 6265 7479 7065  luster, kubetype
+00024b40: 2c20 6b75 6265 5f6f 7665 7272 6964 6573  , kube_overrides
+00024b50: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
+00024b60: 655f 6b75 6265 2873 656c 662c 2063 6c75  e_kube(self, clu
+00024b70: 7374 6572 2c20 6b75 6265 7479 7065 2c20  ster, kubetype, 
+00024b80: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
+00024b90: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
+00024ba0: 7970 6520 3d3d 2027 7765 6227 2061 6e64  ype == 'web' and
+00024bb0: 2073 656c 662e 6b2e 6c6f 6361 6c6b 7562   self.k.localkub
+00024bc0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00024bd0: 6574 7572 6e20 7365 6c66 2e6b 2e63 7265  eturn self.k.cre
+00024be0: 6174 655f 6b75 6265 2863 6c75 7374 6572  ate_kube(cluster
+00024bf0: 2c20 6b75 6265 7479 7065 2c20 6f76 6572  , kubetype, over
+00024c00: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
+00024c10: 0a20 2020 2020 2020 2069 7070 6f6f 6c20  .        ippool 
+00024c20: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+00024c30: 2769 7070 6f6f 6c27 2920 6f72 206f 7665  'ippool') or ove
+00024c40: 7272 6964 6573 2e67 6574 2827 636f 6e66  rrides.get('conf
+00024c50: 706f 6f6c 2729 0a20 2020 2020 2020 2062  pool').        b
+00024c60: 6172 656d 6574 616c 706f 6f6c 203d 206f  aremetalpool = o
+00024c70: 7665 7272 6964 6573 2e67 6574 2827 6970  verrides.get('ip
+00024c80: 706f 6f6c 2729 206f 7220 6f76 6572 7269  pool') or overri
+00024c90: 6465 732e 6765 7428 2763 6f6e 6670 6f6f  des.get('confpoo
+00024ca0: 6c27 290a 2020 2020 2020 2020 6966 2069  l').        if i
+00024cb0: 7070 6f6f 6c20 6973 206e 6f74 204e 6f6e  ppool is not Non
+00024cc0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00024cd0: 656c 662e 6765 745f 7669 705f 6672 6f6d  elf.get_vip_from
+00024ce0: 5f63 6f6e 6670 6f6f 6c28 636c 7573 7465  _confpool(cluste
+00024cf0: 722c 2069 7070 6f6f 6c2c 206f 7665 7272  r, ippool, overr
+00024d00: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
+00024d10: 2020 2020 2020 2020 6966 2062 6172 656d          if barem
+00024d20: 6574 616c 706f 6f6c 2069 7320 6e6f 7420  etalpool is not 
+00024d30: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00024d40: 2020 7365 6c66 2e67 6574 5f62 6172 656d    self.get_barem
+00024d50: 6574 616c 5f68 6f73 7473 5f66 726f 6d5f  etal_hosts_from_
+00024d60: 636f 6e66 706f 6f6c 2863 6c75 7374 6572  confpool(cluster
+00024d70: 2c20 6261 7265 6d65 7461 6c70 6f6f 6c2c  , baremetalpool,
+00024d80: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+00024d90: 6964 6573 290a 2020 2020 2020 2020 6966  ides).        if
+00024da0: 206b 7562 6574 7970 6520 3d3d 2027 6f70   kubetype == 'op
+00024db0: 656e 7368 6966 7427 3a0a 2020 2020 2020  enshift':.      
+00024dc0: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
+00024dd0: 656c 662e 6372 6561 7465 5f6b 7562 655f  elf.create_kube_
+00024de0: 6f70 656e 7368 6966 7428 636c 7573 7465  openshift(cluste
+00024df0: 722c 206f 7665 7272 6964 6573 3d6f 7665  r, overrides=ove
+00024e00: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
+00024e10: 656c 6966 206b 7562 6574 7970 6520 3d3d  elif kubetype ==
+00024e20: 2027 6879 7065 7273 6869 6674 273a 0a20   'hypershift':. 
+00024e30: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00024e40: 7420 3d20 7365 6c66 2e63 7265 6174 655f  t = self.create_
+00024e50: 6b75 6265 5f68 7970 6572 7368 6966 7428  kube_hypershift(
+00024e60: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+00024e70: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
+00024e80: 2020 2020 2020 656c 6966 206b 7562 6574        elif kubet
+00024e90: 7970 6520 3d3d 2027 6d69 6372 6f73 6869  ype == 'microshi
+00024ea0: 6674 273a 0a20 2020 2020 2020 2020 2020  ft':.           
+00024eb0: 2072 6573 756c 7420 3d20 7365 6c66 2e63   result = self.c
+00024ec0: 7265 6174 655f 6b75 6265 5f6d 6963 726f  reate_kube_micro
+00024ed0: 7368 6966 7428 636c 7573 7465 722c 206f  shift(cluster, o
+00024ee0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+00024ef0: 6573 290a 2020 2020 2020 2020 656c 6966  es).        elif
+00024f00: 206b 7562 6574 7970 6520 3d3d 2027 6b33   kubetype == 'k3
+00024f10: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
+00024f20: 7265 7375 6c74 203d 2073 656c 662e 6372  result = self.cr
+00024f30: 6561 7465 5f6b 7562 655f 6b33 7328 636c  eate_kube_k3s(cl
+00024f40: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+00024f50: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
+00024f60: 2020 2020 656c 6966 206b 7562 6574 7970      elif kubetyp
+00024f70: 6520 3d3d 2027 676b 6527 3a0a 2020 2020  e == 'gke':.    
+00024f80: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00024f90: 2073 656c 662e 6372 6561 7465 5f6b 7562   self.create_kub
+00024fa0: 655f 676b 6528 636c 7573 7465 722c 206f  e_gke(cluster, o
+00024fb0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+00024fc0: 6573 290a 2020 2020 2020 2020 656c 6966  es).        elif
+00024fd0: 206b 7562 6574 7970 6520 3d3d 2027 656b   kubetype == 'ek
+00024fe0: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
+00024ff0: 7265 7375 6c74 203d 2073 656c 662e 6372  result = self.cr
+00025000: 6561 7465 5f6b 7562 655f 656b 7328 636c  eate_kube_eks(cl
+00025010: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+00025020: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
+00025030: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00025040: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
+00025050: 656c 662e 6372 6561 7465 5f6b 7562 655f  elf.create_kube_
+00025060: 6765 6e65 7269 6328 636c 7573 7465 722c  generic(cluster,
+00025070: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+00025080: 6964 6573 290a 2020 2020 2020 2020 7265  ides).        re
+00025090: 7475 726e 2072 6573 756c 740a 0a20 2020  turn result..   
+000250a0: 2064 6566 2063 7265 6174 655f 6b75 6265   def create_kube
+000250b0: 5f65 6b73 2873 656c 662c 2063 6c75 7374  _eks(self, clust
+000250c0: 6572 2c20 6f76 6572 7269 6465 733d 7b7d  er, overrides={}
+000250d0: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
+000250e0: 6b76 6972 742e 636c 7573 7465 7220 696d  kvirt.cluster im
+000250f0: 706f 7274 2065 6b73 0a20 2020 2020 2020  port eks.       
+00025100: 2069 6620 636f 6e74 6169 6e65 725f 6d6f   if container_mo
+00025110: 6465 2829 3a0a 2020 2020 2020 2020 2020  de():.          
+00025120: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
+00025130: 5448 275d 202b 3d20 273a 2f77 6f72 6b64  TH'] += ':/workd
+00025140: 6972 270a 2020 2020 2020 2020 656c 7365  ir'.        else
+00025150: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+00025160: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
+00025170: 202b 3d20 273a 2573 2720 2520 6f73 2e67   += ':%s' % os.g
+00025180: 6574 6377 6428 290a 2020 2020 2020 2020  etcwd().        
+00025190: 7265 7475 726e 2065 6b73 2e63 7265 6174  return eks.creat
+000251a0: 6528 7365 6c66 2c20 636c 7573 7465 722c  e(self, cluster,
+000251b0: 206f 7665 7272 6964 6573 290a 0a20 2020   overrides)..   
+000251c0: 2064 6566 2063 7265 6174 655f 6b75 6265   def create_kube
+000251d0: 5f67 656e 6572 6963 2873 656c 662c 2063  _generic(self, c
+000251e0: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
+000251f0: 733d 7b7d 293a 0a20 2020 2020 2020 2069  s={}):.        i
+00025200: 6620 636f 6e74 6169 6e65 725f 6d6f 6465  f container_mode
+00025210: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00025220: 6f73 2e65 6e76 6972 6f6e 5b27 5041 5448  os.environ['PATH
+00025230: 275d 202b 3d20 273a 2f77 6f72 6b64 6972  '] += ':/workdir
+00025240: 270a 2020 2020 2020 2020 656c 7365 3a0a  '.        else:.
+00025250: 2020 2020 2020 2020 2020 2020 6f73 2e65              os.e
+00025260: 6e76 6972 6f6e 5b27 5041 5448 275d 202b  nviron['PATH'] +
+00025270: 3d20 273a 2573 2720 2520 6f73 2e67 6574  = ':%s' % os.get
+00025280: 6377 6428 290a 2020 2020 2020 2020 706c  cwd().        pl
+00025290: 616e 6469 7220 3d20 6f73 2e70 6174 682e  andir = os.path.
+000252a0: 6469 726e 616d 6528 6b75 6265 6164 6d2e  dirname(kubeadm.
+000252b0: 6372 6561 7465 2e5f 5f63 6f64 655f 5f2e  create.__code__.
+000252c0: 636f 5f66 696c 656e 616d 6529 0a20 2020  co_filename).   
+000252d0: 2020 2020 2072 6574 7572 6e20 6b75 6265       return kube
+000252e0: 6164 6d2e 6372 6561 7465 2873 656c 662c  adm.create(self,
+000252f0: 2070 6c61 6e64 6972 2c20 636c 7573 7465   plandir, cluste
+00025300: 722c 206f 7665 7272 6964 6573 290a 0a20  r, overrides).. 
+00025310: 2020 2064 6566 2063 7265 6174 655f 6b75     def create_ku
+00025320: 6265 5f67 6b65 2873 656c 662c 2063 6c75  be_gke(self, clu
+00025330: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
+00025340: 7b7d 293a 0a20 2020 2020 2020 2066 726f  {}):.        fro
+00025350: 6d20 6b76 6972 742e 636c 7573 7465 7220  m kvirt.cluster 
+00025360: 696d 706f 7274 2067 6b65 0a20 2020 2020  import gke.     
+00025370: 2020 2069 6620 636f 6e74 6169 6e65 725f     if container_
+00025380: 6d6f 6465 2829 3a0a 2020 2020 2020 2020  mode():.        
+00025390: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
+000253a0: 5041 5448 275d 202b 3d20 273a 2f77 6f72  PATH'] += ':/wor
+000253b0: 6b64 6972 270a 2020 2020 2020 2020 656c  kdir'.        el
+000253c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000253d0: 6f73 2e65 6e76 6972 6f6e 5b27 5041 5448  os.environ['PATH
+000253e0: 275d 202b 3d20 273a 2573 2720 2520 6f73  '] += ':%s' % os
+000253f0: 2e67 6574 6377 6428 290a 2020 2020 2020  .getcwd().      
+00025400: 2020 7265 7475 726e 2067 6b65 2e63 7265    return gke.cre
+00025410: 6174 6528 7365 6c66 2c20 636c 7573 7465  ate(self, cluste
+00025420: 722c 206f 7665 7272 6964 6573 290a 0a20  r, overrides).. 
+00025430: 2020 2064 6566 2063 7265 6174 655f 6b75     def create_ku
+00025440: 6265 5f6d 6963 726f 7368 6966 7428 7365  be_microshift(se
+00025450: 6c66 2c20 636c 7573 7465 722c 206f 7665  lf, cluster, ove
+00025460: 7272 6964 6573 3d7b 7d29 3a0a 2020 2020  rrides={}):.    
+00025470: 2020 2020 6966 2063 6f6e 7461 696e 6572      if container
+00025480: 5f6d 6f64 6528 293a 0a20 2020 2020 2020  _mode():.       
+00025490: 2020 2020 206f 732e 656e 7669 726f 6e5b       os.environ[
+000254a0: 2750 4154 4827 5d20 2b3d 2027 3a2f 776f  'PATH'] += ':/wo
+000254b0: 726b 6469 7227 0a20 2020 2020 2020 2065  rkdir'.        e
+000254c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000254d0: 206f 732e 656e 7669 726f 6e5b 2750 4154   os.environ['PAT
+000254e0: 4827 5d20 2b3d 2027 3a25 7327 2025 206f  H'] += ':%s' % o
+000254f0: 732e 6765 7463 7764 2829 0a20 2020 2020  s.getcwd().     
+00025500: 2020 2070 6c61 6e64 6972 203d 206f 732e     plandir = os.
+00025510: 7061 7468 2e64 6972 6e61 6d65 286d 6963  path.dirname(mic
+00025520: 726f 7368 6966 742e 6372 6561 7465 2e5f  roshift.create._
+00025530: 5f63 6f64 655f 5f2e 636f 5f66 696c 656e  _code__.co_filen
+00025540: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
+00025550: 7572 6e20 6d69 6372 6f73 6869 6674 2e63  urn microshift.c
+00025560: 7265 6174 6528 7365 6c66 2c20 706c 616e  reate(self, plan
+00025570: 6469 722c 2063 6c75 7374 6572 2c20 6f76  dir, cluster, ov
+00025580: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
+00025590: 6620 6372 6561 7465 5f6b 7562 655f 6b33  f create_kube_k3
+000255a0: 7328 7365 6c66 2c20 636c 7573 7465 722c  s(self, cluster,
+000255b0: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
+000255c0: 2020 2020 2020 2020 6966 2063 6f6e 7461          if conta
+000255d0: 696e 6572 5f6d 6f64 6528 293a 0a20 2020  iner_mode():.   
+000255e0: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
+000255f0: 726f 6e5b 2750 4154 4827 5d20 2b3d 2027  ron['PATH'] += '
+00025600: 3a2f 776f 726b 6469 7227 0a20 2020 2020  :/workdir'.     
+00025610: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00025620: 2020 2020 206f 732e 656e 7669 726f 6e5b       os.environ[
+00025630: 2750 4154 4827 5d20 2b3d 2027 3a25 7327  'PATH'] += ':%s'
+00025640: 2025 206f 732e 6765 7463 7764 2829 0a20   % os.getcwd(). 
+00025650: 2020 2020 2020 2070 6c61 6e64 6972 203d         plandir =
+00025660: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
+00025670: 286b 3373 2e63 7265 6174 652e 5f5f 636f  (k3s.create.__co
+00025680: 6465 5f5f 2e63 6f5f 6669 6c65 6e61 6d65  de__.co_filename
+00025690: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000256a0: 206b 3373 2e63 7265 6174 6528 7365 6c66   k3s.create(self
+000256b0: 2c20 706c 616e 6469 722c 2063 6c75 7374  , plandir, clust
+000256c0: 6572 2c20 6f76 6572 7269 6465 7329 0a0a  er, overrides)..
+000256d0: 2020 2020 6465 6620 6372 6561 7465 5f6b      def create_k
+000256e0: 7562 655f 6879 7065 7273 6869 6674 2873  ube_hypershift(s
+000256f0: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
+00025700: 6572 7269 6465 733d 7b7d 293a 0a20 2020  errides={}):.   
+00025710: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
+00025720: 725f 6d6f 6465 2829 3a0a 2020 2020 2020  r_mode():.      
+00025730: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+00025740: 5b27 5041 5448 275d 202b 3d20 273a 2f77  ['PATH'] += ':/w
+00025750: 6f72 6b64 6972 270a 2020 2020 2020 2020  orkdir'.        
+00025760: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00025770: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
+00025780: 5448 275d 202b 3d20 273a 2573 2720 2520  TH'] += ':%s' % 
+00025790: 6f73 2e67 6574 6377 6428 290a 2020 2020  os.getcwd().    
+000257a0: 2020 2020 706c 616e 6469 7220 3d20 6f73      plandir = os
+000257b0: 2e70 6174 682e 6469 726e 616d 6528 6879  .path.dirname(hy
+000257c0: 7065 7273 6869 6674 2e63 7265 6174 652e  pershift.create.
+000257d0: 5f5f 636f 6465 5f5f 2e63 6f5f 6669 6c65  __code__.co_file
+000257e0: 6e61 6d65 290a 2020 2020 2020 2020 2320  name).        # 
+000257f0: 646e 7363 6c69 656e 7420 3d20 6f76 6572  dnsclient = over
+00025800: 7269 6465 732e 6765 7428 2764 6e73 636c  rides.get('dnscl
+00025810: 6965 6e74 2729 0a20 2020 2020 2020 2023  ient').        #
+00025820: 2064 6e73 636f 6e66 6967 203d 204b 636f   dnsconfig = Kco
+00025830: 6e66 6967 2863 6c69 656e 743d 646e 7363  nfig(client=dnsc
+00025840: 6c69 656e 7429 2069 6620 646e 7363 6c69  lient) if dnscli
+00025850: 656e 7420 6973 206e 6f74 204e 6f6e 6520  ent is not None 
+00025860: 656c 7365 204e 6f6e 650a 2020 2020 2020  else None.      
+00025870: 2020 7265 7475 726e 2068 7970 6572 7368    return hypersh
+00025880: 6966 742e 6372 6561 7465 2873 656c 662c  ift.create(self,
+00025890: 2070 6c61 6e64 6972 2c20 636c 7573 7465   plandir, cluste
+000258a0: 722c 206f 7665 7272 6964 6573 290a 0a20  r, overrides).. 
+000258b0: 2020 2064 6566 2063 7265 6174 655f 6b75     def create_ku
+000258c0: 6265 5f6f 7065 6e73 6869 6674 2873 656c  be_openshift(sel
+000258d0: 662c 2063 6c75 7374 6572 2c20 6f76 6572  f, cluster, over
+000258e0: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
+000258f0: 2020 2069 6620 636f 6e74 6169 6e65 725f     if container_
+00025900: 6d6f 6465 2829 3a0a 2020 2020 2020 2020  mode():.        
+00025910: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
+00025920: 5041 5448 275d 202b 3d20 273a 2f77 6f72  PATH'] += ':/wor
+00025930: 6b64 6972 270a 2020 2020 2020 2020 656c  kdir'.        el
+00025940: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00025950: 6f73 2e65 6e76 6972 6f6e 5b27 5041 5448  os.environ['PATH
+00025960: 275d 202b 3d20 273a 2573 2720 2520 6f73  '] += ':%s' % os
+00025970: 2e67 6574 6377 6428 290a 2020 2020 2020  .getcwd().      
+00025980: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
+00025990: 6174 682e 6469 726e 616d 6528 6f70 656e  ath.dirname(open
+000259a0: 7368 6966 742e 6372 6561 7465 2e5f 5f63  shift.create.__c
+000259b0: 6f64 655f 5f2e 636f 5f66 696c 656e 616d  ode__.co_filenam
+000259c0: 6529 0a20 2020 2020 2020 2064 6e73 636c  e).        dnscl
+000259d0: 6965 6e74 203d 206f 7665 7272 6964 6573  ient = overrides
+000259e0: 2e67 6574 2827 646e 7363 6c69 656e 7427  .get('dnsclient'
+000259f0: 290a 2020 2020 2020 2020 646e 7363 6f6e  ).        dnscon
+00025a00: 6669 6720 3d20 4b63 6f6e 6669 6728 636c  fig = Kconfig(cl
+00025a10: 6965 6e74 3d64 6e73 636c 6965 6e74 2920  ient=dnsclient) 
+00025a20: 6966 2064 6e73 636c 6965 6e74 2069 7320  if dnsclient is 
+00025a30: 6e6f 7420 4e6f 6e65 2065 6c73 6520 4e6f  not None else No
+00025a40: 6e65 0a20 2020 2020 2020 2072 6574 7572  ne.        retur
+00025a50: 6e20 6f70 656e 7368 6966 742e 6372 6561  n openshift.crea
+00025a60: 7465 2873 656c 662c 2070 6c61 6e64 6972  te(self, plandir
+00025a70: 2c20 636c 7573 7465 722c 206f 7665 7272  , cluster, overr
+00025a80: 6964 6573 2c20 646e 7363 6f6e 6669 673d  ides, dnsconfig=
+00025a90: 646e 7363 6f6e 6669 6729 0a0a 2020 2020  dnsconfig)..    
+00025aa0: 6465 6620 6465 6c65 7465 5f6b 7562 6528  def delete_kube(
+00025ab0: 7365 6c66 2c20 636c 7573 7465 722c 206f  self, cluster, o
+00025ac0: 7665 7272 6964 6573 3d7b 7d29 3a0a 2020  verrides={}):.  
+00025ad0: 2020 2020 2020 6879 7065 7273 6869 6674        hypershift
+00025ae0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00025af0: 2061 7373 6973 7465 6420 3d20 4661 6c73   assisted = Fals
+00025b00: 650a 2020 2020 2020 2020 656b 7320 3d20  e.        eks = 
+00025b10: 4661 6c73 650a 2020 2020 2020 2020 676b  False.        gk
+00025b20: 6520 3d20 4661 6c73 650a 2020 2020 2020  e = False.      
+00025b30: 2020 646f 6d61 696e 203d 206f 7665 7272    domain = overr
+00025b40: 6964 6573 2e67 6574 2827 646f 6d61 696e  ides.get('domain
+00025b50: 272c 2027 6b61 726d 616c 6162 732e 636f  ', 'karmalabs.co
+00025b60: 7270 2729 0a20 2020 2020 2020 206b 7562  rp').        kub
+00025b70: 6574 7970 6520 3d20 6f76 6572 7269 6465  etype = override
+00025b80: 732e 6765 7428 276b 7562 6574 7970 6527  s.get('kubetype'
+00025b90: 2c20 2767 656e 6572 6963 2729 0a20 2020  , 'generic').   
+00025ba0: 2020 2020 2064 6e73 636c 6965 6e74 203d       dnsclient =
+00025bb0: 204e 6f6e 650a 2020 2020 2020 2020 6b20   None.        k 
+00025bc0: 3d20 7365 6c66 2e6b 0a20 2020 2020 2020  = self.k.       
+00025bd0: 2069 6620 7365 6c66 2e74 7970 6520 3d3d   if self.type ==
+00025be0: 2027 7765 6227 2061 6e64 2073 656c 662e   'web' and self.
+00025bf0: 6b2e 6c6f 6361 6c6b 7562 653a 0a20 2020  k.localkube:.   
+00025c00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00025c10: 6b2e 6465 6c65 7465 5f6b 7562 6528 636c  k.delete_kube(cl
+00025c20: 7573 7465 722c 206b 7562 6574 7970 652c  uster, kubetype,
+00025c30: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+00025c40: 6964 6573 290a 2020 2020 2020 2020 636c  ides).        cl
+00025c50: 7573 7465 7220 3d20 6f76 6572 7269 6465  uster = override
+00025c60: 732e 6765 7428 2763 6c75 7374 6572 272c  s.get('cluster',
+00025c70: 2063 6c75 7374 6572 290a 2020 2020 2020   cluster).      
+00025c80: 2020 6966 2063 6c75 7374 6572 2069 7320    if cluster is 
+00025c90: 4e6f 6e65 206f 7220 636c 7573 7465 7220  None or cluster 
+00025ca0: 3d3d 2027 273a 0a20 2020 2020 2020 2020  == '':.         
+00025cb0: 2020 2064 6566 6175 6c74 5f63 6c75 7374     default_clust
+00025cc0: 6572 7320 3d20 7b27 6765 6e65 7269 6327  ers = {'generic'
+00025cd0: 3a20 276d 796b 7562 6527 2c20 2768 7970  : 'mykube', 'hyp
+00025ce0: 6572 7368 6966 7427 3a20 276d 7968 7970  ershift': 'myhyp
+00025cf0: 6572 7368 6966 7427 2c20 276f 7065 6e73  ershift', 'opens
+00025d00: 6869 6674 273a 2027 6d79 6f70 656e 7368  hift': 'myopensh
+00025d10: 6966 7427 2c0a 2020 2020 2020 2020 2020  ift',.          
+00025d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025d30: 2020 2020 2020 276b 3373 273a 2027 6d79        'k3s': 'my
+00025d40: 6b33 7327 2c20 276d 6963 726f 7368 6966  k3s', 'microshif
+00025d50: 7427 3a20 276d 796d 6963 726f 7368 6966  t': 'mymicroshif
+00025d60: 7427 2c20 2767 6b65 273a 2027 6d79 676b  t', 'gke': 'mygk
+00025d70: 6527 2c20 2765 6b73 273a 2027 6d79 656b  e', 'eks': 'myek
+00025d80: 7327 7d0a 2020 2020 2020 2020 2020 2020  s'}.            
+00025d90: 636c 7573 7465 7220 3d20 6465 6661 756c  cluster = defaul
+00025da0: 745f 636c 7573 7465 7273 5b6b 7562 6574  t_clusters[kubet
+00025db0: 7970 655d 0a20 2020 2020 2020 2063 6c75  ype].        clu
+00025dc0: 7374 6572 6461 7461 203d 207b 7d0a 2020  sterdata = {}.  
+00025dd0: 2020 2020 2020 636c 7573 7465 7264 6972        clusterdir
+00025de0: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
+00025df0: 6475 7365 7228 6622 7e2f 2e6b 636c 692f  duser(f"~/.kcli/
+00025e00: 636c 7573 7465 7273 2f7b 636c 7573 7465  clusters/{cluste
+00025e10: 727d 2229 0a20 2020 2020 2020 2069 6620  r}").        if 
+00025e20: 6f73 2e70 6174 682e 6578 6973 7473 2863  os.path.exists(c
+00025e30: 6c75 7374 6572 6469 7229 3a0a 2020 2020  lusterdir):.    
+00025e40: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
+00025e50: 7273 6669 6c65 203d 2066 227b 636c 7573  rsfile = f"{clus
+00025e60: 7465 7264 6972 7d2f 6b63 6c69 5f70 6172  terdir}/kcli_par
+00025e70: 616d 6574 6572 732e 796d 6c22 0a20 2020  ameters.yml".   
+00025e80: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+00025e90: 6174 682e 6578 6973 7473 2870 6172 616d  ath.exists(param
+00025ea0: 6574 6572 7366 696c 6529 3a0a 2020 2020  etersfile):.    
+00025eb0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00025ec0: 206f 7065 6e28 7061 7261 6d65 7465 7273   open(parameters
+00025ed0: 6669 6c65 2920 6173 2066 3a0a 2020 2020  file) as f:.    
+00025ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ef0: 636c 7573 7465 7264 6174 6120 3d20 7961  clusterdata = ya
+00025f00: 6d6c 2e73 6166 655f 6c6f 6164 2866 290a  ml.safe_load(f).
+00025f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f20: 2020 2020 6b75 6265 7479 7065 203d 2063      kubetype = c
+00025f30: 6c75 7374 6572 6461 7461 2e67 6574 2827  lusterdata.get('
 00025f40: 6b75 6265 7479 7065 272c 2027 6765 6e65  kubetype', 'gene
 00025f50: 7269 6327 290a 2020 2020 2020 2020 2020  ric').          
-00025f60: 2020 2020 2020 6966 2063 7572 7265 6e74        if current
-00025f70: 636c 7573 7465 7220 6973 206e 6f74 204e  cluster is not N
-00025f80: 6f6e 6520 616e 6420 6375 7272 656e 7463  one and currentc
-00025f90: 6c75 7374 6572 203d 3d20 636c 7573 7465  luster == cluste
-00025fa0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00025fb0: 2020 2020 2020 2069 6620 6b75 6265 7479         if kubety
-00025fc0: 7065 203d 3d20 2767 6b65 273a 0a20 2020  pe == 'gke':.   
-00025fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025fe0: 2020 2020 2067 6b65 203d 2054 7275 650a       gke = True.
-00025ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026000: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00026010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026020: 2020 632e 6465 6c65 7465 286e 616d 652c    c.delete(name,
-00026030: 2073 6e61 7073 686f 7473 3d54 7275 6529   snapshots=True)
-00026040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026050: 2020 2020 2063 6f6d 6d6f 6e2e 6465 6c65       common.dele
-00026060: 7465 5f6c 6173 7476 6d28 6e61 6d65 2c20  te_lastvm(name, 
-00026070: 7365 6c66 2e63 6c69 656e 7429 0a20 2020  self.client).   
-00026080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026090: 2073 7563 6365 7373 2866 227b 6e61 6d65   success(f"{name
-000260a0: 7d20 6465 6c65 7465 6420 6f6e 207b 6879  } deleted on {hy
-000260b0: 7065 7276 6973 6f72 7d21 2229 0a20 2020  pervisor}!").   
-000260c0: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
-000260d0: 6520 3d3d 2027 6b75 6265 7669 7274 273a  e == 'kubevirt':
-000260e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000260f0: 6622 7b63 6c75 7374 6572 7d2d 6170 6922  f"{cluster}-api"
-00026100: 2069 6e20 6b2e 6c69 7374 5f73 6572 7669   in k.list_servi
-00026110: 6365 7328 6b2e 6e61 6d65 7370 6163 6529  ces(k.namespace)
-00026120: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00026130: 2020 6b2e 6465 6c65 7465 5f73 6572 7669    k.delete_servi
-00026140: 6365 2866 227b 636c 7573 7465 727d 2d61  ce(f"{cluster}-a
-00026150: 7069 222c 206b 2e6e 616d 6573 7061 6365  pi", k.namespace
-00026160: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00026170: 2066 227b 636c 7573 7465 727d 2d69 6e67   f"{cluster}-ing
-00026180: 7265 7373 2220 696e 206b 2e6c 6973 745f  ress" in k.list_
-00026190: 7365 7276 6963 6573 286b 2e6e 616d 6573  services(k.names
-000261a0: 7061 6365 293a 0a20 2020 2020 2020 2020  pace):.         
-000261b0: 2020 2020 2020 206b 2e64 656c 6574 655f         k.delete_
-000261c0: 7365 7276 6963 6528 6622 7b63 6c75 7374  service(f"{clust
-000261d0: 6572 7d2d 696e 6772 6573 7322 2c20 6b2e  er}-ingress", k.
-000261e0: 6e61 6d65 7370 6163 6529 0a20 2020 2020  namespace).     
-000261f0: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
-00026200: 696e 205b 2761 7773 272c 2027 6763 7027  in ['aws', 'gcp'
-00026210: 2c20 2769 626d 275d 2061 6e64 206e 6f74  , 'ibm'] and not
-00026220: 2067 6b65 3a0a 2020 2020 2020 2020 2020   gke:.          
-00026230: 2020 6c62 7320 3d20 5b27 6170 6927 5d0a    lbs = ['api'].
-00026240: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00026250: 7562 6574 7970 6520 6e6f 7420 696e 205b  ubetype not in [
-00026260: 276b 3373 272c 2027 6765 6e65 7269 6327  'k3s', 'generic'
-00026270: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00026280: 2020 206c 6273 2e61 7070 656e 6428 2761     lbs.append('a
-00026290: 7070 7327 290a 2020 2020 2020 2020 2020  pps').          
-000262a0: 2020 666f 7220 6c62 2069 6e20 6c62 733a    for lb in lbs:
-000262b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000262c0: 2073 656c 662e 6465 6c65 7465 5f6c 6f61   self.delete_loa
-000262d0: 6462 616c 616e 6365 7228 6622 7b6c 627d  dbalancer(f"{lb}
-000262e0: 2e7b 636c 7573 7465 727d 222c 2064 6f6d  .{cluster}", dom
-000262f0: 6169 6e3d 646f 6d61 696e 290a 2020 2020  ain=domain).    
-00026300: 2020 2020 2020 2020 6275 636b 6574 203d          bucket =
-00026310: 2066 227b 636c 7573 7465 727d 2d7b 646f   f"{cluster}-{do
-00026320: 6d61 696e 7d22 0a20 2020 2020 2020 2020  main}".         
-00026330: 2020 2069 6620 6275 636b 6574 2069 6e20     if bucket in 
-00026340: 7365 6c66 2e6b 2e6c 6973 745f 6275 636b  self.k.list_buck
-00026350: 6574 7328 293a 0a20 2020 2020 2020 2020  ets():.         
-00026360: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00026370: 4465 6c65 7469 6e67 2062 7563 6b65 7420  Deleting bucket 
-00026380: 7b62 7563 6b65 747d 2229 0a20 2020 2020  {bucket}").     
-00026390: 2020 2020 2020 2020 2020 206b 2e64 656c             k.del
-000263a0: 6574 655f 6275 636b 6574 2862 7563 6b65  ete_bucket(bucke
-000263b0: 7429 0a20 2020 2020 2020 2065 6c69 6620  t).        elif 
-000263c0: 646e 7363 6c69 656e 7420 6973 206e 6f74  dnsclient is not
-000263d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000263e0: 2020 207a 203d 204b 636f 6e66 6967 2863     z = Kconfig(c
-000263f0: 6c69 656e 743d 646e 7363 6c69 656e 7429  lient=dnsclient)
-00026400: 2e6b 0a20 2020 2020 2020 2020 2020 207a  .k.            z
-00026410: 2e64 656c 6574 655f 646e 7328 6622 6170  .delete_dns(f"ap
-00026420: 692e 7b63 6c75 7374 6572 7d22 2c20 646f  i.{cluster}", do
-00026430: 6d61 696e 290a 2020 2020 2020 2020 2020  main).          
-00026440: 2020 7a2e 6465 6c65 7465 5f64 6e73 2866    z.delete_dns(f
-00026450: 2261 7070 732e 7b63 6c75 7374 6572 7d22  "apps.{cluster}"
-00026460: 2c20 646f 6d61 696e 290a 2020 2020 2020  , domain).      
-00026470: 2020 6966 2068 7970 6572 7368 6966 743a    if hypershift:
-00026480: 0a20 2020 2020 2020 2020 2020 206b 7562  .            kub
-00026490: 6563 6f6e 6669 676d 676d 7420 3d20 6622  econfigmgmt = f"
-000264a0: 7b63 6c75 7374 6572 6469 727d 2f6b 7562  {clusterdir}/kub
-000264b0: 6563 6f6e 6669 672e 6d67 6d74 220a 2020  econfig.mgmt".  
-000264c0: 2020 2020 2020 2020 2020 6361 6c6c 2866            call(f
-000264d0: 274b 5542 4543 4f4e 4649 473d 7b6b 7562  'KUBECONFIG={kub
-000264e0: 6563 6f6e 6669 676d 676d 747d 206f 6320  econfigmgmt} oc 
-000264f0: 6465 6c65 7465 202d 6620 7b63 6c75 7374  delete -f {clust
-00026500: 6572 6469 727d 2f61 7574 6f61 7070 726f  erdir}/autoappro
-00026510: 7665 7263 726f 6e2e 796d 6c27 2c20 7368  vercron.yml', sh
-00026520: 656c 6c3d 5472 7565 290a 2020 2020 2020  ell=True).      
-00026530: 2020 2020 2020 6361 6c6c 2866 274b 5542        call(f'KUB
-00026540: 4543 4f4e 4649 473d 7b6b 7562 6563 6f6e  ECONFIG={kubecon
-00026550: 6669 676d 676d 747d 206f 6320 6465 6c65  figmgmt} oc dele
-00026560: 7465 202d 6620 7b63 6c75 7374 6572 6469  te -f {clusterdi
-00026570: 727d 2f6e 6f64 6570 6f6f 6c2e 7961 6d6c  r}/nodepool.yaml
-00026580: 272c 2073 6865 6c6c 3d54 7275 6529 0a20  ', shell=True). 
-00026590: 2020 2020 2020 2020 2020 2063 616c 6c28             call(
-000265a0: 6627 4b55 4245 434f 4e46 4947 3d7b 6b75  f'KUBECONFIG={ku
-000265b0: 6265 636f 6e66 6967 6d67 6d74 7d20 6f63  beconfigmgmt} oc
-000265c0: 2064 656c 6574 6520 2d66 207b 636c 7573   delete -f {clus
-000265d0: 7465 7264 6972 7d2f 686f 7374 6564 636c  terdir}/hostedcl
-000265e0: 7573 7465 722e 7961 6d6c 272c 2073 6865  uster.yaml', she
-000265f0: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
-00026600: 2020 2020 2069 6620 6e6f 7420 6173 7369       if not assi
-00026610: 7374 6564 2061 6e64 2028 2762 6172 656d  sted and ('barem
-00026620: 6574 616c 5f69 736f 2720 696e 2063 6c75  etal_iso' in clu
-00026630: 7374 6572 6461 7461 206f 7220 2762 6172  sterdata or 'bar
-00026640: 656d 6574 616c 5f68 6f73 7473 2720 696e  emetal_hosts' in
-00026650: 2063 6c75 7374 6572 6461 7461 293a 0a20   clusterdata):. 
-00026660: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00026670: 616c 6c28 6627 4b55 4245 434f 4e46 4947  all(f'KUBECONFIG
-00026680: 3d7b 6b75 6265 636f 6e66 6967 6d67 6d74  ={kubeconfigmgmt
-00026690: 7d20 6f63 202d 6e20 6465 6661 756c 7420  } oc -n default 
-000266a0: 6465 6c65 7465 2061 6c6c 202d 6c20 6170  delete all -l ap
-000266b0: 703d 6874 7470 642d 6b63 6c69 272c 2073  p=httpd-kcli', s
-000266c0: 6865 6c6c 3d54 7275 6529 0a20 2020 2020  hell=True).     
-000266d0: 2020 2020 2020 2020 2020 2063 616c 6c28             call(
-000266e0: 6627 4b55 4245 434f 4e46 4947 3d7b 6b75  f'KUBECONFIG={ku
-000266f0: 6265 636f 6e66 6967 6d67 6d74 7d20 6f63  beconfigmgmt} oc
-00026700: 202d 6e20 6465 6661 756c 7420 6465 6c65   -n default dele
-00026710: 7465 2070 7663 2068 7474 7064 2d6b 636c  te pvc httpd-kcl
-00026720: 692d 7076 6327 2c20 7368 656c 6c3d 5472  i-pvc', shell=Tr
-00026730: 7565 290a 2020 2020 2020 2020 6966 2067  ue).        if g
-00026740: 6b65 3a0a 2020 2020 2020 2020 2020 2020  ke:.            
-00026750: 6763 7063 6c69 656e 7420 3d20 4e6f 6e65  gcpclient = None
-00026760: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00026770: 2763 6c69 656e 7427 2069 6e20 636c 7573  'client' in clus
-00026780: 7465 7264 6174 613a 0a20 2020 2020 2020  terdata:.       
-00026790: 2020 2020 2020 2020 2067 6370 636c 6965           gcpclie
-000267a0: 6e74 203d 2063 6c75 7374 6572 6461 7461  nt = clusterdata
-000267b0: 5b27 636c 6965 6e74 275d 0a20 2020 2020  ['client'].     
-000267c0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-000267d0: 2e74 7970 6520 3d3d 2027 6763 7027 3a0a  .type == 'gcp':.
-000267e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267f0: 6763 7063 6c69 656e 7420 3d20 7365 6c66  gcpclient = self
-00026800: 2e63 6c69 656e 740a 2020 2020 2020 2020  .client.        
-00026810: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00026820: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
-00026830: 2244 656c 6574 696e 6720 676b 6520 636c  "Deleting gke cl
-00026840: 7573 7465 7220 7265 7175 6972 6573 2074  uster requires t
-00026850: 6f20 696e 7374 616e 7469 6174 6520 6763  o instantiate gc
-00026860: 7020 7072 6f76 6964 6572 220a 2020 2020  p provider".    
-00026870: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00026880: 7228 6d73 6729 0a20 2020 2020 2020 2020  r(msg).         
-00026890: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-000268a0: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
-000268b0: 6527 2c20 2772 6561 736f 6e27 3a20 6d73  e', 'reason': ms
-000268c0: 677d 0a20 2020 2020 2020 2020 2020 2066  g}.            f
-000268d0: 726f 6d20 6b76 6972 742e 636c 7573 7465  rom kvirt.cluste
-000268e0: 7220 696d 706f 7274 2067 6b65 0a20 2020  r import gke.   
-000268f0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-00026900: 636f 6e66 6967 203d 204b 636f 6e66 6967  config = Kconfig
-00026910: 2863 6c69 656e 743d 6763 7063 6c69 656e  (client=gcpclien
-00026920: 7429 2e6b 2069 6620 6763 7063 6c69 656e  t).k if gcpclien
-00026930: 7420 213d 2073 656c 662e 636c 6965 6e74  t != self.client
-00026940: 2065 6c73 6520 7365 6c66 0a20 2020 2020   else self.     
-00026950: 2020 2020 2020 207a 6f6e 616c 203d 2063         zonal = c
-00026960: 6c75 7374 6572 6461 7461 2e67 6574 2827  lusterdata.get('
-00026970: 7a6f 6e61 6c27 2c20 5472 7565 290a 2020  zonal', True).  
-00026980: 2020 2020 2020 2020 2020 676b 652e 6465            gke.de
-00026990: 6c65 7465 2863 7572 7265 6e74 636f 6e66  lete(currentconf
-000269a0: 6967 2c20 636c 7573 7465 722c 207a 6f6e  ig, cluster, zon
-000269b0: 616c 290a 2020 2020 2020 2020 666f 7220  al).        for 
-000269c0: 636f 6e66 706f 6f6c 2069 6e20 7365 6c66  confpool in self
-000269d0: 2e63 6f6e 6670 6f6f 6c73 3a0a 2020 2020  .confpools:.    
-000269e0: 2020 2020 2020 2020 6970 5f72 6573 6572          ip_reser
-000269f0: 7661 7469 6f6e 7320 3d20 7365 6c66 2e63  vations = self.c
-00026a00: 6f6e 6670 6f6f 6c73 5b63 6f6e 6670 6f6f  onfpools[confpoo
-00026a10: 6c5d 2e67 6574 2827 6970 5f72 6573 6572  l].get('ip_reser
-00026a20: 7661 7469 6f6e 7327 2c20 7b7d 290a 2020  vations', {}).  
-00026a30: 2020 2020 2020 2020 2020 6966 2063 6c75            if clu
-00026a40: 7374 6572 2069 6e20 6970 5f72 6573 6572  ster in ip_reser
-00026a50: 7661 7469 6f6e 733a 0a20 2020 2020 2020  vations:.       
-00026a60: 2020 2020 2020 2020 2064 656c 2069 705f           del ip_
-00026a70: 7265 7365 7276 6174 696f 6e73 5b63 6c75  reservations[clu
-00026a80: 7374 6572 5d0a 2020 2020 2020 2020 2020  ster].          
-00026a90: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
-00026aa0: 655f 636f 6e66 706f 6f6c 2863 6f6e 6670  e_confpool(confp
-00026ab0: 6f6f 6c2c 207b 2769 705f 7265 7365 7276  ool, {'ip_reserv
-00026ac0: 6174 696f 6e73 273a 2069 705f 7265 7365  ations': ip_rese
-00026ad0: 7276 6174 696f 6e73 7d29 0a20 2020 2020  rvations}).     
-00026ae0: 2020 2020 2020 206e 616d 655f 7265 7365         name_rese
-00026af0: 7276 6174 696f 6e73 203d 2073 656c 662e  rvations = self.
-00026b00: 636f 6e66 706f 6f6c 735b 636f 6e66 706f  confpools[confpo
-00026b10: 6f6c 5d2e 6765 7428 276e 616d 655f 7265  ol].get('name_re
-00026b20: 7365 7276 6174 696f 6e73 272c 205b 5d29  servations', [])
+00025f60: 2020 2020 2020 2020 2020 6966 206b 7562            if kub
+00025f70: 6574 7970 6520 3d3d 2027 6879 7065 7273  etype == 'hypers
+00025f80: 6869 6674 273a 0a20 2020 2020 2020 2020  hift':.         
+00025f90: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00025fa0: 7970 6572 7368 6966 7420 3d20 5472 7565  ypershift = True
+00025fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025fc0: 2020 2020 2020 2020 2061 7373 6973 7465           assiste
+00025fd0: 6420 3d20 636c 7573 7465 7264 6174 612e  d = clusterdata.
+00025fe0: 6765 7428 2761 7373 6973 7465 6427 2c20  get('assisted', 
+00025ff0: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+00026000: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
+00026010: 6e20 3d20 636c 7573 7465 7264 6174 612e  n = clusterdata.
+00026020: 6765 7428 2764 6f6d 6169 6e27 2c20 646f  get('domain', do
+00026030: 6d61 696e 290a 2020 2020 2020 2020 2020  main).          
+00026040: 2020 2020 2020 2020 2020 646e 7363 6c69            dnscli
+00026050: 656e 7420 3d20 636c 7573 7465 7264 6174  ent = clusterdat
+00026060: 612e 6765 7428 2764 6e73 636c 6965 6e74  a.get('dnsclient
+00026070: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00026080: 2020 2020 2020 2067 6b65 203d 206b 7562         gke = kub
+00026090: 6574 7970 6520 3d3d 2027 676b 6527 0a20  etype == 'gke'. 
+000260a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260b0: 2020 2065 6b73 203d 206b 7562 6574 7970     eks = kubetyp
+000260c0: 6520 3d3d 2027 656b 7327 0a20 2020 2020  e == 'eks'.     
+000260d0: 2020 2064 656c 6574 6563 6c69 656e 7473     deleteclients
+000260e0: 203d 207b 7365 6c66 2e63 6c69 656e 743a   = {self.client:
+000260f0: 206b 7d0a 2020 2020 2020 2020 766d 636c   k}.        vmcl
+00026100: 6965 6e74 7320 3d20 5b5d 0a20 2020 2020  ients = [].     
+00026110: 2020 2076 6d63 6c69 656e 7473 5f66 696c     vmclients_fil
+00026120: 6520 3d20 6f73 2e70 6174 682e 6578 7061  e = os.path.expa
+00026130: 6e64 7573 6572 2866 277e 2f2e 6b63 6c69  nduser(f'~/.kcli
+00026140: 2f76 6d63 6c69 656e 7473 5f7b 636c 7573  /vmclients_{clus
+00026150: 7465 727d 2729 0a20 2020 2020 2020 2069  ter}').        i
+00026160: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+00026170: 2876 6d63 6c69 656e 7473 5f66 696c 6529  (vmclients_file)
+00026180: 3a0a 2020 2020 2020 2020 2020 2020 766d  :.            vm
+00026190: 636c 6965 6e74 7320 3d20 7961 6d6c 2e73  clients = yaml.s
+000261a0: 6166 655f 6c6f 6164 286f 7065 6e28 766d  afe_load(open(vm
+000261b0: 636c 6965 6e74 735f 6669 6c65 2929 0a20  clients_file)). 
+000261c0: 2020 2020 2020 2020 2020 206f 732e 7265             os.re
+000261d0: 6d6f 7665 2876 6d63 6c69 656e 7473 5f66  move(vmclients_f
+000261e0: 696c 6529 0a20 2020 2020 2020 2069 6620  ile).        if 
+000261f0: 7365 6c66 2e65 7874 7261 636c 6965 6e74  self.extraclient
+00026200: 733a 0a20 2020 2020 2020 2020 2020 2064  s:.            d
+00026210: 656c 6574 6563 6c69 656e 7473 2e75 7064  eleteclients.upd
+00026220: 6174 6528 7365 6c66 2e65 7874 7261 636c  ate(self.extracl
+00026230: 6965 6e74 7329 0a20 2020 2020 2020 2065  ients).        e
+00026240: 6c69 6620 766d 636c 6965 6e74 733a 0a20  lif vmclients:. 
+00026250: 2020 2020 2020 2020 2020 2064 656c 6574             delet
+00026260: 6563 6c69 656e 7473 2e75 7064 6174 6528  eclients.update(
+00026270: 7b63 6c69 3a20 4b63 6f6e 6669 6728 636c  {cli: Kconfig(cl
+00026280: 6965 6e74 3d63 6c69 292e 6b20 666f 7220  ient=cli).k for 
+00026290: 636c 6920 696e 2076 6d63 6c69 656e 7473  cli in vmclients
+000262a0: 2069 6620 636c 6920 213d 2073 656c 662e   if cli != self.
+000262b0: 636c 6965 6e74 7d29 0a20 2020 2020 2020  client}).       
+000262c0: 2066 6f72 2068 7970 6572 7669 736f 7220   for hypervisor 
+000262d0: 696e 2064 656c 6574 6563 6c69 656e 7473  in deleteclients
+000262e0: 3a0a 2020 2020 2020 2020 2020 2020 6320  :.            c 
+000262f0: 3d20 6465 6c65 7465 636c 6965 6e74 735b  = deleteclients[
+00026300: 6879 7065 7276 6973 6f72 5d0a 2020 2020  hypervisor].    
+00026310: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
+00026320: 6e20 736f 7274 6564 2863 2e6c 6973 7428  n sorted(c.list(
+00026330: 292c 206b 6579 3d6c 616d 6264 6120 783a  ), key=lambda x:
+00026340: 2078 5b27 6e61 6d65 275d 293a 0a20 2020   x['name']):.   
+00026350: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+00026360: 6520 3d20 766d 5b27 6e61 6d65 275d 0a20  e = vm['name']. 
+00026370: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00026380: 6e73 636c 6965 6e74 203d 2076 6d2e 6765  nsclient = vm.ge
+00026390: 7428 2764 6e73 636c 6965 6e74 2729 206f  t('dnsclient') o
+000263a0: 7220 646e 7363 6c69 656e 740a 2020 2020  r dnsclient.    
+000263b0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+000263c0: 656e 7463 6c75 7374 6572 203d 2076 6d2e  entcluster = vm.
+000263d0: 6765 7428 276b 7562 6527 290a 2020 2020  get('kube').    
+000263e0: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
+000263f0: 7479 7065 203d 2076 6d2e 6765 7428 276b  type = vm.get('k
+00026400: 7562 6574 7970 6527 2c20 2767 656e 6572  ubetype', 'gener
+00026410: 6963 2729 0a20 2020 2020 2020 2020 2020  ic').           
+00026420: 2020 2020 2069 6620 6375 7272 656e 7463       if currentc
+00026430: 6c75 7374 6572 2069 7320 6e6f 7420 4e6f  luster is not No
+00026440: 6e65 2061 6e64 2063 7572 7265 6e74 636c  ne and currentcl
+00026450: 7573 7465 7220 3d3d 2063 6c75 7374 6572  uster == cluster
+00026460: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00026470: 2020 2020 2020 6966 206b 7562 6574 7970        if kubetyp
+00026480: 6520 3d3d 2027 676b 6527 3a0a 2020 2020  e == 'gke':.    
+00026490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000264a0: 2020 2020 676b 6520 3d20 5472 7565 0a20      gke = True. 
+000264b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000264c0: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+000264d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000264e0: 2065 6c69 6620 6b75 6265 7479 7065 203d   elif kubetype =
+000264f0: 3d20 2765 6b73 273a 0a20 2020 2020 2020  = 'eks':.       
+00026500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026510: 2065 6b73 203d 2054 7275 650a 2020 2020   eks = True.    
+00026520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026530: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+00026540: 2020 2020 2020 2020 2020 2020 2020 632e                c.
+00026550: 6465 6c65 7465 286e 616d 652c 2073 6e61  delete(name, sna
+00026560: 7073 686f 7473 3d54 7275 6529 0a20 2020  pshots=True).   
+00026570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026580: 2063 6f6d 6d6f 6e2e 6465 6c65 7465 5f6c   common.delete_l
+00026590: 6173 7476 6d28 6e61 6d65 2c20 7365 6c66  astvm(name, self
+000265a0: 2e63 6c69 656e 7429 0a20 2020 2020 2020  .client).       
+000265b0: 2020 2020 2020 2020 2020 2020 2073 7563               suc
+000265c0: 6365 7373 2866 227b 6e61 6d65 7d20 6465  cess(f"{name} de
+000265d0: 6c65 7465 6420 6f6e 207b 6879 7065 7276  leted on {hyperv
+000265e0: 6973 6f72 7d21 2229 0a20 2020 2020 2020  isor}!").       
+000265f0: 2069 6620 7365 6c66 2e74 7970 6520 3d3d   if self.type ==
+00026600: 2027 6b75 6265 7669 7274 273a 0a20 2020   'kubevirt':.   
+00026610: 2020 2020 2020 2020 2069 6620 6622 7b63           if f"{c
+00026620: 6c75 7374 6572 7d2d 6170 6922 2069 6e20  luster}-api" in 
+00026630: 6b2e 6c69 7374 5f73 6572 7669 6365 7328  k.list_services(
+00026640: 6b2e 6e61 6d65 7370 6163 6529 3a0a 2020  k.namespace):.  
+00026650: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
+00026660: 6465 6c65 7465 5f73 6572 7669 6365 2866  delete_service(f
+00026670: 227b 636c 7573 7465 727d 2d61 7069 222c  "{cluster}-api",
+00026680: 206b 2e6e 616d 6573 7061 6365 290a 2020   k.namespace).  
+00026690: 2020 2020 2020 2020 2020 6966 2066 227b            if f"{
+000266a0: 636c 7573 7465 727d 2d69 6e67 7265 7373  cluster}-ingress
+000266b0: 2220 696e 206b 2e6c 6973 745f 7365 7276  " in k.list_serv
+000266c0: 6963 6573 286b 2e6e 616d 6573 7061 6365  ices(k.namespace
+000266d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000266e0: 2020 206b 2e64 656c 6574 655f 7365 7276     k.delete_serv
+000266f0: 6963 6528 6622 7b63 6c75 7374 6572 7d2d  ice(f"{cluster}-
+00026700: 696e 6772 6573 7322 2c20 6b2e 6e61 6d65  ingress", k.name
+00026710: 7370 6163 6529 0a20 2020 2020 2020 2069  space).        i
+00026720: 6620 7365 6c66 2e74 7970 6520 696e 205b  f self.type in [
+00026730: 2761 7773 272c 2027 6763 7027 2c20 2769  'aws', 'gcp', 'i
+00026740: 626d 275d 2061 6e64 206e 6f74 2067 6b65  bm'] and not gke
+00026750: 2061 6e64 206e 6f74 2065 6b73 3a0a 2020   and not eks:.  
+00026760: 2020 2020 2020 2020 2020 6c62 7320 3d20            lbs = 
+00026770: 5b27 6170 6927 5d0a 2020 2020 2020 2020  ['api'].        
+00026780: 2020 2020 6966 206b 7562 6574 7970 6520      if kubetype 
+00026790: 6e6f 7420 696e 205b 276b 3373 272c 2027  not in ['k3s', '
+000267a0: 6765 6e65 7269 6327 5d3a 0a20 2020 2020  generic']:.     
+000267b0: 2020 2020 2020 2020 2020 206c 6273 2e61             lbs.a
+000267c0: 7070 656e 6428 2761 7070 7327 290a 2020  ppend('apps').  
+000267d0: 2020 2020 2020 2020 2020 666f 7220 6c62            for lb
+000267e0: 2069 6e20 6c62 733a 0a20 2020 2020 2020   in lbs:.       
+000267f0: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
+00026800: 6c65 7465 5f6c 6f61 6462 616c 616e 6365  lete_loadbalance
+00026810: 7228 6622 7b6c 627d 2e7b 636c 7573 7465  r(f"{lb}.{cluste
+00026820: 727d 222c 2064 6f6d 6169 6e3d 646f 6d61  r}", domain=doma
+00026830: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
+00026840: 6275 636b 6574 203d 2066 227b 636c 7573  bucket = f"{clus
+00026850: 7465 727d 2d7b 646f 6d61 696e 7d22 0a20  ter}-{domain}". 
+00026860: 2020 2020 2020 2020 2020 2069 6620 6275             if bu
+00026870: 636b 6574 2069 6e20 7365 6c66 2e6b 2e6c  cket in self.k.l
+00026880: 6973 745f 6275 636b 6574 7328 293a 0a20  ist_buckets():. 
+00026890: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000268a0: 7072 696e 7428 6622 4465 6c65 7469 6e67  print(f"Deleting
+000268b0: 2062 7563 6b65 7420 7b62 7563 6b65 747d   bucket {bucket}
+000268c0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+000268d0: 2020 206b 2e64 656c 6574 655f 6275 636b     k.delete_buck
+000268e0: 6574 2862 7563 6b65 7429 0a20 2020 2020  et(bucket).     
+000268f0: 2020 2065 6c69 6620 646e 7363 6c69 656e     elif dnsclien
+00026900: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
+00026910: 2020 2020 2020 2020 2020 207a 203d 204b             z = K
+00026920: 636f 6e66 6967 2863 6c69 656e 743d 646e  config(client=dn
+00026930: 7363 6c69 656e 7429 2e6b 0a20 2020 2020  sclient).k.     
+00026940: 2020 2020 2020 207a 2e64 656c 6574 655f         z.delete_
+00026950: 646e 7328 6622 6170 692e 7b63 6c75 7374  dns(f"api.{clust
+00026960: 6572 7d22 2c20 646f 6d61 696e 290a 2020  er}", domain).  
+00026970: 2020 2020 2020 2020 2020 7a2e 6465 6c65            z.dele
+00026980: 7465 5f64 6e73 2866 2261 7070 732e 7b63  te_dns(f"apps.{c
+00026990: 6c75 7374 6572 7d22 2c20 646f 6d61 696e  luster}", domain
+000269a0: 290a 2020 2020 2020 2020 6966 2068 7970  ).        if hyp
+000269b0: 6572 7368 6966 743a 0a20 2020 2020 2020  ershift:.       
+000269c0: 2020 2020 206b 7562 6563 6f6e 6669 676d       kubeconfigm
+000269d0: 676d 7420 3d20 6622 7b63 6c75 7374 6572  gmt = f"{cluster
+000269e0: 6469 727d 2f6b 7562 6563 6f6e 6669 672e  dir}/kubeconfig.
+000269f0: 6d67 6d74 220a 2020 2020 2020 2020 2020  mgmt".          
+00026a00: 2020 6361 6c6c 2866 274b 5542 4543 4f4e    call(f'KUBECON
+00026a10: 4649 473d 7b6b 7562 6563 6f6e 6669 676d  FIG={kubeconfigm
+00026a20: 676d 747d 206f 6320 6465 6c65 7465 202d  gmt} oc delete -
+00026a30: 6620 7b63 6c75 7374 6572 6469 727d 2f61  f {clusterdir}/a
+00026a40: 7574 6f61 7070 726f 7665 7263 726f 6e2e  utoapprovercron.
+00026a50: 796d 6c27 2c20 7368 656c 6c3d 5472 7565  yml', shell=True
+00026a60: 290a 2020 2020 2020 2020 2020 2020 6361  ).            ca
+00026a70: 6c6c 2866 274b 5542 4543 4f4e 4649 473d  ll(f'KUBECONFIG=
+00026a80: 7b6b 7562 6563 6f6e 6669 676d 676d 747d  {kubeconfigmgmt}
+00026a90: 206f 6320 6465 6c65 7465 202d 6620 7b63   oc delete -f {c
+00026aa0: 6c75 7374 6572 6469 727d 2f6e 6f64 6570  lusterdir}/nodep
+00026ab0: 6f6f 6c2e 7961 6d6c 272c 2073 6865 6c6c  ool.yaml', shell
+00026ac0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00026ad0: 2020 2063 616c 6c28 6627 4b55 4245 434f     call(f'KUBECO
+00026ae0: 4e46 4947 3d7b 6b75 6265 636f 6e66 6967  NFIG={kubeconfig
+00026af0: 6d67 6d74 7d20 6f63 2064 656c 6574 6520  mgmt} oc delete 
+00026b00: 2d66 207b 636c 7573 7465 7264 6972 7d2f  -f {clusterdir}/
+00026b10: 686f 7374 6564 636c 7573 7465 722e 7961  hostedcluster.ya
+00026b20: 6d6c 272c 2073 6865 6c6c 3d54 7275 6529  ml', shell=True)
 00026b30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00026b40: 636c 7573 7465 7220 696e 206e 616d 655f  cluster in name_
-00026b50: 7265 7365 7276 6174 696f 6e73 3a0a 2020  reservations:.  
-00026b60: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-00026b70: 6d65 5f72 6573 6572 7661 7469 6f6e 732e  me_reservations.
-00026b80: 7265 6d6f 7665 2863 6c75 7374 6572 290a  remove(cluster).
-00026b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ba0: 7365 6c66 2e75 7064 6174 655f 636f 6e66  self.update_conf
-00026bb0: 706f 6f6c 2863 6f6e 6670 6f6f 6c2c 207b  pool(confpool, {
-00026bc0: 276e 616d 655f 7265 7365 7276 6174 696f  'name_reservatio
-00026bd0: 6e73 273a 206e 616d 655f 7265 7365 7276  ns': name_reserv
-00026be0: 6174 696f 6e73 7d29 0a20 2020 2020 2020  ations}).       
-00026bf0: 2020 2020 2063 6c75 7374 6572 5f62 6172       cluster_bar
-00026c00: 656d 6574 616c 5f72 6573 6572 7661 7469  emetal_reservati
-00026c10: 6f6e 7320 3d20 7365 6c66 2e63 6f6e 6670  ons = self.confp
-00026c20: 6f6f 6c73 5b63 6f6e 6670 6f6f 6c5d 2e67  ools[confpool].g
-00026c30: 6574 2827 636c 7573 7465 725f 6261 7265  et('cluster_bare
-00026c40: 6d65 7461 6c5f 7265 7365 7276 6174 696f  metal_reservatio
-00026c50: 6e73 272c 207b 7d29 0a20 2020 2020 2020  ns', {}).       
-00026c60: 2020 2020 2069 6620 636c 7573 7465 7220       if cluster 
-00026c70: 696e 2063 6c75 7374 6572 5f62 6172 656d  in cluster_barem
-00026c80: 6574 616c 5f72 6573 6572 7661 7469 6f6e  etal_reservation
-00026c90: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00026ca0: 2020 2064 656c 2063 6c75 7374 6572 5f62     del cluster_b
-00026cb0: 6172 656d 6574 616c 5f72 6573 6572 7661  aremetal_reserva
-00026cc0: 7469 6f6e 735b 636c 7573 7465 725d 0a20  tions[cluster]. 
-00026cd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00026ce0: 656c 662e 7570 6461 7465 5f63 6f6e 6670  elf.update_confp
-00026cf0: 6f6f 6c28 636f 6e66 706f 6f6c 2c20 7b27  ool(confpool, {'
-00026d00: 636c 7573 7465 725f 6261 7265 6d65 7461  cluster_baremeta
-00026d10: 6c5f 7265 7365 7276 6174 696f 6e73 273a  l_reservations':
-00026d20: 2063 6c75 7374 6572 5f62 6172 656d 6574   cluster_baremet
-00026d30: 616c 5f72 6573 6572 7661 7469 6f6e 737d  al_reservations}
-00026d40: 290a 2020 2020 2020 2020 6966 206f 732e  ).        if os.
-00026d50: 7061 7468 2e65 7869 7374 7328 636c 7573  path.exists(clus
-00026d60: 7465 7264 6972 293a 0a20 2020 2020 2020  terdir):.       
-00026d70: 2020 2020 2070 7072 696e 7428 6622 4465       pprint(f"De
-00026d80: 6c65 7469 6e67 2064 6972 6563 746f 7279  leting directory
-00026d90: 207b 636c 7573 7465 7264 6972 7d22 290a   {clusterdir}").
-00026da0: 2020 2020 2020 2020 2020 2020 726d 7472              rmtr
-00026db0: 6565 2863 6c75 7374 6572 6469 7229 0a20  ee(clusterdir). 
-00026dc0: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-00026dd0: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-00026de0: 7327 7d0a 0a20 2020 2064 6566 2073 6361  s'}..    def sca
-00026df0: 6c65 5f6b 7562 6528 7365 6c66 2c20 636c  le_kube(self, cl
-00026e00: 7573 7465 722c 206b 7562 6574 7970 652c  uster, kubetype,
-00026e10: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
-00026e20: 2020 2020 2020 2020 6966 206b 7562 6574          if kubet
-00026e30: 7970 6520 3d3d 2027 6765 6e65 7269 6327  ype == 'generic'
-00026e40: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00026e50: 7375 6c74 203d 2073 656c 662e 7363 616c  sult = self.scal
-00026e60: 655f 6b75 6265 5f67 656e 6572 6963 2863  e_kube_generic(c
-00026e70: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
-00026e80: 733d 6f76 6572 7269 6465 7329 0a20 2020  s=overrides).   
-00026e90: 2020 2020 2065 6c69 6620 6b75 6265 7479       elif kubety
-00026ea0: 7065 203d 3d20 276b 3373 273a 0a20 2020  pe == 'k3s':.   
-00026eb0: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00026ec0: 3d20 7365 6c66 2e73 6361 6c65 5f6b 7562  = self.scale_kub
-00026ed0: 655f 6b33 7328 636c 7573 7465 722c 206f  e_k3s(cluster, o
-00026ee0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-00026ef0: 6573 290a 2020 2020 2020 2020 656c 6966  es).        elif
-00026f00: 206b 7562 6574 7970 6520 3d3d 2027 6f70   kubetype == 'op
-00026f10: 656e 7368 6966 7427 3a0a 2020 2020 2020  enshift':.      
-00026f20: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
-00026f30: 656c 662e 7363 616c 655f 6b75 6265 5f6f  elf.scale_kube_o
-00026f40: 7065 6e73 6869 6674 2863 6c75 7374 6572  penshift(cluster
-00026f50: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-00026f60: 7269 6465 7329 0a20 2020 2020 2020 2065  rides).        e
-00026f70: 6c69 6620 6b75 6265 7479 7065 203d 3d20  lif kubetype == 
-00026f80: 2768 7970 6572 7368 6966 7427 3a0a 2020  'hypershift':.  
-00026f90: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00026fa0: 203d 2073 656c 662e 7363 616c 655f 6b75   = self.scale_ku
-00026fb0: 6265 5f68 7970 6572 7368 6966 7428 636c  be_hypershift(cl
-00026fc0: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00026fd0: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
-00026fe0: 2020 2020 656c 6966 206b 7562 6574 7970      elif kubetyp
-00026ff0: 6520 3d3d 2027 676b 6527 3a0a 2020 2020  e == 'gke':.    
-00027000: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00027010: 2073 656c 662e 7363 616c 655f 6b75 6265   self.scale_kube
-00027020: 5f67 6b65 2863 6c75 7374 6572 2c20 6f76  _gke(cluster, ov
-00027030: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-00027040: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-00027050: 6e20 7265 7375 6c74 0a0a 2020 2020 6465  n result..    de
-00027060: 6620 7363 616c 655f 6b75 6265 5f67 656e  f scale_kube_gen
-00027070: 6572 6963 2873 656c 662c 2063 6c75 7374  eric(self, clust
-00027080: 6572 2c20 6f76 6572 7269 6465 733d 7b7d  er, overrides={}
-00027090: 293a 0a20 2020 2020 2020 2070 6c61 6e64  ):.        pland
-000270a0: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
-000270b0: 6e61 6d65 286b 7562 6561 646d 2e63 7265  name(kubeadm.cre
-000270c0: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
-000270d0: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
-000270e0: 2020 7265 7475 726e 206b 7562 6561 646d    return kubeadm
-000270f0: 2e73 6361 6c65 2873 656c 662c 2070 6c61  .scale(self, pla
-00027100: 6e64 6972 2c20 636c 7573 7465 722c 206f  ndir, cluster, o
-00027110: 7665 7272 6964 6573 290a 0a20 2020 2064  verrides)..    d
-00027120: 6566 2073 6361 6c65 5f6b 7562 655f 676b  ef scale_kube_gk
-00027130: 6528 7365 6c66 2c20 636c 7573 7465 722c  e(self, cluster,
-00027140: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
-00027150: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
-00027160: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
-00027170: 7420 676b 650a 2020 2020 2020 2020 7265  t gke.        re
-00027180: 7475 726e 2067 6b65 2e73 6361 6c65 2873  turn gke.scale(s
-00027190: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
-000271a0: 6572 7269 6465 7329 0a0a 2020 2020 6465  errides)..    de
-000271b0: 6620 7363 616c 655f 6b75 6265 5f68 7970  f scale_kube_hyp
-000271c0: 6572 7368 6966 7428 7365 6c66 2c20 636c  ershift(self, cl
-000271d0: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-000271e0: 3d7b 7d29 3a0a 2020 2020 2020 2020 706c  ={}):.        pl
-000271f0: 616e 6469 7220 3d20 6f73 2e70 6174 682e  andir = os.path.
-00027200: 6469 726e 616d 6528 6879 7065 7273 6869  dirname(hypershi
-00027210: 6674 2e63 7265 6174 652e 5f5f 636f 6465  ft.create.__code
-00027220: 5f5f 2e63 6f5f 6669 6c65 6e61 6d65 290a  __.co_filename).
-00027230: 2020 2020 2020 2020 7265 7475 726e 2068          return h
-00027240: 7970 6572 7368 6966 742e 7363 616c 6528  ypershift.scale(
-00027250: 7365 6c66 2c20 706c 616e 6469 722c 2063  self, plandir, c
-00027260: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
-00027270: 7329 0a0a 2020 2020 6465 6620 7363 616c  s)..    def scal
-00027280: 655f 6b75 6265 5f6b 3373 2873 656c 662c  e_kube_k3s(self,
-00027290: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
-000272a0: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
-000272b0: 2070 6c61 6e64 6972 203d 206f 732e 7061   plandir = os.pa
-000272c0: 7468 2e64 6972 6e61 6d65 286b 3373 2e63  th.dirname(k3s.c
-000272d0: 7265 6174 652e 5f5f 636f 6465 5f5f 2e63  reate.__code__.c
-000272e0: 6f5f 6669 6c65 6e61 6d65 290a 2020 2020  o_filename).    
-000272f0: 2020 2020 7265 7475 726e 206b 3373 2e73      return k3s.s
-00027300: 6361 6c65 2873 656c 662c 2070 6c61 6e64  cale(self, pland
-00027310: 6972 2c20 636c 7573 7465 722c 206f 7665  ir, cluster, ove
-00027320: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
-00027330: 2073 6361 6c65 5f6b 7562 655f 6f70 656e   scale_kube_open
-00027340: 7368 6966 7428 7365 6c66 2c20 636c 7573  shift(self, clus
-00027350: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
-00027360: 7d29 3a0a 2020 2020 2020 2020 706c 616e  }):.        plan
-00027370: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
-00027380: 726e 616d 6528 6f70 656e 7368 6966 742e  rname(openshift.
-00027390: 6372 6561 7465 2e5f 5f63 6f64 655f 5f2e  create.__code__.
-000273a0: 636f 5f66 696c 656e 616d 6529 0a20 2020  co_filename).   
-000273b0: 2020 2020 2072 6574 7572 6e20 6f70 656e       return open
-000273c0: 7368 6966 742e 7363 616c 6528 7365 6c66  shift.scale(self
-000273d0: 2c20 706c 616e 6469 722c 2063 6c75 7374  , plandir, clust
-000273e0: 6572 2c20 6f76 6572 7269 6465 7329 0a0a  er, overrides)..
-000273f0: 2020 2020 6465 6620 7570 6461 7465 5f6b      def update_k
-00027400: 7562 6528 7365 6c66 2c20 636c 7573 7465  ube(self, cluste
-00027410: 722c 205f 7479 7065 2c20 6f76 6572 7269  r, _type, overri
-00027420: 6465 733d 7b7d 2c20 706c 616e 3d4e 6f6e  des={}, plan=Non
-00027430: 6529 3a0a 2020 2020 2020 2020 6f76 6572  e):.        over
-00027440: 7269 6465 735b 2773 6b69 705f 6669 6c65  rides['skip_file
-00027450: 735f 7265 6d65 6469 6174 696f 6e27 5d20  s_remediation'] 
-00027460: 3d20 5472 7565 0a20 2020 2020 2020 206f  = True.        o
-00027470: 7665 7272 6964 6573 5b27 7363 616c 6527  verrides['scale'
-00027480: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
-00027490: 2063 6c75 7374 6572 6469 7220 3d20 6f73   clusterdir = os
-000274a0: 2e70 6174 682e 6578 7061 6e64 7573 6572  .path.expanduser
-000274b0: 2866 227e 2f2e 6b63 6c69 2f63 6c75 7374  (f"~/.kcli/clust
-000274c0: 6572 732f 7b63 6c75 7374 6572 7d22 290a  ers/{cluster}").
-000274d0: 2020 2020 2020 2020 706c 616e 766d 7320          planvms 
-000274e0: 3d20 5b5d 0a20 2020 2020 2020 2069 6620  = [].        if 
-000274f0: 706c 616e 2069 7320 4e6f 6e65 3a0a 2020  plan is None:.  
-00027500: 2020 2020 2020 2020 2020 706c 616e 203d            plan =
-00027510: 2063 6c75 7374 6572 0a20 2020 2020 2020   cluster.       
-00027520: 2069 6620 5f74 7970 6520 3d3d 2027 6765   if _type == 'ge
-00027530: 6e65 7269 6327 3a0a 2020 2020 2020 2020  neric':.        
-00027540: 2020 2020 726f 6c65 7320 3d20 5b27 6374      roles = ['ct
-00027550: 6c70 6c61 6e65 7327 2c20 2777 6f72 6b65  lplanes', 'worke
-00027560: 7273 275d 0a20 2020 2020 2020 2020 2020  rs'].           
-00027570: 2070 6c61 6e64 6972 203d 206f 732e 7061   plandir = os.pa
-00027580: 7468 2e64 6972 6e61 6d65 286b 7562 6561  th.dirname(kubea
-00027590: 646d 2e63 7265 6174 652e 5f5f 636f 6465  dm.create.__code
-000275a0: 5f5f 2e63 6f5f 6669 6c65 6e61 6d65 290a  __.co_filename).
-000275b0: 2020 2020 2020 2020 656c 6966 205f 7479          elif _ty
-000275c0: 7065 203d 3d20 276b 3373 273a 0a20 2020  pe == 'k3s':.   
-000275d0: 2020 2020 2020 2020 2070 6c61 6e64 6972           plandir
-000275e0: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-000275f0: 6d65 286b 3373 2e63 7265 6174 652e 5f5f  me(k3s.create.__
-00027600: 636f 6465 5f5f 2e63 6f5f 6669 6c65 6e61  code__.co_filena
-00027610: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00027620: 726f 6c65 7320 3d20 5b27 626f 6f74 7374  roles = ['bootst
-00027630: 7261 7027 2c20 2777 6f72 6b65 7273 275d  rap', 'workers']
-00027640: 2069 6620 6f76 6572 7269 6465 732e 6765   if overrides.ge
-00027650: 7428 2763 746c 706c 616e 6573 272c 2031  t('ctlplanes', 1
-00027660: 2920 3d3d 2031 2065 6c73 6520 5b27 626f  ) == 1 else ['bo
-00027670: 6f74 7374 7261 7027 2c20 2763 746c 706c  otstrap', 'ctlpl
-00027680: 616e 6573 272c 0a20 2020 2020 2020 2020  anes',.         
-00027690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000276a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000276b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000276c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000276d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000276e0: 2777 6f72 6b65 7273 275d 0a20 2020 2020  'workers'].     
-000276f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00027700: 2020 2020 2070 6c61 6e64 6972 203d 206f       plandir = o
-00027710: 732e 7061 7468 2e64 6972 6e61 6d65 286f  s.path.dirname(o
-00027720: 7065 6e73 6869 6674 2e63 7265 6174 652e  penshift.create.
-00027730: 5f5f 636f 6465 5f5f 2e63 6f5f 6669 6c65  __code__.co_file
-00027740: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-00027750: 2020 726f 6c65 7320 3d20 5b27 636c 6f75    roles = ['clou
-00027760: 645f 6374 6c70 6c61 6e65 7327 2c20 2763  d_ctlplanes', 'c
-00027770: 6c6f 7564 5f77 6f72 6b65 7273 275d 2069  loud_workers'] i
-00027780: 6620 7365 6c66 2e74 7970 6520 696e 205b  f self.type in [
-00027790: 2761 7773 272c 2027 6763 7027 5d20 656c  'aws', 'gcp'] el
-000277a0: 7365 205b 2763 746c 706c 616e 6573 272c  se ['ctlplanes',
-000277b0: 2027 776f 726b 6572 7327 5d0a 2020 2020   'workers'].    
-000277c0: 2020 2020 6966 206f 7665 7272 6964 6573      if overrides
-000277d0: 2e67 6574 2827 776f 726b 6572 7327 2c20  .get('workers', 
-000277e0: 3029 203d 3d20 303a 0a20 2020 2020 2020  0) == 0:.       
-000277f0: 2020 2020 2064 656c 2072 6f6c 6573 5b2d       del roles[-
-00027800: 315d 0a20 2020 2020 2020 2069 6620 6f73  1].        if os
-00027810: 2e70 6174 682e 6578 6973 7473 2866 227b  .path.exists(f"{
-00027820: 636c 7573 7465 7264 6972 7d2f 6b63 6c69  clusterdir}/kcli
-00027830: 5f70 6172 616d 6574 6572 732e 796d 6c22  _parameters.yml"
-00027840: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
-00027850: 6174 6120 3d20 7b27 636c 7573 7465 7227  ata = {'cluster'
-00027860: 3a20 636c 7573 7465 722c 2027 6b75 6265  : cluster, 'kube
-00027870: 273a 2063 6c75 7374 6572 2c20 276b 7562  ': cluster, 'kub
-00027880: 6574 7970 6527 3a20 5f74 7970 657d 0a20  etype': _type}. 
-00027890: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-000278a0: 6f70 656e 2866 227b 636c 7573 7465 7264  open(f"{clusterd
-000278b0: 6972 7d2f 6b63 6c69 5f70 6172 616d 6574  ir}/kcli_paramet
-000278c0: 6572 732e 796d 6c22 2c20 2772 2729 2061  ers.yml", 'r') a
-000278d0: 7320 696e 7374 616c 6c3a 0a20 2020 2020  s install:.     
-000278e0: 2020 2020 2020 2020 2020 2069 6e73 7461             insta
-000278f0: 6c6c 7061 7261 6d20 3d20 7961 6d6c 2e73  llparam = yaml.s
-00027900: 6166 655f 6c6f 6164 2869 6e73 7461 6c6c  afe_load(install
-00027910: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00027920: 2020 6461 7461 2e75 7064 6174 6528 696e    data.update(in
-00027930: 7374 616c 6c70 6172 616d 290a 2020 2020  stallparam).    
-00027940: 2020 2020 2020 2020 2020 2020 706c 616e              plan
-00027950: 203d 2069 6e73 7461 6c6c 7061 7261 6d2e   = installparam.
-00027960: 6765 7428 2770 6c61 6e27 2c20 706c 616e  get('plan', plan
-00027970: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
-00027980: 7461 2e75 7064 6174 6528 6f76 6572 7269  ta.update(overri
-00027990: 6465 7329 0a20 2020 2020 2020 2020 2020  des).           
-000279a0: 2077 6974 6820 6f70 656e 2866 227b 636c   with open(f"{cl
-000279b0: 7573 7465 7264 6972 7d2f 6b63 6c69 5f70  usterdir}/kcli_p
-000279c0: 6172 616d 6574 6572 732e 796d 6c22 2c20  arameters.yml", 
-000279d0: 2777 2729 2061 7320 7061 7261 6d66 696c  'w') as paramfil
-000279e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000279f0: 2020 2079 616d 6c2e 7361 6665 5f64 756d     yaml.safe_dum
-00027a00: 7028 6461 7461 2c20 7061 7261 6d66 696c  p(data, paramfil
-00027a10: 6529 0a20 2020 2020 2020 206f 732e 6368  e).        os.ch
-00027a20: 6469 7228 6f73 2e70 6174 682e 6578 7061  dir(os.path.expa
-00027a30: 6e64 7573 6572 2822 7e2f 2e6b 636c 6922  nduser("~/.kcli"
-00027a40: 2929 0a20 2020 2020 2020 2066 6f72 2072  )).        for r
-00027a50: 6f6c 6520 696e 2072 6f6c 6573 3a0a 2020  ole in roles:.  
-00027a60: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00027a70: 2866 2255 7064 6174 696e 6720 766d 7320  (f"Updating vms 
-00027a80: 7769 7468 207b 726f 6c65 7d20 726f 6c65  with {role} role
-00027a90: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
-00027aa0: 6c61 6e64 6174 6120 3d20 7365 6c66 2e70  landata = self.p
-00027ab0: 6c61 6e28 706c 616e 2c20 696e 7075 7466  lan(plan, inputf
-00027ac0: 696c 653d 6627 7b70 6c61 6e64 6972 7d2f  ile=f'{plandir}/
-00027ad0: 7b72 6f6c 657d 2e79 6d6c 272c 206f 7665  {role}.yml', ove
-00027ae0: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-00027af0: 2c20 7570 6461 7465 3d54 7275 6529 0a20  , update=True). 
-00027b00: 2020 2020 2020 2020 2020 2070 6c61 6e76             planv
-00027b10: 6d73 2e65 7874 656e 6428 706c 616e 6461  ms.extend(planda
-00027b20: 7461 5b27 6e65 7776 6d73 275d 202b 2070  ta['newvms'] + p
-00027b30: 6c61 6e64 6174 615b 2765 7869 7374 696e  landata['existin
-00027b40: 6776 6d73 275d 290a 2020 2020 2020 2020  gvms']).        
-00027b50: 6f73 2e65 6e76 6972 6f6e 5b27 4b55 4245  os.environ['KUBE
-00027b60: 434f 4e46 4947 275d 203d 2066 227b 636c  CONFIG'] = f"{cl
-00027b70: 7573 7465 7264 6972 7d2f 6175 7468 2f6b  usterdir}/auth/k
-00027b80: 7562 6563 6f6e 6669 6722 0a20 2020 2020  ubeconfig".     
-00027b90: 2020 2062 696e 6172 7920 3d20 276f 6327     binary = 'oc'
-00027ba0: 2069 6620 7768 6963 6828 276f 6327 2920   if which('oc') 
-00027bb0: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-00027bc0: 2027 6b75 6265 6374 6c27 0a20 2020 2020   'kubectl'.     
-00027bd0: 2020 206e 6f64 6573 636d 6420 3d20 6627     nodescmd = f'
-00027be0: 7b62 696e 6172 797d 2067 6574 206e 6f64  {binary} get nod
-00027bf0: 6520 2d6f 206e 616d 6527 0a20 2020 2020  e -o name'.     
-00027c00: 2020 206e 6f64 6573 203d 205b 6e2e 7374     nodes = [n.st
-00027c10: 7269 7028 292e 7265 706c 6163 6528 276e  rip().replace('n
-00027c20: 6f64 652f 272c 2027 2729 2066 6f72 206e  ode/', '') for n
-00027c30: 2069 6e20 6f73 2e70 6f70 656e 286e 6f64   in os.popen(nod
-00027c40: 6573 636d 6429 2e72 6561 646c 696e 6573  escmd).readlines
-00027c50: 2829 5d0a 2020 2020 2020 2020 666f 7220  ()].        for 
-00027c60: 766d 2069 6e20 7365 6c66 2e6b 2e6c 6973  vm in self.k.lis
-00027c70: 7428 293a 0a20 2020 2020 2020 2020 2020  t():.           
-00027c80: 2076 6d6e 616d 6520 3d20 766d 5b27 6e61   vmname = vm['na
-00027c90: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
-00027ca0: 2076 6d70 6c61 6e20 3d20 766d 2e67 6574   vmplan = vm.get
-00027cb0: 2827 706c 616e 272c 2027 6b76 6972 7427  ('plan', 'kvirt'
-00027cc0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00027cd0: 2076 6d70 6c61 6e20 3d3d 2070 6c61 6e20   vmplan == plan 
-00027ce0: 616e 6420 766d 6e61 6d65 206e 6f74 2069  and vmname not i
-00027cf0: 6e20 706c 616e 766d 733a 0a20 2020 2020  n planvms:.     
-00027d00: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00027d10: 7428 6622 4465 6c65 7469 6e67 2076 6d20  t(f"Deleting vm 
-00027d20: 7b76 6d6e 616d 657d 2229 0a20 2020 2020  {vmname}").     
-00027d30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00027d40: 6b2e 6465 6c65 7465 2876 6d6e 616d 6529  k.delete(vmname)
-00027d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027d60: 2066 6f72 206e 6f64 6520 696e 206e 6f64   for node in nod
-00027d70: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00027d80: 2020 2020 2020 2020 6966 206e 6f64 652e          if node.
-00027d90: 7370 6c69 7428 272e 2729 5b30 5d20 3d3d  split('.')[0] ==
-00027da0: 2076 6d6e 616d 653a 0a20 2020 2020 2020   vmname:.       
-00027db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027dc0: 2070 7072 696e 7428 6622 4465 6c65 7469   pprint(f"Deleti
-00027dd0: 6e67 206e 6f64 6520 7b6e 6f64 657d 2066  ng node {node} f
-00027de0: 726f 6d20 796f 7572 2063 6c75 7374 6572  rom your cluster
-00027df0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00027e00: 2020 2020 2020 2020 2020 2063 616c 6c28             call(
-00027e10: 6627 7b62 696e 6172 797d 2064 656c 6574  f'{binary} delet
-00027e20: 6520 6e6f 6465 207b 6e6f 6465 7d27 2c20  e node {node}', 
-00027e30: 7368 656c 6c3d 5472 7565 290a 2020 2020  shell=True).    
-00027e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e50: 2020 2020 6272 6561 6b0a 0a20 2020 2064      break..    d
-00027e60: 6566 2065 7870 6f73 655f 706c 616e 2873  ef expose_plan(s
-00027e70: 656c 662c 2070 6c61 6e2c 2069 6e70 7574  elf, plan, input
-00027e80: 6669 6c65 3d4e 6f6e 652c 206f 7665 7272  file=None, overr
-00027e90: 6964 6573 3d7b 7d2c 2070 6f72 743d 3930  ides={}, port=90
-00027ea0: 3030 2c20 7066 6d6f 6465 3d46 616c 7365  00, pfmode=False
-00027eb0: 2c20 636c 7573 7465 723d 4661 6c73 6529  , cluster=False)
-00027ec0: 3a0a 2020 2020 2020 2020 696e 7075 7466  :.        inputf
-00027ed0: 696c 6520 3d20 6f73 2e70 6174 682e 6578  ile = os.path.ex
-00027ee0: 7061 6e64 7573 6572 2869 6e70 7574 6669  panduser(inputfi
-00027ef0: 6c65 290a 2020 2020 2020 2020 6966 206e  le).        if n
-00027f00: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-00027f10: 7328 696e 7075 7466 696c 6529 3a0a 2020  s(inputfile):.  
-00027f20: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00027f30: 224e 6f20 696e 7075 7420 6669 6c65 2066  "No input file f
-00027f40: 6f75 6e64 206e 6f72 2064 6566 6175 6c74  ound nor default
-00027f50: 206b 636c 695f 706c 616e 2e79 6d6c 2e4c   kcli_plan.yml.L
-00027f60: 6561 7669 6e67 2e2e 2e2e 2229 0a20 2020  eaving....").   
-00027f70: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00027f80: 7428 3129 0a20 2020 2020 2020 2070 7072  t(1).        ppr
-00027f90: 696e 7428 6622 4861 6e64 6c69 6e67 2065  int(f"Handling e
-00027fa0: 7870 6f73 6520 6f66 2070 6c61 6e20 7769  xpose of plan wi
-00027fb0: 7468 206e 616d 6520 7b70 6c61 6e7d 2061  th name {plan} a
-00027fc0: 6e64 2069 6e70 7574 6669 6c65 207b 696e  nd inputfile {in
-00027fd0: 7075 7466 696c 657d 2229 0a20 2020 2020  putfile}").     
-00027fe0: 2020 206b 6578 706f 7365 7220 3d20 4b65     kexposer = Ke
-00027ff0: 7870 6f73 6572 2873 656c 662c 2070 6c61  xposer(self, pla
-00028000: 6e2c 2069 6e70 7574 6669 6c65 2c20 6f76  n, inputfile, ov
-00028010: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-00028020: 732c 2070 6f72 743d 706f 7274 2c20 7066  s, port=port, pf
-00028030: 6d6f 6465 3d70 666d 6f64 652c 2063 6c75  mode=pfmode, clu
-00028040: 7374 6572 3d63 6c75 7374 6572 290a 2020  ster=cluster).  
-00028050: 2020 2020 2020 6b65 7870 6f73 6572 2e72        kexposer.r
-00028060: 756e 2829 0a0a 2020 2020 6465 6620 6372  un()..    def cr
-00028070: 6561 7465 5f6f 7065 6e73 6869 6674 5f69  eate_openshift_i
-00028080: 736f 2873 656c 662c 2063 6c75 7374 6572  so(self, cluster
-00028090: 2c20 6f76 6572 7269 6465 733d 7b7d 2c20  , overrides={}, 
-000280a0: 6967 6e69 7469 6f6e 6669 6c65 3d4e 6f6e  ignitionfile=Non
-000280b0: 652c 2070 6f64 6d61 6e3d 4661 6c73 652c  e, podman=False,
-000280c0: 2069 6e73 7461 6c6c 6572 3d46 616c 7365   installer=False
-000280d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000280e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000280f0: 6972 6563 743d 4661 6c73 6529 3a0a 2020  irect=False):.  
-00028100: 2020 2020 2020 6d65 7461 6c5f 7572 6c20        metal_url 
-00028110: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
-00028120: 736f 5f76 6572 7369 6f6e 203d 2073 7472  so_version = str
-00028130: 286f 7665 7272 6964 6573 2e67 6574 2827  (overrides.get('
-00028140: 7665 7273 696f 6e27 2c20 276c 6174 6573  version', 'lates
-00028150: 7427 2929 0a20 2020 2020 2020 2069 6620  t')).        if 
-00028160: 6e6f 7420 696e 7374 616c 6c65 723a 0a20  not installer:. 
-00028170: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00028180: 6f5f 7665 7273 696f 6e20 6e6f 7420 696e  o_version not in
-00028190: 205b 276c 6174 6573 7427 2c20 2770 7265   ['latest', 'pre
-000281a0: 2d72 656c 6561 7365 275d 2061 6e64 206e  -release'] and n
-000281b0: 6f74 2069 736f 5f76 6572 7369 6f6e 2e73  ot iso_version.s
-000281c0: 7461 7274 7377 6974 6828 2734 2e27 293a  tartswith('4.'):
-000281d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000281e0: 2077 6172 6e69 6e67 2822 466f 7263 696e   warning("Forcin
-000281f0: 6720 6c69 7665 2069 736f 2076 6572 7369  g live iso versi
-00028200: 6f6e 2074 6f20 6c61 7465 7374 2229 0a20  on to latest"). 
-00028210: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00028220: 736f 5f76 6572 7369 6f6e 203d 2027 6c61  so_version = 'la
-00028230: 7465 7374 270a 2020 2020 2020 2020 2020  test'.          
-00028240: 2020 656c 6966 2069 736f 5f76 6572 7369    elif iso_versi
-00028250: 6f6e 2e73 7461 7274 7377 6974 6828 2734  on.startswith('4
-00028260: 2e27 293a 0a20 2020 2020 2020 2020 2020  .'):.           
-00028270: 2020 2020 206d 696e 6f72 5f76 6572 7369       minor_versi
-00028280: 6f6e 203d 2069 736f 5f76 6572 7369 6f6e  on = iso_version
-00028290: 2e73 706c 6974 2827 2e27 295b 315d 0a20  .split('.')[1]. 
-000282a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000282b0: 6620 6d69 6e6f 725f 7665 7273 696f 6e2e  f minor_version.
-000282c0: 6973 6469 6769 7428 2920 616e 6420 696e  isdigit() and in
-000282d0: 7428 6d69 6e6f 725f 7665 7273 696f 6e29  t(minor_version)
-000282e0: 203c 2036 3a0a 2020 2020 2020 2020 2020   < 6:.          
-000282f0: 2020 2020 2020 2020 2020 6d65 7461 6c5f            metal_
-00028300: 7572 6c20 3d20 6622 6874 7470 733a 2f2f  url = f"https://
-00028310: 6d69 7272 6f72 2e6f 7065 6e73 6869 6674  mirror.openshift
-00028320: 2e63 6f6d 2f70 7562 2f6f 7065 6e73 6869  .com/pub/openshi
-00028330: 6674 2d76 342f 6465 7065 6e64 656e 6369  ft-v4/dependenci
-00028340: 6573 2f72 6863 6f73 2f7b 6973 6f5f 7665  es/rhcos/{iso_ve
-00028350: 7273 696f 6e7d 2f6c 6174 6573 7422 0a20  rsion}/latest". 
-00028360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028370: 2020 206d 6574 616c 5f75 726c 202b 3d20     metal_url += 
-00028380: 222f 7268 636f 732d 6d65 7461 6c2e 7838  "/rhcos-metal.x8
-00028390: 365f 3634 2e72 6177 2e67 7a22 0a20 2020  6_64.raw.gz".   
-000283a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283b0: 2077 6172 6e69 6e67 2822 456d 6265 6464   warning("Embedd
-000283c0: 696e 6720 6d65 7461 6c20 7572 6c20 696e  ing metal url in
-000283d0: 2069 736f 2066 6f72 2074 6172 6765 7420   iso for target 
-000283e0: 7665 7273 696f 6e20 616e 6420 696e 7374  version and inst
-000283f0: 616c 6c69 6e67 2077 6974 6820 6120 6d6f  alling with a mo
-00028400: 7265 2072 6563 656e 7420 6973 6f22 290a  re recent iso").
-00028410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028420: 6973 6f5f 7665 7273 696f 6e20 3d20 276c  iso_version = 'l
-00028430: 6174 6573 7427 0a20 2020 2020 2020 2061  atest'.        a
-00028440: 7069 5f69 7020 3d20 6f76 6572 7269 6465  pi_ip = override
-00028450: 732e 6765 7428 2761 7069 5f69 7027 290a  s.get('api_ip').
-00028460: 2020 2020 2020 2020 6967 6e69 7469 6f6e          ignition
-00028470: 5f76 6572 7369 6f6e 203d 206f 7665 7272  _version = overr
-00028480: 6964 6573 2e67 6574 2827 6967 6e69 7469  ides.get('igniti
-00028490: 6f6e 5f76 6572 7369 6f6e 272c 0a20 2020  on_version',.   
-000284a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000284b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000284c0: 2020 2020 2020 636f 6d6d 6f6e 2e69 676e        common.ign
-000284d0: 6974 696f 6e5f 7665 7273 696f 6e28 2272  ition_version("r
-000284e0: 6863 6f73 2d25 7322 2025 2069 736f 5f76  hcos-%s" % iso_v
-000284f0: 6572 7369 6f6e 2e72 6570 6c61 6365 2827  ersion.replace('
-00028500: 2e27 2c20 2727 2929 290a 2020 2020 2020  .', ''))).      
-00028510: 2020 726f 6c65 203d 206f 7665 7272 6964    role = overrid
-00028520: 6573 2e67 6574 2827 726f 6c65 272c 2027  es.get('role', '
-00028530: 776f 726b 6572 2729 0a20 2020 2020 2020  worker').       
-00028540: 2069 736f 203d 206f 7665 7272 6964 6573   iso = overrides
-00028550: 2e67 6574 2827 6973 6f27 2c20 5472 7565  .get('iso', True
-00028560: 290a 2020 2020 2020 2020 646f 6d61 696e  ).        domain
-00028570: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
-00028580: 2827 646f 6d61 696e 2729 0a20 2020 2020  ('domain').     
-00028590: 2020 2069 6620 272e 2720 696e 2063 6c75     if '.' in clu
-000285a0: 7374 6572 3a0a 2020 2020 2020 2020 2020  ster:.          
-000285b0: 2020 646f 6d61 696e 203d 2027 2e27 2e6a    domain = '.'.j
-000285c0: 6f69 6e28 636c 7573 7465 722e 7370 6c69  oin(cluster.spli
-000285d0: 7428 272e 2729 5b31 3a5d 290a 2020 2020  t('.')[1:]).    
-000285e0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-000285f0: 2255 7369 6e67 2064 6f6d 6169 6e20 7b64  "Using domain {d
-00028600: 6f6d 6169 6e7d 2229 0a20 2020 2020 2020  omain}").       
-00028610: 2020 2020 2063 6c75 7374 6572 203d 2063       cluster = c
-00028620: 6c75 7374 6572 2e72 6570 6c61 6365 2866  luster.replace(f
-00028630: 222e 7b64 6f6d 6169 6e7d 222c 2027 2729  ".{domain}", '')
-00028640: 0a20 2020 2020 2020 2069 6620 636c 7573  .        if clus
-00028650: 7465 722e 7374 6172 7473 7769 7468 2827  ter.startswith('
-00028660: 6170 692e 2729 3a0a 2020 2020 2020 2020  api.'):.        
-00028670: 2020 2020 636c 7573 7465 7220 3d20 636c      cluster = cl
-00028680: 7573 7465 722e 7265 706c 6163 6528 2261  uster.replace("a
-00028690: 7069 2e22 2c20 2727 290a 2020 2020 2020  pi.", '').      
-000286a0: 2020 2020 2020 7070 7269 6e74 2866 2255        pprint(f"U
-000286b0: 7369 6e67 2063 6c75 7374 6572 207b 636c  sing cluster {cl
-000286c0: 7573 7465 727d 2229 0a20 2020 2020 2020  uster}").       
-000286d0: 2068 6f73 7473 5f63 6f6e 7465 6e74 203d   hosts_content =
-000286e0: 204e 6f6e 650a 2020 2020 2020 2020 6669   None.        fi
-000286f0: 6e61 6c64 6174 6120 3d20 4e6f 6e65 0a20  naldata = None. 
-00028700: 2020 2020 2020 2069 6620 6967 6e69 7469         if igniti
-00028710: 6f6e 6669 6c65 2069 7320 6e6f 7420 4e6f  onfile is not No
-00028720: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00028730: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
-00028740: 7869 7374 7328 6967 6e69 7469 6f6e 6669  xists(ignitionfi
-00028750: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-00028760: 2020 2020 2065 7272 6f72 2866 227b 6967       error(f"{ig
-00028770: 6e69 7469 6f6e 6669 6c65 7d20 6e6f 7420  nitionfile} not 
-00028780: 666f 756e 6422 290a 2020 2020 2020 2020  found").        
-00028790: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-000287a0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
-000287b0: 6669 6e61 6c64 6174 6120 3d20 6f70 656e  finaldata = open
-000287c0: 2869 676e 6974 696f 6e66 696c 6529 2e72  (ignitionfile).r
-000287d0: 6561 6428 290a 2020 2020 2020 2020 656c  ead().        el
-000287e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000287f0: 6967 6e69 7469 6f6e 6669 6c65 203d 2066  ignitionfile = f
-00028800: 227b 726f 6c65 7d2e 6967 6e22 0a20 2020  "{role}.ign".   
-00028810: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
-00028820: 6174 682e 6578 6973 7473 2869 676e 6974  ath.exists(ignit
-00028830: 696f 6e66 696c 6529 3a0a 2020 2020 2020  ionfile):.      
-00028840: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00028850: 6728 6622 5573 696e 6720 6578 6973 7469  g(f"Using existi
-00028860: 6e67 207b 6967 6e69 7469 6f6e 6669 6c65  ng {ignitionfile
-00028870: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00028880: 2020 2020 6669 6e61 6c64 6174 6120 3d20      finaldata = 
-00028890: 6f70 656e 2869 676e 6974 696f 6e66 696c  open(ignitionfil
-000288a0: 6529 2e72 6561 6428 290a 2020 2020 2020  e).read().      
-000288b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000288c0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-000288d0: 7069 5f69 7020 6973 204e 6f6e 653a 0a20  pi_ip is None:. 
-000288e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000288f0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00028900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028910: 6170 695f 6970 203d 2073 6f63 6b65 742e  api_ip = socket.
-00028920: 6765 7468 6f73 7462 796e 616d 6528 6627  gethostbyname(f'
-00028930: 6170 692e 7b63 6c75 7374 6572 7d2e 7b64  api.{cluster}.{d
-00028940: 6f6d 6169 6e7d 2729 0a20 2020 2020 2020  omain}').       
-00028950: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00028960: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-00028970: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00028980: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00028990: 2020 6966 2061 7069 5f69 7020 6973 204e    if api_ip is N
-000289a0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000289b0: 2020 2020 2020 2020 2069 6620 646f 6d61           if doma
-000289c0: 696e 2069 7320 4e6f 6e65 3a0a 2020 2020  in is None:.    
-000289d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000289e0: 2020 2020 6572 726f 7228 2243 6f75 6c64      error("Could
-000289f0: 6e27 7420 6669 6775 7265 206f 7574 2061  n't figure out a
-00028a00: 7069 5f69 7020 6e6f 7220 7265 6c79 206f  pi_ip nor rely o
-00028a10: 6e20 646e 7320 7369 6e63 6520 646f 6d61  n dns since doma
-00028a20: 696e 2069 7320 6e6f 7420 7365 7422 290a  in is not set").
-00028a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a40: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-00028a50: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
-00028a60: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-00028a70: 2243 6f75 6c64 6e27 7420 6669 6775 7265  "Couldn't figure
-00028a80: 206f 7574 2061 7069 5f69 702e 2052 656c   out api_ip. Rel
-00028a90: 7969 6e67 206f 6e20 646e 7322 290a 2020  ying on dns").  
-00028aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ab0: 2020 6170 695f 6970 203d 2066 2261 7069    api_ip = f"api
-00028ac0: 2e7b 636c 7573 7465 727d 2e7b 646f 6d61  .{cluster}.{doma
-00028ad0: 696e 7d22 0a20 2020 2020 2020 2020 2020  in}".           
-00028ae0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00028af0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00028b00: 6f73 7473 5f63 6f6e 7465 6e74 203d 2022  osts_content = "
-00028b10: 3132 372e 302e 302e 3120 2020 6c6f 6361  127.0.0.1   loca
-00028b20: 6c68 6f73 7420 6c6f 6361 6c68 6f73 742e  lhost localhost.
-00028b30: 6c6f 6361 6c64 6f6d 6169 6e20 6c6f 6361  localdomain loca
-00028b40: 6c68 6f73 7434 206c 6f63 616c 686f 7374  lhost4 localhost
-00028b50: 342e 6c6f 6361 6c64 6f6d 6169 6e34 5c6e  4.localdomain4\n
-00028b60: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00028b70: 2020 2020 2020 686f 7374 735f 636f 6e74        hosts_cont
-00028b80: 656e 7420 2b3d 2022 3a3a 3120 2020 2020  ent += "::1     
-00028b90: 2020 2020 6c6f 6361 6c68 6f73 7420 6c6f      localhost lo
-00028ba0: 6361 6c68 6f73 742e 6c6f 6361 6c64 6f6d  calhost.localdom
-00028bb0: 6169 6e20 6c6f 6361 6c68 6f73 7436 206c  ain localhost6 l
-00028bc0: 6f63 616c 686f 7374 362e 6c6f 6361 6c64  ocalhost6.locald
-00028bd0: 6f6d 6169 6e36 5c6e 220a 2020 2020 2020  omain6\n".      
-00028be0: 2020 2020 2020 2020 2020 2020 2020 686f                ho
-00028bf0: 7374 735f 636f 6e74 656e 7420 2b3d 2066  sts_content += f
-00028c00: 227b 6170 695f 6970 7d20 6170 692d 696e  "{api_ip} api-in
-00028c10: 742e 7b63 6c75 7374 6572 7d2e 7b64 6f6d  t.{cluster}.{dom
-00028c20: 6169 6e7d 2061 7069 2e7b 636c 7573 7465  ain} api.{cluste
-00028c30: 727d 2e7b 646f 6d61 696e 7d22 0a20 2020  r}.{domain}".   
-00028c40: 2020 2020 2070 6c61 6e64 6972 203d 206f       plandir = o
-00028c50: 732e 7061 7468 2e64 6972 6e61 6d65 286f  s.path.dirname(o
-00028c60: 7065 6e73 6869 6674 2e63 7265 6174 652e  penshift.create.
-00028c70: 5f5f 636f 6465 5f5f 2e63 6f5f 6669 6c65  __code__.co_file
-00028c80: 6e61 6d65 290a 2020 2020 2020 2020 7769  name).        wi
-00028c90: 7468 206f 7065 6e28 2269 736f 2e69 676e  th open("iso.ign
-00028ca0: 222c 2027 7727 2920 6173 2066 3a0a 2020  ", 'w') as f:.  
-00028cb0: 2020 2020 2020 2020 2020 6675 6c6c 5f6e            full_n
-00028cc0: 616d 6520 3d20 6627 7b63 6c75 7374 6572  ame = f'{cluster
-00028cd0: 7d2e 7b64 6f6d 6169 6e7d 2720 6966 2064  }.{domain}' if d
-00028ce0: 6f6d 6169 6e20 6973 206e 6f74 204e 6f6e  omain is not Non
-00028cf0: 6520 656c 7365 2063 6c75 7374 6572 0a20  e else cluster. 
-00028d00: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00028d10: 7428 6622 5772 6974 696e 6720 6669 6c65  t(f"Writing file
-00028d20: 2069 736f 2e69 676e 2066 6f72 207b 726f   iso.ign for {ro
-00028d30: 6c65 7d20 696e 207b 6675 6c6c 5f6e 616d  le} in {full_nam
-00028d40: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-00028d50: 2069 736f 6469 7220 3d20 6f73 2e70 6174   isodir = os.pat
-00028d60: 682e 6469 726e 616d 6528 636f 6d6d 6f6e  h.dirname(common
-00028d70: 2e5f 5f66 696c 655f 5f29 0a20 2020 2020  .__file__).     
-00028d80: 2020 2020 2020 2069 6620 6669 6e61 6c64         if finald
-00028d90: 6174 6120 6973 204e 6f6e 653a 0a20 2020  ata is None:.   
-00028da0: 2020 2020 2020 2020 2020 2020 2065 6e76               env
-00028db0: 203d 2045 6e76 6972 6f6e 6d65 6e74 286c   = Environment(l
-00028dc0: 6f61 6465 723d 4669 6c65 5379 7374 656d  oader=FileSystem
-00028dd0: 4c6f 6164 6572 2869 736f 6469 7229 2c20  Loader(isodir), 
-00028de0: 6578 7465 6e73 696f 6e73 3d5b 276a 696e  extensions=['jin
-00028df0: 6a61 322e 6578 742e 646f 275d 2c20 7472  ja2.ext.do'], tr
-00028e00: 696d 5f62 6c6f 636b 733d 5472 7565 2c0a  im_blocks=True,.
-00028e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e30: 2020 6c73 7472 6970 5f62 6c6f 636b 733d    lstrip_blocks=
-00028e40: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00028e50: 2020 2020 2020 7465 6d70 6c20 3d20 656e        templ = en
-00028e60: 762e 6765 745f 7465 6d70 6c61 7465 286f  v.get_template(o
-00028e70: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00028e80: 2269 676e 6974 696f 6e2e 6a32 2229 290a  "ignition.j2")).
-00028e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ea0: 6966 2068 6f73 7473 5f63 6f6e 7465 6e74  if hosts_content
-00028eb0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00028ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ed0: 2020 686f 7374 735f 636f 6e74 656e 7420    hosts_content 
-00028ee0: 3d20 6261 7365 3634 2e62 3634 656e 636f  = base64.b64enco
-00028ef0: 6465 2868 6f73 7473 5f63 6f6e 7465 6e74  de(hosts_content
-00028f00: 2e65 6e63 6f64 6528 2929 2e64 6563 6f64  .encode()).decod
-00028f10: 6528 2255 5446 2d38 2229 0a20 2020 2020  e("UTF-8").     
-00028f20: 2020 2020 2020 2020 2020 2069 6620 273a             if ':
-00028f30: 2720 696e 2061 7069 5f69 703a 2020 2023  ' in api_ip:   #
-00028f40: 2049 5076 3620 6164 6472 6573 730a 2020   IPv6 address.  
-00028f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028f60: 2020 6967 6e69 7469 6f6e 5f75 726c 203d    ignition_url =
-00028f70: 2066 2268 7474 703a 2f2f 5b7b 6170 695f   f"http://[{api_
-00028f80: 6970 7d5d 3a32 3236 3234 2f63 6f6e 6669  ip}]:22624/confi
-00028f90: 672f 7b72 6f6c 657d 220a 2020 2020 2020  g/{role}".      
-00028fa0: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
-00028fb0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00028fc0: 4950 7634 2061 6464 7265 7373 0a20 2020  IPv4 address.   
-00028fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028fe0: 2069 676e 6974 696f 6e5f 7572 6c20 3d20   ignition_url = 
-00028ff0: 6622 6874 7470 3a2f 2f7b 6170 695f 6970  f"http://{api_ip
-00029000: 7d3a 3232 3632 342f 636f 6e66 6967 2f7b  }:22624/config/{
-00029010: 726f 6c65 7d22 0a20 2020 2020 2020 2020  role}".         
-00029020: 2020 2020 2020 2066 696e 616c 6461 7461         finaldata
-00029030: 203d 2074 656d 706c 2e72 656e 6465 7228   = templ.render(
-00029040: 6967 6e69 7469 6f6e 5f75 726c 3d69 676e  ignition_url=ign
-00029050: 6974 696f 6e5f 7572 6c2c 2068 6f73 7473  ition_url, hosts
-00029060: 5f63 6f6e 7465 6e74 3d68 6f73 7473 5f63  _content=hosts_c
-00029070: 6f6e 7465 6e74 2c0a 2020 2020 2020 2020  ontent,.        
-00029080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000290a0: 2069 676e 6974 696f 6e5f 7665 7273 696f   ignition_versio
-000290b0: 6e3d 6967 6e69 7469 6f6e 5f76 6572 7369  n=ignition_versi
-000290c0: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
-000290d0: 6966 2064 6972 6563 743a 0a20 2020 2020  if direct:.     
-000290e0: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
-000290f0: 7465 2866 696e 616c 6461 7461 290a 2020  te(finaldata).  
-00029100: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00029110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029120: 5f66 696c 6573 203d 205b 7b22 7061 7468  _files = [{"path
-00029130: 223a 2022 2f72 6f6f 742f 636f 6e66 6967  ": "/root/config
-00029140: 2e69 676e 222c 2022 636f 6e74 656e 7422  .ign", "content"
-00029150: 3a20 6669 6e61 6c64 6174 617d 5d0a 2020  : finaldata}].  
-00029160: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00029170: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00029180: 2769 736f 2e73 6827 293a 0a20 2020 2020  'iso.sh'):.     
-00029190: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000291a0: 7072 696e 7428 2255 7369 6e67 206c 6f63  print("Using loc
-000291b0: 616c 2069 736f 2e73 6820 7363 7269 7074  al iso.sh script
-000291c0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000291d0: 2020 2020 2020 2069 736f 7363 7269 7074         isoscript
-000291e0: 203d 2027 6973 6f2e 7368 270a 2020 2020   = 'iso.sh'.    
-000291f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00029200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00029210: 2020 2020 2020 6973 6f73 6372 6970 7420        isoscript 
-00029220: 3d20 6627 7b70 6c61 6e64 6972 7d2f 6973  = f'{plandir}/is
-00029230: 6f2e 7368 270a 2020 2020 2020 2020 2020  o.sh'.          
-00029240: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00029250: 2e65 7869 7374 7328 276d 6163 732e 7478  .exists('macs.tx
-00029260: 7427 293a 0a20 2020 2020 2020 2020 2020  t'):.           
-00029270: 2020 2020 2020 2020 205f 6669 6c65 732e           _files.
-00029280: 6170 7065 6e64 287b 2270 6174 6822 3a20  append({"path": 
-00029290: 222f 726f 6f74 2f6d 6163 732e 7478 7422  "/root/macs.txt"
-000292a0: 2c20 226f 7269 6769 6e22 3a20 276d 6163  , "origin": 'mac
-000292b0: 732e 7478 7427 7d29 0a20 2020 2020 2020  s.txt'}).       
-000292c0: 2020 2020 2020 2020 2069 736f 5f6f 7665           iso_ove
-000292d0: 7272 6964 6573 203d 207b 2773 6372 6970  rrides = {'scrip
-000292e0: 7473 273a 205b 6973 6f73 6372 6970 745d  ts': [isoscript]
-000292f0: 2c20 2766 696c 6573 273a 205f 6669 6c65  , 'files': _file
-00029300: 732c 2027 6d65 7461 6c5f 7572 6c27 3a20  s, 'metal_url': 
-00029310: 6d65 7461 6c5f 7572 6c2c 2027 6e6f 6e61  metal_url, 'nona
-00029320: 6d65 273a 2054 7275 652c 0a20 2020 2020  me': True,.     
-00029330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029340: 2020 2020 2020 2020 2020 2020 2769 6d61              'ima
-00029350: 6765 273a 2027 7268 636f 7334 3030 3027  ge': 'rhcos4000'
-00029360: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00029370: 2020 6966 206d 6574 616c 5f75 726c 2069    if metal_url i
-00029380: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00029390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000293a0: 6973 6f5f 6f76 6572 7269 6465 735b 276e  iso_overrides['n
-000293b0: 6565 645f 6e65 7477 6f72 6b27 5d20 3d20  eed_network'] = 
-000293c0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-000293d0: 2020 2020 2069 736f 5f6f 7665 7272 6964       iso_overrid
-000293e0: 6573 2e75 7064 6174 6528 6f76 6572 7269  es.update(overri
-000293f0: 6465 7329 0a20 2020 2020 2020 2020 2020  des).           
-00029400: 2020 2020 2069 6620 276e 616d 6527 2069       if 'name' i
-00029410: 6e20 6f76 6572 7269 6465 733a 0a20 2020  n overrides:.   
-00029420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029430: 2069 736f 5f6e 616d 6520 3d20 6f76 6572   iso_name = over
-00029440: 7269 6465 735b 276e 616d 6527 5d0a 2020  rides['name'].  
+00026b40: 6e6f 7420 6173 7369 7374 6564 2061 6e64  not assisted and
+00026b50: 2028 2762 6172 656d 6574 616c 5f69 736f   ('baremetal_iso
+00026b60: 2720 696e 2063 6c75 7374 6572 6461 7461  ' in clusterdata
+00026b70: 206f 7220 2762 6172 656d 6574 616c 5f68   or 'baremetal_h
+00026b80: 6f73 7473 2720 696e 2063 6c75 7374 6572  osts' in cluster
+00026b90: 6461 7461 293a 0a20 2020 2020 2020 2020  data):.         
+00026ba0: 2020 2020 2020 2063 616c 6c28 6627 4b55         call(f'KU
+00026bb0: 4245 434f 4e46 4947 3d7b 6b75 6265 636f  BECONFIG={kubeco
+00026bc0: 6e66 6967 6d67 6d74 7d20 6f63 202d 6e20  nfigmgmt} oc -n 
+00026bd0: 6465 6661 756c 7420 6465 6c65 7465 2061  default delete a
+00026be0: 6c6c 202d 6c20 6170 703d 6874 7470 642d  ll -l app=httpd-
+00026bf0: 6b63 6c69 272c 2073 6865 6c6c 3d54 7275  kcli', shell=Tru
+00026c00: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00026c10: 2020 2063 616c 6c28 6627 4b55 4245 434f     call(f'KUBECO
+00026c20: 4e46 4947 3d7b 6b75 6265 636f 6e66 6967  NFIG={kubeconfig
+00026c30: 6d67 6d74 7d20 6f63 202d 6e20 6465 6661  mgmt} oc -n defa
+00026c40: 756c 7420 6465 6c65 7465 2070 7663 2068  ult delete pvc h
+00026c50: 7474 7064 2d6b 636c 692d 7076 6327 2c20  ttpd-kcli-pvc', 
+00026c60: 7368 656c 6c3d 5472 7565 290a 2020 2020  shell=True).    
+00026c70: 2020 2020 6966 2067 6b65 3a0a 2020 2020      if gke:.    
+00026c80: 2020 2020 2020 2020 6763 7063 6c69 656e          gcpclien
+00026c90: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
+00026ca0: 2020 2020 2069 6620 2763 6c69 656e 7427       if 'client'
+00026cb0: 2069 6e20 636c 7573 7465 7264 6174 613a   in clusterdata:
+00026cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026cd0: 2067 6370 636c 6965 6e74 203d 2063 6c75   gcpclient = clu
+00026ce0: 7374 6572 6461 7461 5b27 636c 6965 6e74  sterdata['client
+00026cf0: 275d 0a20 2020 2020 2020 2020 2020 2065  '].            e
+00026d00: 6c69 6620 7365 6c66 2e74 7970 6520 3d3d  lif self.type ==
+00026d10: 2027 6763 7027 3a0a 2020 2020 2020 2020   'gcp':.        
+00026d20: 2020 2020 2020 2020 6763 7063 6c69 656e          gcpclien
+00026d30: 7420 3d20 7365 6c66 2e63 6c69 656e 740a  t = self.client.
+00026d40: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00026d50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00026d60: 2020 6d73 6720 3d20 2244 656c 6574 696e    msg = "Deletin
+00026d70: 6720 676b 6520 636c 7573 7465 7220 7265  g gke cluster re
+00026d80: 7175 6972 6573 2074 6f20 696e 7374 616e  quires to instan
+00026d90: 7469 6174 6520 6763 7020 7072 6f76 6964  tiate gcp provid
+00026da0: 6572 220a 2020 2020 2020 2020 2020 2020  er".            
+00026db0: 2020 2020 6572 726f 7228 6d73 6729 0a20      error(msg). 
+00026dc0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00026dd0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00026de0: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
+00026df0: 736f 6e27 3a20 6d73 677d 0a20 2020 2020  son': msg}.     
+00026e00: 2020 2020 2020 2066 726f 6d20 6b76 6972         from kvir
+00026e10: 742e 636c 7573 7465 7220 696d 706f 7274  t.cluster import
+00026e20: 2067 6b65 0a20 2020 2020 2020 2020 2020   gke.           
+00026e30: 2063 7572 7265 6e74 636f 6e66 6967 203d   currentconfig =
+00026e40: 204b 636f 6e66 6967 2863 6c69 656e 743d   Kconfig(client=
+00026e50: 6763 7063 6c69 656e 7429 2e6b 2069 6620  gcpclient).k if 
+00026e60: 6763 7063 6c69 656e 7420 213d 2073 656c  gcpclient != sel
+00026e70: 662e 636c 6965 6e74 2065 6c73 6520 7365  f.client else se
+00026e80: 6c66 0a20 2020 2020 2020 2020 2020 207a  lf.            z
+00026e90: 6f6e 616c 203d 2063 6c75 7374 6572 6461  onal = clusterda
+00026ea0: 7461 2e67 6574 2827 7a6f 6e61 6c27 2c20  ta.get('zonal', 
+00026eb0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00026ec0: 2020 676b 652e 6465 6c65 7465 2863 7572    gke.delete(cur
+00026ed0: 7265 6e74 636f 6e66 6967 2c20 636c 7573  rentconfig, clus
+00026ee0: 7465 722c 207a 6f6e 616c 290a 2020 2020  ter, zonal).    
+00026ef0: 2020 2020 6966 2065 6b73 3a0a 2020 2020      if eks:.    
+00026f00: 2020 2020 2020 2020 656b 7363 6c69 656e          eksclien
+00026f10: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
+00026f20: 2020 2020 2069 6620 2763 6c69 656e 7427       if 'client'
+00026f30: 2069 6e20 636c 7573 7465 7264 6174 613a   in clusterdata:
+00026f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026f50: 2065 6b73 636c 6965 6e74 203d 2063 6c75   eksclient = clu
+00026f60: 7374 6572 6461 7461 5b27 636c 6965 6e74  sterdata['client
+00026f70: 275d 0a20 2020 2020 2020 2020 2020 2065  '].            e
+00026f80: 6c69 6620 7365 6c66 2e74 7970 6520 3d3d  lif self.type ==
+00026f90: 2027 6177 7327 3a0a 2020 2020 2020 2020   'aws':.        
+00026fa0: 2020 2020 2020 2020 656b 7363 6c69 656e          eksclien
+00026fb0: 7420 3d20 7365 6c66 2e63 6c69 656e 740a  t = self.client.
+00026fc0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00026fd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00026fe0: 2020 6d73 6720 3d20 2244 656c 6574 696e    msg = "Deletin
+00026ff0: 6720 676b 6520 636c 7573 7465 7220 7265  g gke cluster re
+00027000: 7175 6972 6573 2074 6f20 696e 7374 616e  quires to instan
+00027010: 7469 6174 6520 6763 7020 7072 6f76 6964  tiate gcp provid
+00027020: 6572 220a 2020 2020 2020 2020 2020 2020  er".            
+00027030: 2020 2020 6572 726f 7228 6d73 6729 0a20      error(msg). 
+00027040: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00027050: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00027060: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
+00027070: 736f 6e27 3a20 6d73 677d 0a20 2020 2020  son': msg}.     
+00027080: 2020 2020 2020 2066 726f 6d20 6b76 6972         from kvir
+00027090: 742e 636c 7573 7465 7220 696d 706f 7274  t.cluster import
+000270a0: 2065 6b73 0a20 2020 2020 2020 2020 2020   eks.           
+000270b0: 2063 7572 7265 6e74 636f 6e66 6967 203d   currentconfig =
+000270c0: 204b 636f 6e66 6967 2863 6c69 656e 743d   Kconfig(client=
+000270d0: 656b 7363 6c69 656e 7429 2e6b 2069 6620  eksclient).k if 
+000270e0: 656b 7363 6c69 656e 7420 213d 2073 656c  eksclient != sel
+000270f0: 662e 636c 6965 6e74 2065 6c73 6520 7365  f.client else se
+00027100: 6c66 0a20 2020 2020 2020 2020 2020 2065  lf.            e
+00027110: 6b73 2e64 656c 6574 6528 6375 7272 656e  ks.delete(curren
+00027120: 7463 6f6e 6669 672c 2063 6c75 7374 6572  tconfig, cluster
+00027130: 290a 2020 2020 2020 2020 666f 7220 636f  ).        for co
+00027140: 6e66 706f 6f6c 2069 6e20 7365 6c66 2e63  nfpool in self.c
+00027150: 6f6e 6670 6f6f 6c73 3a0a 2020 2020 2020  onfpools:.      
+00027160: 2020 2020 2020 6970 5f72 6573 6572 7661        ip_reserva
+00027170: 7469 6f6e 7320 3d20 7365 6c66 2e63 6f6e  tions = self.con
+00027180: 6670 6f6f 6c73 5b63 6f6e 6670 6f6f 6c5d  fpools[confpool]
+00027190: 2e67 6574 2827 6970 5f72 6573 6572 7661  .get('ip_reserva
+000271a0: 7469 6f6e 7327 2c20 7b7d 290a 2020 2020  tions', {}).    
+000271b0: 2020 2020 2020 2020 6966 2063 6c75 7374          if clust
+000271c0: 6572 2069 6e20 6970 5f72 6573 6572 7661  er in ip_reserva
+000271d0: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
+000271e0: 2020 2020 2020 2064 656c 2069 705f 7265         del ip_re
+000271f0: 7365 7276 6174 696f 6e73 5b63 6c75 7374  servations[clust
+00027200: 6572 5d0a 2020 2020 2020 2020 2020 2020  er].            
+00027210: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
+00027220: 636f 6e66 706f 6f6c 2863 6f6e 6670 6f6f  confpool(confpoo
+00027230: 6c2c 207b 2769 705f 7265 7365 7276 6174  l, {'ip_reservat
+00027240: 696f 6e73 273a 2069 705f 7265 7365 7276  ions': ip_reserv
+00027250: 6174 696f 6e73 7d29 0a20 2020 2020 2020  ations}).       
+00027260: 2020 2020 206e 616d 655f 7265 7365 7276       name_reserv
+00027270: 6174 696f 6e73 203d 2073 656c 662e 636f  ations = self.co
+00027280: 6e66 706f 6f6c 735b 636f 6e66 706f 6f6c  nfpools[confpool
+00027290: 5d2e 6765 7428 276e 616d 655f 7265 7365  ].get('name_rese
+000272a0: 7276 6174 696f 6e73 272c 205b 5d29 0a20  rvations', []). 
+000272b0: 2020 2020 2020 2020 2020 2069 6620 636c             if cl
+000272c0: 7573 7465 7220 696e 206e 616d 655f 7265  uster in name_re
+000272d0: 7365 7276 6174 696f 6e73 3a0a 2020 2020  servations:.    
+000272e0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+000272f0: 5f72 6573 6572 7661 7469 6f6e 732e 7265  _reservations.re
+00027300: 6d6f 7665 2863 6c75 7374 6572 290a 2020  move(cluster).  
+00027310: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00027320: 6c66 2e75 7064 6174 655f 636f 6e66 706f  lf.update_confpo
+00027330: 6f6c 2863 6f6e 6670 6f6f 6c2c 207b 276e  ol(confpool, {'n
+00027340: 616d 655f 7265 7365 7276 6174 696f 6e73  ame_reservations
+00027350: 273a 206e 616d 655f 7265 7365 7276 6174  ': name_reservat
+00027360: 696f 6e73 7d29 0a20 2020 2020 2020 2020  ions}).         
+00027370: 2020 2063 6c75 7374 6572 5f62 6172 656d     cluster_barem
+00027380: 6574 616c 5f72 6573 6572 7661 7469 6f6e  etal_reservation
+00027390: 7320 3d20 7365 6c66 2e63 6f6e 6670 6f6f  s = self.confpoo
+000273a0: 6c73 5b63 6f6e 6670 6f6f 6c5d 2e67 6574  ls[confpool].get
+000273b0: 2827 636c 7573 7465 725f 6261 7265 6d65  ('cluster_bareme
+000273c0: 7461 6c5f 7265 7365 7276 6174 696f 6e73  tal_reservations
+000273d0: 272c 207b 7d29 0a20 2020 2020 2020 2020  ', {}).         
+000273e0: 2020 2069 6620 636c 7573 7465 7220 696e     if cluster in
+000273f0: 2063 6c75 7374 6572 5f62 6172 656d 6574   cluster_baremet
+00027400: 616c 5f72 6573 6572 7661 7469 6f6e 733a  al_reservations:
+00027410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027420: 2064 656c 2063 6c75 7374 6572 5f62 6172   del cluster_bar
+00027430: 656d 6574 616c 5f72 6573 6572 7661 7469  emetal_reservati
+00027440: 6f6e 735b 636c 7573 7465 725d 0a20 2020  ons[cluster].   
+00027450: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00027460: 662e 7570 6461 7465 5f63 6f6e 6670 6f6f  f.update_confpoo
+00027470: 6c28 636f 6e66 706f 6f6c 2c20 7b27 636c  l(confpool, {'cl
+00027480: 7573 7465 725f 6261 7265 6d65 7461 6c5f  uster_baremetal_
+00027490: 7265 7365 7276 6174 696f 6e73 273a 2063  reservations': c
+000274a0: 6c75 7374 6572 5f62 6172 656d 6574 616c  luster_baremetal
+000274b0: 5f72 6573 6572 7661 7469 6f6e 737d 290a  _reservations}).
+000274c0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+000274d0: 7468 2e65 7869 7374 7328 636c 7573 7465  th.exists(cluste
+000274e0: 7264 6972 293a 0a20 2020 2020 2020 2020  rdir):.         
+000274f0: 2020 2070 7072 696e 7428 6622 4465 6c65     pprint(f"Dele
+00027500: 7469 6e67 2064 6972 6563 746f 7279 207b  ting directory {
+00027510: 636c 7573 7465 7264 6972 7d22 290a 2020  clusterdir}").  
+00027520: 2020 2020 2020 2020 2020 726d 7472 6565            rmtree
+00027530: 2863 6c75 7374 6572 6469 7229 0a20 2020  (clusterdir).   
+00027540: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00027550: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
+00027560: 7d0a 0a20 2020 2064 6566 2073 6361 6c65  }..    def scale
+00027570: 5f6b 7562 6528 7365 6c66 2c20 636c 7573  _kube(self, clus
+00027580: 7465 722c 206b 7562 6574 7970 652c 206f  ter, kubetype, o
+00027590: 7665 7272 6964 6573 3d7b 7d29 3a0a 2020  verrides={}):.  
+000275a0: 2020 2020 2020 6966 206b 7562 6574 7970        if kubetyp
+000275b0: 6520 3d3d 2027 6765 6e65 7269 6327 3a0a  e == 'generic':.
+000275c0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+000275d0: 6c74 203d 2073 656c 662e 7363 616c 655f  lt = self.scale_
+000275e0: 6b75 6265 5f67 656e 6572 6963 2863 6c75  kube_generic(clu
+000275f0: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
+00027600: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
+00027610: 2020 2065 6c69 6620 6b75 6265 7479 7065     elif kubetype
+00027620: 203d 3d20 276b 3373 273a 0a20 2020 2020   == 'k3s':.     
+00027630: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00027640: 7365 6c66 2e73 6361 6c65 5f6b 7562 655f  self.scale_kube_
+00027650: 6b33 7328 636c 7573 7465 722c 206f 7665  k3s(cluster, ove
+00027660: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+00027670: 290a 2020 2020 2020 2020 656c 6966 206b  ).        elif k
+00027680: 7562 6574 7970 6520 3d3d 2027 6f70 656e  ubetype == 'open
+00027690: 7368 6966 7427 3a0a 2020 2020 2020 2020  shift':.        
+000276a0: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
+000276b0: 662e 7363 616c 655f 6b75 6265 5f6f 7065  f.scale_kube_ope
+000276c0: 6e73 6869 6674 2863 6c75 7374 6572 2c20  nshift(cluster, 
+000276d0: 6f76 6572 7269 6465 733d 6f76 6572 7269  overrides=overri
+000276e0: 6465 7329 0a20 2020 2020 2020 2065 6c69  des).        eli
+000276f0: 6620 6b75 6265 7479 7065 203d 3d20 2768  f kubetype == 'h
+00027700: 7970 6572 7368 6966 7427 3a0a 2020 2020  ypershift':.    
+00027710: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00027720: 2073 656c 662e 7363 616c 655f 6b75 6265   self.scale_kube
+00027730: 5f68 7970 6572 7368 6966 7428 636c 7573  _hypershift(clus
+00027740: 7465 722c 206f 7665 7272 6964 6573 3d6f  ter, overrides=o
+00027750: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
+00027760: 2020 656c 6966 206b 7562 6574 7970 6520    elif kubetype 
+00027770: 3d3d 2027 676b 6527 3a0a 2020 2020 2020  == 'gke':.      
+00027780: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
+00027790: 656c 662e 7363 616c 655f 6b75 6265 5f67  elf.scale_kube_g
+000277a0: 6b65 2863 6c75 7374 6572 2c20 6f76 6572  ke(cluster, over
+000277b0: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
+000277c0: 0a20 2020 2020 2020 2065 6c69 6620 6b75  .        elif ku
+000277d0: 6265 7479 7065 203d 3d20 2765 6b73 273a  betype == 'eks':
+000277e0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+000277f0: 756c 7420 3d20 7365 6c66 2e73 6361 6c65  ult = self.scale
+00027800: 5f6b 7562 655f 656b 7328 636c 7573 7465  _kube_eks(cluste
+00027810: 722c 206f 7665 7272 6964 6573 3d6f 7665  r, overrides=ove
+00027820: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
+00027830: 7265 7475 726e 2072 6573 756c 740a 0a20  return result.. 
+00027840: 2020 2064 6566 2073 6361 6c65 5f6b 7562     def scale_kub
+00027850: 655f 656b 7328 7365 6c66 2c20 636c 7573  e_eks(self, clus
+00027860: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
+00027870: 7d29 3a0a 2020 2020 2020 2020 6672 6f6d  }):.        from
+00027880: 206b 7669 7274 2e63 6c75 7374 6572 2069   kvirt.cluster i
+00027890: 6d70 6f72 7420 656b 730a 2020 2020 2020  mport eks.      
+000278a0: 2020 7265 7475 726e 2065 6b73 2e73 6361    return eks.sca
+000278b0: 6c65 2873 656c 662c 2063 6c75 7374 6572  le(self, cluster
+000278c0: 2c20 6f76 6572 7269 6465 7329 0a0a 2020  , overrides)..  
+000278d0: 2020 6465 6620 7363 616c 655f 6b75 6265    def scale_kube
+000278e0: 5f67 656e 6572 6963 2873 656c 662c 2063  _generic(self, c
+000278f0: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
+00027900: 733d 7b7d 293a 0a20 2020 2020 2020 2070  s={}):.        p
+00027910: 6c61 6e64 6972 203d 206f 732e 7061 7468  landir = os.path
+00027920: 2e64 6972 6e61 6d65 286b 7562 6561 646d  .dirname(kubeadm
+00027930: 2e63 7265 6174 652e 5f5f 636f 6465 5f5f  .create.__code__
+00027940: 2e63 6f5f 6669 6c65 6e61 6d65 290a 2020  .co_filename).  
+00027950: 2020 2020 2020 7265 7475 726e 206b 7562        return kub
+00027960: 6561 646d 2e73 6361 6c65 2873 656c 662c  eadm.scale(self,
+00027970: 2070 6c61 6e64 6972 2c20 636c 7573 7465   plandir, cluste
+00027980: 722c 206f 7665 7272 6964 6573 290a 0a20  r, overrides).. 
+00027990: 2020 2064 6566 2073 6361 6c65 5f6b 7562     def scale_kub
+000279a0: 655f 676b 6528 7365 6c66 2c20 636c 7573  e_gke(self, clus
+000279b0: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
+000279c0: 7d29 3a0a 2020 2020 2020 2020 6672 6f6d  }):.        from
+000279d0: 206b 7669 7274 2e63 6c75 7374 6572 2069   kvirt.cluster i
+000279e0: 6d70 6f72 7420 676b 650a 2020 2020 2020  mport gke.      
+000279f0: 2020 7265 7475 726e 2067 6b65 2e73 6361    return gke.sca
+00027a00: 6c65 2873 656c 662c 2063 6c75 7374 6572  le(self, cluster
+00027a10: 2c20 6f76 6572 7269 6465 7329 0a0a 2020  , overrides)..  
+00027a20: 2020 6465 6620 7363 616c 655f 6b75 6265    def scale_kube
+00027a30: 5f68 7970 6572 7368 6966 7428 7365 6c66  _hypershift(self
+00027a40: 2c20 636c 7573 7465 722c 206f 7665 7272  , cluster, overr
+00027a50: 6964 6573 3d7b 7d29 3a0a 2020 2020 2020  ides={}):.      
+00027a60: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
+00027a70: 6174 682e 6469 726e 616d 6528 6879 7065  ath.dirname(hype
+00027a80: 7273 6869 6674 2e63 7265 6174 652e 5f5f  rshift.create.__
+00027a90: 636f 6465 5f5f 2e63 6f5f 6669 6c65 6e61  code__.co_filena
+00027aa0: 6d65 290a 2020 2020 2020 2020 7265 7475  me).        retu
+00027ab0: 726e 2068 7970 6572 7368 6966 742e 7363  rn hypershift.sc
+00027ac0: 616c 6528 7365 6c66 2c20 706c 616e 6469  ale(self, plandi
+00027ad0: 722c 2063 6c75 7374 6572 2c20 6f76 6572  r, cluster, over
+00027ae0: 7269 6465 7329 0a0a 2020 2020 6465 6620  rides)..    def 
+00027af0: 7363 616c 655f 6b75 6265 5f6b 3373 2873  scale_kube_k3s(s
+00027b00: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
+00027b10: 6572 7269 6465 733d 7b7d 293a 0a20 2020  errides={}):.   
+00027b20: 2020 2020 2070 6c61 6e64 6972 203d 206f       plandir = o
+00027b30: 732e 7061 7468 2e64 6972 6e61 6d65 286b  s.path.dirname(k
+00027b40: 3373 2e63 7265 6174 652e 5f5f 636f 6465  3s.create.__code
+00027b50: 5f5f 2e63 6f5f 6669 6c65 6e61 6d65 290a  __.co_filename).
+00027b60: 2020 2020 2020 2020 7265 7475 726e 206b          return k
+00027b70: 3373 2e73 6361 6c65 2873 656c 662c 2070  3s.scale(self, p
+00027b80: 6c61 6e64 6972 2c20 636c 7573 7465 722c  landir, cluster,
+00027b90: 206f 7665 7272 6964 6573 290a 0a20 2020   overrides)..   
+00027ba0: 2064 6566 2073 6361 6c65 5f6b 7562 655f   def scale_kube_
+00027bb0: 6f70 656e 7368 6966 7428 7365 6c66 2c20  openshift(self, 
+00027bc0: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+00027bd0: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
+00027be0: 706c 616e 6469 7220 3d20 6f73 2e70 6174  plandir = os.pat
+00027bf0: 682e 6469 726e 616d 6528 6f70 656e 7368  h.dirname(opensh
+00027c00: 6966 742e 6372 6561 7465 2e5f 5f63 6f64  ift.create.__cod
+00027c10: 655f 5f2e 636f 5f66 696c 656e 616d 6529  e__.co_filename)
+00027c20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00027c30: 6f70 656e 7368 6966 742e 7363 616c 6528  openshift.scale(
+00027c40: 7365 6c66 2c20 706c 616e 6469 722c 2063  self, plandir, c
+00027c50: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
+00027c60: 7329 0a0a 2020 2020 6465 6620 7570 6461  s)..    def upda
+00027c70: 7465 5f6b 7562 6528 7365 6c66 2c20 636c  te_kube(self, cl
+00027c80: 7573 7465 722c 205f 7479 7065 2c20 6f76  uster, _type, ov
+00027c90: 6572 7269 6465 733d 7b7d 2c20 706c 616e  errides={}, plan
+00027ca0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00027cb0: 6f76 6572 7269 6465 735b 2773 6b69 705f  overrides['skip_
+00027cc0: 6669 6c65 735f 7265 6d65 6469 6174 696f  files_remediatio
+00027cd0: 6e27 5d20 3d20 5472 7565 0a20 2020 2020  n'] = True.     
+00027ce0: 2020 206f 7665 7272 6964 6573 5b27 7363     overrides['sc
+00027cf0: 616c 6527 5d20 3d20 5472 7565 0a20 2020  ale'] = True.   
+00027d00: 2020 2020 2063 6c75 7374 6572 6469 7220       clusterdir 
+00027d10: 3d20 6f73 2e70 6174 682e 6578 7061 6e64  = os.path.expand
+00027d20: 7573 6572 2866 227e 2f2e 6b63 6c69 2f63  user(f"~/.kcli/c
+00027d30: 6c75 7374 6572 732f 7b63 6c75 7374 6572  lusters/{cluster
+00027d40: 7d22 290a 2020 2020 2020 2020 706c 616e  }").        plan
+00027d50: 766d 7320 3d20 5b5d 0a20 2020 2020 2020  vms = [].       
+00027d60: 2069 6620 706c 616e 2069 7320 4e6f 6e65   if plan is None
+00027d70: 3a0a 2020 2020 2020 2020 2020 2020 706c  :.            pl
+00027d80: 616e 203d 2063 6c75 7374 6572 0a20 2020  an = cluster.   
+00027d90: 2020 2020 2069 6620 5f74 7970 6520 3d3d       if _type ==
+00027da0: 2027 6765 6e65 7269 6327 3a0a 2020 2020   'generic':.    
+00027db0: 2020 2020 2020 2020 726f 6c65 7320 3d20          roles = 
+00027dc0: 5b27 6374 6c70 6c61 6e65 7327 2c20 2777  ['ctlplanes', 'w
+00027dd0: 6f72 6b65 7273 275d 0a20 2020 2020 2020  orkers'].       
+00027de0: 2020 2020 2070 6c61 6e64 6972 203d 206f       plandir = o
+00027df0: 732e 7061 7468 2e64 6972 6e61 6d65 286b  s.path.dirname(k
+00027e00: 7562 6561 646d 2e63 7265 6174 652e 5f5f  ubeadm.create.__
+00027e10: 636f 6465 5f5f 2e63 6f5f 6669 6c65 6e61  code__.co_filena
+00027e20: 6d65 290a 2020 2020 2020 2020 656c 6966  me).        elif
+00027e30: 205f 7479 7065 203d 3d20 276b 3373 273a   _type == 'k3s':
+00027e40: 0a20 2020 2020 2020 2020 2020 2070 6c61  .            pla
+00027e50: 6e64 6972 203d 206f 732e 7061 7468 2e64  ndir = os.path.d
+00027e60: 6972 6e61 6d65 286b 3373 2e63 7265 6174  irname(k3s.creat
+00027e70: 652e 5f5f 636f 6465 5f5f 2e63 6f5f 6669  e.__code__.co_fi
+00027e80: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
+00027e90: 2020 2020 726f 6c65 7320 3d20 5b27 626f      roles = ['bo
+00027ea0: 6f74 7374 7261 7027 2c20 2777 6f72 6b65  otstrap', 'worke
+00027eb0: 7273 275d 2069 6620 6f76 6572 7269 6465  rs'] if override
+00027ec0: 732e 6765 7428 2763 746c 706c 616e 6573  s.get('ctlplanes
+00027ed0: 272c 2031 2920 3d3d 2031 2065 6c73 6520  ', 1) == 1 else 
+00027ee0: 5b27 626f 6f74 7374 7261 7027 2c20 2763  ['bootstrap', 'c
+00027ef0: 746c 706c 616e 6573 272c 0a20 2020 2020  tlplanes',.     
+00027f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f50: 2020 2020 2777 6f72 6b65 7273 275d 0a20      'workers']. 
+00027f60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00027f70: 2020 2020 2020 2020 2070 6c61 6e64 6972           plandir
+00027f80: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
+00027f90: 6d65 286f 7065 6e73 6869 6674 2e63 7265  me(openshift.cre
+00027fa0: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
+00027fb0: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+00027fc0: 2020 2020 2020 726f 6c65 7320 3d20 5b27        roles = ['
+00027fd0: 636c 6f75 645f 6374 6c70 6c61 6e65 7327  cloud_ctlplanes'
+00027fe0: 2c20 2763 6c6f 7564 5f77 6f72 6b65 7273  , 'cloud_workers
+00027ff0: 275d 2069 6620 7365 6c66 2e74 7970 6520  '] if self.type 
+00028000: 696e 205b 2761 7773 272c 2027 6763 7027  in ['aws', 'gcp'
+00028010: 5d20 656c 7365 205b 2763 746c 706c 616e  ] else ['ctlplan
+00028020: 6573 272c 2027 776f 726b 6572 7327 5d0a  es', 'workers'].
+00028030: 2020 2020 2020 2020 6966 206f 7665 7272          if overr
+00028040: 6964 6573 2e67 6574 2827 776f 726b 6572  ides.get('worker
+00028050: 7327 2c20 3029 203d 3d20 303a 0a20 2020  s', 0) == 0:.   
+00028060: 2020 2020 2020 2020 2064 656c 2072 6f6c           del rol
+00028070: 6573 5b2d 315d 0a20 2020 2020 2020 2069  es[-1].        i
+00028080: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+00028090: 2866 227b 636c 7573 7465 7264 6972 7d2f  (f"{clusterdir}/
+000280a0: 6b63 6c69 5f70 6172 616d 6574 6572 732e  kcli_parameters.
+000280b0: 796d 6c22 293a 0a20 2020 2020 2020 2020  yml"):.         
+000280c0: 2020 2064 6174 6120 3d20 7b27 636c 7573     data = {'clus
+000280d0: 7465 7227 3a20 636c 7573 7465 722c 2027  ter': cluster, '
+000280e0: 6b75 6265 273a 2063 6c75 7374 6572 2c20  kube': cluster, 
+000280f0: 276b 7562 6574 7970 6527 3a20 5f74 7970  'kubetype': _typ
+00028100: 657d 0a20 2020 2020 2020 2020 2020 2077  e}.            w
+00028110: 6974 6820 6f70 656e 2866 227b 636c 7573  ith open(f"{clus
+00028120: 7465 7264 6972 7d2f 6b63 6c69 5f70 6172  terdir}/kcli_par
+00028130: 616d 6574 6572 732e 796d 6c22 2c20 2772  ameters.yml", 'r
+00028140: 2729 2061 7320 696e 7374 616c 6c3a 0a20  ') as install:. 
+00028150: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00028160: 6e73 7461 6c6c 7061 7261 6d20 3d20 7961  nstallparam = ya
+00028170: 6d6c 2e73 6166 655f 6c6f 6164 2869 6e73  ml.safe_load(ins
+00028180: 7461 6c6c 290a 2020 2020 2020 2020 2020  tall).          
+00028190: 2020 2020 2020 6461 7461 2e75 7064 6174        data.updat
+000281a0: 6528 696e 7374 616c 6c70 6172 616d 290a  e(installparam).
+000281b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000281c0: 706c 616e 203d 2069 6e73 7461 6c6c 7061  plan = installpa
+000281d0: 7261 6d2e 6765 7428 2770 6c61 6e27 2c20  ram.get('plan', 
+000281e0: 706c 616e 290a 2020 2020 2020 2020 2020  plan).          
+000281f0: 2020 6461 7461 2e75 7064 6174 6528 6f76    data.update(ov
+00028200: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
+00028210: 2020 2020 2077 6974 6820 6f70 656e 2866       with open(f
+00028220: 227b 636c 7573 7465 7264 6972 7d2f 6b63  "{clusterdir}/kc
+00028230: 6c69 5f70 6172 616d 6574 6572 732e 796d  li_parameters.ym
+00028240: 6c22 2c20 2777 2729 2061 7320 7061 7261  l", 'w') as para
+00028250: 6d66 696c 653a 0a20 2020 2020 2020 2020  mfile:.         
+00028260: 2020 2020 2020 2079 616d 6c2e 7361 6665         yaml.safe
+00028270: 5f64 756d 7028 6461 7461 2c20 7061 7261  _dump(data, para
+00028280: 6d66 696c 6529 0a20 2020 2020 2020 206f  mfile).        o
+00028290: 732e 6368 6469 7228 6f73 2e70 6174 682e  s.chdir(os.path.
+000282a0: 6578 7061 6e64 7573 6572 2822 7e2f 2e6b  expanduser("~/.k
+000282b0: 636c 6922 2929 0a20 2020 2020 2020 2066  cli")).        f
+000282c0: 6f72 2072 6f6c 6520 696e 2072 6f6c 6573  or role in roles
+000282d0: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
+000282e0: 7269 6e74 2866 2255 7064 6174 696e 6720  rint(f"Updating 
+000282f0: 766d 7320 7769 7468 207b 726f 6c65 7d20  vms with {role} 
+00028300: 726f 6c65 2229 0a20 2020 2020 2020 2020  role").         
+00028310: 2020 2070 6c61 6e64 6174 6120 3d20 7365     plandata = se
+00028320: 6c66 2e70 6c61 6e28 706c 616e 2c20 696e  lf.plan(plan, in
+00028330: 7075 7466 696c 653d 6627 7b70 6c61 6e64  putfile=f'{pland
+00028340: 6972 7d2f 7b72 6f6c 657d 2e79 6d6c 272c  ir}/{role}.yml',
+00028350: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+00028360: 6964 6573 2c20 7570 6461 7465 3d54 7275  ides, update=Tru
+00028370: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
+00028380: 6c61 6e76 6d73 2e65 7874 656e 6428 706c  lanvms.extend(pl
+00028390: 616e 6461 7461 5b27 6e65 7776 6d73 275d  andata['newvms']
+000283a0: 202b 2070 6c61 6e64 6174 615b 2765 7869   + plandata['exi
+000283b0: 7374 696e 6776 6d73 275d 290a 2020 2020  stingvms']).    
+000283c0: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
+000283d0: 4b55 4245 434f 4e46 4947 275d 203d 2066  KUBECONFIG'] = f
+000283e0: 227b 636c 7573 7465 7264 6972 7d2f 6175  "{clusterdir}/au
+000283f0: 7468 2f6b 7562 6563 6f6e 6669 6722 0a20  th/kubeconfig". 
+00028400: 2020 2020 2020 2062 696e 6172 7920 3d20         binary = 
+00028410: 276f 6327 2069 6620 7768 6963 6828 276f  'oc' if which('o
+00028420: 6327 2920 6973 206e 6f74 204e 6f6e 6520  c') is not None 
+00028430: 656c 7365 2027 6b75 6265 6374 6c27 0a20  else 'kubectl'. 
+00028440: 2020 2020 2020 206e 6f64 6573 636d 6420         nodescmd 
+00028450: 3d20 6627 7b62 696e 6172 797d 2067 6574  = f'{binary} get
+00028460: 206e 6f64 6520 2d6f 206e 616d 6527 0a20   node -o name'. 
+00028470: 2020 2020 2020 206e 6f64 6573 203d 205b         nodes = [
+00028480: 6e2e 7374 7269 7028 292e 7265 706c 6163  n.strip().replac
+00028490: 6528 276e 6f64 652f 272c 2027 2729 2066  e('node/', '') f
+000284a0: 6f72 206e 2069 6e20 6f73 2e70 6f70 656e  or n in os.popen
+000284b0: 286e 6f64 6573 636d 6429 2e72 6561 646c  (nodescmd).readl
+000284c0: 696e 6573 2829 5d0a 2020 2020 2020 2020  ines()].        
+000284d0: 666f 7220 766d 2069 6e20 7365 6c66 2e6b  for vm in self.k
+000284e0: 2e6c 6973 7428 293a 0a20 2020 2020 2020  .list():.       
+000284f0: 2020 2020 2076 6d6e 616d 6520 3d20 766d       vmname = vm
+00028500: 5b27 6e61 6d65 275d 0a20 2020 2020 2020  ['name'].       
+00028510: 2020 2020 2076 6d70 6c61 6e20 3d20 766d       vmplan = vm
+00028520: 2e67 6574 2827 706c 616e 272c 2027 6b76  .get('plan', 'kv
+00028530: 6972 7427 290a 2020 2020 2020 2020 2020  irt').          
+00028540: 2020 6966 2076 6d70 6c61 6e20 3d3d 2070    if vmplan == p
+00028550: 6c61 6e20 616e 6420 766d 6e61 6d65 206e  lan and vmname n
+00028560: 6f74 2069 6e20 706c 616e 766d 733a 0a20  ot in planvms:. 
+00028570: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00028580: 7072 696e 7428 6622 4465 6c65 7469 6e67  print(f"Deleting
+00028590: 2076 6d20 7b76 6d6e 616d 657d 2229 0a20   vm {vmname}"). 
+000285a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000285b0: 656c 662e 6b2e 6465 6c65 7465 2876 6d6e  elf.k.delete(vmn
+000285c0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+000285d0: 2020 2020 2066 6f72 206e 6f64 6520 696e       for node in
+000285e0: 206e 6f64 6573 3a0a 2020 2020 2020 2020   nodes:.        
+000285f0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00028600: 6f64 652e 7370 6c69 7428 272e 2729 5b30  ode.split('.')[0
+00028610: 5d20 3d3d 2076 6d6e 616d 653a 0a20 2020  ] == vmname:.   
+00028620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028630: 2020 2020 2070 7072 696e 7428 6622 4465       pprint(f"De
+00028640: 6c65 7469 6e67 206e 6f64 6520 7b6e 6f64  leting node {nod
+00028650: 657d 2066 726f 6d20 796f 7572 2063 6c75  e} from your clu
+00028660: 7374 6572 2229 0a20 2020 2020 2020 2020  ster").         
+00028670: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00028680: 616c 6c28 6627 7b62 696e 6172 797d 2064  all(f'{binary} d
+00028690: 656c 6574 6520 6e6f 6465 207b 6e6f 6465  elete node {node
+000286a0: 7d27 2c20 7368 656c 6c3d 5472 7565 290a  }', shell=True).
+000286b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000286c0: 2020 2020 2020 2020 6272 6561 6b0a 0a20          break.. 
+000286d0: 2020 2064 6566 2065 7870 6f73 655f 706c     def expose_pl
+000286e0: 616e 2873 656c 662c 2070 6c61 6e2c 2069  an(self, plan, i
+000286f0: 6e70 7574 6669 6c65 3d4e 6f6e 652c 206f  nputfile=None, o
+00028700: 7665 7272 6964 6573 3d7b 7d2c 2070 6f72  verrides={}, por
+00028710: 743d 3930 3030 2c20 7066 6d6f 6465 3d46  t=9000, pfmode=F
+00028720: 616c 7365 2c20 636c 7573 7465 723d 4661  alse, cluster=Fa
+00028730: 6c73 6529 3a0a 2020 2020 2020 2020 696e  lse):.        in
+00028740: 7075 7466 696c 6520 3d20 6f73 2e70 6174  putfile = os.pat
+00028750: 682e 6578 7061 6e64 7573 6572 2869 6e70  h.expanduser(inp
+00028760: 7574 6669 6c65 290a 2020 2020 2020 2020  utfile).        
+00028770: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+00028780: 7869 7374 7328 696e 7075 7466 696c 6529  xists(inputfile)
+00028790: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
+000287a0: 726f 7228 224e 6f20 696e 7075 7420 6669  ror("No input fi
+000287b0: 6c65 2066 6f75 6e64 206e 6f72 2064 6566  le found nor def
+000287c0: 6175 6c74 206b 636c 695f 706c 616e 2e79  ault kcli_plan.y
+000287d0: 6d6c 2e4c 6561 7669 6e67 2e2e 2e2e 2229  ml.Leaving....")
+000287e0: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
+000287f0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+00028800: 2070 7072 696e 7428 6622 4861 6e64 6c69   pprint(f"Handli
+00028810: 6e67 2065 7870 6f73 6520 6f66 2070 6c61  ng expose of pla
+00028820: 6e20 7769 7468 206e 616d 6520 7b70 6c61  n with name {pla
+00028830: 6e7d 2061 6e64 2069 6e70 7574 6669 6c65  n} and inputfile
+00028840: 207b 696e 7075 7466 696c 657d 2229 0a20   {inputfile}"). 
+00028850: 2020 2020 2020 206b 6578 706f 7365 7220         kexposer 
+00028860: 3d20 4b65 7870 6f73 6572 2873 656c 662c  = Kexposer(self,
+00028870: 2070 6c61 6e2c 2069 6e70 7574 6669 6c65   plan, inputfile
+00028880: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
+00028890: 7269 6465 732c 2070 6f72 743d 706f 7274  rides, port=port
+000288a0: 2c20 7066 6d6f 6465 3d70 666d 6f64 652c  , pfmode=pfmode,
+000288b0: 2063 6c75 7374 6572 3d63 6c75 7374 6572   cluster=cluster
+000288c0: 290a 2020 2020 2020 2020 6b65 7870 6f73  ).        kexpos
+000288d0: 6572 2e72 756e 2829 0a0a 2020 2020 6465  er.run()..    de
+000288e0: 6620 6372 6561 7465 5f6f 7065 6e73 6869  f create_openshi
+000288f0: 6674 5f69 736f 2873 656c 662c 2063 6c75  ft_iso(self, clu
+00028900: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
+00028910: 7b7d 2c20 6967 6e69 7469 6f6e 6669 6c65  {}, ignitionfile
+00028920: 3d4e 6f6e 652c 2070 6f64 6d61 6e3d 4661  =None, podman=Fa
+00028930: 6c73 652c 2069 6e73 7461 6c6c 6572 3d46  lse, installer=F
+00028940: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00028950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028960: 2020 2064 6972 6563 743d 4661 6c73 6529     direct=False)
+00028970: 3a0a 2020 2020 2020 2020 6d65 7461 6c5f  :.        metal_
+00028980: 7572 6c20 3d20 4e6f 6e65 0a20 2020 2020  url = None.     
+00028990: 2020 2069 736f 5f76 6572 7369 6f6e 203d     iso_version =
+000289a0: 2073 7472 286f 7665 7272 6964 6573 2e67   str(overrides.g
+000289b0: 6574 2827 7665 7273 696f 6e27 2c20 276c  et('version', 'l
+000289c0: 6174 6573 7427 2929 0a20 2020 2020 2020  atest')).       
+000289d0: 2069 6620 6e6f 7420 696e 7374 616c 6c65   if not installe
+000289e0: 723a 0a20 2020 2020 2020 2020 2020 2069  r:.            i
+000289f0: 6620 6973 6f5f 7665 7273 696f 6e20 6e6f  f iso_version no
+00028a00: 7420 696e 205b 276c 6174 6573 7427 2c20  t in ['latest', 
+00028a10: 2770 7265 2d72 656c 6561 7365 275d 2061  'pre-release'] a
+00028a20: 6e64 206e 6f74 2069 736f 5f76 6572 7369  nd not iso_versi
+00028a30: 6f6e 2e73 7461 7274 7377 6974 6828 2734  on.startswith('4
+00028a40: 2e27 293a 0a20 2020 2020 2020 2020 2020  .'):.           
+00028a50: 2020 2020 2077 6172 6e69 6e67 2822 466f       warning("Fo
+00028a60: 7263 696e 6720 6c69 7665 2069 736f 2076  rcing live iso v
+00028a70: 6572 7369 6f6e 2074 6f20 6c61 7465 7374  ersion to latest
+00028a80: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00028a90: 2020 2069 736f 5f76 6572 7369 6f6e 203d     iso_version =
+00028aa0: 2027 6c61 7465 7374 270a 2020 2020 2020   'latest'.      
+00028ab0: 2020 2020 2020 656c 6966 2069 736f 5f76        elif iso_v
+00028ac0: 6572 7369 6f6e 2e73 7461 7274 7377 6974  ersion.startswit
+00028ad0: 6828 2734 2e27 293a 0a20 2020 2020 2020  h('4.'):.       
+00028ae0: 2020 2020 2020 2020 206d 696e 6f72 5f76           minor_v
+00028af0: 6572 7369 6f6e 203d 2069 736f 5f76 6572  ersion = iso_ver
+00028b00: 7369 6f6e 2e73 706c 6974 2827 2e27 295b  sion.split('.')[
+00028b10: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+00028b20: 2020 2069 6620 6d69 6e6f 725f 7665 7273     if minor_vers
+00028b30: 696f 6e2e 6973 6469 6769 7428 2920 616e  ion.isdigit() an
+00028b40: 6420 696e 7428 6d69 6e6f 725f 7665 7273  d int(minor_vers
+00028b50: 696f 6e29 203c 2036 3a0a 2020 2020 2020  ion) < 6:.      
+00028b60: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00028b70: 7461 6c5f 7572 6c20 3d20 6622 6874 7470  tal_url = f"http
+00028b80: 733a 2f2f 6d69 7272 6f72 2e6f 7065 6e73  s://mirror.opens
+00028b90: 6869 6674 2e63 6f6d 2f70 7562 2f6f 7065  hift.com/pub/ope
+00028ba0: 6e73 6869 6674 2d76 342f 6465 7065 6e64  nshift-v4/depend
+00028bb0: 656e 6369 6573 2f72 6863 6f73 2f7b 6973  encies/rhcos/{is
+00028bc0: 6f5f 7665 7273 696f 6e7d 2f6c 6174 6573  o_version}/lates
+00028bd0: 7422 0a20 2020 2020 2020 2020 2020 2020  t".             
+00028be0: 2020 2020 2020 206d 6574 616c 5f75 726c         metal_url
+00028bf0: 202b 3d20 222f 7268 636f 732d 6d65 7461   += "/rhcos-meta
+00028c00: 6c2e 7838 365f 3634 2e72 6177 2e67 7a22  l.x86_64.raw.gz"
+00028c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028c20: 2020 2020 2077 6172 6e69 6e67 2822 456d       warning("Em
+00028c30: 6265 6464 696e 6720 6d65 7461 6c20 7572  bedding metal ur
+00028c40: 6c20 696e 2069 736f 2066 6f72 2074 6172  l in iso for tar
+00028c50: 6765 7420 7665 7273 696f 6e20 616e 6420  get version and 
+00028c60: 696e 7374 616c 6c69 6e67 2077 6974 6820  installing with 
+00028c70: 6120 6d6f 7265 2072 6563 656e 7420 6973  a more recent is
+00028c80: 6f22 290a 2020 2020 2020 2020 2020 2020  o").            
+00028c90: 2020 2020 6973 6f5f 7665 7273 696f 6e20      iso_version 
+00028ca0: 3d20 276c 6174 6573 7427 0a20 2020 2020  = 'latest'.     
+00028cb0: 2020 2061 7069 5f69 7020 3d20 6f76 6572     api_ip = over
+00028cc0: 7269 6465 732e 6765 7428 2761 7069 5f69  rides.get('api_i
+00028cd0: 7027 290a 2020 2020 2020 2020 6967 6e69  p').        igni
+00028ce0: 7469 6f6e 5f76 6572 7369 6f6e 203d 206f  tion_version = o
+00028cf0: 7665 7272 6964 6573 2e67 6574 2827 6967  verrides.get('ig
+00028d00: 6e69 7469 6f6e 5f76 6572 7369 6f6e 272c  nition_version',
+00028d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028d30: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
+00028d40: 2e69 676e 6974 696f 6e5f 7665 7273 696f  .ignition_versio
+00028d50: 6e28 2272 6863 6f73 2d25 7322 2025 2069  n("rhcos-%s" % i
+00028d60: 736f 5f76 6572 7369 6f6e 2e72 6570 6c61  so_version.repla
+00028d70: 6365 2827 2e27 2c20 2727 2929 290a 2020  ce('.', ''))).  
+00028d80: 2020 2020 2020 726f 6c65 203d 206f 7665        role = ove
+00028d90: 7272 6964 6573 2e67 6574 2827 726f 6c65  rrides.get('role
+00028da0: 272c 2027 776f 726b 6572 2729 0a20 2020  ', 'worker').   
+00028db0: 2020 2020 2069 736f 203d 206f 7665 7272       iso = overr
+00028dc0: 6964 6573 2e67 6574 2827 6973 6f27 2c20  ides.get('iso', 
+00028dd0: 5472 7565 290a 2020 2020 2020 2020 646f  True).        do
+00028de0: 6d61 696e 203d 206f 7665 7272 6964 6573  main = overrides
+00028df0: 2e67 6574 2827 646f 6d61 696e 2729 0a20  .get('domain'). 
+00028e00: 2020 2020 2020 2069 6620 272e 2720 696e         if '.' in
+00028e10: 2063 6c75 7374 6572 3a0a 2020 2020 2020   cluster:.      
+00028e20: 2020 2020 2020 646f 6d61 696e 203d 2027        domain = '
+00028e30: 2e27 2e6a 6f69 6e28 636c 7573 7465 722e  .'.join(cluster.
+00028e40: 7370 6c69 7428 272e 2729 5b31 3a5d 290a  split('.')[1:]).
+00028e50: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00028e60: 6e74 2866 2255 7369 6e67 2064 6f6d 6169  nt(f"Using domai
+00028e70: 6e20 7b64 6f6d 6169 6e7d 2229 0a20 2020  n {domain}").   
+00028e80: 2020 2020 2020 2020 2063 6c75 7374 6572           cluster
+00028e90: 203d 2063 6c75 7374 6572 2e72 6570 6c61   = cluster.repla
+00028ea0: 6365 2866 222e 7b64 6f6d 6169 6e7d 222c  ce(f".{domain}",
+00028eb0: 2027 2729 0a20 2020 2020 2020 2069 6620   '').        if 
+00028ec0: 636c 7573 7465 722e 7374 6172 7473 7769  cluster.startswi
+00028ed0: 7468 2827 6170 692e 2729 3a0a 2020 2020  th('api.'):.    
+00028ee0: 2020 2020 2020 2020 636c 7573 7465 7220          cluster 
+00028ef0: 3d20 636c 7573 7465 722e 7265 706c 6163  = cluster.replac
+00028f00: 6528 2261 7069 2e22 2c20 2727 290a 2020  e("api.", '').  
+00028f10: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00028f20: 2866 2255 7369 6e67 2063 6c75 7374 6572  (f"Using cluster
+00028f30: 207b 636c 7573 7465 727d 2229 0a20 2020   {cluster}").   
+00028f40: 2020 2020 2068 6f73 7473 5f63 6f6e 7465       hosts_conte
+00028f50: 6e74 203d 204e 6f6e 650a 2020 2020 2020  nt = None.      
+00028f60: 2020 6669 6e61 6c64 6174 6120 3d20 4e6f    finaldata = No
+00028f70: 6e65 0a20 2020 2020 2020 2069 6620 6967  ne.        if ig
+00028f80: 6e69 7469 6f6e 6669 6c65 2069 7320 6e6f  nitionfile is no
+00028f90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00028fa0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+00028fb0: 7468 2e65 7869 7374 7328 6967 6e69 7469  th.exists(igniti
+00028fc0: 6f6e 6669 6c65 293a 0a20 2020 2020 2020  onfile):.       
+00028fd0: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
+00028fe0: 227b 6967 6e69 7469 6f6e 6669 6c65 7d20  "{ignitionfile} 
+00028ff0: 6e6f 7420 666f 756e 6422 290a 2020 2020  not found").    
+00029000: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00029010: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
+00029020: 2020 2020 6669 6e61 6c64 6174 6120 3d20      finaldata = 
+00029030: 6f70 656e 2869 676e 6974 696f 6e66 696c  open(ignitionfil
+00029040: 6529 2e72 6561 6428 290a 2020 2020 2020  e).read().      
+00029050: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00029060: 2020 2020 6967 6e69 7469 6f6e 6669 6c65      ignitionfile
+00029070: 203d 2066 227b 726f 6c65 7d2e 6967 6e22   = f"{role}.ign"
+00029080: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00029090: 6f73 2e70 6174 682e 6578 6973 7473 2869  os.path.exists(i
+000290a0: 676e 6974 696f 6e66 696c 6529 3a0a 2020  gnitionfile):.  
+000290b0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+000290c0: 726e 696e 6728 6622 5573 696e 6720 6578  rning(f"Using ex
+000290d0: 6973 7469 6e67 207b 6967 6e69 7469 6f6e  isting {ignition
+000290e0: 6669 6c65 7d22 290a 2020 2020 2020 2020  file}").        
+000290f0: 2020 2020 2020 2020 6669 6e61 6c64 6174          finaldat
+00029100: 6120 3d20 6f70 656e 2869 676e 6974 696f  a = open(ignitio
+00029110: 6e66 696c 6529 2e72 6561 6428 290a 2020  nfile).read().  
+00029120: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00029130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029140: 6966 2061 7069 5f69 7020 6973 204e 6f6e  if api_ip is Non
+00029150: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00029160: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00029170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029180: 2020 2020 6170 695f 6970 203d 2073 6f63      api_ip = soc
+00029190: 6b65 742e 6765 7468 6f73 7462 796e 616d  ket.gethostbynam
+000291a0: 6528 6627 6170 692e 7b63 6c75 7374 6572  e(f'api.{cluster
+000291b0: 7d2e 7b64 6f6d 6169 6e7d 2729 0a20 2020  }.{domain}').   
+000291c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291d0: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
+000291e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291f0: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+00029200: 2020 2020 2020 6966 2061 7069 5f69 7020        if api_ip 
+00029210: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00029220: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00029230: 646f 6d61 696e 2069 7320 4e6f 6e65 3a0a  domain is None:.
+00029240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029250: 2020 2020 2020 2020 6572 726f 7228 2243          error("C
+00029260: 6f75 6c64 6e27 7420 6669 6775 7265 206f  ouldn't figure o
+00029270: 7574 2061 7069 5f69 7020 6e6f 7220 7265  ut api_ip nor re
+00029280: 6c79 206f 6e20 646e 7320 7369 6e63 6520  ly on dns since 
+00029290: 646f 6d61 696e 2069 7320 6e6f 7420 7365  domain is not se
+000292a0: 7422 290a 2020 2020 2020 2020 2020 2020  t").            
+000292b0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+000292c0: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
+000292d0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+000292e0: 696e 6728 2243 6f75 6c64 6e27 7420 6669  ing("Couldn't fi
+000292f0: 6775 7265 206f 7574 2061 7069 5f69 702e  gure out api_ip.
+00029300: 2052 656c 7969 6e67 206f 6e20 646e 7322   Relying on dns"
+00029310: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00029320: 2020 2020 2020 6170 695f 6970 203d 2066        api_ip = f
+00029330: 2261 7069 2e7b 636c 7573 7465 727d 2e7b  "api.{cluster}.{
+00029340: 646f 6d61 696e 7d22 0a20 2020 2020 2020  domain}".       
+00029350: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00029360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029370: 2020 2068 6f73 7473 5f63 6f6e 7465 6e74     hosts_content
+00029380: 203d 2022 3132 372e 302e 302e 3120 2020   = "127.0.0.1   
+00029390: 6c6f 6361 6c68 6f73 7420 6c6f 6361 6c68  localhost localh
+000293a0: 6f73 742e 6c6f 6361 6c64 6f6d 6169 6e20  ost.localdomain 
+000293b0: 6c6f 6361 6c68 6f73 7434 206c 6f63 616c  localhost4 local
+000293c0: 686f 7374 342e 6c6f 6361 6c64 6f6d 6169  host4.localdomai
+000293d0: 6e34 5c6e 220a 2020 2020 2020 2020 2020  n4\n".          
+000293e0: 2020 2020 2020 2020 2020 686f 7374 735f            hosts_
+000293f0: 636f 6e74 656e 7420 2b3d 2022 3a3a 3120  content += "::1 
+00029400: 2020 2020 2020 2020 6c6f 6361 6c68 6f73          localhos
+00029410: 7420 6c6f 6361 6c68 6f73 742e 6c6f 6361  t localhost.loca
+00029420: 6c64 6f6d 6169 6e20 6c6f 6361 6c68 6f73  ldomain localhos
+00029430: 7436 206c 6f63 616c 686f 7374 362e 6c6f  t6 localhost6.lo
+00029440: 6361 6c64 6f6d 6169 6e36 5c6e 220a 2020  caldomain6\n".  
 00029450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029460: 2020 6973 6f5f 6f76 6572 7269 6465 735b    iso_overrides[
-00029470: 276e 6f6e 616d 6527 5d20 3d20 4661 6c73  'noname'] = Fals
-00029480: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00029490: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000294a0: 2020 2020 2020 2020 2020 2020 6973 6f5f              iso_
-000294b0: 6e61 6d65 203d 2027 6175 746f 696e 7374  name = 'autoinst
-000294c0: 616c 6c65 7227 0a20 2020 2020 2020 2020  aller'.         
-000294d0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-000294e0: 7365 6c66 2e63 7265 6174 655f 766d 2869  self.create_vm(i
-000294f0: 736f 5f6e 616d 652c 206f 7665 7272 6964  so_name, overrid
-00029500: 6573 3d69 736f 5f6f 7665 7272 6964 6573  es=iso_overrides
-00029510: 2c20 6f6e 6c79 6173 7365 7473 3d54 7275  , onlyassets=Tru
-00029520: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00029530: 2020 2069 6620 2772 6561 736f 6e27 2069     if 'reason' i
-00029540: 6e20 7265 7375 6c74 3a0a 2020 2020 2020  n result:.      
-00029550: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00029560: 726f 7228 7265 7375 6c74 5b27 7265 6173  ror(result['reas
-00029570: 6f6e 275d 290a 2020 2020 2020 2020 2020  on']).          
-00029580: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00029590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000295a0: 662e 7772 6974 6528 7265 7375 6c74 5b27  f.write(result['
-000295b0: 7573 6572 6461 7461 275d 290a 2020 2020  userdata']).    
-000295c0: 2020 2020 6966 2069 736f 3a0a 2020 2020      if iso:.    
-000295d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000295e0: 7479 7065 206e 6f74 2069 6e20 5b27 6b76  type not in ['kv
-000295f0: 6d27 2c20 2766 616b 6527 2c20 276b 7562  m', 'fake', 'kub
-00029600: 6576 6972 7427 2c20 2776 7370 6865 7265  evirt', 'vsphere
-00029610: 272c 2027 6f70 656e 7374 6163 6b27 5d3a  ', 'openstack']:
-00029620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029630: 2077 6172 6e69 6e67 2866 2249 736f 2067   warning(f"Iso g
-00029640: 656e 6572 6174 696f 6e20 6e6f 7420 7375  eneration not su
-00029650: 7070 6f72 7465 6420 6f6e 207b 7365 6c66  pported on {self
-00029660: 2e74 7970 657d 2229 0a20 2020 2020 2020  .type}").       
-00029670: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00029680: 2020 2020 2020 2020 2020 2069 736f 5f70             iso_p
-00029690: 6f6f 6c20 3d20 6f76 6572 7269 6465 732e  ool = overrides.
-000296a0: 6765 7428 2770 6f6f 6c27 2920 6f72 2073  get('pool') or s
-000296b0: 656c 662e 706f 6f6c 0a20 2020 2020 2020  elf.pool.       
-000296c0: 2020 2020 2020 2020 2067 656e 6572 6174           generat
-000296d0: 655f 7268 636f 735f 6973 6f28 7365 6c66  e_rhcos_iso(self
-000296e0: 2e6b 2c20 6622 7b63 6c75 7374 6572 7d2d  .k, f"{cluster}-
-000296f0: 7b72 6f6c 657d 222c 2069 736f 5f70 6f6f  {role}", iso_poo
-00029700: 6c2c 2076 6572 7369 6f6e 3d69 736f 5f76  l, version=iso_v
-00029710: 6572 7369 6f6e 2c20 706f 646d 616e 3d70  ersion, podman=p
-00029720: 6f64 6d61 6e2c 0a20 2020 2020 2020 2020  odman,.         
-00029730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029740: 2020 2020 2020 2020 2020 696e 7374 616c            instal
-00029750: 6c65 723d 696e 7374 616c 6c65 7229 0a0a  ler=installer)..
-00029760: 2020 2020 6465 6620 6372 6561 7465 5f6f      def create_o
-00029770: 7065 6e73 6869 6674 5f64 6973 636f 6e6e  penshift_disconn
-00029780: 6563 7465 6428 7365 6c66 2c20 706c 616e  ected(self, plan
-00029790: 2c20 6f76 6572 7269 6465 733d 7b7d 293a  , overrides={}):
-000297a0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-000297b0: 6f76 6572 7269 6465 730a 2020 2020 2020  overrides.      
-000297c0: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
-000297d0: 6174 682e 6469 726e 616d 6528 6f70 656e  ath.dirname(open
-000297e0: 7368 6966 742e 6372 6561 7465 2e5f 5f63  shift.create.__c
-000297f0: 6f64 655f 5f2e 636f 5f66 696c 656e 616d  ode__.co_filenam
-00029800: 6529 0a20 2020 2020 2020 2063 6c75 7374  e).        clust
-00029810: 6572 203d 2064 6174 612e 6765 7428 2763  er = data.get('c
-00029820: 6c75 7374 6572 272c 2027 6d79 6f70 656e  luster', 'myopen
-00029830: 7368 6966 7427 290a 2020 2020 2020 2020  shift').        
-00029840: 7570 7374 7265 616d 203d 2064 6174 612e  upstream = data.
-00029850: 6765 7428 2775 7073 7472 6561 6d27 2c20  get('upstream', 
-00029860: 4661 6c73 6529 0a20 2020 2020 2020 2076  False).        v
-00029870: 6572 7369 6f6e 203d 2064 6174 612e 6765  ersion = data.ge
-00029880: 7428 2776 6572 7369 6f6e 272c 2027 7374  t('version', 'st
-00029890: 6162 6c65 2729 0a20 2020 2020 2020 2074  able').        t
-000298a0: 6167 203d 2064 6174 612e 6765 7428 2774  ag = data.get('t
-000298b0: 6167 272c 204f 5045 4e53 4849 4654 5f54  ag', OPENSHIFT_T
-000298c0: 4147 290a 2020 2020 2020 2020 7070 7269  AG).        ppri
-000298d0: 6e74 2866 2255 7369 6e67 2076 6572 7369  nt(f"Using versi
-000298e0: 6f6e 207b 7665 7273 696f 6e7d 2061 6e64  on {version} and
-000298f0: 2074 6167 207b 7461 677d 2229 0a20 2020   tag {tag}").   
-00029900: 2020 2020 2064 6973 636f 6e6e 6563 7465       disconnecte
-00029910: 645f 766d 203d 2066 227b 636c 7573 7465  d_vm = f"{cluste
-00029920: 727d 2d64 6973 636f 6e6e 6563 7465 6422  r}-disconnected"
-00029930: 0a20 2020 2020 2020 2064 6973 636f 6e6e  .        disconn
-00029940: 6563 7465 645f 7265 7573 6520 3d20 6461  ected_reuse = da
-00029950: 7461 2e67 6574 2827 6469 7363 6f6e 6e65  ta.get('disconne
-00029960: 6374 6564 5f72 6575 7365 272c 2046 616c  cted_reuse', Fal
-00029970: 7365 290a 2020 2020 2020 2020 6469 7363  se).        disc
-00029980: 6f6e 6e65 6374 6564 5f73 796e 6320 3d20  onnected_sync = 
-00029990: 6461 7461 2e67 6574 2827 6469 7363 6f6e  data.get('discon
-000299a0: 6e65 6374 6564 5f73 796e 6327 2c20 5472  nected_sync', Tr
-000299b0: 7565 290a 2020 2020 2020 2020 7070 7269  ue).        ppri
-000299c0: 6e74 2866 2244 6570 6c6f 7969 6e67 2064  nt(f"Deploying d
-000299d0: 6973 636f 6e6e 6563 7465 6420 766d 207b  isconnected vm {
-000299e0: 6469 7363 6f6e 6e65 6374 6564 5f76 6d7d  disconnected_vm}
-000299f0: 2229 0a20 2020 2020 2020 2069 6620 6469  ").        if di
-00029a00: 7363 6f6e 6e65 6374 6564 5f73 796e 633a  sconnected_sync:
-00029a10: 0a20 2020 2020 2020 2020 2020 2070 756c  .            pul
-00029a20: 6c5f 7365 6372 6574 203d 2070 7764 5f70  l_secret = pwd_p
-00029a30: 6174 6828 6461 7461 2e67 6574 2827 7075  ath(data.get('pu
-00029a40: 6c6c 5f73 6563 7265 7427 2929 2069 6620  ll_secret')) if 
-00029a50: 6e6f 7420 7570 7374 7265 616d 2065 6c73  not upstream els
-00029a60: 6520 6622 7b70 6c61 6e64 6972 7d2f 6661  e f"{plandir}/fa
-00029a70: 6b65 5f70 756c 6c2e 6a73 6f6e 220a 2020  ke_pull.json".  
-00029a80: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00029a90: 2075 7073 7472 6561 6d3a 0a20 2020 2020   upstream:.     
-00029aa0: 2020 2020 2020 2020 2020 2070 756c 6c5f             pull_
-00029ab0: 7365 6372 6574 203d 2070 7764 5f70 6174  secret = pwd_pat
-00029ac0: 6828 6461 7461 2e67 6574 2827 7075 6c6c  h(data.get('pull
-00029ad0: 5f73 6563 7265 7427 2c20 276f 7065 6e73  _secret', 'opens
-00029ae0: 6869 6674 5f70 756c 6c2e 6a73 6f6e 2729  hift_pull.json')
-00029af0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00029b00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00029b10: 2020 2020 7075 6c6c 5f73 6563 7265 7420      pull_secret 
-00029b20: 3d20 6622 7b70 6c61 6e64 6972 7d2f 6661  = f"{plandir}/fa
-00029b30: 6b65 5f70 756c 6c2e 6a73 6f6e 220a 2020  ke_pull.json".  
-00029b40: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00029b50: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00029b60: 7075 6c6c 5f73 6563 7265 7429 3a0a 2020  pull_secret):.  
-00029b70: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00029b80: 726f 7228 6622 4d69 7373 696e 6720 7075  ror(f"Missing pu
-00029b90: 6c6c 2073 6563 7265 7420 6669 6c65 207b  ll secret file {
-00029ba0: 7075 6c6c 5f73 6563 7265 747d 2229 0a20  pull_secret}"). 
-00029bb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00029bc0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
-00029bd0: 2020 2020 2020 2064 6174 615b 2770 756c         data['pul
-00029be0: 6c5f 7365 6372 6574 275d 203d 2072 652e  l_secret'] = re.
-00029bf0: 7375 6228 7222 5c73 222c 2022 222c 206f  sub(r"\s", "", o
-00029c00: 7065 6e28 7075 6c6c 5f73 6563 7265 7429  pen(pull_secret)
-00029c10: 2e72 6561 6428 2929 0a20 2020 2020 2020  .read()).       
-00029c20: 2064 6973 636f 6e6e 6563 7465 645f 706c   disconnected_pl
-00029c30: 616e 203d 2066 227b 706c 616e 7d2d 7265  an = f"{plan}-re
-00029c40: 7573 6522 2069 6620 6469 7363 6f6e 6e65  use" if disconne
-00029c50: 6374 6564 5f72 6575 7365 2065 6c73 6520  cted_reuse else 
-00029c60: 706c 616e 0a20 2020 2020 2020 2069 6620  plan.        if 
-00029c70: 7665 7273 696f 6e20 3d3d 2027 6369 2720  version == 'ci' 
-00029c80: 616e 6420 2764 6973 636f 6e6e 6563 7465  and 'disconnecte
-00029c90: 645f 6f72 6967 696e 2720 6e6f 7420 696e  d_origin' not in
-00029ca0: 206f 7665 7272 6964 6573 3a0a 2020 2020   overrides:.    
-00029cb0: 2020 2020 2020 2020 7265 6720 3d20 2772          reg = 'r
-00029cc0: 6567 6973 7472 792e 6275 696c 6430 312e  egistry.build01.
-00029cd0: 6369 2e6f 7065 6e73 6869 6674 2e6f 7267  ci.openshift.org
-00029ce0: 2720 6966 2073 7472 2874 6167 292e 7374  ' if str(tag).st
-00029cf0: 6172 7473 7769 7468 2827 6369 2d27 2920  artswith('ci-') 
-00029d00: 656c 7365 2027 7265 6769 7374 7279 2e63  else 'registry.c
-00029d10: 692e 6f70 656e 7368 6966 742e 6f72 6727  i.openshift.org'
-00029d20: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
-00029d30: 6e69 6e67 2866 2246 6f72 6369 6e67 2064  ning(f"Forcing d
-00029d40: 6973 636f 6e6e 6563 7465 645f 6f72 6967  isconnected_orig
-00029d50: 696e 2074 6f20 7b72 6567 7d22 290a 2020  in to {reg}").  
-00029d60: 2020 2020 2020 2020 2020 6461 7461 5b27            data['
-00029d70: 6469 7363 6f6e 6e65 6374 6564 5f6f 7269  disconnected_ori
-00029d80: 6769 6e27 5d20 3d20 7265 670a 2020 2020  gin'] = reg.    
-00029d90: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-00029da0: 662e 706c 616e 2864 6973 636f 6e6e 6563  f.plan(disconnec
-00029db0: 7465 645f 706c 616e 2c20 696e 7075 7466  ted_plan, inputf
-00029dc0: 696c 653d 6627 7b70 6c61 6e64 6972 7d2f  ile=f'{plandir}/
-00029dd0: 6469 7363 6f6e 6e65 6374 6564 2e79 6d6c  disconnected.yml
-00029de0: 272c 206f 7665 7272 6964 6573 3d64 6174  ', overrides=dat
-00029df0: 6129 0a20 2020 2020 2020 2069 6620 7265  a).        if re
-00029e00: 7375 6c74 5b27 7265 7375 6c74 275d 2021  sult['result'] !
-00029e10: 3d20 2773 7563 6365 7373 273a 0a20 2020  = 'success':.   
-00029e20: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00029e30: 7428 3129 0a20 2020 2020 2020 2065 6c69  t(1).        eli
-00029e40: 6620 6469 7363 6f6e 6e65 6374 6564 5f73  f disconnected_s
-00029e50: 796e 633a 0a20 2020 2020 2020 2020 2020  ync:.           
-00029e60: 2070 7072 696e 7428 2255 7365 2074 6865   pprint("Use the
-00029e70: 2066 6f6c 6c6f 7769 6e67 204f 5045 4e53   following OPENS
-00029e80: 4849 4654 5f49 4e53 5441 4c4c 5f52 454c  HIFT_INSTALL_REL
-00029e90: 4541 5345 5f49 4d41 4745 5f4f 5645 5252  EASE_IMAGE_OVERR
-00029ea0: 4944 4522 290a 2020 2020 2020 2020 2020  IDE").          
-00029eb0: 2020 6e61 6d65 203d 2064 6174 612e 6765    name = data.ge
-00029ec0: 7428 2764 6973 636f 6e6e 6563 7465 645f  t('disconnected_
-00029ed0: 7265 7573 655f 6e61 6d65 2729 206f 7220  reuse_name') or 
-00029ee0: 636c 7573 7465 720a 2020 2020 2020 2020  cluster.        
-00029ef0: 2020 2020 6970 2c20 766d 706f 7274 203d      ip, vmport =
-00029f00: 205f 7373 685f 6372 6564 656e 7469 616c   _ssh_credential
-00029f10: 7328 7365 6c66 2e6b 2c20 6627 7b6e 616d  s(self.k, f'{nam
-00029f20: 657d 2d64 6973 636f 6e6e 6563 7465 6427  e}-disconnected'
-00029f30: 295b 313a 5d0a 2020 2020 2020 2020 2020  )[1:].          
-00029f40: 2020 636d 6420 3d20 2263 6174 202f 726f    cmd = "cat /ro
-00029f50: 6f74 2f76 6572 7369 6f6e 2e74 7874 220a  ot/version.txt".
-00029f60: 2020 2020 2020 2020 2020 2020 7373 6863              sshc
-00029f70: 6d64 203d 2073 7368 286e 616d 652c 2069  md = ssh(name, i
-00029f80: 703d 6970 2c20 7573 6572 3d27 726f 6f74  p=ip, user='root
-00029f90: 272c 2074 756e 6e65 6c3d 7365 6c66 2e74  ', tunnel=self.t
-00029fa0: 756e 6e65 6c2c 0a20 2020 2020 2020 2020  unnel,.         
-00029fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029fc0: 7475 6e6e 656c 686f 7374 3d73 656c 662e  tunnelhost=self.
-00029fd0: 7475 6e6e 656c 686f 7374 2c20 7475 6e6e  tunnelhost, tunn
-00029fe0: 656c 706f 7274 3d73 656c 662e 7475 6e6e  elport=self.tunn
-00029ff0: 656c 706f 7274 2c0a 2020 2020 2020 2020  elport,.        
-0002a000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a010: 2074 756e 6e65 6c75 7365 723d 7365 6c66   tunneluser=self
-0002a020: 2e74 756e 6e65 6c75 7365 722c 2069 6e73  .tunneluser, ins
-0002a030: 6563 7572 653d 5472 7565 2c20 636d 643d  ecure=True, cmd=
-0002a040: 636d 642c 2076 6d70 6f72 743d 766d 706f  cmd, vmport=vmpo
-0002a050: 7274 290a 2020 2020 2020 2020 2020 2020  rt).            
-0002a060: 6f73 2e73 7973 7465 6d28 7373 6863 6d64  os.system(sshcmd
-0002a070: 290a 0a20 2020 2064 6566 2068 616e 646c  )..    def handl
-0002a080: 655f 6669 6e69 7368 6669 6c65 7328 7365  e_finishfiles(se
-0002a090: 6c66 2c20 6e61 6d65 2c20 6669 6e69 7368  lf, name, finish
-0002a0a0: 6669 6c65 732c 2069 6465 6e74 6974 7966  files, identityf
-0002a0b0: 696c 653d 4e6f 6e65 2c20 766d 636c 6965  ile=None, vmclie
-0002a0c0: 6e74 3d4e 6f6e 6529 3a0a 2020 2020 2020  nt=None):.      
-0002a0d0: 2020 636f 6e66 6967 203d 204b 636f 6e66    config = Kconf
-0002a0e0: 6967 2863 6c69 656e 743d 766d 636c 6965  ig(client=vmclie
-0002a0f0: 6e74 2920 6966 2076 6d63 6c69 656e 7420  nt) if vmclient 
-0002a100: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-0002a110: 2073 656c 660a 2020 2020 2020 2020 6b20   self.        k 
-0002a120: 3d20 636f 6e66 6967 2e6b 0a20 2020 2020  = config.k.     
-0002a130: 2020 2063 7572 7265 6e74 5f69 7020 3d20     current_ip = 
-0002a140: 636f 6d6d 6f6e 2e5f 7373 685f 6372 6564  common._ssh_cred
-0002a150: 656e 7469 616c 7328 6b2c 206e 616d 6529  entials(k, name)
-0002a160: 5b31 5d0a 2020 2020 2020 2020 666f 7220  [1].        for 
-0002a170: 6669 6e69 7368 6669 6c65 2069 6e20 6669  finishfile in fi
-0002a180: 6e69 7368 6669 6c65 733a 0a20 2020 2020  nishfiles:.     
-0002a190: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0002a1a0: 616e 6365 2866 696e 6973 6866 696c 652c  ance(finishfile,
-0002a1b0: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
-0002a1c0: 2020 2020 2020 2064 6573 7469 6e61 7469         destinati
-0002a1d0: 6f6e 203d 2027 2e27 0a20 2020 2020 2020  on = '.'.       
-0002a1e0: 2020 2020 2020 2020 2073 6f75 7263 6520           source 
-0002a1f0: 3d20 6669 6e69 7368 6669 6c65 2069 6620  = finishfile if 
-0002a200: 272f 2720 696e 2066 696e 6973 6866 696c  '/' in finishfil
-0002a210: 6520 656c 7365 2066 272f 726f 6f74 2f7b  e else f'/root/{
-0002a220: 6669 6e69 7368 6669 6c65 7d27 0a20 2020  finishfile}'.   
-0002a230: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
-0002a240: 696e 7374 616e 6365 2866 696e 6973 6866  instance(finishf
-0002a250: 696c 652c 2064 6963 7429 2061 6e64 2027  ile, dict) and '
-0002a260: 6f72 6967 696e 2720 696e 2066 696e 6973  origin' in finis
-0002a270: 6866 696c 6520 616e 6420 2770 6174 6827  hfile and 'path'
-0002a280: 2069 6e20 6669 6e69 7368 6669 6c65 3a0a   in finishfile:.
-0002a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a2a0: 736f 7572 6365 2c20 6465 7374 696e 6174  source, destinat
-0002a2b0: 696f 6e20 3d20 6669 6e69 7368 6669 6c65  ion = finishfile
-0002a2c0: 2e67 6574 2827 6f72 6967 696e 2729 2c20  .get('origin'), 
-0002a2d0: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
-0002a2e0: 6572 2866 696e 6973 6866 696c 652e 6765  er(finishfile.ge
-0002a2f0: 7428 2770 6174 6827 2c20 272e 2729 290a  t('path', '.')).
-0002a300: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0002a310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002a320: 2020 7761 726e 696e 6728 6622 496e 636f    warning(f"Inco
-0002a330: 7272 6563 7420 6669 6e69 7368 6669 6c65  rrect finishfile
-0002a340: 2065 6e74 7279 207b 6669 6e69 7368 6669   entry {finishfi
-0002a350: 6c65 7d2e 2053 6b69 7070 696e 6722 290a  le}. Skipping").
-0002a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a370: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0002a380: 2020 2020 2073 6370 636d 6420 3d20 636f       scpcmd = co
-0002a390: 6d6d 6f6e 2e73 6370 286e 616d 652c 2069  mmon.scp(name, i
-0002a3a0: 703d 6375 7272 656e 745f 6970 2c20 7573  p=current_ip, us
-0002a3b0: 6572 3d27 726f 6f74 272c 2073 6f75 7263  er='root', sourc
-0002a3c0: 653d 736f 7572 6365 2c20 6465 7374 696e  e=source, destin
-0002a3d0: 6174 696f 6e3d 6465 7374 696e 6174 696f  ation=destinatio
-0002a3e0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-0002a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a400: 2020 2074 756e 6e65 6c3d 636f 6e66 6967     tunnel=config
-0002a410: 2e74 756e 6e65 6c2c 2074 756e 6e65 6c68  .tunnel, tunnelh
-0002a420: 6f73 743d 636f 6e66 6967 2e74 756e 6e65  ost=config.tunne
-0002a430: 6c68 6f73 742c 2074 756e 6e65 6c70 6f72  lhost, tunnelpor
-0002a440: 743d 636f 6e66 6967 2e74 756e 6e65 6c70  t=config.tunnelp
-0002a450: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
-0002a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a470: 2020 2020 2074 756e 6e65 6c75 7365 723d       tunneluser=
-0002a480: 7365 6c66 2e74 756e 6e65 6c75 7365 722c  self.tunneluser,
-0002a490: 2064 6f77 6e6c 6f61 643d 5472 7565 2c20   download=True, 
-0002a4a0: 696e 7365 6375 7265 3d54 7275 652c 2069  insecure=True, i
-0002a4b0: 6465 6e74 6974 7966 696c 653d 6964 656e  dentityfile=iden
-0002a4c0: 7469 7479 6669 6c65 290a 2020 2020 2020  tityfile).      
-0002a4d0: 2020 2020 2020 6f73 2e73 7973 7465 6d28        os.system(
-0002a4e0: 7363 7063 6d64 290a 0a20 2020 2064 6566  scpcmd)..    def
-0002a4f0: 2068 616e 646c 655f 6e6f 7469 6669 6361   handle_notifica
-0002a500: 7469 6f6e 7328 7365 6c66 2c20 6e61 6d65  tions(self, name
-0002a510: 2c20 6e6f 7469 6679 6d65 7468 6f64 733d  , notifymethods=
-0002a520: 5b5d 2c20 7075 7368 6275 6c6c 6574 746f  [], pushbulletto
-0002a530: 6b65 6e3d 4e6f 6e65 2c20 6e6f 7469 6679  ken=None, notify
-0002a540: 7363 7269 7074 3d4e 6f6e 652c 206e 6f74  script=None, not
-0002a550: 6966 7963 6d64 3d4e 6f6e 652c 0a20 2020  ifycmd=None,.   
-0002a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a570: 2020 2020 2020 2020 2020 736c 6163 6b63            slackc
-0002a580: 6861 6e6e 656c 3d4e 6f6e 652c 2073 6c61  hannel=None, sla
-0002a590: 636b 746f 6b65 6e3d 4e6f 6e65 2c20 6d61  cktoken=None, ma
-0002a5a0: 696c 7365 7276 6572 3d4e 6f6e 652c 206d  ilserver=None, m
-0002a5b0: 6169 6c66 726f 6d3d 4e6f 6e65 2c20 6d61  ailfrom=None, ma
-0002a5c0: 696c 746f 3d4e 6f6e 652c 0a20 2020 2020  ilto=None,.     
-0002a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a5e0: 2020 2020 2020 2020 636c 7573 7465 723d          cluster=
-0002a5f0: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-0002a600: 5f74 7970 6520 3d20 2743 6c75 7374 6572  _type = 'Cluster
-0002a610: 2720 6966 2063 6c75 7374 6572 2065 6c73  ' if cluster els
-0002a620: 6520 2756 6d27 0a20 2020 2020 2020 2074  e 'Vm'.        t
-0002a630: 6974 6c65 203d 2066 227b 5f74 7970 657d  itle = f"{_type}
-0002a640: 207b 6e61 6d65 7d20 6f6e 207b 7365 6c66   {name} on {self
-0002a650: 2e63 6c69 656e 747d 2072 6570 6f72 7422  .client} report"
-0002a660: 0a20 2020 2020 2020 2063 6d64 732c 206d  .        cmds, m
-0002a670: 6169 6c63 6f6e 7465 6e74 203d 205b 5d2c  ailcontent = [],
-0002a680: 204e 6f6e 650a 2020 2020 2020 2020 666f   None.        fo
-0002a690: 7220 6e6f 7469 6679 6d65 7468 6f64 2069  r notifymethod i
-0002a6a0: 6e20 736f 7274 6564 286e 6f74 6966 796d  n sorted(notifym
-0002a6b0: 6574 686f 6473 2c20 7265 7665 7273 653d  ethods, reverse=
-0002a6c0: 5472 7565 293a 0a20 2020 2020 2020 2020  True):.         
-0002a6d0: 2020 2069 6620 6e6f 7469 6679 6d65 7468     if notifymeth
-0002a6e0: 6f64 203d 3d20 2770 7573 6862 756c 6c65  od == 'pushbulle
-0002a6f0: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
-0002a700: 2020 2020 6966 2070 7573 6862 756c 6c65      if pushbulle
-0002a710: 7474 6f6b 656e 2069 7320 4e6f 6e65 3a0a  ttoken is None:.
-0002a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a730: 2020 2020 7761 726e 696e 6728 6622 4e6f      warning(f"No
-0002a740: 7469 6669 6361 7469 6f6e 2072 6571 7569  tification requi
-0002a750: 7265 6420 666f 7220 7b6e 616d 657d 2062  red for {name} b
-0002a760: 7574 206d 6973 7369 6e67 2070 7573 6862  ut missing pushb
-0002a770: 756c 6c65 7474 6f6b 656e 2229 0a20 2020  ullettoken").   
-0002a780: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0002a790: 6620 6e6f 7469 6679 7363 7269 7074 2069  f notifyscript i
-0002a7a0: 7320 4e6f 6e65 2061 6e64 206e 6f74 6966  s None and notif
-0002a7b0: 7963 6d64 2069 7320 4e6f 6e65 3a0a 2020  ycmd is None:.  
-0002a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a7d0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0002a7e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0002a7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a800: 2020 2020 2074 6f6b 656e 203d 2070 7573       token = pus
-0002a810: 6862 756c 6c65 7474 6f6b 656e 0a20 2020  hbullettoken.   
+00029460: 2020 686f 7374 735f 636f 6e74 656e 7420    hosts_content 
+00029470: 2b3d 2066 227b 6170 695f 6970 7d20 6170  += f"{api_ip} ap
+00029480: 692d 696e 742e 7b63 6c75 7374 6572 7d2e  i-int.{cluster}.
+00029490: 7b64 6f6d 6169 6e7d 2061 7069 2e7b 636c  {domain} api.{cl
+000294a0: 7573 7465 727d 2e7b 646f 6d61 696e 7d22  uster}.{domain}"
+000294b0: 0a20 2020 2020 2020 2070 6c61 6e64 6972  .        plandir
+000294c0: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
+000294d0: 6d65 286f 7065 6e73 6869 6674 2e63 7265  me(openshift.cre
+000294e0: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
+000294f0: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+00029500: 2020 7769 7468 206f 7065 6e28 2269 736f    with open("iso
+00029510: 2e69 676e 222c 2027 7727 2920 6173 2066  .ign", 'w') as f
+00029520: 3a0a 2020 2020 2020 2020 2020 2020 6675  :.            fu
+00029530: 6c6c 5f6e 616d 6520 3d20 6627 7b63 6c75  ll_name = f'{clu
+00029540: 7374 6572 7d2e 7b64 6f6d 6169 6e7d 2720  ster}.{domain}' 
+00029550: 6966 2064 6f6d 6169 6e20 6973 206e 6f74  if domain is not
+00029560: 204e 6f6e 6520 656c 7365 2063 6c75 7374   None else clust
+00029570: 6572 0a20 2020 2020 2020 2020 2020 2070  er.            p
+00029580: 7072 696e 7428 6622 5772 6974 696e 6720  print(f"Writing 
+00029590: 6669 6c65 2069 736f 2e69 676e 2066 6f72  file iso.ign for
+000295a0: 207b 726f 6c65 7d20 696e 207b 6675 6c6c   {role} in {full
+000295b0: 5f6e 616d 657d 2229 0a20 2020 2020 2020  _name}").       
+000295c0: 2020 2020 2069 736f 6469 7220 3d20 6f73       isodir = os
+000295d0: 2e70 6174 682e 6469 726e 616d 6528 636f  .path.dirname(co
+000295e0: 6d6d 6f6e 2e5f 5f66 696c 655f 5f29 0a20  mmon.__file__). 
+000295f0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00029600: 6e61 6c64 6174 6120 6973 204e 6f6e 653a  naldata is None:
+00029610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029620: 2065 6e76 203d 2045 6e76 6972 6f6e 6d65   env = Environme
+00029630: 6e74 286c 6f61 6465 723d 4669 6c65 5379  nt(loader=FileSy
+00029640: 7374 656d 4c6f 6164 6572 2869 736f 6469  stemLoader(isodi
+00029650: 7229 2c20 6578 7465 6e73 696f 6e73 3d5b  r), extensions=[
+00029660: 276a 696e 6a61 322e 6578 742e 646f 275d  'jinja2.ext.do']
+00029670: 2c20 7472 696d 5f62 6c6f 636b 733d 5472  , trim_blocks=Tr
+00029680: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00029690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000296a0: 2020 2020 2020 6c73 7472 6970 5f62 6c6f        lstrip_blo
+000296b0: 636b 733d 5472 7565 290a 2020 2020 2020  cks=True).      
+000296c0: 2020 2020 2020 2020 2020 7465 6d70 6c20            templ 
+000296d0: 3d20 656e 762e 6765 745f 7465 6d70 6c61  = env.get_templa
+000296e0: 7465 286f 732e 7061 7468 2e62 6173 656e  te(os.path.basen
+000296f0: 616d 6528 2269 676e 6974 696f 6e2e 6a32  ame("ignition.j2
+00029700: 2229 290a 2020 2020 2020 2020 2020 2020  ")).            
+00029710: 2020 2020 6966 2068 6f73 7473 5f63 6f6e      if hosts_con
+00029720: 7465 6e74 2069 7320 6e6f 7420 4e6f 6e65  tent is not None
+00029730: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00029740: 2020 2020 2020 686f 7374 735f 636f 6e74        hosts_cont
+00029750: 656e 7420 3d20 6261 7365 3634 2e62 3634  ent = base64.b64
+00029760: 656e 636f 6465 2868 6f73 7473 5f63 6f6e  encode(hosts_con
+00029770: 7465 6e74 2e65 6e63 6f64 6528 2929 2e64  tent.encode()).d
+00029780: 6563 6f64 6528 2255 5446 2d38 2229 0a20  ecode("UTF-8"). 
+00029790: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000297a0: 6620 273a 2720 696e 2061 7069 5f69 703a  f ':' in api_ip:
+000297b0: 2020 2023 2049 5076 3620 6164 6472 6573     # IPv6 addres
+000297c0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+000297d0: 2020 2020 2020 6967 6e69 7469 6f6e 5f75        ignition_u
+000297e0: 726c 203d 2066 2268 7474 703a 2f2f 5b7b  rl = f"http://[{
+000297f0: 6170 695f 6970 7d5d 3a32 3236 3234 2f63  api_ip}]:22624/c
+00029800: 6f6e 6669 672f 7b72 6f6c 657d 220a 2020  onfig/{role}".  
+00029810: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00029820: 7365 3a20 2020 2020 2020 2020 2020 2020  se:             
+00029830: 2020 2320 4950 7634 2061 6464 7265 7373    # IPv4 address
+00029840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029850: 2020 2020 2069 676e 6974 696f 6e5f 7572       ignition_ur
+00029860: 6c20 3d20 6622 6874 7470 3a2f 2f7b 6170  l = f"http://{ap
+00029870: 695f 6970 7d3a 3232 3632 342f 636f 6e66  i_ip}:22624/conf
+00029880: 6967 2f7b 726f 6c65 7d22 0a20 2020 2020  ig/{role}".     
+00029890: 2020 2020 2020 2020 2020 2066 696e 616c             final
+000298a0: 6461 7461 203d 2074 656d 706c 2e72 656e  data = templ.ren
+000298b0: 6465 7228 6967 6e69 7469 6f6e 5f75 726c  der(ignition_url
+000298c0: 3d69 676e 6974 696f 6e5f 7572 6c2c 2068  =ignition_url, h
+000298d0: 6f73 7473 5f63 6f6e 7465 6e74 3d68 6f73  osts_content=hos
+000298e0: 7473 5f63 6f6e 7465 6e74 2c0a 2020 2020  ts_content,.    
+000298f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029910: 2020 2020 2069 676e 6974 696f 6e5f 7665       ignition_ve
+00029920: 7273 696f 6e3d 6967 6e69 7469 6f6e 5f76  rsion=ignition_v
+00029930: 6572 7369 6f6e 290a 2020 2020 2020 2020  ersion).        
+00029940: 2020 2020 6966 2064 6972 6563 743a 0a20      if direct:. 
+00029950: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00029960: 2e77 7269 7465 2866 696e 616c 6461 7461  .write(finaldata
+00029970: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00029980: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00029990: 2020 2020 5f66 696c 6573 203d 205b 7b22      _files = [{"
+000299a0: 7061 7468 223a 2022 2f72 6f6f 742f 636f  path": "/root/co
+000299b0: 6e66 6967 2e69 676e 222c 2022 636f 6e74  nfig.ign", "cont
+000299c0: 656e 7422 3a20 6669 6e61 6c64 6174 617d  ent": finaldata}
+000299d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000299e0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+000299f0: 7374 7328 2769 736f 2e73 6827 293a 0a20  sts('iso.sh'):. 
+00029a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029a10: 2020 2070 7072 696e 7428 2255 7369 6e67     pprint("Using
+00029a20: 206c 6f63 616c 2069 736f 2e73 6820 7363   local iso.sh sc
+00029a30: 7269 7074 2229 0a20 2020 2020 2020 2020  ript").         
+00029a40: 2020 2020 2020 2020 2020 2069 736f 7363             isosc
+00029a50: 7269 7074 203d 2027 6973 6f2e 7368 270a  ript = 'iso.sh'.
+00029a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029a70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00029a80: 2020 2020 2020 2020 2020 6973 6f73 6372            isoscr
+00029a90: 6970 7420 3d20 6627 7b70 6c61 6e64 6972  ipt = f'{plandir
+00029aa0: 7d2f 6973 6f2e 7368 270a 2020 2020 2020  }/iso.sh'.      
+00029ab0: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+00029ac0: 7061 7468 2e65 7869 7374 7328 276d 6163  path.exists('mac
+00029ad0: 732e 7478 7427 293a 0a20 2020 2020 2020  s.txt'):.       
+00029ae0: 2020 2020 2020 2020 2020 2020 205f 6669               _fi
+00029af0: 6c65 732e 6170 7065 6e64 287b 2270 6174  les.append({"pat
+00029b00: 6822 3a20 222f 726f 6f74 2f6d 6163 732e  h": "/root/macs.
+00029b10: 7478 7422 2c20 226f 7269 6769 6e22 3a20  txt", "origin": 
+00029b20: 276d 6163 732e 7478 7427 7d29 0a20 2020  'macs.txt'}).   
+00029b30: 2020 2020 2020 2020 2020 2020 2069 736f               iso
+00029b40: 5f6f 7665 7272 6964 6573 203d 207b 2773  _overrides = {'s
+00029b50: 6372 6970 7473 273a 205b 6973 6f73 6372  cripts': [isoscr
+00029b60: 6970 745d 2c20 2766 696c 6573 273a 205f  ipt], 'files': _
+00029b70: 6669 6c65 732c 2027 6d65 7461 6c5f 7572  files, 'metal_ur
+00029b80: 6c27 3a20 6d65 7461 6c5f 7572 6c2c 2027  l': metal_url, '
+00029b90: 6e6f 6e61 6d65 273a 2054 7275 652c 0a20  noname': True,. 
+00029ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029bc0: 2769 6d61 6765 273a 2027 7268 636f 7334  'image': 'rhcos4
+00029bd0: 3030 3027 7d0a 2020 2020 2020 2020 2020  000'}.          
+00029be0: 2020 2020 2020 6966 206d 6574 616c 5f75        if metal_u
+00029bf0: 726c 2069 7320 6e6f 7420 4e6f 6e65 3a0a  rl is not None:.
+00029c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029c10: 2020 2020 6973 6f5f 6f76 6572 7269 6465      iso_override
+00029c20: 735b 276e 6565 645f 6e65 7477 6f72 6b27  s['need_network'
+00029c30: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
+00029c40: 2020 2020 2020 2020 2069 736f 5f6f 7665           iso_ove
+00029c50: 7272 6964 6573 2e75 7064 6174 6528 6f76  rrides.update(ov
+00029c60: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
+00029c70: 2020 2020 2020 2020 2069 6620 276e 616d           if 'nam
+00029c80: 6527 2069 6e20 6f76 6572 7269 6465 733a  e' in overrides:
+00029c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029ca0: 2020 2020 2069 736f 5f6e 616d 6520 3d20       iso_name = 
+00029cb0: 6f76 6572 7269 6465 735b 276e 616d 6527  overrides['name'
+00029cc0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00029cd0: 2020 2020 2020 6973 6f5f 6f76 6572 7269        iso_overri
+00029ce0: 6465 735b 276e 6f6e 616d 6527 5d20 3d20  des['noname'] = 
+00029cf0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00029d00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00029d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029d20: 6973 6f5f 6e61 6d65 203d 2027 6175 746f  iso_name = 'auto
+00029d30: 696e 7374 616c 6c65 7227 0a20 2020 2020  installer'.     
+00029d40: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00029d50: 7420 3d20 7365 6c66 2e63 7265 6174 655f  t = self.create_
+00029d60: 766d 2869 736f 5f6e 616d 652c 206f 7665  vm(iso_name, ove
+00029d70: 7272 6964 6573 3d69 736f 5f6f 7665 7272  rrides=iso_overr
+00029d80: 6964 6573 2c20 6f6e 6c79 6173 7365 7473  ides, onlyassets
+00029d90: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00029da0: 2020 2020 2020 2069 6620 2772 6561 736f         if 'reaso
+00029db0: 6e27 2069 6e20 7265 7375 6c74 3a0a 2020  n' in result:.  
+00029dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029dd0: 2020 6572 726f 7228 7265 7375 6c74 5b27    error(result['
+00029de0: 7265 6173 6f6e 275d 290a 2020 2020 2020  reason']).      
+00029df0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00029e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029e10: 2020 2020 662e 7772 6974 6528 7265 7375      f.write(resu
+00029e20: 6c74 5b27 7573 6572 6461 7461 275d 290a  lt['userdata']).
+00029e30: 2020 2020 2020 2020 6966 2069 736f 3a0a          if iso:.
+00029e40: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00029e50: 656c 662e 7479 7065 206e 6f74 2069 6e20  elf.type not in 
+00029e60: 5b27 6b76 6d27 2c20 2766 616b 6527 2c20  ['kvm', 'fake', 
+00029e70: 276b 7562 6576 6972 7427 2c20 2776 7370  'kubevirt', 'vsp
+00029e80: 6865 7265 272c 2027 6f70 656e 7374 6163  here', 'openstac
+00029e90: 6b27 5d3a 0a20 2020 2020 2020 2020 2020  k']:.           
+00029ea0: 2020 2020 2077 6172 6e69 6e67 2866 2249       warning(f"I
+00029eb0: 736f 2067 656e 6572 6174 696f 6e20 6e6f  so generation no
+00029ec0: 7420 7375 7070 6f72 7465 6420 6f6e 207b  t supported on {
+00029ed0: 7365 6c66 2e74 7970 657d 2229 0a20 2020  self.type}").   
+00029ee0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00029ef0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00029f00: 736f 5f70 6f6f 6c20 3d20 6f76 6572 7269  so_pool = overri
+00029f10: 6465 732e 6765 7428 2770 6f6f 6c27 2920  des.get('pool') 
+00029f20: 6f72 2073 656c 662e 706f 6f6c 0a20 2020  or self.pool.   
+00029f30: 2020 2020 2020 2020 2020 2020 2067 656e               gen
+00029f40: 6572 6174 655f 7268 636f 735f 6973 6f28  erate_rhcos_iso(
+00029f50: 7365 6c66 2e6b 2c20 6622 7b63 6c75 7374  self.k, f"{clust
+00029f60: 6572 7d2d 7b72 6f6c 657d 222c 2069 736f  er}-{role}", iso
+00029f70: 5f70 6f6f 6c2c 2076 6572 7369 6f6e 3d69  _pool, version=i
+00029f80: 736f 5f76 6572 7369 6f6e 2c20 706f 646d  so_version, podm
+00029f90: 616e 3d70 6f64 6d61 6e2c 0a20 2020 2020  an=podman,.     
+00029fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029fb0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00029fc0: 7374 616c 6c65 723d 696e 7374 616c 6c65  staller=installe
+00029fd0: 7229 0a0a 2020 2020 6465 6620 6372 6561  r)..    def crea
+00029fe0: 7465 5f6f 7065 6e73 6869 6674 5f64 6973  te_openshift_dis
+00029ff0: 636f 6e6e 6563 7465 6428 7365 6c66 2c20  connected(self, 
+0002a000: 706c 616e 2c20 6f76 6572 7269 6465 733d  plan, overrides=
+0002a010: 7b7d 293a 0a20 2020 2020 2020 2064 6174  {}):.        dat
+0002a020: 6120 3d20 6f76 6572 7269 6465 730a 2020  a = overrides.  
+0002a030: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
+0002a040: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+0002a050: 6f70 656e 7368 6966 742e 6372 6561 7465  openshift.create
+0002a060: 2e5f 5f63 6f64 655f 5f2e 636f 5f66 696c  .__code__.co_fil
+0002a070: 656e 616d 6529 0a20 2020 2020 2020 2063  ename).        c
+0002a080: 6c75 7374 6572 203d 2064 6174 612e 6765  luster = data.ge
+0002a090: 7428 2763 6c75 7374 6572 272c 2027 6d79  t('cluster', 'my
+0002a0a0: 6f70 656e 7368 6966 7427 290a 2020 2020  openshift').    
+0002a0b0: 2020 2020 7570 7374 7265 616d 203d 2064      upstream = d
+0002a0c0: 6174 612e 6765 7428 2775 7073 7472 6561  ata.get('upstrea
+0002a0d0: 6d27 2c20 4661 6c73 6529 0a20 2020 2020  m', False).     
+0002a0e0: 2020 2076 6572 7369 6f6e 203d 2064 6174     version = dat
+0002a0f0: 612e 6765 7428 2776 6572 7369 6f6e 272c  a.get('version',
+0002a100: 2027 7374 6162 6c65 2729 0a20 2020 2020   'stable').     
+0002a110: 2020 2074 6167 203d 2064 6174 612e 6765     tag = data.ge
+0002a120: 7428 2774 6167 272c 204f 5045 4e53 4849  t('tag', OPENSHI
+0002a130: 4654 5f54 4147 290a 2020 2020 2020 2020  FT_TAG).        
+0002a140: 7070 7269 6e74 2866 2255 7369 6e67 2076  pprint(f"Using v
+0002a150: 6572 7369 6f6e 207b 7665 7273 696f 6e7d  ersion {version}
+0002a160: 2061 6e64 2074 6167 207b 7461 677d 2229   and tag {tag}")
+0002a170: 0a20 2020 2020 2020 2064 6973 636f 6e6e  .        disconn
+0002a180: 6563 7465 645f 766d 203d 2066 227b 636c  ected_vm = f"{cl
+0002a190: 7573 7465 727d 2d64 6973 636f 6e6e 6563  uster}-disconnec
+0002a1a0: 7465 6422 0a20 2020 2020 2020 2064 6973  ted".        dis
+0002a1b0: 636f 6e6e 6563 7465 645f 7265 7573 6520  connected_reuse 
+0002a1c0: 3d20 6461 7461 2e67 6574 2827 6469 7363  = data.get('disc
+0002a1d0: 6f6e 6e65 6374 6564 5f72 6575 7365 272c  onnected_reuse',
+0002a1e0: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
+0002a1f0: 6469 7363 6f6e 6e65 6374 6564 5f73 796e  disconnected_syn
+0002a200: 6320 3d20 6461 7461 2e67 6574 2827 6469  c = data.get('di
+0002a210: 7363 6f6e 6e65 6374 6564 5f73 796e 6327  sconnected_sync'
+0002a220: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
+0002a230: 7070 7269 6e74 2866 2244 6570 6c6f 7969  pprint(f"Deployi
+0002a240: 6e67 2064 6973 636f 6e6e 6563 7465 6420  ng disconnected 
+0002a250: 766d 207b 6469 7363 6f6e 6e65 6374 6564  vm {disconnected
+0002a260: 5f76 6d7d 2229 0a20 2020 2020 2020 2069  _vm}").        i
+0002a270: 6620 6469 7363 6f6e 6e65 6374 6564 5f73  f disconnected_s
+0002a280: 796e 633a 0a20 2020 2020 2020 2020 2020  ync:.           
+0002a290: 2070 756c 6c5f 7365 6372 6574 203d 2070   pull_secret = p
+0002a2a0: 7764 5f70 6174 6828 6461 7461 2e67 6574  wd_path(data.get
+0002a2b0: 2827 7075 6c6c 5f73 6563 7265 7427 2929  ('pull_secret'))
+0002a2c0: 2069 6620 6e6f 7420 7570 7374 7265 616d   if not upstream
+0002a2d0: 2065 6c73 6520 6622 7b70 6c61 6e64 6972   else f"{plandir
+0002a2e0: 7d2f 6661 6b65 5f70 756c 6c2e 6a73 6f6e  }/fake_pull.json
+0002a2f0: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
+0002a300: 206e 6f74 2075 7073 7472 6561 6d3a 0a20   not upstream:. 
+0002a310: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002a320: 756c 6c5f 7365 6372 6574 203d 2070 7764  ull_secret = pwd
+0002a330: 5f70 6174 6828 6461 7461 2e67 6574 2827  _path(data.get('
+0002a340: 7075 6c6c 5f73 6563 7265 7427 2c20 276f  pull_secret', 'o
+0002a350: 7065 6e73 6869 6674 5f70 756c 6c2e 6a73  penshift_pull.js
+0002a360: 6f6e 2729 290a 2020 2020 2020 2020 2020  on')).          
+0002a370: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002a380: 2020 2020 2020 2020 7075 6c6c 5f73 6563          pull_sec
+0002a390: 7265 7420 3d20 6622 7b70 6c61 6e64 6972  ret = f"{plandir
+0002a3a0: 7d2f 6661 6b65 5f70 756c 6c2e 6a73 6f6e  }/fake_pull.json
+0002a3b0: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
+0002a3c0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+0002a3d0: 7374 7328 7075 6c6c 5f73 6563 7265 7429  sts(pull_secret)
+0002a3e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002a3f0: 2020 6572 726f 7228 6622 4d69 7373 696e    error(f"Missin
+0002a400: 6720 7075 6c6c 2073 6563 7265 7420 6669  g pull secret fi
+0002a410: 6c65 207b 7075 6c6c 5f73 6563 7265 747d  le {pull_secret}
+0002a420: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0002a430: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+0002a440: 2020 2020 2020 2020 2020 2064 6174 615b             data[
+0002a450: 2770 756c 6c5f 7365 6372 6574 275d 203d  'pull_secret'] =
+0002a460: 2072 652e 7375 6228 7222 5c73 222c 2022   re.sub(r"\s", "
+0002a470: 222c 206f 7065 6e28 7075 6c6c 5f73 6563  ", open(pull_sec
+0002a480: 7265 7429 2e72 6561 6428 2929 0a20 2020  ret).read()).   
+0002a490: 2020 2020 2064 6973 636f 6e6e 6563 7465       disconnecte
+0002a4a0: 645f 706c 616e 203d 2066 227b 706c 616e  d_plan = f"{plan
+0002a4b0: 7d2d 7265 7573 6522 2069 6620 6469 7363  }-reuse" if disc
+0002a4c0: 6f6e 6e65 6374 6564 5f72 6575 7365 2065  onnected_reuse e
+0002a4d0: 6c73 6520 706c 616e 0a20 2020 2020 2020  lse plan.       
+0002a4e0: 2069 6620 7665 7273 696f 6e20 3d3d 2027   if version == '
+0002a4f0: 6369 2720 616e 6420 2764 6973 636f 6e6e  ci' and 'disconn
+0002a500: 6563 7465 645f 6f72 6967 696e 2720 6e6f  ected_origin' no
+0002a510: 7420 696e 206f 7665 7272 6964 6573 3a0a  t in overrides:.
+0002a520: 2020 2020 2020 2020 2020 2020 7265 6720              reg 
+0002a530: 3d20 2772 6567 6973 7472 792e 6275 696c  = 'registry.buil
+0002a540: 6430 312e 6369 2e6f 7065 6e73 6869 6674  d01.ci.openshift
+0002a550: 2e6f 7267 2720 6966 2073 7472 2874 6167  .org' if str(tag
+0002a560: 292e 7374 6172 7473 7769 7468 2827 6369  ).startswith('ci
+0002a570: 2d27 2920 656c 7365 2027 7265 6769 7374  -') else 'regist
+0002a580: 7279 2e63 692e 6f70 656e 7368 6966 742e  ry.ci.openshift.
+0002a590: 6f72 6727 0a20 2020 2020 2020 2020 2020  org'.           
+0002a5a0: 2077 6172 6e69 6e67 2866 2246 6f72 6369   warning(f"Forci
+0002a5b0: 6e67 2064 6973 636f 6e6e 6563 7465 645f  ng disconnected_
+0002a5c0: 6f72 6967 696e 2074 6f20 7b72 6567 7d22  origin to {reg}"
+0002a5d0: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
+0002a5e0: 7461 5b27 6469 7363 6f6e 6e65 6374 6564  ta['disconnected
+0002a5f0: 5f6f 7269 6769 6e27 5d20 3d20 7265 670a  _origin'] = reg.
+0002a600: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0002a610: 2073 656c 662e 706c 616e 2864 6973 636f   self.plan(disco
+0002a620: 6e6e 6563 7465 645f 706c 616e 2c20 696e  nnected_plan, in
+0002a630: 7075 7466 696c 653d 6627 7b70 6c61 6e64  putfile=f'{pland
+0002a640: 6972 7d2f 6469 7363 6f6e 6e65 6374 6564  ir}/disconnected
+0002a650: 2e79 6d6c 272c 206f 7665 7272 6964 6573  .yml', overrides
+0002a660: 3d64 6174 6129 0a20 2020 2020 2020 2069  =data).        i
+0002a670: 6620 7265 7375 6c74 5b27 7265 7375 6c74  f result['result
+0002a680: 275d 2021 3d20 2773 7563 6365 7373 273a  '] != 'success':
+0002a690: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
+0002a6a0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+0002a6b0: 2065 6c69 6620 6469 7363 6f6e 6e65 6374   elif disconnect
+0002a6c0: 6564 5f73 796e 633a 0a20 2020 2020 2020  ed_sync:.       
+0002a6d0: 2020 2020 2070 7072 696e 7428 2255 7365       pprint("Use
+0002a6e0: 2074 6865 2066 6f6c 6c6f 7769 6e67 204f   the following O
+0002a6f0: 5045 4e53 4849 4654 5f49 4e53 5441 4c4c  PENSHIFT_INSTALL
+0002a700: 5f52 454c 4541 5345 5f49 4d41 4745 5f4f  _RELEASE_IMAGE_O
+0002a710: 5645 5252 4944 4522 290a 2020 2020 2020  VERRIDE").      
+0002a720: 2020 2020 2020 6e61 6d65 203d 2064 6174        name = dat
+0002a730: 612e 6765 7428 2764 6973 636f 6e6e 6563  a.get('disconnec
+0002a740: 7465 645f 7265 7573 655f 6e61 6d65 2729  ted_reuse_name')
+0002a750: 206f 7220 636c 7573 7465 720a 2020 2020   or cluster.    
+0002a760: 2020 2020 2020 2020 6970 2c20 766d 706f          ip, vmpo
+0002a770: 7274 203d 205f 7373 685f 6372 6564 656e  rt = _ssh_creden
+0002a780: 7469 616c 7328 7365 6c66 2e6b 2c20 6627  tials(self.k, f'
+0002a790: 7b6e 616d 657d 2d64 6973 636f 6e6e 6563  {name}-disconnec
+0002a7a0: 7465 6427 295b 313a 5d0a 2020 2020 2020  ted')[1:].      
+0002a7b0: 2020 2020 2020 636d 6420 3d20 2263 6174        cmd = "cat
+0002a7c0: 202f 726f 6f74 2f76 6572 7369 6f6e 2e74   /root/version.t
+0002a7d0: 7874 220a 2020 2020 2020 2020 2020 2020  xt".            
+0002a7e0: 7373 6863 6d64 203d 2073 7368 286e 616d  sshcmd = ssh(nam
+0002a7f0: 652c 2069 703d 6970 2c20 7573 6572 3d27  e, ip=ip, user='
+0002a800: 726f 6f74 272c 2074 756e 6e65 6c3d 7365  root', tunnel=se
+0002a810: 6c66 2e74 756e 6e65 6c2c 0a20 2020 2020  lf.tunnel,.     
 0002a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a830: 2070 6263 6d64 203d 2027 6375 726c 202d   pbcmd = 'curl -
-0002a840: 7375 2022 2573 3a22 202d 6420 7479 7065  su "%s:" -d type
-0002a850: 3d22 6e6f 7465 2220 2d64 2062 6f64 793d  ="note" -d body=
-0002a860: 2260 2573 2032 3e26 3160 2220 2d64 2074  "`%s 2>&1`" -d t
-0002a870: 6974 6c65 3d22 2573 2220 2720 2520 2874  itle="%s" ' % (t
-0002a880: 6f6b 656e 2c0a 2020 2020 2020 2020 2020  oken,.          
-0002a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a8e0: 2020 2020 2020 2020 6e6f 7469 6679 636d          notifycm
-0002a8f0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-0002a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a950: 2020 2020 2074 6974 6c65 290a 2020 2020       title).    
-0002a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a970: 7062 636d 6420 2b3d 2027 6874 7470 733a  pbcmd += 'https:
-0002a980: 2f2f 6170 692e 7075 7368 6275 6c6c 6574  //api.pushbullet
-0002a990: 2e63 6f6d 2f76 322f 7075 7368 6573 270a  .com/v2/pushes'.
-0002a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a9b0: 2020 2020 636d 6473 2e61 7070 656e 6428      cmds.append(
-0002a9c0: 7062 636d 6429 0a20 2020 2020 2020 2020  pbcmd).         
-0002a9d0: 2020 2065 6c69 6620 6e6f 7469 6679 6d65     elif notifyme
-0002a9e0: 7468 6f64 203d 3d20 2773 6c61 636b 273a  thod == 'slack':
-0002a9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002aa00: 2069 6620 736c 6163 6b63 6861 6e6e 656c   if slackchannel
-0002aa10: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0002aa20: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0002aa30: 726e 696e 6728 6622 4e6f 7469 6669 6361  rning(f"Notifica
-0002aa40: 7469 6f6e 2072 6571 7569 7265 6420 666f  tion required fo
-0002aa50: 7220 7b6e 616d 657d 2062 7574 206d 6973  r {name} but mis
-0002aa60: 7369 6e67 2073 6c61 636b 2063 6861 6e6e  sing slack chann
-0002aa70: 656c 2229 0a20 2020 2020 2020 2020 2020  el").           
-0002aa80: 2020 2020 2065 6c69 6620 736c 6163 6b74       elif slackt
-0002aa90: 6f6b 656e 2069 7320 4e6f 6e65 3a0a 2020  oken is None:.  
-0002aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aab0: 2020 7761 726e 696e 6728 6622 4e6f 7469    warning(f"Noti
-0002aac0: 6669 6361 7469 6f6e 2072 6571 7569 7265  fication require
-0002aad0: 6420 666f 7220 7b6e 616d 657d 2062 7574  d for {name} but
-0002aae0: 206d 6973 7369 6e67 2073 6c61 636b 746f   missing slackto
-0002aaf0: 6b65 6e22 290a 2020 2020 2020 2020 2020  ken").          
-0002ab00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ab20: 736c 6163 6b63 6d64 203d 2066 2269 6e66  slackcmd = f"inf
-0002ab30: 6f3d 607b 6e6f 7469 6679 636d 647d 2032  o=`{notifycmd} 2
-0002ab40: 3e26 3120 7c20 7365 6420 2773 2f5c 5c78  >&1 | sed 's/\\x
-0002ab50: 322f 202f 6727 603b 220a 2020 2020 2020  2/ /g'`;".      
-0002ab60: 2020 2020 2020 2020 2020 2020 2020 736c                sl
-0002ab70: 6163 6b63 6d64 202b 3d20 2222 2263 7572  ackcmd += """cur
-0002ab80: 6c20 2d58 2050 4f53 5420 2d48 2027 4175  l -X POST -H 'Au
-0002ab90: 7468 6f72 697a 6174 696f 6e3a 2042 6561  thorization: Bea
-0002aba0: 7265 7220 2573 270a 202d 4820 2743 6f6e  rer %s'. -H 'Con
-0002abb0: 7465 6e74 2d74 7970 653a 2061 7070 6c69  tent-type: appli
-0002abc0: 6361 7469 6f6e 2f6a 736f 6e3b 2063 6861  cation/json; cha
-0002abd0: 7273 6574 3d75 7466 2d38 270a 202d 2d64  rset=utf-8'. --d
-0002abe0: 6174 6120 277b 2263 6861 6e6e 656c 223a  ata '{"channel":
-0002abf0: 2225 7322 2c22 7465 7874 223a 2225 7322  "%s","text":"%s"
-0002ac00: 2c22 6174 7461 6368 6d65 6e74 7322 3a20  ,"attachments": 
-0002ac10: 5b7b 2274 6578 7422 3a22 2722 2469 6e66  [{"text":"'"$inf
-0002ac20: 6f22 2722 2c22 6661 6c6c 6261 636b 223a  o"'","fallback":
-0002ac30: 226e 6f74 6869 6e67 222c 0a22 636f 6c6f  "nothing",."colo
-0002ac40: 7222 3a22 2333 4141 3345 3322 2c22 6174  r":"#3AA3E3","at
-0002ac50: 7461 6368 6d65 6e74 5f74 7970 6522 3a22  tachment_type":"
-0002ac60: 6465 6661 756c 7422 7d5d 7d27 2068 7474  default"}]}' htt
-0002ac70: 7073 3a2f 2f73 6c61 636b 2e63 6f6d 2f61  ps://slack.com/a
-0002ac80: 7069 2f63 6861 742e 706f 7374 4d65 7373  pi/chat.postMess
-0002ac90: 6167 6522 2222 2025 2028 736c 6163 6b74  age""" % (slackt
-0002aca0: 6f6b 656e 2c0a 2020 2020 2020 2020 2020  oken,.          
-0002acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a830: 2020 2020 7475 6e6e 656c 686f 7374 3d73      tunnelhost=s
+0002a840: 656c 662e 7475 6e6e 656c 686f 7374 2c20  elf.tunnelhost, 
+0002a850: 7475 6e6e 656c 706f 7274 3d73 656c 662e  tunnelport=self.
+0002a860: 7475 6e6e 656c 706f 7274 2c0a 2020 2020  tunnelport,.    
+0002a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a880: 2020 2020 2074 756e 6e65 6c75 7365 723d       tunneluser=
+0002a890: 7365 6c66 2e74 756e 6e65 6c75 7365 722c  self.tunneluser,
+0002a8a0: 2069 6e73 6563 7572 653d 5472 7565 2c20   insecure=True, 
+0002a8b0: 636d 643d 636d 642c 2076 6d70 6f72 743d  cmd=cmd, vmport=
+0002a8c0: 766d 706f 7274 290a 2020 2020 2020 2020  vmport).        
+0002a8d0: 2020 2020 6f73 2e73 7973 7465 6d28 7373      os.system(ss
+0002a8e0: 6863 6d64 290a 0a20 2020 2064 6566 2068  hcmd)..    def h
+0002a8f0: 616e 646c 655f 6669 6e69 7368 6669 6c65  andle_finishfile
+0002a900: 7328 7365 6c66 2c20 6e61 6d65 2c20 6669  s(self, name, fi
+0002a910: 6e69 7368 6669 6c65 732c 2069 6465 6e74  nishfiles, ident
+0002a920: 6974 7966 696c 653d 4e6f 6e65 2c20 766d  ityfile=None, vm
+0002a930: 636c 6965 6e74 3d4e 6f6e 6529 3a0a 2020  client=None):.  
+0002a940: 2020 2020 2020 636f 6e66 6967 203d 204b        config = K
+0002a950: 636f 6e66 6967 2863 6c69 656e 743d 766d  config(client=vm
+0002a960: 636c 6965 6e74 2920 6966 2076 6d63 6c69  client) if vmcli
+0002a970: 656e 7420 6973 206e 6f74 204e 6f6e 6520  ent is not None 
+0002a980: 656c 7365 2073 656c 660a 2020 2020 2020  else self.      
+0002a990: 2020 6b20 3d20 636f 6e66 6967 2e6b 0a20    k = config.k. 
+0002a9a0: 2020 2020 2020 2063 7572 7265 6e74 5f69         current_i
+0002a9b0: 7020 3d20 636f 6d6d 6f6e 2e5f 7373 685f  p = common._ssh_
+0002a9c0: 6372 6564 656e 7469 616c 7328 6b2c 206e  credentials(k, n
+0002a9d0: 616d 6529 5b31 5d0a 2020 2020 2020 2020  ame)[1].        
+0002a9e0: 666f 7220 6669 6e69 7368 6669 6c65 2069  for finishfile i
+0002a9f0: 6e20 6669 6e69 7368 6669 6c65 733a 0a20  n finishfiles:. 
+0002aa00: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0002aa10: 696e 7374 616e 6365 2866 696e 6973 6866  instance(finishf
+0002aa20: 696c 652c 2073 7472 293a 0a20 2020 2020  ile, str):.     
+0002aa30: 2020 2020 2020 2020 2020 2064 6573 7469             desti
+0002aa40: 6e61 7469 6f6e 203d 2027 2e27 0a20 2020  nation = '.'.   
+0002aa50: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
+0002aa60: 7263 6520 3d20 6669 6e69 7368 6669 6c65  rce = finishfile
+0002aa70: 2069 6620 272f 2720 696e 2066 696e 6973   if '/' in finis
+0002aa80: 6866 696c 6520 656c 7365 2066 272f 726f  hfile else f'/ro
+0002aa90: 6f74 2f7b 6669 6e69 7368 6669 6c65 7d27  ot/{finishfile}'
+0002aaa0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0002aab0: 6620 6973 696e 7374 616e 6365 2866 696e  f isinstance(fin
+0002aac0: 6973 6866 696c 652c 2064 6963 7429 2061  ishfile, dict) a
+0002aad0: 6e64 2027 6f72 6967 696e 2720 696e 2066  nd 'origin' in f
+0002aae0: 696e 6973 6866 696c 6520 616e 6420 2770  inishfile and 'p
+0002aaf0: 6174 6827 2069 6e20 6669 6e69 7368 6669  ath' in finishfi
+0002ab00: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+0002ab10: 2020 2020 736f 7572 6365 2c20 6465 7374      source, dest
+0002ab20: 696e 6174 696f 6e20 3d20 6669 6e69 7368  ination = finish
+0002ab30: 6669 6c65 2e67 6574 2827 6f72 6967 696e  file.get('origin
+0002ab40: 2729 2c20 6f73 2e70 6174 682e 6578 7061  '), os.path.expa
+0002ab50: 6e64 7573 6572 2866 696e 6973 6866 696c  nduser(finishfil
+0002ab60: 652e 6765 7428 2770 6174 6827 2c20 272e  e.get('path', '.
+0002ab70: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
+0002ab80: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002ab90: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+0002aba0: 496e 636f 7272 6563 7420 6669 6e69 7368  Incorrect finish
+0002abb0: 6669 6c65 2065 6e74 7279 207b 6669 6e69  file entry {fini
+0002abc0: 7368 6669 6c65 7d2e 2053 6b69 7070 696e  shfile}. Skippin
+0002abd0: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
+0002abe0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0002abf0: 2020 2020 2020 2020 2073 6370 636d 6420           scpcmd 
+0002ac00: 3d20 636f 6d6d 6f6e 2e73 6370 286e 616d  = common.scp(nam
+0002ac10: 652c 2069 703d 6375 7272 656e 745f 6970  e, ip=current_ip
+0002ac20: 2c20 7573 6572 3d27 726f 6f74 272c 2073  , user='root', s
+0002ac30: 6f75 7263 653d 736f 7572 6365 2c20 6465  ource=source, de
+0002ac40: 7374 696e 6174 696f 6e3d 6465 7374 696e  stination=destin
+0002ac50: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
+0002ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ac70: 2020 2020 2020 2074 756e 6e65 6c3d 636f         tunnel=co
+0002ac80: 6e66 6967 2e74 756e 6e65 6c2c 2074 756e  nfig.tunnel, tun
+0002ac90: 6e65 6c68 6f73 743d 636f 6e66 6967 2e74  nelhost=config.t
+0002aca0: 756e 6e65 6c68 6f73 742c 2074 756e 6e65  unnelhost, tunne
+0002acb0: 6c70 6f72 743d 636f 6e66 6967 2e74 756e  lport=config.tun
+0002acc0: 6e65 6c70 6f72 742c 0a20 2020 2020 2020  nelport,.       
 0002acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ad00: 2020 2020 2073 6c61 636b 6368 616e 6e65       slackchanne
-0002ad10: 6c2c 2074 6974 6c65 290a 2020 2020 2020  l, title).      
-0002ad20: 2020 2020 2020 2020 2020 2020 2020 736c                sl
-0002ad30: 6163 6b63 6d64 203d 2073 6c61 636b 636d  ackcmd = slackcm
-0002ad40: 642e 7265 706c 6163 6528 275c 6e27 2c20  d.replace('\n', 
-0002ad50: 2727 290a 2020 2020 2020 2020 2020 2020  '').            
-0002ad60: 2020 2020 2020 2020 636d 6473 2e61 7070          cmds.app
-0002ad70: 656e 6428 736c 6163 6b63 6d64 290a 2020  end(slackcmd).  
-0002ad80: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
-0002ad90: 6f74 6966 796d 6574 686f 6420 3d3d 2027  otifymethod == '
-0002ada0: 6d61 696c 273a 0a20 2020 2020 2020 2020  mail':.         
-0002adb0: 2020 2020 2020 2069 6620 6d61 696c 7365         if mailse
-0002adc0: 7276 6572 2069 7320 4e6f 6e65 3a0a 2020  rver is None:.  
-0002add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ade0: 2020 7761 726e 696e 6728 6622 4e6f 7469    warning(f"Noti
-0002adf0: 6669 6361 7469 6f6e 2072 6571 7569 7265  fication require
-0002ae00: 6420 666f 7220 7b6e 616d 657d 2062 7574  d for {name} but
-0002ae10: 206d 6973 7369 6e67 206d 6169 6c73 6572   missing mailser
-0002ae20: 7665 7222 290a 2020 2020 2020 2020 2020  ver").          
-0002ae30: 2020 2020 2020 656c 6966 206d 6169 6c66        elif mailf
-0002ae40: 726f 6d20 6973 204e 6f6e 653a 0a20 2020  rom is None:.   
-0002ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ae60: 2077 6172 6e69 6e67 2866 224e 6f74 6966   warning(f"Notif
-0002ae70: 6963 6174 696f 6e20 7265 7175 6972 6564  ication required
-0002ae80: 2066 6f72 207b 6e61 6d65 7d20 6275 7420   for {name} but 
-0002ae90: 6d69 7373 696e 6720 6d61 696c 6672 6f6d  missing mailfrom
-0002aea0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0002aeb0: 2020 2065 6c69 6620 6e6f 7420 6d61 696c     elif not mail
-0002aec0: 746f 3a0a 2020 2020 2020 2020 2020 2020  to:.            
-0002aed0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-0002aee0: 6622 4e6f 7469 6669 6361 7469 6f6e 2072  f"Notification r
-0002aef0: 6571 7569 7265 6420 666f 7220 7b6e 616d  equired for {nam
-0002af00: 657d 2062 7574 206d 6973 7369 6e67 206d  e} but missing m
-0002af10: 6169 6c74 6f22 290a 2020 2020 2020 2020  ailto").        
-0002af20: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002af30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002af40: 2020 6e6f 7720 3d20 6461 7465 7469 6d65    now = datetime
-0002af50: 2e6e 6f77 2829 0a20 2020 2020 2020 2020  .now().         
-0002af60: 2020 2020 2020 2020 2020 206e 6f77 203d             now =
-0002af70: 206e 6f77 2e20 7374 7266 7469 6d65 2822   now. strftime("
-0002af80: 2561 2c25 6420 2562 2025 5920 2548 3a25  %a,%d %b %Y %H:%
-0002af90: 4d3a 2553 2229 0a20 2020 2020 2020 2020  M:%S").         
-0002afa0: 2020 2020 2020 2020 2020 2074 6f73 203d             tos =
-0002afb0: 2027 2c27 2e6a 6f69 6e28 5b66 223c 7b74   ','.join([f"<{t
-0002afc0: 6f7d 3e22 2066 6f72 2074 6f20 696e 206d  o}>" for to in m
-0002afd0: 6169 6c74 6f5d 290a 2020 2020 2020 2020  ailto]).        
-0002afe0: 2020 2020 2020 2020 2020 2020 6d61 696c              mail
-0002aff0: 636f 6e74 656e 7420 3d20 6622 4672 6f6d  content = f"From
-0002b000: 3a20 7b6d 6169 6c66 726f 6d7d 203c 7b6d  : {mailfrom} <{m
-0002b010: 6169 6c66 726f 6d7d 3e5c 6e54 6f3a 207b  ailfrom}>\nTo: {
-0002b020: 746f 737d 5c6e 4461 7465 3a20 7b6e 6f77  tos}\nDate: {now
-0002b030: 7d5c 6e53 7562 6a65 6374 3a20 7b74 6974  }\nSubject: {tit
-0002b040: 6c65 7d22 0a20 2020 2020 2020 2020 2020  le}".           
-0002b050: 2020 2020 2020 2020 206d 6169 6c63 6d64           mailcmd
-0002b060: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0002b070: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0002b080: 2063 6c75 7374 6572 3a0a 2020 2020 2020   cluster:.      
-0002b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b0a0: 2020 6d61 696c 636d 642e 6170 7065 6e64    mailcmd.append
-0002b0b0: 2827 7465 7374 202d 6620 2f65 7463 2f64  ('test -f /etc/d
-0002b0c0: 6562 6961 6e5f 7665 7273 696f 6e20 2626  ebian_version &&
-0002b0d0: 2061 7074 2d67 6574 202d 7920 696e 7374   apt-get -y inst
-0002b0e0: 616c 6c20 6375 726c 2729 0a20 2020 2020  all curl').     
-0002b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b100: 2020 206d 6169 6c63 6d64 2e61 7070 656e     mailcmd.appen
-0002b110: 6428 2765 6368 6f20 2222 203e 3e20 2f76  d('echo "" >> /v
-0002b120: 6172 2f74 6d70 2f6d 6169 6c2e 7478 7427  ar/tmp/mail.txt'
-0002b130: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002b140: 2020 2020 2020 6d61 696c 636d 642e 6170        mailcmd.ap
-0002b150: 7065 6e64 2866 277b 6e6f 7469 6679 636d  pend(f'{notifycm
-0002b160: 647d 2032 3e26 3120 3e3e 202f 7661 722f  d} 2>&1 >> /var/
-0002b170: 746d 702f 6d61 696c 2e74 7874 2729 0a20  tmp/mail.txt'). 
+0002ace0: 2020 2020 2020 2020 2074 756e 6e65 6c75           tunnelu
+0002acf0: 7365 723d 7365 6c66 2e74 756e 6e65 6c75  ser=self.tunnelu
+0002ad00: 7365 722c 2064 6f77 6e6c 6f61 643d 5472  ser, download=Tr
+0002ad10: 7565 2c20 696e 7365 6375 7265 3d54 7275  ue, insecure=Tru
+0002ad20: 652c 2069 6465 6e74 6974 7966 696c 653d  e, identityfile=
+0002ad30: 6964 656e 7469 7479 6669 6c65 290a 2020  identityfile).  
+0002ad40: 2020 2020 2020 2020 2020 6f73 2e73 7973            os.sys
+0002ad50: 7465 6d28 7363 7063 6d64 290a 0a20 2020  tem(scpcmd)..   
+0002ad60: 2064 6566 2068 616e 646c 655f 6e6f 7469   def handle_noti
+0002ad70: 6669 6361 7469 6f6e 7328 7365 6c66 2c20  fications(self, 
+0002ad80: 6e61 6d65 2c20 6e6f 7469 6679 6d65 7468  name, notifymeth
+0002ad90: 6f64 733d 5b5d 2c20 7075 7368 6275 6c6c  ods=[], pushbull
+0002ada0: 6574 746f 6b65 6e3d 4e6f 6e65 2c20 6e6f  ettoken=None, no
+0002adb0: 7469 6679 7363 7269 7074 3d4e 6f6e 652c  tifyscript=None,
+0002adc0: 206e 6f74 6966 7963 6d64 3d4e 6f6e 652c   notifycmd=None,
+0002add0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ade0: 2020 2020 2020 2020 2020 2020 2020 736c                sl
+0002adf0: 6163 6b63 6861 6e6e 656c 3d4e 6f6e 652c  ackchannel=None,
+0002ae00: 2073 6c61 636b 746f 6b65 6e3d 4e6f 6e65   slacktoken=None
+0002ae10: 2c20 6d61 696c 7365 7276 6572 3d4e 6f6e  , mailserver=Non
+0002ae20: 652c 206d 6169 6c66 726f 6d3d 4e6f 6e65  e, mailfrom=None
+0002ae30: 2c20 6d61 696c 746f 3d4e 6f6e 652c 0a20  , mailto=None,. 
+0002ae40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ae50: 2020 2020 2020 2020 2020 2020 636c 7573              clus
+0002ae60: 7465 723d 4661 6c73 6529 3a0a 2020 2020  ter=False):.    
+0002ae70: 2020 2020 5f74 7970 6520 3d20 2743 6c75      _type = 'Clu
+0002ae80: 7374 6572 2720 6966 2063 6c75 7374 6572  ster' if cluster
+0002ae90: 2065 6c73 6520 2756 6d27 0a20 2020 2020   else 'Vm'.     
+0002aea0: 2020 2074 6974 6c65 203d 2066 227b 5f74     title = f"{_t
+0002aeb0: 7970 657d 207b 6e61 6d65 7d20 6f6e 207b  ype} {name} on {
+0002aec0: 7365 6c66 2e63 6c69 656e 747d 2072 6570  self.client} rep
+0002aed0: 6f72 7422 0a20 2020 2020 2020 2063 6d64  ort".        cmd
+0002aee0: 732c 206d 6169 6c63 6f6e 7465 6e74 203d  s, mailcontent =
+0002aef0: 205b 5d2c 204e 6f6e 650a 2020 2020 2020   [], None.      
+0002af00: 2020 666f 7220 6e6f 7469 6679 6d65 7468    for notifymeth
+0002af10: 6f64 2069 6e20 736f 7274 6564 286e 6f74  od in sorted(not
+0002af20: 6966 796d 6574 686f 6473 2c20 7265 7665  ifymethods, reve
+0002af30: 7273 653d 5472 7565 293a 0a20 2020 2020  rse=True):.     
+0002af40: 2020 2020 2020 2069 6620 6e6f 7469 6679         if notify
+0002af50: 6d65 7468 6f64 203d 3d20 2770 7573 6862  method == 'pushb
+0002af60: 756c 6c65 7427 3a0a 2020 2020 2020 2020  ullet':.        
+0002af70: 2020 2020 2020 2020 6966 2070 7573 6862          if pushb
+0002af80: 756c 6c65 7474 6f6b 656e 2069 7320 4e6f  ullettoken is No
+0002af90: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0002afa0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+0002afb0: 6622 4e6f 7469 6669 6361 7469 6f6e 2072  f"Notification r
+0002afc0: 6571 7569 7265 6420 666f 7220 7b6e 616d  equired for {nam
+0002afd0: 657d 2062 7574 206d 6973 7369 6e67 2070  e} but missing p
+0002afe0: 7573 6862 756c 6c65 7474 6f6b 656e 2229  ushbullettoken")
+0002aff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b000: 2065 6c69 6620 6e6f 7469 6679 7363 7269   elif notifyscri
+0002b010: 7074 2069 7320 4e6f 6e65 2061 6e64 206e  pt is None and n
+0002b020: 6f74 6966 7963 6d64 2069 7320 4e6f 6e65  otifycmd is None
+0002b030: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002b040: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0002b050: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002b060: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002b070: 2020 2020 2020 2020 2074 6f6b 656e 203d           token =
+0002b080: 2070 7573 6862 756c 6c65 7474 6f6b 656e   pushbullettoken
+0002b090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b0a0: 2020 2020 2070 6263 6d64 203d 2027 6375       pbcmd = 'cu
+0002b0b0: 726c 202d 7375 2022 2573 3a22 202d 6420  rl -su "%s:" -d 
+0002b0c0: 7479 7065 3d22 6e6f 7465 2220 2d64 2062  type="note" -d b
+0002b0d0: 6f64 793d 2260 2573 2032 3e26 3160 2220  ody="`%s 2>&1`" 
+0002b0e0: 2d64 2074 6974 6c65 3d22 2573 2220 2720  -d title="%s" ' 
+0002b0f0: 2520 2874 6f6b 656e 2c0a 2020 2020 2020  % (token,.      
+0002b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b150: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
+0002b160: 6679 636d 642c 0a20 2020 2020 2020 2020  fycmd,.         
+0002b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b190: 2020 2063 7572 6c63 6d64 203d 2066 2263     curlcmd = f"c
-0002b1a0: 7572 6c20 2d2d 7369 6c65 6e74 202d 2d75  url --silent --u
-0002b1b0: 726c 2073 6d74 703a 2f2f 7b6d 6169 6c73  rl smtp://{mails
-0002b1c0: 6572 7665 727d 3a32 3520 2d2d 6d61 696c  erver}:25 --mail
-0002b1d0: 2d66 726f 6d20 7b6d 6169 6c66 726f 6d7d  -from {mailfrom}
-0002b1e0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002b1f0: 2020 2020 2020 666f 7220 6164 6472 6573        for addres
-0002b200: 7320 696e 206d 6169 6c74 6f3a 0a20 2020  s in mailto:.   
-0002b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b220: 2020 2020 2063 7572 6c63 6d64 202b 3d20       curlcmd += 
-0002b230: 6622 202d 2d6d 6169 6c2d 7263 7074 207b  f" --mail-rcpt {
-0002b240: 6164 6472 6573 737d 2022 0a20 2020 2020  address} ".     
-0002b250: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002b260: 6620 636c 7573 7465 723a 0a20 2020 2020  f cluster:.     
-0002b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b280: 2020 206d 6169 6c63 6f6e 7465 6e74 203d     mailcontent =
-0002b290: 2022 220a 2020 2020 2020 2020 2020 2020   "".            
-0002b2a0: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
-0002b2b0: 636f 6e66 6967 203d 2066 272f 6574 632f  config = f'/etc/
-0002b2c0: 6b75 6265 726e 6574 6573 2f6b 7562 6563  kubernetes/kubec
-0002b2d0: 6f6e 6669 672e 7b6e 616d 657d 270a 2020  onfig.{name}'.  
-0002b2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b2f0: 2020 2020 2020 6375 726c 636d 6420 2b3d        curlcmd +=
-0002b300: 2066 2720 2d48 2022 5375 626a 6563 743a   f' -H "Subject:
-0002b310: 207b 7469 746c 657d 2220 2d48 2022 4672   {title}" -H "Fr
-0002b320: 6f6d 3a20 7b6d 6169 6c66 726f 6d7d 203c  om: {mailfrom} <
-0002b330: 7b6d 6169 6c66 726f 6d7d 3e22 270a 2020  {mailfrom}>"'.  
-0002b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b350: 2020 2020 2020 666f 7220 6164 6472 6573        for addres
-0002b360: 7320 696e 206d 6169 6c74 6f3a 0a20 2020  s in mailto:.   
-0002b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b380: 2020 2020 2020 2020 2063 7572 6c63 6d64           curlcmd
-0002b390: 202b 3d20 6627 202d 4820 2254 6f3a 207b   += f' -H "To: {
-0002b3a0: 6164 6472 6573 737d 203c 7b61 6464 7265  address} <{addre
-0002b3b0: 7373 7d3e 2227 0a20 2020 2020 2020 2020  ss}>"'.         
-0002b3c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002b3d0: 7572 6c63 6d64 202b 3d20 2720 2d46 2022  urlcmd += ' -F "
-0002b3e0: 3d28 3b74 7970 653d 6d75 6c74 6970 6172  =(;type=multipar
-0002b3f0: 742f 6d69 7865 6422 202d 4620 223d 2428  t/mixed" -F "=$(
-0002b400: 6361 7420 2f76 6172 2f74 6d70 2f6d 6169  cat /var/tmp/mai
-0002b410: 6c2e 7478 7429 3b74 7970 653d 7465 7874  l.txt);type=text
-0002b420: 2f70 6c61 696e 2227 0a20 2020 2020 2020  /plain"'.       
-0002b430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b440: 2063 7572 6c63 6d64 202b 3d20 6627 202d   curlcmd += f' -
-0002b450: 4620 2266 696c 653d 407b 6b75 6265 636f  F "file=@{kubeco
-0002b460: 6e66 6967 7d3b 7479 7065 3d74 6578 742f  nfig};type=text/
-0002b470: 706c 6169 6e3b 656e 636f 6465 723d 6261  plain;encoder=ba
-0002b480: 7365 3634 2220 2d46 2022 3d29 2227 0a20  se64" -F "=)"'. 
-0002b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b4a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002b4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b4c0: 2063 7572 6c63 6d64 202b 3d20 2220 2d2d   curlcmd += " --
-0002b4d0: 7570 6c6f 6164 2d66 696c 6520 2f76 6172  upload-file /var
-0002b4e0: 2f74 6d70 2f6d 6169 6c2e 7478 7422 0a20  /tmp/mail.txt". 
-0002b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b500: 2020 206d 6169 6c63 6d64 2e61 7070 656e     mailcmd.appen
-0002b510: 6428 6375 726c 636d 6429 0a20 2020 2020  d(curlcmd).     
-0002b520: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002b530: 6d64 732e 6578 7465 6e64 286d 6169 6c63  mds.extend(mailc
-0002b540: 6d64 290a 2020 2020 2020 2020 2020 2020  md).            
-0002b550: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0002b560: 2020 2020 2020 6572 726f 7228 6622 496e        error(f"In
-0002b570: 7661 6c69 6420 6d65 7468 6f64 207b 6e6f  valid method {no
-0002b580: 7469 6679 6d65 7468 6f64 7d22 290a 2020  tifymethod}").  
-0002b590: 2020 2020 2020 7265 7475 726e 2063 6d64        return cmd
-0002b5a0: 732c 206d 6169 6c63 6f6e 7465 6e74 0a0a  s, mailcontent..
-0002b5b0: 2020 2020 6465 6620 6861 6e64 6c65 5f76      def handle_v
-0002b5c0: 6d5f 7265 7375 6c74 2873 656c 662c 206e  m_result(self, n
-0002b5d0: 616d 652c 2070 726f 6669 6c65 2c20 7265  ame, profile, re
-0002b5e0: 7375 6c74 2c20 6e65 7776 6d73 2c20 6661  sult, newvms, fa
-0002b5f0: 696c 6564 766d 732c 2061 7379 6e63 7761  iledvms, asyncwa
-0002b600: 6974 766d 732c 206f 6e6c 7961 7373 6574  itvms, onlyasset
-0002b610: 733d 4661 6c73 652c 206e 6577 6173 7365  s=False, newasse
-0002b620: 7473 3d5b 5d2c 0a20 2020 2020 2020 2020  ts=[],.         
-0002b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b640: 766d 636c 6965 6e74 3d4e 6f6e 6529 3a0a  vmclient=None):.
-0002b650: 2020 2020 2020 2020 6966 2027 7265 7375          if 'resu
-0002b660: 6c74 2720 696e 2072 6573 756c 7420 616e  lt' in result an
-0002b670: 6420 7265 7375 6c74 5b27 7265 7375 6c74  d result['result
-0002b680: 275d 203d 3d20 2773 7563 6365 7373 273a  '] == 'success':
-0002b690: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-0002b6a0: 766d 732e 6170 7065 6e64 286e 616d 6529  vms.append(name)
-0002b6b0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0002b6c0: 2020 2020 2020 2020 2020 2066 6169 6c65             faile
-0002b6d0: 6476 6d73 2e61 7070 656e 6428 7b27 6e61  dvms.append({'na
-0002b6e0: 6d65 273a 206e 616d 652c 2027 7265 6173  me': name, 'reas
-0002b6f0: 6f6e 273a 2072 6573 756c 745b 2772 6561  on': result['rea
-0002b700: 736f 6e27 5d7d 290a 2020 2020 2020 2020  son']}).        
-0002b710: 7374 6172 7420 3d20 7072 6f66 696c 652e  start = profile.
-0002b720: 6765 7428 2773 7461 7274 272c 2054 7275  get('start', Tru
-0002b730: 6529 0a20 2020 2020 2020 2063 6c6f 7564  e).        cloud
-0002b740: 696e 6974 203d 2070 726f 6669 6c65 2e67  init = profile.g
-0002b750: 6574 2827 636c 6f75 6469 6e69 7427 2c20  et('cloudinit', 
-0002b760: 5472 7565 290a 2020 2020 2020 2020 6173  True).        as
-0002b770: 796e 6377 6169 7420 3d20 7072 6f66 696c  yncwait = profil
-0002b780: 652e 6765 7428 2761 7379 6e63 7761 6974  e.get('asyncwait
-0002b790: 272c 2046 616c 7365 290a 2020 2020 2020  ', False).      
-0002b7a0: 2020 6669 6e69 7368 6669 6c65 7320 3d20    finishfiles = 
-0002b7b0: 7072 6f66 696c 652e 6765 7428 2766 696e  profile.get('fin
-0002b7c0: 6973 6866 696c 6573 272c 205b 5d29 0a20  ishfiles', []). 
-0002b7d0: 2020 2020 2020 2069 6620 6f6e 6c79 6173         if onlyas
-0002b7e0: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
-0002b7f0: 2020 6966 2027 6461 7461 2720 696e 2072    if 'data' in r
-0002b800: 6573 756c 743a 0a20 2020 2020 2020 2020  esult:.         
-0002b810: 2020 2020 2020 206e 6577 6173 7365 7473         newassets
-0002b820: 2e61 7070 656e 6428 7265 7375 6c74 5b27  .append(result['
-0002b830: 6461 7461 275d 290a 2020 2020 2020 2020  data']).        
-0002b840: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002b850: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-0002b860: 7265 7375 6c74 5b27 7265 6173 6f6e 275d  result['reason']
-0002b870: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-0002b880: 2061 7379 6e63 7761 6974 3a0a 2020 2020   asyncwait:.    
-0002b890: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-0002b8a0: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-0002b8b0: 7374 6172 7420 6f72 206e 6f74 2063 6c6f  start or not clo
-0002b8c0: 7564 696e 6974 206f 7220 7072 6f66 696c  udinit or profil
-0002b8d0: 652e 6765 7428 2769 6d61 6765 2729 2069  e.get('image') i
-0002b8e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0002b8f0: 2020 2020 7070 7269 6e74 2866 2253 6b69      pprint(f"Ski
-0002b900: 7070 696e 6720 7761 6974 206f 6e20 7b6e  pping wait on {n
-0002b910: 616d 657d 2229 0a20 2020 2020 2020 2065  ame}").        e
-0002b920: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002b930: 2077 6169 7463 6f6d 6d61 6e64 203d 2070   waitcommand = p
-0002b940: 726f 6669 6c65 2e67 6574 2827 7761 6974  rofile.get('wait
-0002b950: 636f 6d6d 616e 6427 290a 2020 2020 2020  command').      
-0002b960: 2020 2020 2020 7761 6974 7469 6d65 6f75        waittimeou
-0002b970: 7420 3d20 7072 6f66 696c 652e 6765 7428  t = profile.get(
-0002b980: 2777 6169 7474 696d 656f 7574 272c 2030  'waittimeout', 0
-0002b990: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-0002b9a0: 796e 6377 6169 7476 6d20 3d20 7b27 6e61  yncwaitvm = {'na
-0002b9b0: 6d65 273a 206e 616d 652c 2027 6669 6e69  me': name, 'fini
-0002b9c0: 7368 6669 6c65 7327 3a20 6669 6e69 7368  shfiles': finish
-0002b9d0: 6669 6c65 732c 2027 7761 6974 636f 6d6d  files, 'waitcomm
-0002b9e0: 616e 6427 3a20 7761 6974 636f 6d6d 616e  and': waitcomman
-0002b9f0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-0002ba00: 2020 2020 2020 2020 2020 2020 2020 2777                'w
-0002ba10: 6169 7474 696d 656f 7574 273a 2077 6169  aittimeout': wai
-0002ba20: 7474 696d 656f 7574 2c20 2776 6d63 6c69  ttimeout, 'vmcli
-0002ba30: 656e 7427 3a20 766d 636c 6965 6e74 7d0a  ent': vmclient}.
-0002ba40: 2020 2020 2020 2020 2020 2020 6173 796e              asyn
-0002ba50: 6377 6169 7476 6d73 2e61 7070 656e 6428  cwaitvms.append(
-0002ba60: 6173 796e 6377 6169 7476 6d29 0a0a 2020  asyncwaitvm)..  
-0002ba70: 2020 6465 6620 7468 7265 6164 6564 5f63    def threaded_c
-0002ba80: 7265 6174 655f 766d 2873 656c 662c 206e  reate_vm(self, n
-0002ba90: 616d 652c 2070 726f 6669 6c65 6e61 6d65  ame, profilename
-0002baa0: 2c20 6375 7272 656e 746f 7665 7272 6964  , currentoverrid
-0002bab0: 6573 2c20 7072 6f66 696c 652c 207a 2c20  es, profile, z, 
-0002bac0: 706c 616e 2c20 6375 7272 656e 7470 6c61  plan, currentpla
-0002bad0: 6e64 6972 2c20 766d 636c 6965 6e74 2c0a  ndir, vmclient,.
+0002b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b1c0: 2020 2020 2020 2020 2074 6974 6c65 290a           title).
+0002b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b1e0: 2020 2020 7062 636d 6420 2b3d 2027 6874      pbcmd += 'ht
+0002b1f0: 7470 733a 2f2f 6170 692e 7075 7368 6275  tps://api.pushbu
+0002b200: 6c6c 6574 2e63 6f6d 2f76 322f 7075 7368  llet.com/v2/push
+0002b210: 6573 270a 2020 2020 2020 2020 2020 2020  es'.            
+0002b220: 2020 2020 2020 2020 636d 6473 2e61 7070          cmds.app
+0002b230: 656e 6428 7062 636d 6429 0a20 2020 2020  end(pbcmd).     
+0002b240: 2020 2020 2020 2065 6c69 6620 6e6f 7469         elif noti
+0002b250: 6679 6d65 7468 6f64 203d 3d20 2773 6c61  fymethod == 'sla
+0002b260: 636b 273a 0a20 2020 2020 2020 2020 2020  ck':.           
+0002b270: 2020 2020 2069 6620 736c 6163 6b63 6861       if slackcha
+0002b280: 6e6e 656c 2069 7320 4e6f 6e65 3a0a 2020  nnel is None:.  
+0002b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b2a0: 2020 7761 726e 696e 6728 6622 4e6f 7469    warning(f"Noti
+0002b2b0: 6669 6361 7469 6f6e 2072 6571 7569 7265  fication require
+0002b2c0: 6420 666f 7220 7b6e 616d 657d 2062 7574  d for {name} but
+0002b2d0: 206d 6973 7369 6e67 2073 6c61 636b 2063   missing slack c
+0002b2e0: 6861 6e6e 656c 2229 0a20 2020 2020 2020  hannel").       
+0002b2f0: 2020 2020 2020 2020 2065 6c69 6620 736c           elif sl
+0002b300: 6163 6b74 6f6b 656e 2069 7320 4e6f 6e65  acktoken is None
+0002b310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002b320: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+0002b330: 4e6f 7469 6669 6361 7469 6f6e 2072 6571  Notification req
+0002b340: 7569 7265 6420 666f 7220 7b6e 616d 657d  uired for {name}
+0002b350: 2062 7574 206d 6973 7369 6e67 2073 6c61   but missing sla
+0002b360: 636b 746f 6b65 6e22 290a 2020 2020 2020  cktoken").      
+0002b370: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0002b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b390: 2020 2020 736c 6163 6b63 6d64 203d 2066      slackcmd = f
+0002b3a0: 2269 6e66 6f3d 607b 6e6f 7469 6679 636d  "info=`{notifycm
+0002b3b0: 647d 2032 3e26 3120 7c20 7365 6420 2773  d} 2>&1 | sed 's
+0002b3c0: 2f5c 5c78 322f 202f 6727 603b 220a 2020  /\\x2/ /g'`;".  
+0002b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b3e0: 2020 736c 6163 6b63 6d64 202b 3d20 2222    slackcmd += ""
+0002b3f0: 2263 7572 6c20 2d58 2050 4f53 5420 2d48  "curl -X POST -H
+0002b400: 2027 4175 7468 6f72 697a 6174 696f 6e3a   'Authorization:
+0002b410: 2042 6561 7265 7220 2573 270a 202d 4820   Bearer %s'. -H 
+0002b420: 2743 6f6e 7465 6e74 2d74 7970 653a 2061  'Content-type: a
+0002b430: 7070 6c69 6361 7469 6f6e 2f6a 736f 6e3b  pplication/json;
+0002b440: 2063 6861 7273 6574 3d75 7466 2d38 270a   charset=utf-8'.
+0002b450: 202d 2d64 6174 6120 277b 2263 6861 6e6e   --data '{"chann
+0002b460: 656c 223a 2225 7322 2c22 7465 7874 223a  el":"%s","text":
+0002b470: 2225 7322 2c22 6174 7461 6368 6d65 6e74  "%s","attachment
+0002b480: 7322 3a20 5b7b 2274 6578 7422 3a22 2722  s": [{"text":"'"
+0002b490: 2469 6e66 6f22 2722 2c22 6661 6c6c 6261  $info"'","fallba
+0002b4a0: 636b 223a 226e 6f74 6869 6e67 222c 0a22  ck":"nothing",."
+0002b4b0: 636f 6c6f 7222 3a22 2333 4141 3345 3322  color":"#3AA3E3"
+0002b4c0: 2c22 6174 7461 6368 6d65 6e74 5f74 7970  ,"attachment_typ
+0002b4d0: 6522 3a22 6465 6661 756c 7422 7d5d 7d27  e":"default"}]}'
+0002b4e0: 2068 7474 7073 3a2f 2f73 6c61 636b 2e63   https://slack.c
+0002b4f0: 6f6d 2f61 7069 2f63 6861 742e 706f 7374  om/api/chat.post
+0002b500: 4d65 7373 6167 6522 2222 2025 2028 736c  Message""" % (sl
+0002b510: 6163 6b74 6f6b 656e 2c0a 2020 2020 2020  acktoken,.      
+0002b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b570: 2020 2020 2020 2020 2073 6c61 636b 6368           slackch
+0002b580: 616e 6e65 6c2c 2074 6974 6c65 290a 2020  annel, title).  
+0002b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b5a0: 2020 736c 6163 6b63 6d64 203d 2073 6c61    slackcmd = sla
+0002b5b0: 636b 636d 642e 7265 706c 6163 6528 275c  ckcmd.replace('\
+0002b5c0: 6e27 2c20 2727 290a 2020 2020 2020 2020  n', '').        
+0002b5d0: 2020 2020 2020 2020 2020 2020 636d 6473              cmds
+0002b5e0: 2e61 7070 656e 6428 736c 6163 6b63 6d64  .append(slackcmd
+0002b5f0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0002b600: 6966 206e 6f74 6966 796d 6574 686f 6420  if notifymethod 
+0002b610: 3d3d 2027 6d61 696c 273a 0a20 2020 2020  == 'mail':.     
+0002b620: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
+0002b630: 696c 7365 7276 6572 2069 7320 4e6f 6e65  ilserver is None
+0002b640: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002b650: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+0002b660: 4e6f 7469 6669 6361 7469 6f6e 2072 6571  Notification req
+0002b670: 7569 7265 6420 666f 7220 7b6e 616d 657d  uired for {name}
+0002b680: 2062 7574 206d 6973 7369 6e67 206d 6169   but missing mai
+0002b690: 6c73 6572 7665 7222 290a 2020 2020 2020  lserver").      
+0002b6a0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+0002b6b0: 6169 6c66 726f 6d20 6973 204e 6f6e 653a  ailfrom is None:
+0002b6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b6d0: 2020 2020 2077 6172 6e69 6e67 2866 224e       warning(f"N
+0002b6e0: 6f74 6966 6963 6174 696f 6e20 7265 7175  otification requ
+0002b6f0: 6972 6564 2066 6f72 207b 6e61 6d65 7d20  ired for {name} 
+0002b700: 6275 7420 6d69 7373 696e 6720 6d61 696c  but missing mail
+0002b710: 6672 6f6d 2229 0a20 2020 2020 2020 2020  from").         
+0002b720: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
+0002b730: 6d61 696c 746f 3a0a 2020 2020 2020 2020  mailto:.        
+0002b740: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+0002b750: 696e 6728 6622 4e6f 7469 6669 6361 7469  ing(f"Notificati
+0002b760: 6f6e 2072 6571 7569 7265 6420 666f 7220  on required for 
+0002b770: 7b6e 616d 657d 2062 7574 206d 6973 7369  {name} but missi
+0002b780: 6e67 206d 6169 6c74 6f22 290a 2020 2020  ng mailto").    
+0002b790: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0002b7a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002b7b0: 2020 2020 2020 6e6f 7720 3d20 6461 7465        now = date
+0002b7c0: 7469 6d65 2e6e 6f77 2829 0a20 2020 2020  time.now().     
+0002b7d0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0002b7e0: 6f77 203d 206e 6f77 2e20 7374 7266 7469  ow = now. strfti
+0002b7f0: 6d65 2822 2561 2c25 6420 2562 2025 5920  me("%a,%d %b %Y 
+0002b800: 2548 3a25 4d3a 2553 2229 0a20 2020 2020  %H:%M:%S").     
+0002b810: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002b820: 6f73 203d 2027 2c27 2e6a 6f69 6e28 5b66  os = ','.join([f
+0002b830: 223c 7b74 6f7d 3e22 2066 6f72 2074 6f20  "<{to}>" for to 
+0002b840: 696e 206d 6169 6c74 6f5d 290a 2020 2020  in mailto]).    
+0002b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b860: 6d61 696c 636f 6e74 656e 7420 3d20 6622  mailcontent = f"
+0002b870: 4672 6f6d 3a20 7b6d 6169 6c66 726f 6d7d  From: {mailfrom}
+0002b880: 203c 7b6d 6169 6c66 726f 6d7d 3e5c 6e54   <{mailfrom}>\nT
+0002b890: 6f3a 207b 746f 737d 5c6e 4461 7465 3a20  o: {tos}\nDate: 
+0002b8a0: 7b6e 6f77 7d5c 6e53 7562 6a65 6374 3a20  {now}\nSubject: 
+0002b8b0: 7b74 6974 6c65 7d22 0a20 2020 2020 2020  {title}".       
+0002b8c0: 2020 2020 2020 2020 2020 2020 206d 6169               mai
+0002b8d0: 6c63 6d64 203d 205b 5d0a 2020 2020 2020  lcmd = [].      
+0002b8e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002b8f0: 206e 6f74 2063 6c75 7374 6572 3a0a 2020   not cluster:.  
+0002b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b910: 2020 2020 2020 6d61 696c 636d 642e 6170        mailcmd.ap
+0002b920: 7065 6e64 2827 7465 7374 202d 6620 2f65  pend('test -f /e
+0002b930: 7463 2f64 6562 6961 6e5f 7665 7273 696f  tc/debian_versio
+0002b940: 6e20 2626 2061 7074 2d67 6574 202d 7920  n && apt-get -y 
+0002b950: 696e 7374 616c 6c20 6375 726c 2729 0a20  install curl'). 
+0002b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b970: 2020 2020 2020 206d 6169 6c63 6d64 2e61         mailcmd.a
+0002b980: 7070 656e 6428 2765 6368 6f20 2222 203e  ppend('echo "" >
+0002b990: 3e20 2f76 6172 2f74 6d70 2f6d 6169 6c2e  > /var/tmp/mail.
+0002b9a0: 7478 7427 290a 2020 2020 2020 2020 2020  txt').          
+0002b9b0: 2020 2020 2020 2020 2020 6d61 696c 636d            mailcm
+0002b9c0: 642e 6170 7065 6e64 2866 277b 6e6f 7469  d.append(f'{noti
+0002b9d0: 6679 636d 647d 2032 3e26 3120 3e3e 202f  fycmd} 2>&1 >> /
+0002b9e0: 7661 722f 746d 702f 6d61 696c 2e74 7874  var/tmp/mail.txt
+0002b9f0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0002ba00: 2020 2020 2020 2063 7572 6c63 6d64 203d         curlcmd =
+0002ba10: 2066 2263 7572 6c20 2d2d 7369 6c65 6e74   f"curl --silent
+0002ba20: 202d 2d75 726c 2073 6d74 703a 2f2f 7b6d   --url smtp://{m
+0002ba30: 6169 6c73 6572 7665 727d 3a32 3520 2d2d  ailserver}:25 --
+0002ba40: 6d61 696c 2d66 726f 6d20 7b6d 6169 6c66  mail-from {mailf
+0002ba50: 726f 6d7d 220a 2020 2020 2020 2020 2020  rom}".          
+0002ba60: 2020 2020 2020 2020 2020 666f 7220 6164            for ad
+0002ba70: 6472 6573 7320 696e 206d 6169 6c74 6f3a  dress in mailto:
+0002ba80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ba90: 2020 2020 2020 2020 2063 7572 6c63 6d64           curlcmd
+0002baa0: 202b 3d20 6622 202d 2d6d 6169 6c2d 7263   += f" --mail-rc
+0002bab0: 7074 207b 6164 6472 6573 737d 2022 0a20  pt {address} ". 
+0002bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bad0: 2020 2069 6620 636c 7573 7465 723a 0a20     if cluster:. 
 0002bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002baf0: 2020 2020 2020 2020 2020 206f 6e66 6c79             onfly
-0002bb00: 2c20 6f6e 6c79 6173 7365 7473 2c20 6e65  , onlyassets, ne
-0002bb10: 7776 6d73 2c20 6661 696c 6564 766d 732c  wvms, failedvms,
-0002bb20: 2061 7379 6e63 7761 6974 766d 732c 206e   asyncwaitvms, n
-0002bb30: 6577 6173 7365 7473 293a 0a20 2020 2020  ewassets):.     
-0002bb40: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
-0002bb50: 2e63 7265 6174 655f 766d 286e 616d 652c  .create_vm(name,
-0002bb60: 2070 726f 6669 6c65 6e61 6d65 2c20 6f76   profilename, ov
-0002bb70: 6572 7269 6465 733d 6375 7272 656e 746f  errides=currento
-0002bb80: 7665 7272 6964 6573 2c20 6375 7374 6f6d  verrides, custom
-0002bb90: 7072 6f66 696c 653d 7072 6f66 696c 652c  profile=profile,
-0002bba0: 206b 3d7a 2c0a 2020 2020 2020 2020 2020   k=z,.          
-0002bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bbc0: 2020 2020 2020 706c 616e 3d70 6c61 6e2c        plan=plan,
-0002bbd0: 2062 6173 6564 6972 3d63 7572 7265 6e74   basedir=current
-0002bbe0: 706c 616e 6469 722c 2063 6c69 656e 743d  plandir, client=
-0002bbf0: 766d 636c 6965 6e74 2c20 6f6e 666c 793d  vmclient, onfly=
-0002bc00: 6f6e 666c 792c 0a20 2020 2020 2020 2020  onfly,.         
-0002bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bc20: 2020 2020 2020 206f 6e6c 7961 7373 6574         onlyasset
-0002bc30: 733d 6f6e 6c79 6173 7365 7473 290a 2020  s=onlyassets).  
-0002bc40: 2020 2020 2020 6966 206e 6f74 206f 6e6c        if not onl
-0002bc50: 7961 7373 6574 733a 0a20 2020 2020 2020  yassets:.       
-0002bc60: 2020 2020 2063 6f6d 6d6f 6e2e 6861 6e64       common.hand
-0002bc70: 6c65 5f72 6573 706f 6e73 6528 7265 7375  le_response(resu
-0002bc80: 6c74 2c20 6e61 6d65 2c20 636c 6965 6e74  lt, name, client
-0002bc90: 3d76 6d63 6c69 656e 7429 0a20 2020 2020  =vmclient).     
-0002bca0: 2020 2073 656c 662e 6861 6e64 6c65 5f76     self.handle_v
-0002bcb0: 6d5f 7265 7375 6c74 286e 616d 652c 2070  m_result(name, p
-0002bcc0: 726f 6669 6c65 2c20 7265 7375 6c74 3d72  rofile, result=r
-0002bcd0: 6573 756c 742c 206e 6577 766d 733d 6e65  esult, newvms=ne
-0002bce0: 7776 6d73 2c20 6661 696c 6564 766d 733d  wvms, failedvms=
-0002bcf0: 6661 696c 6564 766d 732c 0a20 2020 2020  failedvms,.     
-0002bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd10: 2020 2020 2020 2020 2061 7379 6e63 7761           asyncwa
-0002bd20: 6974 766d 733d 6173 796e 6377 6169 7476  itvms=asyncwaitv
-0002bd30: 6d73 2c20 6f6e 6c79 6173 7365 7473 3d6f  ms, onlyassets=o
-0002bd40: 6e6c 7961 7373 6574 732c 206e 6577 6173  nlyassets, newas
-0002bd50: 7365 7473 3d6e 6577 6173 7365 7473 2c20  sets=newassets, 
-0002bd60: 766d 636c 6965 6e74 3d76 6d63 6c69 656e  vmclient=vmclien
-0002bd70: 7429 0a0a 2020 2020 6465 6620 7061 7273  t)..    def pars
-0002bd80: 655f 6669 6c65 7328 7365 6c66 2c20 6e61  e_files(self, na
-0002bd90: 6d65 2c20 6669 6c65 732c 2062 6173 6564  me, files, based
-0002bda0: 6972 3d27 2e27 2c20 6f6e 666c 793d 4e6f  ir='.', onfly=No
-0002bdb0: 6e65 293a 0a20 2020 2020 2020 2069 6620  ne):.        if 
-0002bdc0: 6e6f 7420 6669 6c65 733a 0a20 2020 2020  not files:.     
-0002bdd0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-0002bde0: 2020 2020 2020 666f 7220 696e 6465 782c        for index,
-0002bdf0: 2066 696c 2069 6e20 656e 756d 6572 6174   fil in enumerat
-0002be00: 6528 6669 6c65 7329 3a0a 2020 2020 2020  e(files):.      
-0002be10: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0002be20: 6e63 6528 6669 6c2c 2073 7472 293a 0a20  nce(fil, str):. 
-0002be30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0002be40: 6174 6820 3d20 6622 2f72 6f6f 742f 7b66  ath = f"/root/{f
-0002be50: 696c 7d22 0a20 2020 2020 2020 2020 2020  il}".           
-0002be60: 2020 2020 2069 6620 6261 7365 6469 7220       if basedir 
-0002be70: 213d 2027 2e27 3a0a 2020 2020 2020 2020  != '.':.        
-0002be80: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
-0002be90: 696e 203d 2066 227b 6261 7365 6469 727d  in = f"{basedir}
-0002bea0: 2f7b 7061 7468 7d22 0a20 2020 2020 2020  /{path}".       
-0002beb0: 2020 2020 2020 2020 206f 7269 6769 6e20           origin 
-0002bec0: 3d20 6669 6c0a 2020 2020 2020 2020 2020  = fil.          
-0002bed0: 2020 2020 2020 636f 6e74 656e 7420 3d20        content = 
-0002bee0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0002bef0: 2020 2020 2066 696c 6573 5b69 6e64 6578       files[index
-0002bf00: 5d20 3d20 7b27 7061 7468 273a 2070 6174  ] = {'path': pat
-0002bf10: 682c 2027 6f72 6967 696e 273a 206f 7269  h, 'origin': ori
-0002bf20: 6769 6e7d 0a20 2020 2020 2020 2020 2020  gin}.           
-0002bf30: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-0002bf40: 2866 696c 2c20 6469 6374 293a 0a20 2020  (fil, dict):.   
-0002bf50: 2020 2020 2020 2020 2020 2020 206f 7269               ori
-0002bf60: 6769 6e20 3d20 6669 6c2e 6765 7428 276f  gin = fil.get('o
-0002bf70: 7269 6769 6e27 290a 2020 2020 2020 2020  rigin').        
-0002bf80: 2020 2020 2020 2020 636f 6e74 656e 7420          content 
-0002bf90: 3d20 6669 6c2e 6765 7428 2763 6f6e 7465  = fil.get('conte
-0002bfa0: 6e74 2729 0a20 2020 2020 2020 2020 2020  nt').           
-0002bfb0: 2020 2020 2070 6174 6820 3d20 6669 6c2e       path = fil.
-0002bfc0: 6765 7428 2770 6174 6827 290a 2020 2020  get('path').    
-0002bfd0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-0002bfe0: 6174 6820 6973 204e 6f6e 653a 0a20 2020  ath is None:.   
-0002bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c000: 2069 6620 6f72 6967 696e 2069 7320 6e6f   if origin is no
-0002c010: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0002c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c030: 6669 6c65 735b 696e 6465 785d 5b27 7061  files[index]['pa
-0002c040: 7468 275d 203d 2066 222f 726f 6f74 2f7b  th'] = f"/root/{
-0002c050: 6f72 6967 696e 7d22 0a20 2020 2020 2020  origin}".       
-0002c060: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0002c070: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002c080: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-0002c090: 2866 2249 6e63 6f72 7265 6374 2065 6e74  (f"Incorrect ent
-0002c0a0: 7279 207b 6669 6c7d 2e4c 6561 7669 6e67  ry {fil}.Leaving
-0002c0b0: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-0002c0c0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0002c0d0: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
-0002c0e0: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
-0002c0f0: 6f74 2070 6174 682e 7374 6172 7473 7769  ot path.startswi
-0002c100: 7468 2827 2f27 293a 0a20 2020 2020 2020  th('/'):.       
-0002c110: 2020 2020 2020 2020 2020 2020 2065 7272               err
-0002c120: 6f72 2866 2249 6e63 6f72 7265 6374 2070  or(f"Incorrect p
-0002c130: 6174 6820 7b70 6174 687d 2e4c 6561 7669  ath {path}.Leavi
-0002c140: 6e67 2e2e 2e22 290a 2020 2020 2020 2020  ng...").        
-0002c150: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-0002c160: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-0002c170: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002c180: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002c190: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-0002c1a0: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-0002c1b0: 2022 496e 636f 7272 6563 7420 6669 6c65   "Incorrect file
-0002c1c0: 2065 6e74 7279 227d 0a20 2020 2020 2020   entry"}.       
-0002c1d0: 2020 2020 2069 6620 6f72 6967 696e 2069       if origin i
-0002c1e0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0002c1f0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-0002c200: 6e66 6c79 2069 7320 6e6f 7420 4e6f 6e65  nfly is not None
-0002c210: 2061 6e64 2027 7e27 206e 6f74 2069 6e20   and '~' not in 
-0002c220: 6f72 6967 696e 3a0a 2020 2020 2020 2020  origin:.        
-0002c230: 2020 2020 2020 2020 2020 2020 6465 7374              dest
-0002c240: 6469 7220 3d20 6261 7365 6469 720a 2020  dir = basedir.  
-0002c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c260: 2020 6966 2027 2f27 2069 6e20 6f72 6967    if '/' in orig
-0002c270: 696e 3a0a 2020 2020 2020 2020 2020 2020  in:.            
-0002c280: 2020 2020 2020 2020 2020 2020 6465 7374              dest
-0002c290: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
-0002c2a0: 726e 616d 6528 6f72 6967 696e 290a 2020  rname(origin).  
-0002c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c2c0: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
-0002c2d0: 7328 6465 7374 6469 722c 2065 7869 7374  s(destdir, exist
-0002c2e0: 5f6f 6b3d 5472 7565 290a 2020 2020 2020  _ok=True).      
-0002c2f0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0002c300: 6d6d 6f6e 2e66 6574 6368 2866 227b 6f6e  mmon.fetch(f"{on
-0002c310: 666c 797d 2f7b 6f72 6967 696e 7d22 2c20  fly}/{origin}", 
-0002c320: 6465 7374 6469 7229 0a20 2020 2020 2020  destdir).       
-0002c330: 2020 2020 2020 2020 206f 7269 6769 6e20           origin 
-0002c340: 3d20 6f73 2e70 6174 682e 6578 7061 6e64  = os.path.expand
-0002c350: 7573 6572 286f 7269 6769 6e29 0a20 2020  user(origin).   
-0002c360: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002c370: 6e6f 7420 6f73 2e70 6174 682e 6973 6162  not os.path.isab
-0002c380: 7328 6f72 6967 696e 293a 0a20 2020 2020  s(origin):.     
-0002c390: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002c3a0: 6620 6973 696e 7374 616e 6365 2866 696c  f isinstance(fil
-0002c3b0: 2c20 6469 6374 2920 616e 6420 6669 6c2e  , dict) and fil.
-0002c3c0: 6765 7428 2763 7572 7265 6e74 6469 7227  get('currentdir'
-0002c3d0: 2c20 4661 6c73 6529 3a0a 2020 2020 2020  , False):.      
-0002c3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c3f0: 2020 6f72 6967 696e 203d 2066 227b 6f73    origin = f"{os
-0002c400: 2e67 6574 6377 6428 297d 2f7b 6f72 6967  .getcwd()}/{orig
-0002c410: 696e 7d22 0a20 2020 2020 2020 2020 2020  in}".           
-0002c420: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0002c430: 6573 5b69 6e64 6578 5d5b 276f 7269 6769  es[index]['origi
-0002c440: 6e27 5d20 3d20 6f72 6967 696e 0a20 2020  n'] = origin.   
-0002c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c460: 2065 6c69 6620 6261 7365 6469 7220 213d   elif basedir !=
-0002c470: 2027 2e27 2061 6e64 206e 6f74 206f 7269   '.' and not ori
-0002c480: 6769 6e2e 7374 6172 7473 7769 7468 2827  gin.startswith('
-0002c490: 2e2f 2729 2061 6e64 206e 6f74 206f 7269  ./') and not ori
-0002c4a0: 6769 6e2e 7374 6172 7473 7769 7468 2827  gin.startswith('
-0002c4b0: 2f77 6f72 6b64 6972 2f27 293a 0a20 2020  /workdir/'):.   
-0002c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c4d0: 2020 2020 206f 7269 6769 6e20 3d20 6622       origin = f"
-0002c4e0: 7b62 6173 6564 6972 7d2f 7b6f 7269 6769  {basedir}/{origi
-0002c4f0: 6e7d 220a 2020 2020 2020 2020 2020 2020  n}".            
-0002c500: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0002c510: 735b 696e 6465 785d 5b27 6f72 6967 696e  s[index]['origin
-0002c520: 275d 203d 206f 7269 6769 6e0a 2020 2020  '] = origin.    
-0002c530: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0002c540: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-0002c550: 7328 6f72 6967 696e 293a 0a20 2020 2020  s(origin):.     
-0002c560: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0002c570: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-0002c580: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
-0002c590: 736f 6e27 3a20 6622 4f72 6967 696e 2066  son': f"Origin f
-0002c5a0: 696c 6520 7b6f 7269 6769 6e7d 206e 6f74  ile {origin} not
-0002c5b0: 2066 6f75 6e64 2066 6f72 207b 6e61 6d65   found for {name
-0002c5c0: 7d22 7d0a 2020 2020 2020 2020 2020 2020  }"}.            
-0002c5d0: 656c 6966 2063 6f6e 7465 6e74 2069 7320  elif content is 
-0002c5e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0002c5f0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-0002c600: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
-0002c610: 272c 2027 7265 6173 6f6e 273a 2066 2243  ', 'reason': f"C
-0002c620: 6f6e 7465 6e74 206f 6620 6669 6c65 207b  ontent of file {
-0002c630: 7061 7468 7d20 6e6f 7420 666f 756e 6420  path} not found 
-0002c640: 666f 7220 7b6e 616d 657d 227d 0a0a 2020  for {name}"}..  
-0002c650: 2020 6465 6620 7072 6570 656e 645f 696e    def prepend_in
-0002c660: 7075 745f 6469 7228 7365 6c66 2c20 6e65  put_dir(self, ne
-0002c670: 7766 696c 6573 2c20 696e 7075 7464 6972  wfiles, inputdir
-0002c680: 293a 0a20 2020 2020 2020 2072 6573 756c  ):.        resul
-0002c690: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
-0002c6a0: 666f 7220 6669 6320 696e 206e 6577 6669  for fic in newfi
-0002c6b0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-0002c6c0: 2069 6620 6973 696e 7374 616e 6365 2866   if isinstance(f
-0002c6d0: 6963 2c20 7374 7229 2061 6e64 206e 6f74  ic, str) and not
-0002c6e0: 206f 732e 7061 7468 2e69 7361 6273 2866   os.path.isabs(f
-0002c6f0: 6963 293a 0a20 2020 2020 2020 2020 2020  ic):.           
-0002c700: 2020 2020 206e 6577 5f66 6963 203d 2066       new_fic = f
-0002c710: 227b 696e 7075 7464 6972 7d2f 7b66 6963  "{inputdir}/{fic
-0002c720: 7d22 0a20 2020 2020 2020 2020 2020 2065  }".            e
-0002c730: 6c69 6620 6973 696e 7374 616e 6365 2866  lif isinstance(f
-0002c740: 6963 2c20 6469 6374 2920 616e 6420 276f  ic, dict) and 'o
-0002c750: 7269 6769 6e27 2069 6e20 6669 6320 616e  rigin' in fic an
-0002c760: 6420 6e6f 7420 6f73 2e70 6174 682e 6973  d not os.path.is
-0002c770: 6162 7328 6f73 2e70 6174 682e 6578 7061  abs(os.path.expa
-0002c780: 6e64 7573 6572 2866 6963 5b27 6f72 6967  nduser(fic['orig
-0002c790: 696e 275d 2929 3a0a 2020 2020 2020 2020  in'])):.        
-0002c7a0: 2020 2020 2020 2020 6e65 775f 6669 6320          new_fic 
-0002c7b0: 3d20 6669 632e 636f 7079 2829 0a20 2020  = fic.copy().   
-0002c7c0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0002c7d0: 5f66 6963 5b27 6f72 6967 696e 275d 203d  _fic['origin'] =
-0002c7e0: 2066 227b 696e 7075 7464 6972 7d2f 7b66   f"{inputdir}/{f
-0002c7f0: 6963 5b27 6f72 6967 696e 275d 7d22 0a20  ic['origin']}". 
-0002c800: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0002c810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c820: 206e 6577 5f66 6963 203d 2066 6963 0a20   new_fic = fic. 
-0002c830: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0002c840: 7473 2e61 7070 656e 6428 6e65 775f 6669  ts.append(new_fi
-0002c850: 6329 0a20 2020 2020 2020 2072 6574 7572  c).        retur
-0002c860: 6e20 7265 7375 6c74 730a 0a20 2020 2064  n results..    d
-0002c870: 6566 2072 656d 6564 6961 7465 5f66 696c  ef remediate_fil
-0002c880: 6573 2873 656c 662c 206e 616d 652c 206e  es(self, name, n
-0002c890: 6577 6669 6c65 732c 206f 7665 7272 6964  ewfiles, overrid
-0002c8a0: 6573 3d7b 7d2c 2069 6e70 7574 6469 723d  es={}, inputdir=
-0002c8b0: 272e 2729 3a0a 2020 2020 2020 2020 7570  '.'):.        up
-0002c8c0: 6461 7465 645f 6669 6c65 7320 3d20 5b5d  dated_files = []
-0002c8d0: 0a20 2020 2020 2020 2069 702c 2076 6d70  .        ip, vmp
-0002c8e0: 6f72 7420 3d20 5f73 7368 5f63 7265 6465  ort = _ssh_crede
-0002c8f0: 6e74 6961 6c73 2873 656c 662e 6b2c 206e  ntials(self.k, n
-0002c900: 616d 6529 5b31 3a5d 0a20 2020 2020 2020  ame)[1:].       
-0002c910: 2069 6620 696e 7075 7464 6972 2021 3d20   if inputdir != 
-0002c920: 272e 273a 0a20 2020 2020 2020 2020 2020  '.':.           
-0002c930: 206e 6577 6669 6c65 7320 3d20 7365 6c66   newfiles = self
-0002c940: 2e70 7265 7065 6e64 5f69 6e70 7574 5f64  .prepend_input_d
-0002c950: 6972 286e 6577 6669 6c65 732c 2069 6e70  ir(newfiles, inp
-0002c960: 7574 6469 7229 0a20 2020 2020 2020 2073  utdir).        s
-0002c970: 656c 662e 7061 7273 655f 6669 6c65 7328  elf.parse_files(
-0002c980: 6e61 6d65 2c20 6e65 7766 696c 6573 290a  name, newfiles).
-0002c990: 2020 2020 2020 2020 6f76 6572 7269 6465          override
-0002c9a0: 735f 6669 6c65 7320 3d20 6f76 6572 7269  s_files = overri
-0002c9b0: 6465 732e 636f 7079 2829 0a20 2020 2020  des.copy().     
-0002c9c0: 2020 206f 7665 7272 6964 6573 5f66 696c     overrides_fil
-0002c9d0: 6573 5b27 6e61 6d65 275d 203d 206e 616d  es['name'] = nam
-0002c9e0: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
-0002c9f0: 2070 726f 6365 7373 5f66 696c 6573 2866   process_files(f
-0002ca00: 696c 6573 3d6e 6577 6669 6c65 732c 206f  iles=newfiles, o
-0002ca10: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-0002ca20: 6573 5f66 696c 6573 2c20 7265 6d65 6469  es_files, remedi
-0002ca30: 6174 653d 5472 7565 290a 2020 2020 2020  ate=True).      
-0002ca40: 2020 6461 7461 6469 7273 203d 207b 7d0a    datadirs = {}.
-0002ca50: 2020 2020 2020 2020 7769 7468 2054 656d          with Tem
-0002ca60: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
-0002ca70: 2920 6173 2074 6d70 6469 723a 0a20 2020  ) as tmpdir:.   
-0002ca80: 2020 2020 2020 2020 2066 6f72 2069 6e64           for ind
-0002ca90: 6578 2c20 656e 7472 7920 696e 2065 6e75  ex, entry in enu
-0002caa0: 6d65 7261 7465 2864 6174 6129 3a0a 2020  merate(data):.  
-0002cab0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0002cac0: 7374 696e 6174 696f 6e20 3d20 656e 7472  stination = entr
-0002cad0: 795b 2770 6174 6827 5d0a 2020 2020 2020  y['path'].      
-0002cae0: 2020 2020 2020 2020 2020 7061 7468 6469            pathdi
-0002caf0: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
-0002cb00: 616d 6528 6465 7374 696e 6174 696f 6e29  ame(destination)
-0002cb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002cb20: 2069 6620 7061 7468 6469 7220 6e6f 7420   if pathdir not 
-0002cb30: 696e 2064 6174 6164 6972 733a 0a20 2020  in datadirs:.   
-0002cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cb50: 2070 6174 6864 6972 636d 6420 3d20 6627   pathdircmd = f'
-0002cb60: 6c73 202d 6120 7b70 6174 6864 6972 7d20  ls -a {pathdir} 
-0002cb70: 323e 2631 270a 2020 2020 2020 2020 2020  2>&1'.          
-0002cb80: 2020 2020 2020 2020 2020 7061 7468 6469            pathdi
-0002cb90: 7263 6d64 203d 2073 7368 286e 616d 652c  rcmd = ssh(name,
-0002cba0: 2069 703d 6970 2c20 7573 6572 3d27 726f   ip=ip, user='ro
-0002cbb0: 6f74 272c 2074 756e 6e65 6c3d 7365 6c66  ot', tunnel=self
-0002cbc0: 2e74 756e 6e65 6c2c 2074 756e 6e65 6c68  .tunnel, tunnelh
-0002cbd0: 6f73 743d 7365 6c66 2e74 756e 6e65 6c68  ost=self.tunnelh
-0002cbe0: 6f73 742c 0a20 2020 2020 2020 2020 2020  ost,.           
-0002cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cc00: 2020 2020 2020 2020 2020 7475 6e6e 656c            tunnel
-0002cc10: 706f 7274 3d73 656c 662e 7475 6e6e 656c  port=self.tunnel
-0002cc20: 706f 7274 2c20 7475 6e6e 656c 7573 6572  port, tunneluser
-0002cc30: 3d73 656c 662e 7475 6e6e 656c 7573 6572  =self.tunneluser
-0002cc40: 2c20 696e 7365 6375 7265 3d54 7275 652c  , insecure=True,
-0002cc50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002cc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cc70: 2020 2020 2020 636d 643d 7061 7468 6469        cmd=pathdi
-0002cc80: 7263 6d64 2c20 766d 706f 7274 3d76 6d70  rcmd, vmport=vmp
-0002cc90: 6f72 7429 0a20 2020 2020 2020 2020 2020  ort).           
-0002cca0: 2020 2020 2020 2020 2070 6174 6864 6972           pathdir
-0002ccb0: 6669 6c65 7320 3d20 6f73 2e70 6f70 656e  files = os.popen
-0002ccc0: 2870 6174 6864 6972 636d 6429 2e72 6561  (pathdircmd).rea
-0002ccd0: 646c 696e 6573 2829 0a20 2020 2020 2020  dlines().       
-0002cce0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002ccf0: 6c65 6e28 7061 7468 6469 7266 696c 6573  len(pathdirfiles
-0002cd00: 2920 3d3d 2031 2061 6e64 2027 4e6f 2073  ) == 1 and 'No s
-0002cd10: 7563 6820 6669 6c65 206f 7220 6469 7265  uch file or dire
-0002cd20: 6374 6f72 7927 2069 6e20 7061 7468 6469  ctory' in pathdi
-0002cd30: 7266 696c 6573 5b30 5d3a 0a20 2020 2020  rfiles[0]:.     
-0002cd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cd50: 2020 2063 7265 6174 6564 6972 636d 6420     createdircmd 
-0002cd60: 3d20 6627 6d6b 6469 7220 2d70 207b 7061  = f'mkdir -p {pa
-0002cd70: 7468 6469 727d 270a 2020 2020 2020 2020  thdir}'.        
-0002cd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cd90: 6372 6561 7465 6469 7263 6d64 203d 2073  createdircmd = s
-0002cda0: 7368 286e 616d 652c 2069 703d 6970 2c20  sh(name, ip=ip, 
-0002cdb0: 7573 6572 3d27 726f 6f74 272c 2074 756e  user='root', tun
-0002cdc0: 6e65 6c3d 7365 6c66 2e74 756e 6e65 6c2c  nel=self.tunnel,
-0002cdd0: 2074 756e 6e65 6c68 6f73 743d 7365 6c66   tunnelhost=self
-0002cde0: 2e74 756e 6e65 6c68 6f73 742c 0a20 2020  .tunnelhost,.   
-0002cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce10: 2020 2020 2020 2020 7475 6e6e 656c 706f          tunnelpo
-0002ce20: 7274 3d73 656c 662e 7475 6e6e 656c 706f  rt=self.tunnelpo
-0002ce30: 7274 2c20 7475 6e6e 656c 7573 6572 3d73  rt, tunneluser=s
-0002ce40: 656c 662e 7475 6e6e 656c 7573 6572 2c20  elf.tunneluser, 
-0002ce50: 696e 7365 6375 7265 3d54 7275 652c 0a20  insecure=True,. 
-0002ce60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce80: 2020 2020 2020 2020 2020 636d 643d 6372            cmd=cr
-0002ce90: 6561 7465 6469 7263 6d64 2c20 766d 706f  eatedircmd, vmpo
-0002cea0: 7274 3d76 6d70 6f72 7429 0a20 2020 2020  rt=vmport).     
-0002ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cec0: 2020 206f 732e 706f 7065 6e28 6372 6561     os.popen(crea
-0002ced0: 7465 6469 7263 6d64 290a 2020 2020 2020  tedircmd).      
-0002cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cef0: 2020 7061 7468 6469 7266 696c 6573 203d    pathdirfiles =
-0002cf00: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0002cf10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf30: 2020 2020 2020 7061 7468 6469 7266 696c        pathdirfil
-0002cf40: 6573 203d 205b 782e 7374 7269 7028 2920  es = [x.strip() 
-0002cf50: 666f 7220 7820 696e 2070 6174 6864 6972  for x in pathdir
-0002cf60: 6669 6c65 735d 0a20 2020 2020 2020 2020  files].         
-0002cf70: 2020 2020 2020 2020 2020 2064 6174 6164             datad
-0002cf80: 6972 735b 7061 7468 6469 725d 203d 2070  irs[pathdir] = p
-0002cf90: 6174 6864 6972 6669 6c65 730a 2020 2020  athdirfiles.    
-0002cfa0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-0002cfb0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-0002cfc0: 6465 7374 696e 6174 696f 6e29 206e 6f74  destination) not
-0002cfd0: 2069 6e20 6461 7461 6469 7273 5b70 6174   in datadirs[pat
-0002cfe0: 6864 6972 5d3a 0a20 2020 2020 2020 2020  hdir]:.         
-0002cff0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0002d000: 7428 6622 5570 6461 7469 6e67 207b 6465  t(f"Updating {de
-0002d010: 7374 696e 6174 696f 6e7d 2069 6e20 7b6e  stination} in {n
-0002d020: 616d 657d 2229 0a20 2020 2020 2020 2020  ame}").         
-0002d030: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
-0002d040: 6520 3d20 6622 7b74 6d70 6469 727d 2f66  e = f"{tmpdir}/f
-0002d050: 6963 7b69 6e64 6578 7d22 0a20 2020 2020  ic{index}".     
-0002d060: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0002d070: 6974 6820 6f70 656e 2873 6f75 7263 652c  ith open(source,
-0002d080: 2027 7727 2920 6173 2066 3a0a 2020 2020   'w') as f:.    
-0002d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d0a0: 2020 2020 662e 7772 6974 6528 656e 7472      f.write(entr
-0002d0b0: 795b 2763 6f6e 7465 6e74 275d 290a 2020  y['content']).  
-0002d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d0d0: 2020 7363 7063 6d64 203d 2073 6370 286e    scpcmd = scp(n
-0002d0e0: 616d 652c 2069 703d 6970 2c20 7573 6572  ame, ip=ip, user
-0002d0f0: 3d27 726f 6f74 272c 2073 6f75 7263 653d  ='root', source=
-0002d100: 736f 7572 6365 2c20 6465 7374 696e 6174  source, destinat
-0002d110: 696f 6e3d 6465 7374 696e 6174 696f 6e2c  ion=destination,
-0002d120: 2074 756e 6e65 6c3d 7365 6c66 2e74 756e   tunnel=self.tun
-0002d130: 6e65 6c2c 0a20 2020 2020 2020 2020 2020  nel,.           
-0002d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d150: 2020 2020 2020 7475 6e6e 656c 686f 7374        tunnelhost
-0002d160: 3d73 656c 662e 7475 6e6e 656c 686f 7374  =self.tunnelhost
-0002d170: 2c20 7475 6e6e 656c 706f 7274 3d73 656c  , tunnelport=sel
-0002d180: 662e 7475 6e6e 656c 706f 7274 2c20 7475  f.tunnelport, tu
-0002d190: 6e6e 656c 7573 6572 3d73 656c 662e 7475  nneluser=self.tu
-0002d1a0: 6e6e 656c 7573 6572 2c0a 2020 2020 2020  nneluser,.      
-0002d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d1c0: 2020 2020 2020 2020 2020 2064 6f77 6e6c             downl
-0002d1d0: 6f61 643d 4661 6c73 652c 2069 6e73 6563  oad=False, insec
-0002d1e0: 7572 653d 5472 7565 2c20 766d 706f 7274  ure=True, vmport
-0002d1f0: 3d76 6d70 6f72 7429 0a20 2020 2020 2020  =vmport).       
-0002d200: 2020 2020 2020 2020 2020 2020 206f 732e               os.
-0002d210: 7379 7374 656d 2873 6370 636d 6429 0a20  system(scpcmd). 
-0002d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d230: 2020 2075 7064 6174 6564 5f66 696c 6573     updated_files
-0002d240: 2e61 7070 656e 6428 6465 7374 696e 6174  .append(destinat
-0002d250: 696f 6e29 0a20 2020 2020 2020 2072 6574  ion).        ret
-0002d260: 7572 6e20 7570 6461 7465 645f 6669 6c65  urn updated_file
-0002d270: 730a 0a20 2020 2064 6566 2069 6e66 6f5f  s..    def info_
-0002d280: 7370 6563 6966 6963 5f70 6c61 6e28 7365  specific_plan(se
-0002d290: 6c66 2c20 706c 616e 293a 0a20 2020 2020  lf, plan):.     
-0002d2a0: 2020 2070 7072 696e 7428 6622 5072 6f76     pprint(f"Prov
-0002d2b0: 6964 696e 6720 696e 666f 726d 6174 696f  iding informatio
-0002d2c0: 6e20 6162 6f75 7420 706c 616e 207b 706c  n about plan {pl
-0002d2d0: 616e 7d22 290a 2020 2020 2020 2020 6b20  an}").        k 
-0002d2e0: 3d20 7365 6c66 2e6b 0a20 2020 2020 2020  = self.k.       
-0002d2f0: 2072 6573 756c 7473 203d 205b 5d0a 2020   results = [].  
-0002d300: 2020 2020 2020 666f 7220 766d 2069 6e20        for vm in 
-0002d310: 6b2e 6c69 7374 2829 3a0a 2020 2020 2020  k.list():.      
-0002d320: 2020 2020 2020 6966 2076 6d2e 6765 7428        if vm.get(
-0002d330: 2770 6c61 6e27 2c20 2727 2920 3d3d 2070  'plan', '') == p
-0002d340: 6c61 6e3a 0a20 2020 2020 2020 2020 2020  lan:.           
-0002d350: 2020 2020 2072 6573 756c 7473 2e61 7070       results.app
-0002d360: 656e 6428 766d 290a 2020 2020 2020 2020  end(vm).        
-0002d370: 7265 7475 726e 2072 6573 756c 7473 0a0a  return results..
-0002d380: 2020 2020 6465 6620 6175 746f 7363 616c      def autoscal
-0002d390: 655f 636c 7573 7465 7228 7365 6c66 2c20  e_cluster(self, 
-0002d3a0: 6b75 6265 2c20 6b75 6265 7479 7065 2c20  kube, kubetype, 
-0002d3b0: 776f 726b 6572 732c 2074 6872 6573 686f  workers, thresho
-0002d3c0: 6c64 2c20 6964 6c65 293a 0a20 2020 2020  ld, idle):.     
-0002d3d0: 2020 2069 6620 7468 7265 7368 6f6c 6420     if threshold 
-0002d3e0: 3e20 3939 3939 3a0a 2020 2020 2020 2020  > 9999:.        
-0002d3f0: 2020 2020 7070 7269 6e74 2866 2253 6b69      pprint(f"Ski
-0002d400: 7070 696e 6720 6175 746f 7363 616c 696e  pping autoscalin
-0002d410: 6720 7570 2063 6865 636b 7320 666f 7220  g up checks for 
-0002d420: 636c 7573 7465 7220 7b6b 7562 657d 2061  cluster {kube} a
-0002d430: 7320 7065 7220 7468 7265 7368 6f6c 6420  s per threshold 
-0002d440: 7b74 6872 6573 686f 6c64 7d22 290a 2020  {threshold}").  
-0002d450: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002d460: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
-0002d470: 6365 7373 272c 2027 776f 726b 6572 7327  cess', 'workers'
-0002d480: 3a20 776f 726b 6572 737d 0a20 2020 2020  : workers}.     
-0002d490: 2020 2069 6620 6964 6c65 203c 2031 3a0a     if idle < 1:.
-0002d4a0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-0002d4b0: 6e74 2866 2253 6b69 7070 696e 6720 6175  nt(f"Skipping au
-0002d4c0: 746f 7363 616c 696e 6720 646f 776e 2063  toscaling down c
-0002d4d0: 6865 636b 7320 666f 7220 636c 7573 7465  hecks for cluste
-0002d4e0: 7220 7b6b 7562 657d 2061 7320 7065 7220  r {kube} as per 
-0002d4f0: 6964 6c65 207b 6964 6c65 7d22 290a 2020  idle {idle}").  
-0002d500: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002d510: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
-0002d520: 6365 7373 272c 2027 776f 726b 6572 7327  cess', 'workers'
-0002d530: 3a20 776f 726b 6572 737d 0a20 2020 2020  : workers}.     
-0002d540: 2020 2070 7072 696e 7428 6622 4368 6563     pprint(f"Chec
-0002d550: 6b69 6e67 206e 6f6e 2073 6368 6564 756c  king non schedul
-0002d560: 6564 2070 6f64 7320 636f 756e 7420 6f6e  ed pods count on
-0002d570: 2063 6c75 7374 6572 207b 6b75 6265 7d22   cluster {kube}"
-0002d580: 290a 2020 2020 2020 2020 7365 6c65 6374  ).        select
-0002d590: 6f72 203d 2022 216e 6f64 652d 726f 6c65  or = "!node-role
-0002d5a0: 2e6b 7562 6572 6e65 7465 732e 696f 2f63  .kubernetes.io/c
-0002d5b0: 6f6e 7472 6f6c 2d70 6c61 6e65 2c6e 6f64  ontrol-plane,nod
-0002d5c0: 652d 726f 6c65 2e6b 7562 6572 6e65 7465  e-role.kubernete
-0002d5d0: 732e 696f 2f77 6f72 6b65 7222 0a20 2020  s.io/worker".   
-0002d5e0: 2020 2020 2063 7572 7265 6e74 636d 6420       currentcmd 
-0002d5f0: 3d20 6622 6b75 6265 6374 6c20 6765 7420  = f"kubectl get 
-0002d600: 6e6f 6465 202d 2d73 656c 6563 746f 723d  node --selector=
-0002d610: 277b 7365 6c65 6374 6f72 7d27 220a 2020  '{selector}'".  
-0002d620: 2020 2020 2020 6375 7272 656e 7463 6d64        currentcmd
-0002d630: 202b 3d20 2220 7c20 6772 6570 2027 2052   += " | grep ' R
-0002d640: 6561 6479 2722 0a20 2020 2020 2020 2077  eady'".        w
-0002d650: 6f72 6b65 7273 203d 206c 656e 286f 732e  orkers = len(os.
-0002d660: 706f 7065 6e28 6375 7272 656e 7463 6d64  popen(currentcmd
-0002d670: 292e 7265 6164 6c69 6e65 7328 2929 0a20  ).readlines()). 
-0002d680: 2020 2020 2020 2070 656e 6469 6e67 636d         pendingcm
-0002d690: 6420 3d20 226b 7562 6563 746c 2067 6574  d = "kubectl get
-0002d6a0: 2070 6f64 7320 2d41 202d 2d66 6965 6c64   pods -A --field
-0002d6b0: 2d73 656c 6563 746f 723d 7374 6174 7573  -selector=status
-0002d6c0: 2e70 6861 7365 3d50 656e 6469 6e67 202d  .phase=Pending -
-0002d6d0: 6f20 7961 6d6c 220a 2020 2020 2020 2020  o yaml".        
-0002d6e0: 7065 6e64 696e 675f 706f 6473 203d 2079  pending_pods = y
-0002d6f0: 616d 6c2e 7361 6665 5f6c 6f61 6428 6f73  aml.safe_load(os
-0002d700: 2e70 6f70 656e 2870 656e 6469 6e67 636d  .popen(pendingcm
-0002d710: 6429 2e72 6561 6428 2929 5b27 6974 656d  d).read())['item
-0002d720: 7327 5d0a 2020 2020 2020 2020 6966 206c  s'].        if l
-0002d730: 656e 2870 656e 6469 6e67 5f70 6f64 7329  en(pending_pods)
-0002d740: 203e 2074 6872 6573 686f 6c64 3a0a 2020   > threshold:.  
-0002d750: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-0002d760: 2866 2254 7269 6767 6572 696e 6720 7363  (f"Triggering sc
-0002d770: 616c 696e 6720 7570 2066 6f72 2063 6c75  aling up for clu
-0002d780: 7374 6572 207b 6b75 6265 7d20 6173 2074  ster {kube} as t
-0002d790: 6865 7265 2061 7265 207b 6c65 6e28 7065  here are {len(pe
-0002d7a0: 6e64 696e 675f 706f 6473 297d 2070 656e  nding_pods)} pen
-0002d7b0: 6469 6e67 2070 6f64 7322 290a 2020 2020  ding pods").    
-0002d7c0: 2020 2020 2020 2020 776f 726b 6572 7320          workers 
-0002d7d0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-0002d7e0: 2070 7072 696e 7428 2253 6361 6c69 6e67   pprint("Scaling
-0002d7f0: 2075 7020 636c 7573 7465 7220 7b6b 7562   up cluster {kub
-0002d800: 657d 2074 6f20 7b77 6f72 6b65 7273 7d20  e} to {workers} 
-0002d810: 776f 726b 6572 7322 290a 2020 2020 2020  workers").      
-0002d820: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
-0002d830: 656c 662e 7363 616c 655f 6b75 6265 286b  elf.scale_kube(k
-0002d840: 7562 652c 206b 7562 6574 7970 652c 206f  ube, kubetype, o
-0002d850: 7665 7272 6964 6573 3d7b 2777 6f72 6b65  verrides={'worke
-0002d860: 7273 273a 2077 6f72 6b65 7273 7d29 0a20  rs': workers}). 
-0002d870: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0002d880: 745b 2777 6f72 6b65 7273 275d 203d 2077  t['workers'] = w
-0002d890: 6f72 6b65 7273 0a20 2020 2020 2020 2020  orkers.         
-0002d8a0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-0002d8b0: 0a20 2020 2020 2020 206e 6f64 6573 203d  .        nodes =
-0002d8c0: 207b 7d0a 2020 2020 2020 2020 6375 7272   {}.        curr
-0002d8d0: 656e 7463 6d64 203d 2022 6b75 6265 6374  entcmd = "kubect
-0002d8e0: 6c20 6765 7420 706f 6420 2d41 202d 6f20  l get pod -A -o 
-0002d8f0: 7961 6d6c 220a 2020 2020 2020 2020 616c  yaml".        al
-0002d900: 6c70 6f64 7320 3d20 7961 6d6c 2e73 6166  lpods = yaml.saf
-0002d910: 655f 6c6f 6164 286f 732e 706f 7065 6e28  e_load(os.popen(
-0002d920: 6375 7272 656e 7463 6d64 292e 7265 6164  currentcmd).read
-0002d930: 2829 295b 2769 7465 6d73 275d 0a20 2020  ())['items'].   
-0002d940: 2020 2020 2066 6f72 2070 6f64 2069 6e20       for pod in 
-0002d950: 616c 6c70 6f64 733a 0a20 2020 2020 2020  allpods:.       
-0002d960: 2020 2020 206e 6f64 656e 616d 6520 3d20       nodename = 
-0002d970: 706f 645b 2773 7065 6327 5d5b 276e 6f64  pod['spec']['nod
-0002d980: 654e 616d 6527 5d0a 2020 2020 2020 2020  eName'].        
-0002d990: 2020 2020 7374 6174 7573 203d 2070 6f64      status = pod
-0002d9a0: 5b27 7374 6174 7573 275d 5b27 7068 6173  ['status']['phas
-0002d9b0: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-0002d9c0: 6966 2073 7461 7475 7320 213d 2027 5275  if status != 'Ru
-0002d9d0: 6e6e 696e 6727 3a0a 2020 2020 2020 2020  nning':.        
-0002d9e0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0002d9f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002da00: 6e6f 6465 6e61 6d65 206e 6f74 2069 6e20  nodename not in 
-0002da10: 6e6f 6465 733a 0a20 2020 2020 2020 2020  nodes:.         
-0002da20: 2020 2020 2020 206e 6f64 6573 5b6e 6f64         nodes[nod
-0002da30: 656e 616d 655d 203d 2031 0a20 2020 2020  ename] = 1.     
-0002da40: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0002da50: 2020 2020 2020 2020 2020 2020 206e 6f64               nod
-0002da60: 6573 5b6e 6f64 656e 616d 655d 202b 3d20  es[nodename] += 
-0002da70: 310a 2020 2020 2020 2020 746f 6465 6c65  1.        todele
-0002da80: 7465 203d 2030 0a20 2020 2020 2020 2066  te = 0.        f
-0002da90: 6f72 206e 6f64 6520 696e 206e 6f64 6573  or node in nodes
-0002daa0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0002dab0: 206e 6f64 6573 5b6e 6f64 655d 203c 2069   nodes[node] < i
-0002dac0: 646c 653a 0a20 2020 2020 2020 2020 2020  dle:.           
-0002dad0: 2020 2020 2070 7072 696e 7428 6622 6e6f       pprint(f"no
-0002dae0: 6465 207b 6e6f 6465 7d20 746f 2062 6520  de {node} to be 
-0002daf0: 7265 6d6f 7665 6420 7369 6e63 6520 6974  removed since it
-0002db00: 206f 6e6c 7920 6861 7320 7468 6520 666f   only has the fo
-0002db10: 6c6c 6f77 696e 6720 706f 6473 3a20 7b6e  llowing pods: {n
-0002db20: 6f64 6573 5b6e 6f64 655d 7d22 290a 2020  odes[node]}").  
-0002db30: 2020 2020 2020 2020 2020 2020 2020 746f                to
-0002db40: 6465 6c65 7465 202b 3d20 310a 2020 2020  delete += 1.    
-0002db50: 2020 2020 6966 2074 6f64 656c 6574 6520      if todelete 
-0002db60: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0002db70: 2070 7072 696e 7428 6622 5472 6967 6765   pprint(f"Trigge
-0002db80: 7269 6e67 2073 6361 6c69 6e67 2064 6f77  ring scaling dow
-0002db90: 6e20 666f 7220 636c 7573 7465 7220 7b6b  n for cluster {k
-0002dba0: 7562 657d 2061 7320 7468 6572 6520 6172  ube} as there ar
-0002dbb0: 6520 7b74 6f64 656c 6574 657d 2069 646c  e {todelete} idl
-0002dbc0: 6520 6e6f 6465 7322 290a 2020 2020 2020  e nodes").      
-0002dbd0: 2020 2020 2020 776f 726b 6572 7320 3d20        workers = 
-0002dbe0: 776f 726b 6572 7320 2d20 746f 6465 6c65  workers - todele
-0002dbf0: 7465 0a20 2020 2020 2020 2020 2020 2070  te.            p
-0002dc00: 7072 696e 7428 6622 5363 616c 696e 6720  print(f"Scaling 
-0002dc10: 646f 776e 2063 6c75 7374 6572 207b 6b75  down cluster {ku
-0002dc20: 6265 7d20 746f 207b 776f 726b 6572 737d  be} to {workers}
-0002dc30: 2077 6f72 6b65 7273 2229 0a20 2020 2020   workers").     
-0002dc40: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0002dc50: 7365 6c66 2e73 6361 6c65 5f6b 7562 6528  self.scale_kube(
-0002dc60: 6b75 6265 2c20 6b75 6265 7479 7065 2c20  kube, kubetype, 
-0002dc70: 6f76 6572 7269 6465 733d 7b27 776f 726b  overrides={'work
-0002dc80: 6572 7327 3a20 776f 726b 6572 737d 290a  ers': workers}).
-0002dc90: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0002dca0: 6c74 5b27 776f 726b 6572 7327 5d20 3d20  lt['workers'] = 
-0002dcb0: 776f 726b 6572 730a 2020 2020 2020 2020  workers.        
-0002dcc0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-0002dcd0: 740a 2020 2020 2020 2020 7265 7475 726e  t.        return
-0002dce0: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
-0002dcf0: 6365 7373 272c 2027 776f 726b 6572 7327  cess', 'workers'
-0002dd00: 3a20 776f 726b 6572 737d 0a0a 2020 2020  : workers}..    
-0002dd10: 6465 6620 6c6f 6f70 5f61 7574 6f73 6361  def loop_autosca
-0002dd20: 6c65 5f63 6c75 7374 6572 2873 656c 662c  le_cluster(self,
-0002dd30: 206b 7562 652c 206b 7562 6574 7970 652c   kube, kubetype,
-0002dd40: 2077 6f72 6b65 7273 2c20 7468 7265 7368   workers, thresh
-0002dd50: 6f6c 642c 2069 646c 6529 3a0a 2020 2020  old, idle):.    
-0002dd60: 2020 2020 7070 7269 6e74 2866 2253 7461      pprint(f"Sta
-0002dd70: 7274 696e 6720 7769 7468 207b 776f 726b  rting with {work
-0002dd80: 6572 737d 2077 6f72 6b65 7273 2229 0a20  ers} workers"). 
-0002dd90: 2020 2020 2020 2069 6620 7768 6963 6828         if which(
-0002dda0: 276b 7562 6563 746c 2729 2069 7320 4e6f  'kubectl') is No
-0002ddb0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0002ddc0: 636f 6d6d 6f6e 2e67 6574 5f6b 7562 6563  common.get_kubec
-0002ddd0: 746c 2829 0a20 2020 2020 2020 2020 2020  tl().           
-0002dde0: 206f 732e 656e 7669 726f 6e5b 2750 4154   os.environ['PAT
-0002ddf0: 4827 5d20 2b3d 2027 3a2e 270a 2020 2020  H'] += ':.'.    
-0002de00: 2020 2020 7768 696c 6520 5472 7565 3a0a      while True:.
-0002de10: 2020 2020 2020 2020 2020 2020 7365 6c65              sele
-0002de20: 6374 6f72 203d 2022 216e 6f64 652d 726f  ctor = "!node-ro
-0002de30: 6c65 2e6b 7562 6572 6e65 7465 732e 696f  le.kubernetes.io
-0002de40: 2f63 6f6e 7472 6f6c 2d70 6c61 6e65 2c6e  /control-plane,n
-0002de50: 6f64 652d 726f 6c65 2e6b 7562 6572 6e65  ode-role.kuberne
-0002de60: 7465 732e 696f 2f77 6f72 6b65 7222 0a20  tes.io/worker". 
-0002de70: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0002de80: 6e74 636d 6420 3d20 6622 6b75 6265 6374  ntcmd = f"kubect
-0002de90: 6c20 6765 7420 6e6f 6465 202d 2d73 656c  l get node --sel
-0002dea0: 6563 746f 723d 277b 7365 6c65 6374 6f72  ector='{selector
-0002deb0: 7d27 220a 2020 2020 2020 2020 2020 2020  }'".            
-0002dec0: 6375 7272 656e 7463 6d64 202b 3d20 2220  currentcmd += " 
-0002ded0: 7c20 6772 6570 2027 2052 6561 6479 2722  | grep ' Ready'"
-0002dee0: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-0002def0: 7265 6e74 6e6f 6465 7320 3d20 6f73 2e70  rentnodes = os.p
-0002df00: 6f70 656e 2863 7572 7265 6e74 636d 6429  open(currentcmd)
-0002df10: 2e72 6561 646c 696e 6573 2829 0a20 2020  .readlines().   
-0002df20: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0002df30: 6375 7272 656e 746e 6f64 6573 2920 213d  currentnodes) !=
-0002df40: 2077 6f72 6b65 7273 3a0a 2020 2020 2020   workers:.      
-0002df50: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-0002df60: 2866 224f 6e67 6f69 6e67 2073 6361 6c69  (f"Ongoing scali
-0002df70: 6e67 206f 7065 7261 7469 6f6e 206f 6e20  ng operation on 
-0002df80: 636c 7573 7465 7220 7b6b 7562 657d 2229  cluster {kube}")
-0002df90: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0002dfa0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002dfb0: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
-0002dfc0: 2e61 7574 6f73 6361 6c65 5f63 6c75 7374  .autoscale_clust
-0002dfd0: 6572 286b 7562 652c 206b 7562 6574 7970  er(kube, kubetyp
-0002dfe0: 652c 2077 6f72 6b65 7273 2c20 7468 7265  e, workers, thre
-0002dff0: 7368 6f6c 642c 2069 646c 6529 0a20 2020  shold, idle).   
-0002e000: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002e010: 7265 7375 6c74 5b27 7265 7375 6c74 275d  result['result']
-0002e020: 2021 3d20 2773 7563 6365 7373 273a 0a20   != 'success':. 
-0002e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e040: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-0002e050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002e060: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002e070: 2020 2020 2020 2020 2020 2077 6f72 6b65             worke
-0002e080: 7273 203d 2072 6573 756c 745b 2777 6f72  rs = result['wor
-0002e090: 6b65 7273 275d 0a20 2020 2020 2020 2020  kers'].         
-0002e0a0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0002e0b0: 7428 6622 4375 7272 656e 7420 776f 726b  t(f"Current work
-0002e0c0: 6572 7320 6e75 6d62 6572 2064 6573 6972  ers number desir
-0002e0d0: 6564 3a20 7b77 6f72 6b65 7273 7d22 290a  ed: {workers}").
-0002e0e0: 2020 2020 2020 2020 2020 2020 736c 6565              slee
-0002e0f0: 7028 3630 290a 0a20 2020 2064 6566 2074  p(60)..    def t
-0002e100: 6872 6561 6465 645f 7765 625f 636f 6e73  hreaded_web_cons
-0002e110: 6f6c 6528 7365 6c66 2c20 706f 7274 2c20  ole(self, port, 
-0002e120: 6e61 6d65 293a 0a20 2020 2020 2020 2063  name):.        c
-0002e130: 6f6e 736f 6c65 203d 204b 6d69 6e69 636f  onsole = Kminico
-0002e140: 6e73 6f6c 6528 636f 6e66 6967 3d73 656c  nsole(config=sel
-0002e150: 662c 2070 6f72 743d 706f 7274 2c20 6e61  f, port=port, na
-0002e160: 6d65 3d6e 616d 6529 0a20 2020 2020 2020  me=name).       
-0002e170: 2063 6f6e 736f 6c65 2e72 756e 2829 0a0a   console.run()..
-0002e180: 2020 2020 6465 6620 7765 6263 6f6e 736f      def webconso
-0002e190: 6c65 2873 656c 662c 206e 616d 6529 3a0a  le(self, name):.
-0002e1a0: 2020 2020 2020 2020 706f 7274 203d 2067          port = g
-0002e1b0: 6574 5f66 7265 655f 706f 7274 2829 0a20  et_free_port(). 
-0002e1c0: 2020 2020 2020 2074 203d 2074 6872 6561         t = threa
-0002e1d0: 6469 6e67 2e54 6872 6561 6428 7461 7267  ding.Thread(targ
-0002e1e0: 6574 3d73 656c 662e 7468 7265 6164 6564  et=self.threaded
-0002e1f0: 5f77 6562 5f63 6f6e 736f 6c65 2c20 6172  _web_console, ar
-0002e200: 6773 3d28 706f 7274 2c20 6e61 6d65 2c29  gs=(port, name,)
-0002e210: 290a 2020 2020 2020 2020 742e 7374 6172  ).        t.star
-0002e220: 7428 290a 2020 2020 2020 2020 7765 6262  t().        webb
-0002e230: 726f 7773 6572 2e6f 7065 6e28 6622 6874  rowser.open(f"ht
-0002e240: 7470 3a2f 2f31 3237 2e30 2e30 2e31 3a7b  tp://127.0.0.1:{
-0002e250: 706f 7274 7d22 2c20 6e65 773d 322c 2061  port}", new=2, a
-0002e260: 7574 6f72 6169 7365 3d54 7275 6529 0a0a  utoraise=True)..
-0002e270: 2020 2020 6465 6620 696e 666f 5f73 7065      def info_spe
-0002e280: 6369 6669 635f 676b 6528 7365 6c66 2c20  cific_gke(self, 
-0002e290: 636c 7573 7465 7229 3a0a 2020 2020 2020  cluster):.      
-0002e2a0: 2020 6672 6f6d 206b 7669 7274 2e63 6c75    from kvirt.clu
-0002e2b0: 7374 6572 2e67 6b65 2069 6d70 6f72 7420  ster.gke import 
-0002e2c0: 696e 666f 2061 7320 676b 655f 696e 666f  info as gke_info
-0002e2d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0002e2e0: 676b 655f 696e 666f 2873 656c 662c 2063  gke_info(self, c
-0002e2f0: 6c75 7374 6572 2c20 7365 6c66 2e64 6562  luster, self.deb
-0002e300: 7567 290a 0a20 2020 2064 6566 2069 6e66  ug)..    def inf
-0002e310: 6f5f 6b75 6265 5f67 6b65 2873 656c 662c  o_kube_gke(self,
-0002e320: 2071 7569 6574 2c20 7765 623d 4661 6c73   quiet, web=Fals
-0002e330: 6529 3a0a 2020 2020 2020 2020 6672 6f6d  e):.        from
-0002e340: 206b 7669 7274 2e63 6c75 7374 6572 2069   kvirt.cluster i
-0002e350: 6d70 6f72 7420 676b 650a 2020 2020 2020  mport gke.      
-0002e360: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
-0002e370: 6174 682e 6469 726e 616d 6528 676b 652e  ath.dirname(gke.
-0002e380: 6372 6561 7465 2e5f 5f63 6f64 655f 5f2e  create.__code__.
-0002e390: 636f 5f66 696c 656e 616d 6529 0a20 2020  co_filename).   
-0002e3a0: 2020 2020 2069 6e70 7574 6669 6c65 203d       inputfile =
-0002e3b0: 2066 277b 706c 616e 6469 727d 2f66 616b   f'{plandir}/fak
-0002e3c0: 652e 796d 6c27 0a20 2020 2020 2020 2073  e.yml'.        s
-0002e3d0: 656c 662e 696e 666f 5f70 6c61 6e28 696e  elf.info_plan(in
-0002e3e0: 7075 7466 696c 652c 2071 7569 6574 3d71  putfile, quiet=q
-0002e3f0: 7569 6574 2c20 7765 623d 7765 6229 0a20  uiet, web=web). 
-0002e400: 2020 2020 2020 2067 6b65 2e69 6e66 6f5f         gke.info_
-0002e410: 7365 7276 6963 6528 7365 6c66 290a       service(self).
+0002baf0: 2020 2020 2020 206d 6169 6c63 6f6e 7465         mailconte
+0002bb00: 6e74 203d 2022 220a 2020 2020 2020 2020  nt = "".        
+0002bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bb20: 6b75 6265 636f 6e66 6967 203d 2066 272f  kubeconfig = f'/
+0002bb30: 6574 632f 6b75 6265 726e 6574 6573 2f6b  etc/kubernetes/k
+0002bb40: 7562 6563 6f6e 6669 672e 7b6e 616d 657d  ubeconfig.{name}
+0002bb50: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0002bb60: 2020 2020 2020 2020 2020 6375 726c 636d            curlcm
+0002bb70: 6420 2b3d 2066 2720 2d48 2022 5375 626a  d += f' -H "Subj
+0002bb80: 6563 743a 207b 7469 746c 657d 2220 2d48  ect: {title}" -H
+0002bb90: 2022 4672 6f6d 3a20 7b6d 6169 6c66 726f   "From: {mailfro
+0002bba0: 6d7d 203c 7b6d 6169 6c66 726f 6d7d 3e22  m} <{mailfrom}>"
+0002bbb0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0002bbc0: 2020 2020 2020 2020 2020 666f 7220 6164            for ad
+0002bbd0: 6472 6573 7320 696e 206d 6169 6c74 6f3a  dress in mailto:
+0002bbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002bbf0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+0002bc00: 6c63 6d64 202b 3d20 6627 202d 4820 2254  lcmd += f' -H "T
+0002bc10: 6f3a 207b 6164 6472 6573 737d 203c 7b61  o: {address} <{a
+0002bc20: 6464 7265 7373 7d3e 2227 0a20 2020 2020  ddress}>"'.     
+0002bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bc40: 2020 2063 7572 6c63 6d64 202b 3d20 2720     curlcmd += ' 
+0002bc50: 2d46 2022 3d28 3b74 7970 653d 6d75 6c74  -F "=(;type=mult
+0002bc60: 6970 6172 742f 6d69 7865 6422 202d 4620  ipart/mixed" -F 
+0002bc70: 223d 2428 6361 7420 2f76 6172 2f74 6d70  "=$(cat /var/tmp
+0002bc80: 2f6d 6169 6c2e 7478 7429 3b74 7970 653d  /mail.txt);type=
+0002bc90: 7465 7874 2f70 6c61 696e 2227 0a20 2020  text/plain"'.   
+0002bca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bcb0: 2020 2020 2063 7572 6c63 6d64 202b 3d20       curlcmd += 
+0002bcc0: 6627 202d 4620 2266 696c 653d 407b 6b75  f' -F "file=@{ku
+0002bcd0: 6265 636f 6e66 6967 7d3b 7479 7065 3d74  beconfig};type=t
+0002bce0: 6578 742f 706c 6169 6e3b 656e 636f 6465  ext/plain;encode
+0002bcf0: 723d 6261 7365 3634 2220 2d46 2022 3d29  r=base64" -F "=)
+0002bd00: 2227 0a20 2020 2020 2020 2020 2020 2020  "'.             
+0002bd10: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0002bd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bd30: 2020 2020 2063 7572 6c63 6d64 202b 3d20       curlcmd += 
+0002bd40: 2220 2d2d 7570 6c6f 6164 2d66 696c 6520  " --upload-file 
+0002bd50: 2f76 6172 2f74 6d70 2f6d 6169 6c2e 7478  /var/tmp/mail.tx
+0002bd60: 7422 0a20 2020 2020 2020 2020 2020 2020  t".             
+0002bd70: 2020 2020 2020 206d 6169 6c63 6d64 2e61         mailcmd.a
+0002bd80: 7070 656e 6428 6375 726c 636d 6429 0a20  ppend(curlcmd). 
+0002bd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bda0: 2020 2063 6d64 732e 6578 7465 6e64 286d     cmds.extend(m
+0002bdb0: 6169 6c63 6d64 290a 2020 2020 2020 2020  ailcmd).        
+0002bdc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002bdd0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+0002bde0: 6622 496e 7661 6c69 6420 6d65 7468 6f64  f"Invalid method
+0002bdf0: 207b 6e6f 7469 6679 6d65 7468 6f64 7d22   {notifymethod}"
+0002be00: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0002be10: 2063 6d64 732c 206d 6169 6c63 6f6e 7465   cmds, mailconte
+0002be20: 6e74 0a0a 2020 2020 6465 6620 6861 6e64  nt..    def hand
+0002be30: 6c65 5f76 6d5f 7265 7375 6c74 2873 656c  le_vm_result(sel
+0002be40: 662c 206e 616d 652c 2070 726f 6669 6c65  f, name, profile
+0002be50: 2c20 7265 7375 6c74 2c20 6e65 7776 6d73  , result, newvms
+0002be60: 2c20 6661 696c 6564 766d 732c 2061 7379  , failedvms, asy
+0002be70: 6e63 7761 6974 766d 732c 206f 6e6c 7961  ncwaitvms, onlya
+0002be80: 7373 6574 733d 4661 6c73 652c 206e 6577  ssets=False, new
+0002be90: 6173 7365 7473 3d5b 5d2c 0a20 2020 2020  assets=[],.     
+0002bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002beb0: 2020 2020 766d 636c 6965 6e74 3d4e 6f6e      vmclient=Non
+0002bec0: 6529 3a0a 2020 2020 2020 2020 6966 2027  e):.        if '
+0002bed0: 7265 7375 6c74 2720 696e 2072 6573 756c  result' in resul
+0002bee0: 7420 616e 6420 7265 7375 6c74 5b27 7265  t and result['re
+0002bef0: 7375 6c74 275d 203d 3d20 2773 7563 6365  sult'] == 'succe
+0002bf00: 7373 273a 0a20 2020 2020 2020 2020 2020  ss':.           
+0002bf10: 206e 6577 766d 732e 6170 7065 6e64 286e   newvms.append(n
+0002bf20: 616d 6529 0a20 2020 2020 2020 2065 6c73  ame).        els
+0002bf30: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
+0002bf40: 6169 6c65 6476 6d73 2e61 7070 656e 6428  ailedvms.append(
+0002bf50: 7b27 6e61 6d65 273a 206e 616d 652c 2027  {'name': name, '
+0002bf60: 7265 6173 6f6e 273a 2072 6573 756c 745b  reason': result[
+0002bf70: 2772 6561 736f 6e27 5d7d 290a 2020 2020  'reason']}).    
+0002bf80: 2020 2020 7374 6172 7420 3d20 7072 6f66      start = prof
+0002bf90: 696c 652e 6765 7428 2773 7461 7274 272c  ile.get('start',
+0002bfa0: 2054 7275 6529 0a20 2020 2020 2020 2063   True).        c
+0002bfb0: 6c6f 7564 696e 6974 203d 2070 726f 6669  loudinit = profi
+0002bfc0: 6c65 2e67 6574 2827 636c 6f75 6469 6e69  le.get('cloudini
+0002bfd0: 7427 2c20 5472 7565 290a 2020 2020 2020  t', True).      
+0002bfe0: 2020 6173 796e 6377 6169 7420 3d20 7072    asyncwait = pr
+0002bff0: 6f66 696c 652e 6765 7428 2761 7379 6e63  ofile.get('async
+0002c000: 7761 6974 272c 2046 616c 7365 290a 2020  wait', False).  
+0002c010: 2020 2020 2020 6669 6e69 7368 6669 6c65        finishfile
+0002c020: 7320 3d20 7072 6f66 696c 652e 6765 7428  s = profile.get(
+0002c030: 2766 696e 6973 6866 696c 6573 272c 205b  'finishfiles', [
+0002c040: 5d29 0a20 2020 2020 2020 2069 6620 6f6e  ]).        if on
+0002c050: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
+0002c060: 2020 2020 2020 6966 2027 6461 7461 2720        if 'data' 
+0002c070: 696e 2072 6573 756c 743a 0a20 2020 2020  in result:.     
+0002c080: 2020 2020 2020 2020 2020 206e 6577 6173             newas
+0002c090: 7365 7473 2e61 7070 656e 6428 7265 7375  sets.append(resu
+0002c0a0: 6c74 5b27 6461 7461 275d 290a 2020 2020  lt['data']).    
+0002c0b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002c0c0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+0002c0d0: 726f 7228 7265 7375 6c74 5b27 7265 6173  ror(result['reas
+0002c0e0: 6f6e 275d 290a 2020 2020 2020 2020 6966  on']).        if
+0002c0f0: 206e 6f74 2061 7379 6e63 7761 6974 3a0a   not asyncwait:.
+0002c100: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0002c110: 726e 0a20 2020 2020 2020 2065 6c69 6620  rn.        elif 
+0002c120: 6e6f 7420 7374 6172 7420 6f72 206e 6f74  not start or not
+0002c130: 2063 6c6f 7564 696e 6974 206f 7220 7072   cloudinit or pr
+0002c140: 6f66 696c 652e 6765 7428 2769 6d61 6765  ofile.get('image
+0002c150: 2729 2069 7320 4e6f 6e65 3a0a 2020 2020  ') is None:.    
+0002c160: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0002c170: 2253 6b69 7070 696e 6720 7761 6974 206f  "Skipping wait o
+0002c180: 6e20 7b6e 616d 657d 2229 0a20 2020 2020  n {name}").     
+0002c190: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0002c1a0: 2020 2020 2077 6169 7463 6f6d 6d61 6e64       waitcommand
+0002c1b0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0002c1c0: 7761 6974 636f 6d6d 616e 6427 290a 2020  waitcommand').  
+0002c1d0: 2020 2020 2020 2020 2020 7761 6974 7469            waitti
+0002c1e0: 6d65 6f75 7420 3d20 7072 6f66 696c 652e  meout = profile.
+0002c1f0: 6765 7428 2777 6169 7474 696d 656f 7574  get('waittimeout
+0002c200: 272c 2030 290a 2020 2020 2020 2020 2020  ', 0).          
+0002c210: 2020 6173 796e 6377 6169 7476 6d20 3d20    asyncwaitvm = 
+0002c220: 7b27 6e61 6d65 273a 206e 616d 652c 2027  {'name': name, '
+0002c230: 6669 6e69 7368 6669 6c65 7327 3a20 6669  finishfiles': fi
+0002c240: 6e69 7368 6669 6c65 732c 2027 7761 6974  nishfiles, 'wait
+0002c250: 636f 6d6d 616e 6427 3a20 7761 6974 636f  command': waitco
+0002c260: 6d6d 616e 642c 0a20 2020 2020 2020 2020  mmand,.         
+0002c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c280: 2020 2777 6169 7474 696d 656f 7574 273a    'waittimeout':
+0002c290: 2077 6169 7474 696d 656f 7574 2c20 2776   waittimeout, 'v
+0002c2a0: 6d63 6c69 656e 7427 3a20 766d 636c 6965  mclient': vmclie
+0002c2b0: 6e74 7d0a 2020 2020 2020 2020 2020 2020  nt}.            
+0002c2c0: 6173 796e 6377 6169 7476 6d73 2e61 7070  asyncwaitvms.app
+0002c2d0: 656e 6428 6173 796e 6377 6169 7476 6d29  end(asyncwaitvm)
+0002c2e0: 0a0a 2020 2020 6465 6620 7468 7265 6164  ..    def thread
+0002c2f0: 6564 5f63 7265 6174 655f 766d 2873 656c  ed_create_vm(sel
+0002c300: 662c 206e 616d 652c 2070 726f 6669 6c65  f, name, profile
+0002c310: 6e61 6d65 2c20 6375 7272 656e 746f 7665  name, currentove
+0002c320: 7272 6964 6573 2c20 7072 6f66 696c 652c  rrides, profile,
+0002c330: 207a 2c20 706c 616e 2c20 6375 7272 656e   z, plan, curren
+0002c340: 7470 6c61 6e64 6972 2c20 766d 636c 6965  tplandir, vmclie
+0002c350: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+0002c360: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0002c370: 6e66 6c79 2c20 6f6e 6c79 6173 7365 7473  nfly, onlyassets
+0002c380: 2c20 6e65 7776 6d73 2c20 6661 696c 6564  , newvms, failed
+0002c390: 766d 732c 2061 7379 6e63 7761 6974 766d  vms, asyncwaitvm
+0002c3a0: 732c 206e 6577 6173 7365 7473 293a 0a20  s, newassets):. 
+0002c3b0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+0002c3c0: 7365 6c66 2e63 7265 6174 655f 766d 286e  self.create_vm(n
+0002c3d0: 616d 652c 2070 726f 6669 6c65 6e61 6d65  ame, profilename
+0002c3e0: 2c20 6f76 6572 7269 6465 733d 6375 7272  , overrides=curr
+0002c3f0: 656e 746f 7665 7272 6964 6573 2c20 6375  entoverrides, cu
+0002c400: 7374 6f6d 7072 6f66 696c 653d 7072 6f66  stomprofile=prof
+0002c410: 696c 652c 206b 3d7a 2c0a 2020 2020 2020  ile, k=z,.      
+0002c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c430: 2020 2020 2020 2020 2020 706c 616e 3d70            plan=p
+0002c440: 6c61 6e2c 2062 6173 6564 6972 3d63 7572  lan, basedir=cur
+0002c450: 7265 6e74 706c 616e 6469 722c 2063 6c69  rentplandir, cli
+0002c460: 656e 743d 766d 636c 6965 6e74 2c20 6f6e  ent=vmclient, on
+0002c470: 666c 793d 6f6e 666c 792c 0a20 2020 2020  fly=onfly,.     
+0002c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c490: 2020 2020 2020 2020 2020 206f 6e6c 7961             onlya
+0002c4a0: 7373 6574 733d 6f6e 6c79 6173 7365 7473  ssets=onlyassets
+0002c4b0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+0002c4c0: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
+0002c4d0: 2020 2020 2020 2020 2063 6f6d 6d6f 6e2e           common.
+0002c4e0: 6861 6e64 6c65 5f72 6573 706f 6e73 6528  handle_response(
+0002c4f0: 7265 7375 6c74 2c20 6e61 6d65 2c20 636c  result, name, cl
+0002c500: 6965 6e74 3d76 6d63 6c69 656e 7429 0a20  ient=vmclient). 
+0002c510: 2020 2020 2020 2073 656c 662e 6861 6e64         self.hand
+0002c520: 6c65 5f76 6d5f 7265 7375 6c74 286e 616d  le_vm_result(nam
+0002c530: 652c 2070 726f 6669 6c65 2c20 7265 7375  e, profile, resu
+0002c540: 6c74 3d72 6573 756c 742c 206e 6577 766d  lt=result, newvm
+0002c550: 733d 6e65 7776 6d73 2c20 6661 696c 6564  s=newvms, failed
+0002c560: 766d 733d 6661 696c 6564 766d 732c 0a20  vms=failedvms,. 
+0002c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c580: 2020 2020 2020 2020 2020 2020 2061 7379               asy
+0002c590: 6e63 7761 6974 766d 733d 6173 796e 6377  ncwaitvms=asyncw
+0002c5a0: 6169 7476 6d73 2c20 6f6e 6c79 6173 7365  aitvms, onlyasse
+0002c5b0: 7473 3d6f 6e6c 7961 7373 6574 732c 206e  ts=onlyassets, n
+0002c5c0: 6577 6173 7365 7473 3d6e 6577 6173 7365  ewassets=newasse
+0002c5d0: 7473 2c20 766d 636c 6965 6e74 3d76 6d63  ts, vmclient=vmc
+0002c5e0: 6c69 656e 7429 0a0a 2020 2020 6465 6620  lient)..    def 
+0002c5f0: 7061 7273 655f 6669 6c65 7328 7365 6c66  parse_files(self
+0002c600: 2c20 6e61 6d65 2c20 6669 6c65 732c 2062  , name, files, b
+0002c610: 6173 6564 6972 3d27 2e27 2c20 6f6e 666c  asedir='.', onfl
+0002c620: 793d 4e6f 6e65 293a 0a20 2020 2020 2020  y=None):.       
+0002c630: 2069 6620 6e6f 7420 6669 6c65 733a 0a20   if not files:. 
+0002c640: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0002c650: 6e0a 2020 2020 2020 2020 666f 7220 696e  n.        for in
+0002c660: 6465 782c 2066 696c 2069 6e20 656e 756d  dex, fil in enum
+0002c670: 6572 6174 6528 6669 6c65 7329 3a0a 2020  erate(files):.  
+0002c680: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0002c690: 6e73 7461 6e63 6528 6669 6c2c 2073 7472  nstance(fil, str
+0002c6a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0002c6b0: 2020 2070 6174 6820 3d20 6622 2f72 6f6f     path = f"/roo
+0002c6c0: 742f 7b66 696c 7d22 0a20 2020 2020 2020  t/{fil}".       
+0002c6d0: 2020 2020 2020 2020 2069 6620 6261 7365           if base
+0002c6e0: 6469 7220 213d 2027 2e27 3a0a 2020 2020  dir != '.':.    
+0002c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c700: 6f72 6967 696e 203d 2066 227b 6261 7365  origin = f"{base
+0002c710: 6469 727d 2f7b 7061 7468 7d22 0a20 2020  dir}/{path}".   
+0002c720: 2020 2020 2020 2020 2020 2020 206f 7269               ori
+0002c730: 6769 6e20 3d20 6669 6c0a 2020 2020 2020  gin = fil.      
+0002c740: 2020 2020 2020 2020 2020 636f 6e74 656e            conten
+0002c750: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
+0002c760: 2020 2020 2020 2020 2066 696c 6573 5b69           files[i
+0002c770: 6e64 6578 5d20 3d20 7b27 7061 7468 273a  ndex] = {'path':
+0002c780: 2070 6174 682c 2027 6f72 6967 696e 273a   path, 'origin':
+0002c790: 206f 7269 6769 6e7d 0a20 2020 2020 2020   origin}.       
+0002c7a0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+0002c7b0: 616e 6365 2866 696c 2c20 6469 6374 293a  ance(fil, dict):
+0002c7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c7d0: 206f 7269 6769 6e20 3d20 6669 6c2e 6765   origin = fil.ge
+0002c7e0: 7428 276f 7269 6769 6e27 290a 2020 2020  t('origin').    
+0002c7f0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0002c800: 656e 7420 3d20 6669 6c2e 6765 7428 2763  ent = fil.get('c
+0002c810: 6f6e 7465 6e74 2729 0a20 2020 2020 2020  ontent').       
+0002c820: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
+0002c830: 6669 6c2e 6765 7428 2770 6174 6827 290a  fil.get('path').
+0002c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c850: 6966 2070 6174 6820 6973 204e 6f6e 653a  if path is None:
+0002c860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c870: 2020 2020 2069 6620 6f72 6967 696e 2069       if origin i
+0002c880: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0002c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c8a0: 2020 2020 6669 6c65 735b 696e 6465 785d      files[index]
+0002c8b0: 5b27 7061 7468 275d 203d 2066 222f 726f  ['path'] = f"/ro
+0002c8c0: 6f74 2f7b 6f72 6967 696e 7d22 0a20 2020  ot/{origin}".   
+0002c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c8e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0002c8f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002c900: 7272 6f72 2866 2249 6e63 6f72 7265 6374  rror(f"Incorrect
+0002c910: 2065 6e74 7279 207b 6669 6c7d 2e4c 6561   entry {fil}.Lea
+0002c920: 7669 6e67 2e2e 2e22 290a 2020 2020 2020  ving...").      
+0002c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c940: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
+0002c950: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0002c960: 6966 206e 6f74 2070 6174 682e 7374 6172  if not path.star
+0002c970: 7473 7769 7468 2827 2f27 293a 0a20 2020  tswith('/'):.   
+0002c980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c990: 2065 7272 6f72 2866 2249 6e63 6f72 7265   error(f"Incorre
+0002c9a0: 6374 2070 6174 6820 7b70 6174 687d 2e4c  ct path {path}.L
+0002c9b0: 6561 7669 6e67 2e2e 2e22 290a 2020 2020  eaving...").    
+0002c9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c9d0: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+0002c9e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002c9f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0002ca00: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+0002ca10: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
+0002ca20: 6f6e 273a 2022 496e 636f 7272 6563 7420  on': "Incorrect 
+0002ca30: 6669 6c65 2065 6e74 7279 227d 0a20 2020  file entry"}.   
+0002ca40: 2020 2020 2020 2020 2069 6620 6f72 6967           if orig
+0002ca50: 696e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  in is not None:.
+0002ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca70: 6966 206f 6e66 6c79 2069 7320 6e6f 7420  if onfly is not 
+0002ca80: 4e6f 6e65 2061 6e64 2027 7e27 206e 6f74  None and '~' not
+0002ca90: 2069 6e20 6f72 6967 696e 3a0a 2020 2020   in origin:.    
+0002caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cab0: 6465 7374 6469 7220 3d20 6261 7365 6469  destdir = basedi
+0002cac0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+0002cad0: 2020 2020 2020 6966 2027 2f27 2069 6e20        if '/' in 
+0002cae0: 6f72 6967 696e 3a0a 2020 2020 2020 2020  origin:.        
+0002caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cb00: 6465 7374 6469 7220 3d20 6f73 2e70 6174  destdir = os.pat
+0002cb10: 682e 6469 726e 616d 6528 6f72 6967 696e  h.dirname(origin
+0002cb20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002cb30: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
+0002cb40: 6564 6972 7328 6465 7374 6469 722c 2065  edirs(destdir, e
+0002cb50: 7869 7374 5f6f 6b3d 5472 7565 290a 2020  xist_ok=True).  
+0002cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cb70: 2020 636f 6d6d 6f6e 2e66 6574 6368 2866    common.fetch(f
+0002cb80: 227b 6f6e 666c 797d 2f7b 6f72 6967 696e  "{onfly}/{origin
+0002cb90: 7d22 2c20 6465 7374 6469 7229 0a20 2020  }", destdir).   
+0002cba0: 2020 2020 2020 2020 2020 2020 206f 7269               ori
+0002cbb0: 6769 6e20 3d20 6f73 2e70 6174 682e 6578  gin = os.path.ex
+0002cbc0: 7061 6e64 7573 6572 286f 7269 6769 6e29  panduser(origin)
+0002cbd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cbe0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+0002cbf0: 6973 6162 7328 6f72 6967 696e 293a 0a20  isabs(origin):. 
+0002cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cc10: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0002cc20: 2866 696c 2c20 6469 6374 2920 616e 6420  (fil, dict) and 
+0002cc30: 6669 6c2e 6765 7428 2763 7572 7265 6e74  fil.get('current
+0002cc40: 6469 7227 2c20 4661 6c73 6529 3a0a 2020  dir', False):.  
+0002cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cc60: 2020 2020 2020 6f72 6967 696e 203d 2066        origin = f
+0002cc70: 227b 6f73 2e67 6574 6377 6428 297d 2f7b  "{os.getcwd()}/{
+0002cc80: 6f72 6967 696e 7d22 0a20 2020 2020 2020  origin}".       
+0002cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cca0: 2066 696c 6573 5b69 6e64 6578 5d5b 276f   files[index]['o
+0002ccb0: 7269 6769 6e27 5d20 3d20 6f72 6967 696e  rigin'] = origin
+0002ccc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ccd0: 2020 2020 2065 6c69 6620 6261 7365 6469       elif basedi
+0002cce0: 7220 213d 2027 2e27 2061 6e64 206e 6f74  r != '.' and not
+0002ccf0: 206f 7269 6769 6e2e 7374 6172 7473 7769   origin.startswi
+0002cd00: 7468 2827 2e2f 2729 2061 6e64 206e 6f74  th('./') and not
+0002cd10: 206f 7269 6769 6e2e 7374 6172 7473 7769   origin.startswi
+0002cd20: 7468 2827 2f77 6f72 6b64 6972 2f27 293a  th('/workdir/'):
+0002cd30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cd40: 2020 2020 2020 2020 206f 7269 6769 6e20           origin 
+0002cd50: 3d20 6622 7b62 6173 6564 6972 7d2f 7b6f  = f"{basedir}/{o
+0002cd60: 7269 6769 6e7d 220a 2020 2020 2020 2020  rigin}".        
+0002cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cd80: 6669 6c65 735b 696e 6465 785d 5b27 6f72  files[index]['or
+0002cd90: 6967 696e 275d 203d 206f 7269 6769 6e0a  igin'] = origin.
+0002cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cdb0: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+0002cdc0: 7869 7374 7328 6f72 6967 696e 293a 0a20  xists(origin):. 
+0002cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cde0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+0002cdf0: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
+0002ce00: 2772 6561 736f 6e27 3a20 6622 4f72 6967  'reason': f"Orig
+0002ce10: 696e 2066 696c 6520 7b6f 7269 6769 6e7d  in file {origin}
+0002ce20: 206e 6f74 2066 6f75 6e64 2066 6f72 207b   not found for {
+0002ce30: 6e61 6d65 7d22 7d0a 2020 2020 2020 2020  name}"}.        
+0002ce40: 2020 2020 656c 6966 2063 6f6e 7465 6e74      elif content
+0002ce50: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0002ce60: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002ce70: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
+0002ce80: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
+0002ce90: 2066 2243 6f6e 7465 6e74 206f 6620 6669   f"Content of fi
+0002cea0: 6c65 207b 7061 7468 7d20 6e6f 7420 666f  le {path} not fo
+0002ceb0: 756e 6420 666f 7220 7b6e 616d 657d 227d  und for {name}"}
+0002cec0: 0a0a 2020 2020 6465 6620 7072 6570 656e  ..    def prepen
+0002ced0: 645f 696e 7075 745f 6469 7228 7365 6c66  d_input_dir(self
+0002cee0: 2c20 6e65 7766 696c 6573 2c20 696e 7075  , newfiles, inpu
+0002cef0: 7464 6972 293a 0a20 2020 2020 2020 2072  tdir):.        r
+0002cf00: 6573 756c 7473 203d 205b 5d0a 2020 2020  esults = [].    
+0002cf10: 2020 2020 666f 7220 6669 6320 696e 206e      for fic in n
+0002cf20: 6577 6669 6c65 733a 0a20 2020 2020 2020  ewfiles:.       
+0002cf30: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0002cf40: 6365 2866 6963 2c20 7374 7229 2061 6e64  ce(fic, str) and
+0002cf50: 206e 6f74 206f 732e 7061 7468 2e69 7361   not os.path.isa
+0002cf60: 6273 2866 6963 293a 0a20 2020 2020 2020  bs(fic):.       
+0002cf70: 2020 2020 2020 2020 206e 6577 5f66 6963           new_fic
+0002cf80: 203d 2066 227b 696e 7075 7464 6972 7d2f   = f"{inputdir}/
+0002cf90: 7b66 6963 7d22 0a20 2020 2020 2020 2020  {fic}".         
+0002cfa0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+0002cfb0: 6365 2866 6963 2c20 6469 6374 2920 616e  ce(fic, dict) an
+0002cfc0: 6420 276f 7269 6769 6e27 2069 6e20 6669  d 'origin' in fi
+0002cfd0: 6320 616e 6420 6e6f 7420 6f73 2e70 6174  c and not os.pat
+0002cfe0: 682e 6973 6162 7328 6f73 2e70 6174 682e  h.isabs(os.path.
+0002cff0: 6578 7061 6e64 7573 6572 2866 6963 5b27  expanduser(fic['
+0002d000: 6f72 6967 696e 275d 2929 3a0a 2020 2020  origin'])):.    
+0002d010: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0002d020: 6669 6320 3d20 6669 632e 636f 7079 2829  fic = fic.copy()
+0002d030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d040: 206e 6577 5f66 6963 5b27 6f72 6967 696e   new_fic['origin
+0002d050: 275d 203d 2066 227b 696e 7075 7464 6972  '] = f"{inputdir
+0002d060: 7d2f 7b66 6963 5b27 6f72 6967 696e 275d  }/{fic['origin']
+0002d070: 7d22 0a20 2020 2020 2020 2020 2020 2065  }".            e
+0002d080: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002d090: 2020 2020 206e 6577 5f66 6963 203d 2066       new_fic = f
+0002d0a0: 6963 0a20 2020 2020 2020 2020 2020 2072  ic.            r
+0002d0b0: 6573 756c 7473 2e61 7070 656e 6428 6e65  esults.append(ne
+0002d0c0: 775f 6669 6329 0a20 2020 2020 2020 2072  w_fic).        r
+0002d0d0: 6574 7572 6e20 7265 7375 6c74 730a 0a20  eturn results.. 
+0002d0e0: 2020 2064 6566 2072 656d 6564 6961 7465     def remediate
+0002d0f0: 5f66 696c 6573 2873 656c 662c 206e 616d  _files(self, nam
+0002d100: 652c 206e 6577 6669 6c65 732c 206f 7665  e, newfiles, ove
+0002d110: 7272 6964 6573 3d7b 7d2c 2069 6e70 7574  rrides={}, input
+0002d120: 6469 723d 272e 2729 3a0a 2020 2020 2020  dir='.'):.      
+0002d130: 2020 7570 6461 7465 645f 6669 6c65 7320    updated_files 
+0002d140: 3d20 5b5d 0a20 2020 2020 2020 2069 702c  = [].        ip,
+0002d150: 2076 6d70 6f72 7420 3d20 5f73 7368 5f63   vmport = _ssh_c
+0002d160: 7265 6465 6e74 6961 6c73 2873 656c 662e  redentials(self.
+0002d170: 6b2c 206e 616d 6529 5b31 3a5d 0a20 2020  k, name)[1:].   
+0002d180: 2020 2020 2069 6620 696e 7075 7464 6972       if inputdir
+0002d190: 2021 3d20 272e 273a 0a20 2020 2020 2020   != '.':.       
+0002d1a0: 2020 2020 206e 6577 6669 6c65 7320 3d20       newfiles = 
+0002d1b0: 7365 6c66 2e70 7265 7065 6e64 5f69 6e70  self.prepend_inp
+0002d1c0: 7574 5f64 6972 286e 6577 6669 6c65 732c  ut_dir(newfiles,
+0002d1d0: 2069 6e70 7574 6469 7229 0a20 2020 2020   inputdir).     
+0002d1e0: 2020 2073 656c 662e 7061 7273 655f 6669     self.parse_fi
+0002d1f0: 6c65 7328 6e61 6d65 2c20 6e65 7766 696c  les(name, newfil
+0002d200: 6573 290a 2020 2020 2020 2020 6f76 6572  es).        over
+0002d210: 7269 6465 735f 6669 6c65 7320 3d20 6f76  rides_files = ov
+0002d220: 6572 7269 6465 732e 636f 7079 2829 0a20  errides.copy(). 
+0002d230: 2020 2020 2020 206f 7665 7272 6964 6573         overrides
+0002d240: 5f66 696c 6573 5b27 6e61 6d65 275d 203d  _files['name'] =
+0002d250: 206e 616d 650a 2020 2020 2020 2020 6461   name.        da
+0002d260: 7461 203d 2070 726f 6365 7373 5f66 696c  ta = process_fil
+0002d270: 6573 2866 696c 6573 3d6e 6577 6669 6c65  es(files=newfile
+0002d280: 732c 206f 7665 7272 6964 6573 3d6f 7665  s, overrides=ove
+0002d290: 7272 6964 6573 5f66 696c 6573 2c20 7265  rrides_files, re
+0002d2a0: 6d65 6469 6174 653d 5472 7565 290a 2020  mediate=True).  
+0002d2b0: 2020 2020 2020 6461 7461 6469 7273 203d        datadirs =
+0002d2c0: 207b 7d0a 2020 2020 2020 2020 7769 7468   {}.        with
+0002d2d0: 2054 656d 706f 7261 7279 4469 7265 6374   TemporaryDirect
+0002d2e0: 6f72 7928 2920 6173 2074 6d70 6469 723a  ory() as tmpdir:
+0002d2f0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0002d300: 2069 6e64 6578 2c20 656e 7472 7920 696e   index, entry in
+0002d310: 2065 6e75 6d65 7261 7465 2864 6174 6129   enumerate(data)
+0002d320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002d330: 2020 6465 7374 696e 6174 696f 6e20 3d20    destination = 
+0002d340: 656e 7472 795b 2770 6174 6827 5d0a 2020  entry['path'].  
+0002d350: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0002d360: 7468 6469 7220 3d20 6f73 2e70 6174 682e  thdir = os.path.
+0002d370: 6469 726e 616d 6528 6465 7374 696e 6174  dirname(destinat
+0002d380: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
+0002d390: 2020 2020 2069 6620 7061 7468 6469 7220       if pathdir 
+0002d3a0: 6e6f 7420 696e 2064 6174 6164 6972 733a  not in datadirs:
+0002d3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d3c0: 2020 2020 2070 6174 6864 6972 636d 6420       pathdircmd 
+0002d3d0: 3d20 6627 6c73 202d 6120 7b70 6174 6864  = f'ls -a {pathd
+0002d3e0: 6972 7d20 323e 2631 270a 2020 2020 2020  ir} 2>&1'.      
+0002d3f0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0002d400: 7468 6469 7263 6d64 203d 2073 7368 286e  thdircmd = ssh(n
+0002d410: 616d 652c 2069 703d 6970 2c20 7573 6572  ame, ip=ip, user
+0002d420: 3d27 726f 6f74 272c 2074 756e 6e65 6c3d  ='root', tunnel=
+0002d430: 7365 6c66 2e74 756e 6e65 6c2c 2074 756e  self.tunnel, tun
+0002d440: 6e65 6c68 6f73 743d 7365 6c66 2e74 756e  nelhost=self.tun
+0002d450: 6e65 6c68 6f73 742c 0a20 2020 2020 2020  nelhost,.       
+0002d460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d470: 2020 2020 2020 2020 2020 2020 2020 7475                tu
+0002d480: 6e6e 656c 706f 7274 3d73 656c 662e 7475  nnelport=self.tu
+0002d490: 6e6e 656c 706f 7274 2c20 7475 6e6e 656c  nnelport, tunnel
+0002d4a0: 7573 6572 3d73 656c 662e 7475 6e6e 656c  user=self.tunnel
+0002d4b0: 7573 6572 2c20 696e 7365 6375 7265 3d54  user, insecure=T
+0002d4c0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+0002d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d4e0: 2020 2020 2020 2020 2020 636d 643d 7061            cmd=pa
+0002d4f0: 7468 6469 7263 6d64 2c20 766d 706f 7274  thdircmd, vmport
+0002d500: 3d76 6d70 6f72 7429 0a20 2020 2020 2020  =vmport).       
+0002d510: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+0002d520: 6864 6972 6669 6c65 7320 3d20 6f73 2e70  hdirfiles = os.p
+0002d530: 6f70 656e 2870 6174 6864 6972 636d 6429  open(pathdircmd)
+0002d540: 2e72 6561 646c 696e 6573 2829 0a20 2020  .readlines().   
+0002d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d560: 2069 6620 6c65 6e28 7061 7468 6469 7266   if len(pathdirf
+0002d570: 696c 6573 2920 3d3d 2031 2061 6e64 2027  iles) == 1 and '
+0002d580: 4e6f 2073 7563 6820 6669 6c65 206f 7220  No such file or 
+0002d590: 6469 7265 6374 6f72 7927 2069 6e20 7061  directory' in pa
+0002d5a0: 7468 6469 7266 696c 6573 5b30 5d3a 0a20  thdirfiles[0]:. 
+0002d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d5c0: 2020 2020 2020 2063 7265 6174 6564 6972         createdir
+0002d5d0: 636d 6420 3d20 6627 6d6b 6469 7220 2d70  cmd = f'mkdir -p
+0002d5e0: 207b 7061 7468 6469 727d 270a 2020 2020   {pathdir}'.    
+0002d5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d600: 2020 2020 6372 6561 7465 6469 7263 6d64      createdircmd
+0002d610: 203d 2073 7368 286e 616d 652c 2069 703d   = ssh(name, ip=
+0002d620: 6970 2c20 7573 6572 3d27 726f 6f74 272c  ip, user='root',
+0002d630: 2074 756e 6e65 6c3d 7365 6c66 2e74 756e   tunnel=self.tun
+0002d640: 6e65 6c2c 2074 756e 6e65 6c68 6f73 743d  nel, tunnelhost=
+0002d650: 7365 6c66 2e74 756e 6e65 6c68 6f73 742c  self.tunnelhost,
+0002d660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d680: 2020 2020 2020 2020 2020 2020 7475 6e6e              tunn
+0002d690: 656c 706f 7274 3d73 656c 662e 7475 6e6e  elport=self.tunn
+0002d6a0: 656c 706f 7274 2c20 7475 6e6e 656c 7573  elport, tunnelus
+0002d6b0: 6572 3d73 656c 662e 7475 6e6e 656c 7573  er=self.tunnelus
+0002d6c0: 6572 2c20 696e 7365 6375 7265 3d54 7275  er, insecure=Tru
+0002d6d0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0002d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d6f0: 2020 2020 2020 2020 2020 2020 2020 636d                cm
+0002d700: 643d 6372 6561 7465 6469 7263 6d64 2c20  d=createdircmd, 
+0002d710: 766d 706f 7274 3d76 6d70 6f72 7429 0a20  vmport=vmport). 
+0002d720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d730: 2020 2020 2020 206f 732e 706f 7065 6e28         os.popen(
+0002d740: 6372 6561 7465 6469 7263 6d64 290a 2020  createdircmd).  
+0002d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d760: 2020 2020 2020 7061 7468 6469 7266 696c        pathdirfil
+0002d770: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
+0002d780: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0002d790: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002d7a0: 2020 2020 2020 2020 2020 7061 7468 6469            pathdi
+0002d7b0: 7266 696c 6573 203d 205b 782e 7374 7269  rfiles = [x.stri
+0002d7c0: 7028 2920 666f 7220 7820 696e 2070 6174  p() for x in pat
+0002d7d0: 6864 6972 6669 6c65 735d 0a20 2020 2020  hdirfiles].     
+0002d7e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0002d7f0: 6174 6164 6972 735b 7061 7468 6469 725d  atadirs[pathdir]
+0002d800: 203d 2070 6174 6864 6972 6669 6c65 730a   = pathdirfiles.
+0002d810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d820: 6966 206f 732e 7061 7468 2e62 6173 656e  if os.path.basen
+0002d830: 616d 6528 6465 7374 696e 6174 696f 6e29  ame(destination)
+0002d840: 206e 6f74 2069 6e20 6461 7461 6469 7273   not in datadirs
+0002d850: 5b70 6174 6864 6972 5d3a 0a20 2020 2020  [pathdir]:.     
+0002d860: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002d870: 7072 696e 7428 6622 5570 6461 7469 6e67  print(f"Updating
+0002d880: 207b 6465 7374 696e 6174 696f 6e7d 2069   {destination} i
+0002d890: 6e20 7b6e 616d 657d 2229 0a20 2020 2020  n {name}").     
+0002d8a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002d8b0: 6f75 7263 6520 3d20 6622 7b74 6d70 6469  ource = f"{tmpdi
+0002d8c0: 727d 2f66 6963 7b69 6e64 6578 7d22 0a20  r}/fic{index}". 
+0002d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d8e0: 2020 2077 6974 6820 6f70 656e 2873 6f75     with open(sou
+0002d8f0: 7263 652c 2027 7727 2920 6173 2066 3a0a  rce, 'w') as f:.
+0002d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d910: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
+0002d920: 656e 7472 795b 2763 6f6e 7465 6e74 275d  entry['content']
+0002d930: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002d940: 2020 2020 2020 7363 7063 6d64 203d 2073        scpcmd = s
+0002d950: 6370 286e 616d 652c 2069 703d 6970 2c20  cp(name, ip=ip, 
+0002d960: 7573 6572 3d27 726f 6f74 272c 2073 6f75  user='root', sou
+0002d970: 7263 653d 736f 7572 6365 2c20 6465 7374  rce=source, dest
+0002d980: 696e 6174 696f 6e3d 6465 7374 696e 6174  ination=destinat
+0002d990: 696f 6e2c 2074 756e 6e65 6c3d 7365 6c66  ion, tunnel=self
+0002d9a0: 2e74 756e 6e65 6c2c 0a20 2020 2020 2020  .tunnel,.       
+0002d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d9c0: 2020 2020 2020 2020 2020 7475 6e6e 656c            tunnel
+0002d9d0: 686f 7374 3d73 656c 662e 7475 6e6e 656c  host=self.tunnel
+0002d9e0: 686f 7374 2c20 7475 6e6e 656c 706f 7274  host, tunnelport
+0002d9f0: 3d73 656c 662e 7475 6e6e 656c 706f 7274  =self.tunnelport
+0002da00: 2c20 7475 6e6e 656c 7573 6572 3d73 656c  , tunneluser=sel
+0002da10: 662e 7475 6e6e 656c 7573 6572 2c0a 2020  f.tunneluser,.  
+0002da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002da30: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0002da40: 6f77 6e6c 6f61 643d 4661 6c73 652c 2069  ownload=False, i
+0002da50: 6e73 6563 7572 653d 5472 7565 2c20 766d  nsecure=True, vm
+0002da60: 706f 7274 3d76 6d70 6f72 7429 0a20 2020  port=vmport).   
+0002da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002da80: 206f 732e 7379 7374 656d 2873 6370 636d   os.system(scpcm
+0002da90: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
+0002daa0: 2020 2020 2020 2075 7064 6174 6564 5f66         updated_f
+0002dab0: 696c 6573 2e61 7070 656e 6428 6465 7374  iles.append(dest
+0002dac0: 696e 6174 696f 6e29 0a20 2020 2020 2020  ination).       
+0002dad0: 2072 6574 7572 6e20 7570 6461 7465 645f   return updated_
+0002dae0: 6669 6c65 730a 0a20 2020 2064 6566 2069  files..    def i
+0002daf0: 6e66 6f5f 7370 6563 6966 6963 5f70 6c61  nfo_specific_pla
+0002db00: 6e28 7365 6c66 2c20 706c 616e 293a 0a20  n(self, plan):. 
+0002db10: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+0002db20: 5072 6f76 6964 696e 6720 696e 666f 726d  Providing inform
+0002db30: 6174 696f 6e20 6162 6f75 7420 706c 616e  ation about plan
+0002db40: 207b 706c 616e 7d22 290a 2020 2020 2020   {plan}").      
+0002db50: 2020 6b20 3d20 7365 6c66 2e6b 0a20 2020    k = self.k.   
+0002db60: 2020 2020 2072 6573 756c 7473 203d 205b       results = [
+0002db70: 5d0a 2020 2020 2020 2020 666f 7220 766d  ].        for vm
+0002db80: 2069 6e20 6b2e 6c69 7374 2829 3a0a 2020   in k.list():.  
+0002db90: 2020 2020 2020 2020 2020 6966 2076 6d2e            if vm.
+0002dba0: 6765 7428 2770 6c61 6e27 2c20 2727 2920  get('plan', '') 
+0002dbb0: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
+0002dbc0: 2020 2020 2020 2020 2072 6573 756c 7473           results
+0002dbd0: 2e61 7070 656e 6428 766d 290a 2020 2020  .append(vm).    
+0002dbe0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+0002dbf0: 7473 0a0a 2020 2020 6465 6620 6175 746f  ts..    def auto
+0002dc00: 7363 616c 655f 636c 7573 7465 7228 7365  scale_cluster(se
+0002dc10: 6c66 2c20 6b75 6265 2c20 6b75 6265 7479  lf, kube, kubety
+0002dc20: 7065 2c20 776f 726b 6572 732c 2074 6872  pe, workers, thr
+0002dc30: 6573 686f 6c64 2c20 6964 6c65 293a 0a20  eshold, idle):. 
+0002dc40: 2020 2020 2020 2069 6620 7468 7265 7368         if thresh
+0002dc50: 6f6c 6420 3e20 3939 3939 3a0a 2020 2020  old > 9999:.    
+0002dc60: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0002dc70: 2253 6b69 7070 696e 6720 6175 746f 7363  "Skipping autosc
+0002dc80: 616c 696e 6720 7570 2063 6865 636b 7320  aling up checks 
+0002dc90: 666f 7220 636c 7573 7465 7220 7b6b 7562  for cluster {kub
+0002dca0: 657d 2061 7320 7065 7220 7468 7265 7368  e} as per thresh
+0002dcb0: 6f6c 6420 7b74 6872 6573 686f 6c64 7d22  old {threshold}"
+0002dcc0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0002dcd0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+0002dce0: 2773 7563 6365 7373 272c 2027 776f 726b  'success', 'work
+0002dcf0: 6572 7327 3a20 776f 726b 6572 737d 0a20  ers': workers}. 
+0002dd00: 2020 2020 2020 2069 6620 6964 6c65 203c         if idle <
+0002dd10: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0002dd20: 7070 7269 6e74 2866 2253 6b69 7070 696e  pprint(f"Skippin
+0002dd30: 6720 6175 746f 7363 616c 696e 6720 646f  g autoscaling do
+0002dd40: 776e 2063 6865 636b 7320 666f 7220 636c  wn checks for cl
+0002dd50: 7573 7465 7220 7b6b 7562 657d 2061 7320  uster {kube} as 
+0002dd60: 7065 7220 6964 6c65 207b 6964 6c65 7d22  per idle {idle}"
+0002dd70: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0002dd80: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+0002dd90: 2773 7563 6365 7373 272c 2027 776f 726b  'success', 'work
+0002dda0: 6572 7327 3a20 776f 726b 6572 737d 0a20  ers': workers}. 
+0002ddb0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+0002ddc0: 4368 6563 6b69 6e67 206e 6f6e 2073 6368  Checking non sch
+0002ddd0: 6564 756c 6564 2070 6f64 7320 636f 756e  eduled pods coun
+0002dde0: 7420 6f6e 2063 6c75 7374 6572 207b 6b75  t on cluster {ku
+0002ddf0: 6265 7d22 290a 2020 2020 2020 2020 7365  be}").        se
+0002de00: 6c65 6374 6f72 203d 2022 216e 6f64 652d  lector = "!node-
+0002de10: 726f 6c65 2e6b 7562 6572 6e65 7465 732e  role.kubernetes.
+0002de20: 696f 2f63 6f6e 7472 6f6c 2d70 6c61 6e65  io/control-plane
+0002de30: 2c6e 6f64 652d 726f 6c65 2e6b 7562 6572  ,node-role.kuber
+0002de40: 6e65 7465 732e 696f 2f77 6f72 6b65 7222  netes.io/worker"
+0002de50: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
+0002de60: 636d 6420 3d20 6622 6b75 6265 6374 6c20  cmd = f"kubectl 
+0002de70: 6765 7420 6e6f 6465 202d 2d73 656c 6563  get node --selec
+0002de80: 746f 723d 277b 7365 6c65 6374 6f72 7d27  tor='{selector}'
+0002de90: 220a 2020 2020 2020 2020 6375 7272 656e  ".        curren
+0002dea0: 7463 6d64 202b 3d20 2220 7c20 6772 6570  tcmd += " | grep
+0002deb0: 2027 2052 6561 6479 2722 0a20 2020 2020   ' Ready'".     
+0002dec0: 2020 2077 6f72 6b65 7273 203d 206c 656e     workers = len
+0002ded0: 286f 732e 706f 7065 6e28 6375 7272 656e  (os.popen(curren
+0002dee0: 7463 6d64 292e 7265 6164 6c69 6e65 7328  tcmd).readlines(
+0002def0: 2929 0a20 2020 2020 2020 2070 656e 6469  )).        pendi
+0002df00: 6e67 636d 6420 3d20 226b 7562 6563 746c  ngcmd = "kubectl
+0002df10: 2067 6574 2070 6f64 7320 2d41 202d 2d66   get pods -A --f
+0002df20: 6965 6c64 2d73 656c 6563 746f 723d 7374  ield-selector=st
+0002df30: 6174 7573 2e70 6861 7365 3d50 656e 6469  atus.phase=Pendi
+0002df40: 6e67 202d 6f20 7961 6d6c 220a 2020 2020  ng -o yaml".    
+0002df50: 2020 2020 7065 6e64 696e 675f 706f 6473      pending_pods
+0002df60: 203d 2079 616d 6c2e 7361 6665 5f6c 6f61   = yaml.safe_loa
+0002df70: 6428 6f73 2e70 6f70 656e 2870 656e 6469  d(os.popen(pendi
+0002df80: 6e67 636d 6429 2e72 6561 6428 2929 5b27  ngcmd).read())['
+0002df90: 6974 656d 7327 5d0a 2020 2020 2020 2020  items'].        
+0002dfa0: 6966 206c 656e 2870 656e 6469 6e67 5f70  if len(pending_p
+0002dfb0: 6f64 7329 203e 2074 6872 6573 686f 6c64  ods) > threshold
+0002dfc0: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
+0002dfd0: 7269 6e74 2866 2254 7269 6767 6572 696e  rint(f"Triggerin
+0002dfe0: 6720 7363 616c 696e 6720 7570 2066 6f72  g scaling up for
+0002dff0: 2063 6c75 7374 6572 207b 6b75 6265 7d20   cluster {kube} 
+0002e000: 6173 2074 6865 7265 2061 7265 207b 6c65  as there are {le
+0002e010: 6e28 7065 6e64 696e 675f 706f 6473 297d  n(pending_pods)}
+0002e020: 2070 656e 6469 6e67 2070 6f64 7322 290a   pending pods").
+0002e030: 2020 2020 2020 2020 2020 2020 776f 726b              work
+0002e040: 6572 7320 2b3d 2031 0a20 2020 2020 2020  ers += 1.       
+0002e050: 2020 2020 2070 7072 696e 7428 2253 6361       pprint("Sca
+0002e060: 6c69 6e67 2075 7020 636c 7573 7465 7220  ling up cluster 
+0002e070: 7b6b 7562 657d 2074 6f20 7b77 6f72 6b65  {kube} to {worke
+0002e080: 7273 7d20 776f 726b 6572 7322 290a 2020  rs} workers").  
+0002e090: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+0002e0a0: 203d 2073 656c 662e 7363 616c 655f 6b75   = self.scale_ku
+0002e0b0: 6265 286b 7562 652c 206b 7562 6574 7970  be(kube, kubetyp
+0002e0c0: 652c 206f 7665 7272 6964 6573 3d7b 2777  e, overrides={'w
+0002e0d0: 6f72 6b65 7273 273a 2077 6f72 6b65 7273  orkers': workers
+0002e0e0: 7d29 0a20 2020 2020 2020 2020 2020 2072  }).            r
+0002e0f0: 6573 756c 745b 2777 6f72 6b65 7273 275d  esult['workers']
+0002e100: 203d 2077 6f72 6b65 7273 0a20 2020 2020   = workers.     
+0002e110: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0002e120: 7375 6c74 0a20 2020 2020 2020 206e 6f64  sult.        nod
+0002e130: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+0002e140: 6375 7272 656e 7463 6d64 203d 2022 6b75  currentcmd = "ku
+0002e150: 6265 6374 6c20 6765 7420 706f 6420 2d41  bectl get pod -A
+0002e160: 202d 6f20 7961 6d6c 220a 2020 2020 2020   -o yaml".      
+0002e170: 2020 616c 6c70 6f64 7320 3d20 7961 6d6c    allpods = yaml
+0002e180: 2e73 6166 655f 6c6f 6164 286f 732e 706f  .safe_load(os.po
+0002e190: 7065 6e28 6375 7272 656e 7463 6d64 292e  pen(currentcmd).
+0002e1a0: 7265 6164 2829 295b 2769 7465 6d73 275d  read())['items']
+0002e1b0: 0a20 2020 2020 2020 2066 6f72 2070 6f64  .        for pod
+0002e1c0: 2069 6e20 616c 6c70 6f64 733a 0a20 2020   in allpods:.   
+0002e1d0: 2020 2020 2020 2020 206e 6f64 656e 616d           nodenam
+0002e1e0: 6520 3d20 706f 645b 2773 7065 6327 5d5b  e = pod['spec'][
+0002e1f0: 276e 6f64 654e 616d 6527 5d0a 2020 2020  'nodeName'].    
+0002e200: 2020 2020 2020 2020 7374 6174 7573 203d          status =
+0002e210: 2070 6f64 5b27 7374 6174 7573 275d 5b27   pod['status']['
+0002e220: 7068 6173 6527 5d0a 2020 2020 2020 2020  phase'].        
+0002e230: 2020 2020 6966 2073 7461 7475 7320 213d      if status !=
+0002e240: 2027 5275 6e6e 696e 6727 3a0a 2020 2020   'Running':.    
+0002e250: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0002e260: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0002e270: 2069 6620 6e6f 6465 6e61 6d65 206e 6f74   if nodename not
+0002e280: 2069 6e20 6e6f 6465 733a 0a20 2020 2020   in nodes:.     
+0002e290: 2020 2020 2020 2020 2020 206e 6f64 6573             nodes
+0002e2a0: 5b6e 6f64 656e 616d 655d 203d 2031 0a20  [nodename] = 1. 
+0002e2b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0002e2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e2d0: 206e 6f64 6573 5b6e 6f64 656e 616d 655d   nodes[nodename]
+0002e2e0: 202b 3d20 310a 2020 2020 2020 2020 746f   += 1.        to
+0002e2f0: 6465 6c65 7465 203d 2030 0a20 2020 2020  delete = 0.     
+0002e300: 2020 2066 6f72 206e 6f64 6520 696e 206e     for node in n
+0002e310: 6f64 6573 3a0a 2020 2020 2020 2020 2020  odes:.          
+0002e320: 2020 6966 206e 6f64 6573 5b6e 6f64 655d    if nodes[node]
+0002e330: 203c 2069 646c 653a 0a20 2020 2020 2020   < idle:.       
+0002e340: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0002e350: 6622 6e6f 6465 207b 6e6f 6465 7d20 746f  f"node {node} to
+0002e360: 2062 6520 7265 6d6f 7665 6420 7369 6e63   be removed sinc
+0002e370: 6520 6974 206f 6e6c 7920 6861 7320 7468  e it only has th
+0002e380: 6520 666f 6c6c 6f77 696e 6720 706f 6473  e following pods
+0002e390: 3a20 7b6e 6f64 6573 5b6e 6f64 655d 7d22  : {nodes[node]}"
+0002e3a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002e3b0: 2020 746f 6465 6c65 7465 202b 3d20 310a    todelete += 1.
+0002e3c0: 2020 2020 2020 2020 6966 2074 6f64 656c          if todel
+0002e3d0: 6574 6520 3e20 303a 0a20 2020 2020 2020  ete > 0:.       
+0002e3e0: 2020 2020 2070 7072 696e 7428 6622 5472       pprint(f"Tr
+0002e3f0: 6967 6765 7269 6e67 2073 6361 6c69 6e67  iggering scaling
+0002e400: 2064 6f77 6e20 666f 7220 636c 7573 7465   down for cluste
+0002e410: 7220 7b6b 7562 657d 2061 7320 7468 6572  r {kube} as ther
+0002e420: 6520 6172 6520 7b74 6f64 656c 6574 657d  e are {todelete}
+0002e430: 2069 646c 6520 6e6f 6465 7322 290a 2020   idle nodes").  
+0002e440: 2020 2020 2020 2020 2020 776f 726b 6572            worker
+0002e450: 7320 3d20 776f 726b 6572 7320 2d20 746f  s = workers - to
+0002e460: 6465 6c65 7465 0a20 2020 2020 2020 2020  delete.         
+0002e470: 2020 2070 7072 696e 7428 6622 5363 616c     pprint(f"Scal
+0002e480: 696e 6720 646f 776e 2063 6c75 7374 6572  ing down cluster
+0002e490: 207b 6b75 6265 7d20 746f 207b 776f 726b   {kube} to {work
+0002e4a0: 6572 737d 2077 6f72 6b65 7273 2229 0a20  ers} workers"). 
+0002e4b0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0002e4c0: 7420 3d20 7365 6c66 2e73 6361 6c65 5f6b  t = self.scale_k
+0002e4d0: 7562 6528 6b75 6265 2c20 6b75 6265 7479  ube(kube, kubety
+0002e4e0: 7065 2c20 6f76 6572 7269 6465 733d 7b27  pe, overrides={'
+0002e4f0: 776f 726b 6572 7327 3a20 776f 726b 6572  workers': worker
+0002e500: 737d 290a 2020 2020 2020 2020 2020 2020  s}).            
+0002e510: 7265 7375 6c74 5b27 776f 726b 6572 7327  result['workers'
+0002e520: 5d20 3d20 776f 726b 6572 730a 2020 2020  ] = workers.    
+0002e530: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0002e540: 6573 756c 740a 2020 2020 2020 2020 7265  esult.        re
+0002e550: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+0002e560: 2773 7563 6365 7373 272c 2027 776f 726b  'success', 'work
+0002e570: 6572 7327 3a20 776f 726b 6572 737d 0a0a  ers': workers}..
+0002e580: 2020 2020 6465 6620 6c6f 6f70 5f61 7574      def loop_aut
+0002e590: 6f73 6361 6c65 5f63 6c75 7374 6572 2873  oscale_cluster(s
+0002e5a0: 656c 662c 206b 7562 652c 206b 7562 6574  elf, kube, kubet
+0002e5b0: 7970 652c 2077 6f72 6b65 7273 2c20 7468  ype, workers, th
+0002e5c0: 7265 7368 6f6c 642c 2069 646c 6529 3a0a  reshold, idle):.
+0002e5d0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0002e5e0: 2253 7461 7274 696e 6720 7769 7468 207b  "Starting with {
+0002e5f0: 776f 726b 6572 737d 2077 6f72 6b65 7273  workers} workers
+0002e600: 2229 0a20 2020 2020 2020 2069 6620 7768  ").        if wh
+0002e610: 6963 6828 276b 7562 6563 746c 2729 2069  ich('kubectl') i
+0002e620: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0002e630: 2020 2020 636f 6d6d 6f6e 2e67 6574 5f6b      common.get_k
+0002e640: 7562 6563 746c 2829 0a20 2020 2020 2020  ubectl().       
+0002e650: 2020 2020 206f 732e 656e 7669 726f 6e5b       os.environ[
+0002e660: 2750 4154 4827 5d20 2b3d 2027 3a2e 270a  'PATH'] += ':.'.
+0002e670: 2020 2020 2020 2020 7768 696c 6520 5472          while Tr
+0002e680: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+0002e690: 7365 6c65 6374 6f72 203d 2022 216e 6f64  selector = "!nod
+0002e6a0: 652d 726f 6c65 2e6b 7562 6572 6e65 7465  e-role.kubernete
+0002e6b0: 732e 696f 2f63 6f6e 7472 6f6c 2d70 6c61  s.io/control-pla
+0002e6c0: 6e65 2c6e 6f64 652d 726f 6c65 2e6b 7562  ne,node-role.kub
+0002e6d0: 6572 6e65 7465 732e 696f 2f77 6f72 6b65  ernetes.io/worke
+0002e6e0: 7222 0a20 2020 2020 2020 2020 2020 2063  r".            c
+0002e6f0: 7572 7265 6e74 636d 6420 3d20 6622 6b75  urrentcmd = f"ku
+0002e700: 6265 6374 6c20 6765 7420 6e6f 6465 202d  bectl get node -
+0002e710: 2d73 656c 6563 746f 723d 277b 7365 6c65  -selector='{sele
+0002e720: 6374 6f72 7d27 220a 2020 2020 2020 2020  ctor}'".        
+0002e730: 2020 2020 6375 7272 656e 7463 6d64 202b      currentcmd +
+0002e740: 3d20 2220 7c20 6772 6570 2027 2052 6561  = " | grep ' Rea
+0002e750: 6479 2722 0a20 2020 2020 2020 2020 2020  dy'".           
+0002e760: 2063 7572 7265 6e74 6e6f 6465 7320 3d20   currentnodes = 
+0002e770: 6f73 2e70 6f70 656e 2863 7572 7265 6e74  os.popen(current
+0002e780: 636d 6429 2e72 6561 646c 696e 6573 2829  cmd).readlines()
+0002e790: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002e7a0: 6c65 6e28 6375 7272 656e 746e 6f64 6573  len(currentnodes
+0002e7b0: 2920 213d 2077 6f72 6b65 7273 3a0a 2020  ) != workers:.  
+0002e7c0: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+0002e7d0: 7269 6e74 2866 224f 6e67 6f69 6e67 2073  rint(f"Ongoing s
+0002e7e0: 6361 6c69 6e67 206f 7065 7261 7469 6f6e  caling operation
+0002e7f0: 206f 6e20 636c 7573 7465 7220 7b6b 7562   on cluster {kub
+0002e800: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+0002e810: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0002e820: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+0002e830: 7365 6c66 2e61 7574 6f73 6361 6c65 5f63  self.autoscale_c
+0002e840: 6c75 7374 6572 286b 7562 652c 206b 7562  luster(kube, kub
+0002e850: 6574 7970 652c 2077 6f72 6b65 7273 2c20  etype, workers, 
+0002e860: 7468 7265 7368 6f6c 642c 2069 646c 6529  threshold, idle)
+0002e870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e880: 2069 6620 7265 7375 6c74 5b27 7265 7375   if result['resu
+0002e890: 6c74 275d 2021 3d20 2773 7563 6365 7373  lt'] != 'success
+0002e8a0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+0002e8b0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0002e8c0: 7375 6c74 0a20 2020 2020 2020 2020 2020  sult.           
+0002e8d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002e8e0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0002e8f0: 6f72 6b65 7273 203d 2072 6573 756c 745b  orkers = result[
+0002e900: 2777 6f72 6b65 7273 275d 0a20 2020 2020  'workers'].     
+0002e910: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002e920: 7072 696e 7428 6622 4375 7272 656e 7420  print(f"Current 
+0002e930: 776f 726b 6572 7320 6e75 6d62 6572 2064  workers number d
+0002e940: 6573 6972 6564 3a20 7b77 6f72 6b65 7273  esired: {workers
+0002e950: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0002e960: 736c 6565 7028 3630 290a 0a20 2020 2064  sleep(60)..    d
+0002e970: 6566 2074 6872 6561 6465 645f 7765 625f  ef threaded_web_
+0002e980: 636f 6e73 6f6c 6528 7365 6c66 2c20 706f  console(self, po
+0002e990: 7274 2c20 6e61 6d65 293a 0a20 2020 2020  rt, name):.     
+0002e9a0: 2020 2063 6f6e 736f 6c65 203d 204b 6d69     console = Kmi
+0002e9b0: 6e69 636f 6e73 6f6c 6528 636f 6e66 6967  niconsole(config
+0002e9c0: 3d73 656c 662c 2070 6f72 743d 706f 7274  =self, port=port
+0002e9d0: 2c20 6e61 6d65 3d6e 616d 6529 0a20 2020  , name=name).   
+0002e9e0: 2020 2020 2063 6f6e 736f 6c65 2e72 756e       console.run
+0002e9f0: 2829 0a0a 2020 2020 6465 6620 7765 6263  ()..    def webc
+0002ea00: 6f6e 736f 6c65 2873 656c 662c 206e 616d  onsole(self, nam
+0002ea10: 6529 3a0a 2020 2020 2020 2020 706f 7274  e):.        port
+0002ea20: 203d 2067 6574 5f66 7265 655f 706f 7274   = get_free_port
+0002ea30: 2829 0a20 2020 2020 2020 2074 203d 2074  ().        t = t
+0002ea40: 6872 6561 6469 6e67 2e54 6872 6561 6428  hreading.Thread(
+0002ea50: 7461 7267 6574 3d73 656c 662e 7468 7265  target=self.thre
+0002ea60: 6164 6564 5f77 6562 5f63 6f6e 736f 6c65  aded_web_console
+0002ea70: 2c20 6172 6773 3d28 706f 7274 2c20 6e61  , args=(port, na
+0002ea80: 6d65 2c29 290a 2020 2020 2020 2020 742e  me,)).        t.
+0002ea90: 7374 6172 7428 290a 2020 2020 2020 2020  start().        
+0002eaa0: 7765 6262 726f 7773 6572 2e6f 7065 6e28  webbrowser.open(
+0002eab0: 6622 6874 7470 3a2f 2f31 3237 2e30 2e30  f"http://127.0.0
+0002eac0: 2e31 3a7b 706f 7274 7d22 2c20 6e65 773d  .1:{port}", new=
+0002ead0: 322c 2061 7574 6f72 6169 7365 3d54 7275  2, autoraise=Tru
+0002eae0: 6529 0a0a 2020 2020 6465 6620 696e 666f  e)..    def info
+0002eaf0: 5f73 7065 6369 6669 635f 656b 7328 7365  _specific_eks(se
+0002eb00: 6c66 2c20 636c 7573 7465 7229 3a0a 2020  lf, cluster):.  
+0002eb10: 2020 2020 2020 6672 6f6d 206b 7669 7274        from kvirt
+0002eb20: 2e63 6c75 7374 6572 2e65 6b73 2069 6d70  .cluster.eks imp
+0002eb30: 6f72 7420 696e 666f 2061 7320 656b 735f  ort info as eks_
+0002eb40: 696e 666f 0a20 2020 2020 2020 2072 6574  info.        ret
+0002eb50: 7572 6e20 656b 735f 696e 666f 2873 656c  urn eks_info(sel
+0002eb60: 662c 2063 6c75 7374 6572 2c20 7365 6c66  f, cluster, self
+0002eb70: 2e64 6562 7567 290a 0a20 2020 2064 6566  .debug)..    def
+0002eb80: 2069 6e66 6f5f 6b75 6265 5f65 6b73 2873   info_kube_eks(s
+0002eb90: 656c 662c 2071 7569 6574 2c20 7765 623d  elf, quiet, web=
+0002eba0: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+0002ebb0: 6672 6f6d 206b 7669 7274 2e63 6c75 7374  from kvirt.clust
+0002ebc0: 6572 2069 6d70 6f72 7420 656b 730a 2020  er import eks.  
+0002ebd0: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
+0002ebe0: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+0002ebf0: 656b 732e 6372 6561 7465 2e5f 5f63 6f64  eks.create.__cod
+0002ec00: 655f 5f2e 636f 5f66 696c 656e 616d 6529  e__.co_filename)
+0002ec10: 0a20 2020 2020 2020 2069 6e70 7574 6669  .        inputfi
+0002ec20: 6c65 203d 2066 277b 706c 616e 6469 727d  le = f'{plandir}
+0002ec30: 2f66 616b 652e 796d 6c27 0a20 2020 2020  /fake.yml'.     
+0002ec40: 2020 2073 656c 662e 696e 666f 5f70 6c61     self.info_pla
+0002ec50: 6e28 696e 7075 7466 696c 652c 2071 7569  n(inputfile, qui
+0002ec60: 6574 3d71 7569 6574 2c20 7765 623d 7765  et=quiet, web=we
+0002ec70: 6229 0a20 2020 2020 2020 2065 6b73 2e69  b).        eks.i
+0002ec80: 6e66 6f5f 7365 7276 6963 6528 7365 6c66  nfo_service(self
+0002ec90: 290a 0a20 2020 2064 6566 2069 6e66 6f5f  )..    def info_
+0002eca0: 7370 6563 6966 6963 5f67 6b65 2873 656c  specific_gke(sel
+0002ecb0: 662c 2063 6c75 7374 6572 293a 0a20 2020  f, cluster):.   
+0002ecc0: 2020 2020 2066 726f 6d20 6b76 6972 742e       from kvirt.
+0002ecd0: 636c 7574 6572 2e67 6b65 2069 6d70 6f72  cluter.gke impor
+0002ece0: 7420 696e 666f 2061 7320 676b 655f 696e  t info as gke_in
+0002ecf0: 666f 0a20 2020 2020 2020 2072 6574 7572  fo.        retur
+0002ed00: 6e20 676b 655f 696e 666f 2873 656c 662c  n gke_info(self,
+0002ed10: 2063 6c75 7374 6572 2c20 7365 6c66 2e64   cluster, self.d
+0002ed20: 6562 7567 290a 0a20 2020 2064 6566 2069  ebug)..    def i
+0002ed30: 6e66 6f5f 6b75 6265 5f67 6b65 2873 656c  nfo_kube_gke(sel
+0002ed40: 662c 2071 7569 6574 2c20 7765 623d 4661  f, quiet, web=Fa
+0002ed50: 6c73 6529 3a0a 2020 2020 2020 2020 6672  lse):.        fr
+0002ed60: 6f6d 206b 7669 7274 2e63 6c75 7374 6572  om kvirt.cluster
+0002ed70: 2069 6d70 6f72 7420 676b 650a 2020 2020   import gke.    
+0002ed80: 2020 2020 706c 616e 6469 7220 3d20 6f73      plandir = os
+0002ed90: 2e70 6174 682e 6469 726e 616d 6528 676b  .path.dirname(gk
+0002eda0: 652e 6372 6561 7465 2e5f 5f63 6f64 655f  e.create.__code_
+0002edb0: 5f2e 636f 5f66 696c 656e 616d 6529 0a20  _.co_filename). 
+0002edc0: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
+0002edd0: 203d 2066 277b 706c 616e 6469 727d 2f66   = f'{plandir}/f
+0002ede0: 616b 652e 796d 6c27 0a20 2020 2020 2020  ake.yml'.       
+0002edf0: 2073 656c 662e 696e 666f 5f70 6c61 6e28   self.info_plan(
+0002ee00: 696e 7075 7466 696c 652c 2071 7569 6574  inputfile, quiet
+0002ee10: 3d71 7569 6574 2c20 7765 623d 7765 6229  =quiet, web=web)
+0002ee20: 0a20 2020 2020 2020 2067 6b65 2e69 6e66  .        gke.inf
+0002ee30: 6f5f 7365 7276 6963 6528 7365 6c66 290a  o_service(self).
```

## kvirt/examples.py

```diff
@@ -166,14 +166,21 @@
 $ kcli console -s myvm
 """
 
 vmexport = """# Export vm myvm with a specific name for the generated image
 $ kcli export -i myimage myvm
 """
 
+kubeekscreate = """# Create a gke instance named myeks with default values
+$ kcli create kube eks myeks
+
+# Use a parameter file
+$ kcli create kube eks --paramfile=myparameters.yml myeks
+"""
+
 kubegenericcreate = """# Create a kube instance named mykube with default values
 $ kcli create kube generic mykube
 
 # Do the same but customize some parameters
 $ kcli create kube generic -P ctlplanes=1 -P workers=2 mykube
 
 # Use a parameter file
@@ -341,14 +348,22 @@
 $ kcli run workflow myworkflow -P cmds=[hostname]
 
 # Only output assets to dir without running
 $ kcli run workflow myscript.sh -do mydir
 
 """
 
+kubeeksscale = """# Scale nodes from eks cluster myeks
+$ kcli scale cluster eks -P workers=3 myeks
+
+# Alternative way to indicate workers
+$ kcli scale cluster eks --workers 3 myeks
+
+"""
+
 kubegenericscale = """# Scale workers from generic cluster myclu
 $ kcli scale cluster generic -P workers=3 myclu
 
 # Scale ctlplanes
 $ kcli scale cluster generic -P ctlplanes=3 myclu
 
 # Scale both ctlplanes and workers
```

## kvirt/providers/aws/__init__.py

```diff
@@ -1411,7 +1411,36 @@
     def delete_security_group(self, name):
         self.conn.delete_security_group(GroupName=name)
         return {'result': 'success'}
 
     def info_subnet(self, name):
         print("not implemented")
         return {}
+
+    def eks_get_network(self, netname):
+        conn = self.conn
+        vpcs = conn.describe_vpcs()
+        subnets = conn.describe_subnets()
+        if netname in [subnet['SubnetId'] for subnet in subnets['Subnets']]:
+            subnetid = netname
+            vpcid = [subnet['VpcId'] for subnet in subnets['Subnets'] if subnet['SubnetId'] == netname][0]
+        elif netname == 'default':
+            vpcid = [vpc['VpcId'] for vpc in vpcs['Vpcs'] if vpc['IsDefault']]
+            if not vpcid:
+                error("Couldn't find default vpc")
+                sys.exit(1)
+            vpcid = vpcid[0]
+            subnetid = [subnet['SubnetId'] for subnet in subnets['Subnets']
+                        if subnet['DefaultForAz'] and subnet['VpcId'] == vpcid][0]
+            pprint(f"Using subnet {subnetid} as default")
+        else:
+            vpcid = self.get_vpc_id(vpcs, netname) if not netname.startswith('vpc-') else netname
+            if vpcid is None:
+                error(f"Couldn't find vpc {netname}")
+                sys.exit(1)
+            subnetids = [subnet['SubnetId'] for subnet in subnets['Subnets'] if subnet['VpcId'] == vpcid]
+            if subnetids:
+                subnetid = subnetids[0]
+            else:
+                error(f"Couldn't find valid subnet for vpc {netname}")
+                sys.exit(1)
+        return vpcid, subnetid
```

## kvirt/version/git

```diff
@@ -1 +1 @@
-36d6fd9 2023/06/24
+0ead50d 2023/06/25
```

## Comparing `kcli-99.0.202306241558.dist-info/LICENSE` & `kcli-99.0.202306251729.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `kcli-99.0.202306241558.dist-info/METADATA` & `kcli-99.0.202306251729.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: kcli
-Version: 99.0.202306241558
+Version: 99.0.202306251729
 Summary: Provisioner/Manager for Libvirt/Vsphere/Aws/Gcp/Kubevirt/Ovirt/Openstack/IBM Cloud and containers
 Home-page: http://github.com/karmab/kcli
 Author: Karim Boumedhel
 Author-email: karimboumedhel@gmail.com
 License: ASL
 Platform: UNKNOWN
 License-File: LICENSE
```

## Comparing `kcli-99.0.202306241558.dist-info/RECORD` & `kcli-99.0.202306251729.dist-info/RECORD`

 * *Files 1% similar despite different names*

```diff
@@ -1,21 +1,25 @@
 kvirt/__init__.py,sha256=eoZ6GfifbqhMLNzjlqRDVil-yyBkOmVN9ujSgJWNBlY,15
 kvirt/baseconfig.py,sha256=SVs4GB-vHzKaa29ERsSHTDDcUUPAM3UfZ5IkP95VCb4,100420
 kvirt/bottle.py,sha256=DMuCINuwVog8XC-D6nPFVzRmo6lnJZ1H3sNK2VICKKE,171487
-kvirt/cli.py,sha256=P824PHjy1qqNbwm05X5VgbugmSEJ2PL30t08ZTHR_3I,251162
-kvirt/config.py,sha256=fZ3oP_EWRUIYANsCs7cJF_rEjaYTuVcQtTrHCkqKbmU,189470
+kvirt/cli.py,sha256=1Bo8PuEhg7iv9a51KgkMRkEPKVrTBmXYByuZWLYgzrA,253634
+kvirt/config.py,sha256=UI53xYrUGxpr6qaLiAA1fY5-CAj60JPAU8cjzEAFrUw,192064
 kvirt/containerconfig.py,sha256=Pfp1wWU1u1S6S0IT00mWFEAa8FlbTV2qrFE21_cquWA,2851
 kvirt/defaults.py,sha256=I1d1gKipNnKx6-oDP6NzDgANA6m7MrR_yQ3R5dzy_DM,11612
-kvirt/examples.py,sha256=TnmPTuz9t7DQoJYLDZTMDWjGvYhG28H6V8o7fXFfyqo,20237
+kvirt/ekstoken.py,sha256=hQqxsFLJcz4XwZLYl0-ZTUcEcsdJrh-MSuy9rN_a_24,1478
+kvirt/examples.py,sha256=fQMHbmsRqqwehMyNusMo_Je0qTL4SbIL-k8lNUpXD1Y,20615
 kvirt/ignitionmerger.py,sha256=K22COM_XqYOG28ezUJzoRjQL-jbJqpFWgm7lUwDiVbE,4333
 kvirt/keywords.yaml,sha256=HG5nGzsC2pPwWy86XQjL-UoDw_j8IIy4dVZeGIMP3k0,9871
 kvirt/klist.py,sha256=6rUa1Z7aH-Yx8MAVW-7TvB2DzteGkquBBlPQmei1p8E,3487
 kvirt/ansibleutils/__init__.py,sha256=uxy2it8uvuhDZSIlKOimpqPZtFTPsZ0AX_DLs5y7fSo,6009
 kvirt/cluster/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kvirt/cluster/sampleprovider.py,sha256=OA414n2t54Bd6EIV1K1hXpe3KndPBtRzoYTZRH5JWu4,204
+kvirt/cluster/eks/__init__.py,sha256=-Jj4BbEfpcg0Slkn5NEwDbvWABOW6nHzZp6D9fCFe7k,11371
+kvirt/cluster/eks/fake.yml,sha256=pWlbBWME2LeLtXGiYDpd6yGuHSZCrvZ9O_mUWF1Om_w,16
+kvirt/cluster/eks/kcli_default.yml,sha256=kWppGUyVLN-Lt1Ne9TNSI6R39Gn1K2qzlm6b8UUvZyo,169
 kvirt/cluster/gke/__init__.py,sha256=s721beGp-Vsa0QVSWYakoJ9vfSACdLXb57b969FtqdE,12317
 kvirt/cluster/gke/fake.yml,sha256=pWlbBWME2LeLtXGiYDpd6yGuHSZCrvZ9O_mUWF1Om_w,16
 kvirt/cluster/gke/kcli_default.yml,sha256=QfI4kP9hJJXOZChmSmGxi2wFsUAhFb7VsZBXh0upeBc,497
 kvirt/cluster/gke/kubeconfig.j2,sha256=56NOOo7asmKHB6pklx-3mhMQu_gweijjwtfwlf2Hzzc,312
 kvirt/cluster/hypershift/99-apps.yaml,sha256=nWmGvSlPFTU8roqqkO89Hd-1lDiCaMM8mp_G_f-7Epk,931
 kvirt/cluster/hypershift/99-forcedns,sha256=J53iIXocjMnmXRizQW2MiIOeg9MTqmA4xEKS6e5VXk8,694
 kvirt/cluster/hypershift/99-notifications.yaml,sha256=0Cd13fQNCOQKS7ERso7E05zUkctrtHaFzcK2jGCsl0s,1480
@@ -333,15 +337,15 @@
 kvirt/ksushy/templates/systems.json,sha256=yuSt-tgmJyxv8GN1eCr8MH2Pp5y088Scp7s-8T76YgQ,511
 kvirt/ksushy/templates/virtualmedia_cd.json,sha256=7GiCfBsFs91bBToQLTdWpynk98olFKvdDaJRacGjnWk,1219
 kvirt/ksushy/templates/virtualmedias.json,sha256=IocFk2ecKvgnzO8nyxsBhJEdU62X_KvX0m4EunVQscw,705
 kvirt/miniconsole/__init__.py,sha256=jCaDAk4Yq2fjOR_4GrnRxMq9CPLolxIJR81_hAk1eZg,2780
 kvirt/nameutils/__init__.py,sha256=bYAHswUEYVvTUXB-DsV05bjNdpbO4Tt_2Pb-nxYj0A0,3721
 kvirt/providers/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kvirt/providers/sampleprovider.py,sha256=CUYPZEk7IVQJyDMSfx7G-R9CDSsSIamNKPeptLzv-tA,9038
-kvirt/providers/aws/__init__.py,sha256=GefyylJ6o4bDjm-VOSuyBfHJwYJ8rcQsatVab4zJIYw,65930
+kvirt/providers/aws/__init__.py,sha256=OXuuT23XijzHhWr3_2zlOSbkgnch-eYZmJ0cRoDePSI,67298
 kvirt/providers/fake/__init__.py,sha256=ufPQ7JdEkz7fQAiwb-LfHwrKzBFZrpiwk-8Hh8oI_XI,479
 kvirt/providers/gcp/__init__.py,sha256=drKtxuomLk-jaGkvgCAC8legJAPbMa29Gofm7hPUl4M,74801
 kvirt/providers/gcp/gcp-hack.service,sha256=gG35O6KTLlGqIMwrSBqb_id-h3SWm_us_yLkLfQelOw,175
 kvirt/providers/gcp/gcp-hack.sh,sha256=K4ZDgWo9AoysBEMAZW3pj_5_1KmQAz0th49EqamsLVY,231
 kvirt/providers/ibm/__init__.py,sha256=eJErZ4CIDwejrru1w-dLMYrzm1SXrLgxg6w3udsGx0M,65166
 kvirt/providers/kubevirt/__init__.py,sha256=3akplzHJmP6bpYm0XHeuxnnY7YQcSYFxunUgZU9dWeo,81078
 kvirt/providers/kvm/__init__.py,sha256=F3DPtp-wel1OkAi48LIpcc3AT6JGnMkJp7IlQmnk3II,185506
@@ -350,15 +354,15 @@
 kvirt/providers/ovirt/__init__.py,sha256=SYfwN7vgif_SYn6L5CPqepWS7v5JYrw2aG2StSCU6qA,62662
 kvirt/providers/packet/__init__.py,sha256=z71vF3yFtt36u2xcIlDdpLtQ0Tvv30acFyllwPZ2qOo,31230
 kvirt/providers/vsphere/__init__.py,sha256=-Yap7VbRjUjWI9mrvDnvGks5rW37UolJl7_wphBsnck,73215
 kvirt/providers/vsphere/helpers.py,sha256=F1rB_AHISd8TFYQ6eRolQmCVqU8KFAa36CCwjDj-vqw,13655
 kvirt/providers/vsphere/tagging.py,sha256=7RqFIUETSzHAjS0F_8-j145-_8lca7aDUsCxs4DhQVQ,4893
 kvirt/providers/web/__init__.py,sha256=5fTs7xbQ2TT9uCUp6TtYWQVl6ywsB-efH7_PgX1wrZI,21420
 kvirt/version/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-kvirt/version/git,sha256=eGm-RWATJdDYkgsP29qLIKribDG50pDXz2IVoogWdLk,19
+kvirt/version/git,sha256=QmHoyuS2A9G4h_jFxzI8UGnOJTVO2oAIQGtCf9c9PWs,19
 kvirt/web/__init__.py,sha256=mz6UtxtapEZzgWy-6KWw5pwNQUhUxWyHqFOh1HUlQZk,46652
 kvirt/web/main.py,sha256=DIb6tW3ce7wCc83kD9HBCG4ALJuLItp9uaP6tzdsm_Y,261
 kvirt/web/static/css/bootstrap-notify.css,sha256=ibUTW-jDj-F8d1T1KZ4DOujRmVTFfvMKL9y14QgEaPQ,408
 kvirt/web/static/css/bootstrap-theme.min.css,sha256=ZT4HPpdCOt2lvDkXokHuhJfdOKSPFLzeAJik5U_Q-l4,23409
 kvirt/web/static/css/bootstrap.min.css,sha256=E-dwlJxOS7dOrKCvR-5WCqiHCbIHLl59MMDVsfU4oiU,121125
 kvirt/web/static/css/dataTables.checkboxes.css,sha256=H-x4lWeyX3jMsghnkCUUTO2lXjRpJ8pxhUj3YAqaBrQ,399
 kvirt/web/static/css/jquery.dataTables.min.css,sha256=-Z1rYa3ys5OdZNUck5G7lBvb8A13OrYwvf-d8PfEaHQ,13587
@@ -592,13 +596,13 @@
 kvirt/web/templates/repos.html,sha256=HaFCTQjX3zSaqyV05Y_wG0vSkOWDpc-wj6Uj5TLbiFg,475
 kvirt/web/templates/repostable.html,sha256=6HH8sgdppR-yojQspdcI59ju4e9HZYVvV6uvnPxqbeo,1203
 kvirt/web/templates/vmcreate.html,sha256=FG3OoQEKTpeo8spJ1WiqYVkOp672saYRQKujNWOA3uQ,958
 kvirt/web/templates/vmprofiles.html,sha256=T65Cv7povhBtD2dyuWkWJE6byaA9EYtLSk5gtcQlHIU,486
 kvirt/web/templates/vmprofilestable.html,sha256=-8viNOqSvN_yzimENxq7Q0187zbflOn8p8zpgx0Vyek,1420
 kvirt/web/templates/vms.html,sha256=k2ptKeiLFdpzgfbk6xi__sduu0UALYXXrnrmDEmAfaQ,470
 kvirt/web/templates/vmstable.html,sha256=ikuYkIm_ocvGIBXFyJt1-tBjwQWCyqkgC08leoXgR54,4894
-kcli-99.0.202306241558.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
-kcli-99.0.202306241558.dist-info/METADATA,sha256=vtNsXFXKunqloy-uTjAdJFu1x8IX95lcZElDbqPBKQo,3024
-kcli-99.0.202306241558.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-kcli-99.0.202306241558.dist-info/entry_points.txt,sha256=Rks05_15yZkzTe2QTbrkV_O8uruW_WjUDzmfMApHUvw,209
-kcli-99.0.202306241558.dist-info/top_level.txt,sha256=FwVTxtMIWdr8QBk5mTfd0f_GheFlRR_vn4zl6p5N57s,6
-kcli-99.0.202306241558.dist-info/RECORD,,
+kcli-99.0.202306251729.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
+kcli-99.0.202306251729.dist-info/METADATA,sha256=BHhCtaIviig3yskGfPhPTpZjQTCjxAP8onjxX8uPy4c,3024
+kcli-99.0.202306251729.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+kcli-99.0.202306251729.dist-info/entry_points.txt,sha256=yoSDPiSjlySMdlW6ygbl7w1y1_rPj07ythkDRfEpDBo,245
+kcli-99.0.202306251729.dist-info/top_level.txt,sha256=FwVTxtMIWdr8QBk5mTfd0f_GheFlRR_vn4zl6p5N57s,6
+kcli-99.0.202306251729.dist-info/RECORD,,
```

